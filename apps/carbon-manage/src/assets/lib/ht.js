!function(t,e,i){"use strict";function n(){this.el=[1,0,0,0,1,0,0,0,1]}function r(t){var e={};return{get:function(n){if(e[n]!==i)return e[n];var r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":r=t.getExtension("WEBGL_compressed_texture_etc1");break;default:r=t.getExtension(n)}return e[n]=r,r}}}function o(t,e,n){function r(){if(a!==i)return a;var n=e.get("EXT_texture_filter_anisotropic");return a=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function o(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var a;n=n||{};var s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,l=n.precision!==i?n.precision:"highp",c=o(l);c!==l&&(console.warn("WebGL:",l,"not supported, using",c,"instead."),l=c);var h=!0===n.logarithmicDepthBuffer,u=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),f=t.getParameter(t.MAX_TEXTURE_SIZE),g=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),p=t.getParameter(t.MAX_VERTEX_ATTRIBS),v=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),_=t.getParameter(t.MAX_VARYING_VECTORS),y=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),m=d>0,b=s||!!e.get("OES_texture_float"),x=m&&b,w=s?t.getParameter(t.MAX_SAMPLES):0;return{getMaxAnisotropy:r,getMaxPrecision:o,precision:l,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:g,maxAttributes:p,maxVertexUniforms:v,maxVaryings:_,maxFragmentUniforms:y,vertexTextures:m,floatFragmentTextures:b,floatVertexTextures:x,maxSamples:w}}var a="ht";if(!t[a]){!function(){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),t.performance&&t.performance.now||function(){var e=Date.now();t.performance||(t.performance={}),t.performance.now=function(){return Date.now()-e}}();for(var n=Date.now(),r=16,o=["ms","moz","webkit","o"],a=0;a<o.length&&!t.requestAnimationFrame;++a)t.requestAnimationFrame=t[o[a]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[o[a]+"CancelAnimationFrame"]||t[o[a]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(e){var i=Date.now(),o=r+n-i;return 0>o&&(o=0),n=i,t.setTimeout((function(){n=Date.now(),e(performance.now())}),o)}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(e){return t.clearTimeout(e)}),e.assign===i&&(e.assign=function(t){if(t===i||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var n=e(t),r=1;r<arguments.length;r++){var o=arguments[r];if(o!==i&&null!==o)for(var a in o)e.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])}return n})}();var s=t.document,l=null,c=t[a]={},h=t[a+"config"],u=c.Default=h&&h.Default||{},d=c.Style=h&&h.Style||{},f=c.Attr=h&&h.Attr||{},g=c.Color=h&&h.Color||{},p=c.IsGetter=h&&h.IsGetter||{};!function(){var n=!1;try{var r=e.defineProperty({},"passive",{get:function(){return n=!0,i}});t.addEventListener("test",r,r),t.removeEventListener("test",r,r)}catch(S){n=!1}u.passiveSupported=n}();var v,_,y,m=u.passiveSupported,b=u.eventListenerOptionsFalse=!!m&&{passive:!1,capture:!1},x=u.eventListenerOptionsTrue=!m||{passive:!1,capture:!0},w=function(t,e,i,n){t.addEventListener(e,i,n?x:b)},C=function(t,e,i,n){t.removeEventListener(e,i,n?x:b)},S=Math,I=S.round,M=S.floor,T=S.ceil,E=S.sqrt,P=S.max,D=S.min,O=S.abs,R=S.cos,z=S.acos,k=S.sin,A=S.pow,V=S.asin,B=S.exp,L=S.PI,F=2*L,j=L/2,H=S.tan,G=S.atan2,U=S.random,W=S.log,N=!1,q=!1,X=t.parseInt||global.parseInt,Q="2021-9-15",Y=!!t.navigator&&t.navigator.platform.indexOf("Win")>-1,Z=function(t){return t*t},J=t.setTimeout,K=t.clearTimeout,$=t.location,tt=t.navigator?t.navigator.userAgent.toLowerCase():"",et=function(t){return t.test(tt)},it=et(/msie/),nt=et(/msie/)||et(/trident/),rt=et(/msie 10/),ot=et(/edge/),at=et(/firefox/),st=et(/mac/),lt=u.isTouchable===i?!Y&&(!!s&&"ontouchend"in s):u.isTouchable,ct="default",ht="single",ut="multiple",dt="front",ft="back",gt="left",pt="right",vt="top",_t="bottom",yt="center",mt="eye",bt="middle",xt="east",wt="west",Ct="north",St="none",It="px",Mt="absolute",Tt="border",Et="triangle",Pt="rect",Dt="circle",Ot="cylinder",Rt="shape",zt="items",kt="normal",At="remove",Vt="clear",Bt="width",Lt="height",Ft="ingroup",jt="check",Ht="uncheck",Gt="radio",Ut="radioOn",Wt="radioOff",Nt="points",qt="values",Xt="series",Qt="body",Yt="label",Zt="label2",Jt="note",Kt="note2",$t="icons",te="labelFont",ee="labelColor",ie="labelSelectColor",ne="note.expanded",re="note2.expanded",oe="edge.expanded",ae="edge.points",se="edge.type",le="rotation",ce="hidden",he="visible",ue="tuv",de="no",fe="draw",ge="select",pe="currentSubGraph",ve="selectBackground",_e="autoMakeVisible",ye="autoHideScrollBar",me="scrollBarColor",be="scrollBarSize",xe="indent",we="rowHeight",Ce="columnLineColor",Se="rowLineColor",Ie="columnLineVisible",Me="rowLineVisible",Te="visibleFunc",Ee="expandIcon",Pe="collapseIcon",De="checkMode",Oe="sortFunc",Re="editable",ze="batchEditable",ke="tristate",Ae="asc",Ve="desc",Be="position",Le="elevation",Fe="children",je="translateX",He="translateY",Ge="dataModel",Ue="maxSize",We="state",Ne="shape3d",qe="shape3d.resolution",Xe="shape3d.visible",Qe="shape3d.from.visible",Ye="shape3d.to.visible",Ze="shape3d.top.visible",Je="shape3d.bottom.visible",Ke="repeat.uv.length",$e="serializeValue",ti="deserializeValue",ei="centerUniform",ii="uniform",ni="rgba(255,255,255,0)",ri="style",oi="attr",ai="field",si="string",li="boolean",ci="color",hi="int",ui="number",di="ew-resize",fi="ns-resize",gi="pointer",pi="auto",vi="mousedown",_i="mousemove",yi="mouseup",mi="mouseout",bi="touchstart",xi="touchmove",wi="touchend",Ci="keydown",Si="keyup",Ii=["DOMMouseScroll","mousewheel"],Mi=at?Ii[0]:Ii[1],Ti=[bi,xi,wi],Ei=[vi,_i,yi,mi,Mi,"wheel","mouseenter","mouseleave","mouseover"],Pi=[Ci,Si,"keypress","input","contextmenu","compositionstart","compositionupdate","compositionend"],Di=lt?Ti.concat(Pi):Ei.concat(Pi),Oi=l,Ri=l,zi=l,ki=yi.length,Ai=function(){zi&&(K(zi.timeout),zi=l)},Vi=function(){zi&&ls(zi.e,zi.info)};t.addEventListener&&(lt||(w(t,mi,(function(){Ai()})),w(t,Mi,(function(){cs()}))),w(t,Si,(function(t){91===t.keyCode?Zi={}:delete Zi[t.keyCode]}),!0),w(t,Ci,(function(t){Zi[t.keyCode]=!0}),!0),w(t,"blur",(function(){Zi={}})));var Bi,Li,Fi,ji=0,Hi=l,Gi=function(t,e){var i=J((function(){delete Hi[i],$n(Hi)&&(Hi=l),t()}),e);return i},Ui=l,Wi=l,Ni={},qi={},Xi={},Qi={},Yi={},Zi={},Ji={},Ki={},$i={},tn={},en=/.json$/,nn=/^data:image\/svg\+xml/,rn={},on=[],an={},sn=l,ln=function(){},cn=function(){throw"Oops!"},hn=[0,0,0],un={x:0,y:0,width:0,height:0},dn=l,fn=l,gn=l,pn=function(t,e){qi[t]=e,e&&e.comps&&!e.uuid&&(e.uuid=c.Math.generateUUID()),$c[t]&&(e.cacheRule=$c[t],delete $c[t])},vn=function(t){fn&&!t._72O&&(gn||(gn={}),gn[t._72O=Bs()]=t),Bi!=l?rr()<.05&&y&&!Li&&(Ar=Ai):Ar=zn},_n=function(t,e,i,n){fn||(fn={});var r=fn[t];if(r){if(r.url===e)return;r.image?(r.image.onload=ln,r.image.onerror=ln):r.request&&(r.request.onload=ln,r.request.onerror=ln)}if(en.test(e)){var o=new wu;if(fn[t]={request:o,url:e},e=u.beforeLoadURL(e,t),e.data){var a=u.parse(e.data);yn(t,a),u.handleImageLoaded(t,a)}else{o.onload=function(){if(200===this.status||0===this.status){var i=u.parse(o.getResponseText());yn(t,i),u.handleImageLoaded(t,i)}else yn(t,u.handleUnfoundImage(t,e)||l)},o.onerror=function(){yn(t,u.handleUnfoundImage(t,e)||l)};var c={};c.url=encodeURI(e),c.sync=!1,o.send(c)}}else{a=new Image;fn[t]={image:a,url:e},/^data:image/.test(e)||(e=u.beforeLoadURL(e,t),e=u.appendTimeStamp(e),e=encodeURI(e),a.crossOrigin=u.crossOrigin),u.convertImageSrc(e,(function(r){nt&&(e.toLowerCase().indexOf(".svg")>0||nn.test(e))?(s.body.appendChild(a),a.style.visibility="hidden",a.onload=function(){J((function(){if(i&&(a.width=i),n&&(a.height=n),!a.width||!a.height){var e=a.width||a.clientWidth,r=a.height||a.clientHeight;a.width=e,a.height=r}u.handleImageLoaded(t,a),yn(t,a),s.body.removeChild(a),a.style.visibility=""}),180)},a.onerror=function(){yn(t,u.handleUnfoundImage(t,e)||l),s.body.removeChild(a),a.style.visibility=""}):(a.onload=function(){i&&(a.width=i),n&&(a.height=n),u.handleImageLoaded(t,a),yn(t,a)},a.onerror=function(){yn(t,u.handleUnfoundImage(t,e)||l)}),a.src=r}))}},yn=function(t,e){if(pn(t,e),delete fn[t],$n(fn)&&(fn=l,gn)){for(var n in gn){var r=gn[n];r._2O&&r._2O[t]&&(r.deleteTexture(t),delete r._2O[t]),r.invalidateAll&&r.invalidateAll(i,"imageLoaded",t),r.redraw&&r.redraw(),r.iv(),delete r._72O}gn=l}if(e&&gn)for(var n in gn){r=gn[n];r.invalidateAll&&r.invalidateAll(i,"imageLoading",t),r.redraw&&r.redraw(),r.iv()}},mn=function(){return W=S&&Date,function(){return t.performance&&t.performance.now?t.performance.now():Date.now()}}(),bn=function(t,e,i){return{width:t,height:e,comps:Vn(i)?i:[i]}},xn=function(t,e){return{type:Dt,rect:[t,e,1.6,1.6],borderWidth:1,borderColor:wa,gradient:ss,gradientColor:Ca,background:wa}},wn=function(t,e){return bn(16,16,{type:Et,rect:[4,4,10,8],background:t,rotation:e?1.57:3.14})},Cn=function(t,e){return bn(16,16,{type:Et,rect:[4,4,8,7],background:t,rotation:e?3.14:0})},Sn=function(t){var e=t._orientation;return"horizontal"===e||"h"===e},In=function(t,e){var i=l||4,n=l||1,r=l||1;0>i?i=0:i>.25&&(i=.25);var o,a,s,c,h,u,d,f=.5,g=[],p=[],v=[],_=F/r,y=F/n,m=f-i;for(a=0;n>=a;a++)for(c=a*y-L,u=R(c),h=k(c),o=0;r>=o;o++)s=o*_,d=m+i*u,g.push(R(s)*d,h*i,-k(s)*d),[t,e]&&p.push(o/r,1-a/n);for(a=0;n>a;a++){var b=a*(r+1),x=(a+1)*(r+1);for(o=0;r>o;o++)v.push(b+o,x+o+1,x+o,b+o,b+o+1,x+o+1),dr.z=Do.z=[t,e]}},Mn=function(t){var e=2,i=0;for(var n in t)n.length===e&&X(n,32)===no&&(sn=t[n]),i++;return i},Tn=function(t,e,i,n){return i||(i=lt?5:3,i/=n||1),{x:t-i,y:e-i,width:2*i,height:2*i}},En=function(e,i,n,r){var o=this;i||(i=lt?5:3,n=20,r=20);var a={x:e,y:i,width:n,height:r};if(n)for(var s=0;n>s;s++)if(3===n)r=20;else for(var l=0;r>l;l++)o=t||n;var c={x:L,y:2*L};if(al(a,c)){var h=Lt[0]+vt[0]+Vt[1]+Ae.length,u=ce[0]+ke[0]+Vt[1]+Qt.length;Io[mt]=[o[h],o[u]],o[h]=Dn[mt],o[u]=Dn[Ne]}},Pn=function(t){return(/ble$/.test(t)||/ed$/.test(t)||p[t]?"is":"get")+t.charAt(0).toUpperCase()+t.slice(1)},Dn=function(t){return"set"+t.charAt(0).toUpperCase()+t.slice(1)},On=function(t){return typeof t===si||t instanceof String},Rn=function(t){return typeof t===ui},zn=function(t){return typeof t===li},kn=function(t){return t&&"object"==typeof t},An=function(t){return"function"==typeof t},Vn=function(t){return t instanceof Array},Bn=function(t){return t instanceof gc},Ln=function(t){return Vn(t)?new gc(t):t},Fn=function(t){return t instanceof ru},jn=function(t){return t instanceof hu},Hn=function(t){return t instanceof uu},Gn=function(t,e){if(!(t instanceof c.Group))return!1;if(!e)return t.isExpanded();var i=e.getDataUI(t);return!(!i||!i._88I)},Un=function(t){return t instanceof du},Wn=function(t){return t&&"IFRAME"===t.tagName},Nn=function(t){return t==l||u.numberDigits==l?t:parseFloat(t.toFixed(u.numberDigits))},qn=function(t,e,i){var n,r=e.length;if(i)for(var o=0;i>o;o++)if(3===r)t.push(e[0]),t.push(e[1]),t.push(e[2]);else for(n=0;r>n;n++)t.push(e[n]);else if(3===r)t.push(e[0]),t.push(e[1]),t.push(e[2]);else for(n=0;r>n;n++)t.push(e[n])},Xn=function(t){return!!t&&(kn(t)?t:{})},Qn=function(t,e,n){var r,o=kn(t)?t:t.prototype;for(r in e)n&&r in o?o[r]===i&&console.warn("class",o,"has own undefined property",r,", keep exist!"):o[r]=e[r];return t},Yn=function(t,e){if(!("wheelDelta"in e)){var i=e.deltaMode;e.wheelDelta=i===e.DOM_DELTA_PIXEL?-e.deltaY:i===e.DOM_DELTA_LINE?40*-e.deltaY:120*-e.deltaY}t.handle_mousewheel(e)},Zn=function(t){return String.fromCharCode(t)},Jn=function(t){for(var e,i=0,n="";i<t.length;i++)e=t[t.length-1-i],"%"===e?e="'":"a"===e?e='"':"]"===e&&(e="\\"),n+=Zn(e.charCodeAt(0)-1);return n},Kn=function(t,e,i){t.superClass.constructor.apply(e,i)},$n=function(t){for(var e in t)return!1;return!0},tr=function(t){return!t||0===t.length},er=function(){var t="";return[Ht[0],Se[0],Yt[0]].forEach((function(e){t+=Dn(e).slice(3)})),ii=s&&s[t]||ei,function(t,e){return t===e||t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}}(),ir=function(t,e,i){return e>t?e:t>i?i:t},nr=function(t){return 0>t?-1:t>0?1:0},rr=function(){var t=1e4*k(ki++);return t-M(t)},or=function(t,e,i){return ar(t.x,t.y,e.x,e.y,i.x,i.y,i.x+i.width,i.y,!0)||ar(t.x,t.y,e.x,e.y,i.x+i.width,i.y,i.x+i.width,i.y+i.height,!0)||ar(t.x,t.y,e.x,e.y,i.x+i.width,i.y+i.height,i.x,i.y+i.height,!0)||ar(t.x,t.y,e.x,e.y,i.x,i.y+i.height,i.x,i.y,!0)},ar=function(t,e,i,n,r,o,a,s,c){var h=(a-r)*(e-o)-(s-o)*(t-r),u=(s-o)*(i-t)-(a-r)*(n-e);if(0!==u){var d=h/u,f=t+d*(i-t),g=e+d*(n-e);return c&&(f+Cl<D(t,i)||f-Cl>P(t,i)||f+Cl<D(r,a)||f-Cl>P(r,a)||g+Cl<D(e,n)||g-Cl>P(e,n)||g+Cl<D(o,s)||g-Cl>P(o,s))?l:[f,g]}return l},sr=function(t,e,n){if(t&&n)if(e){if(e===ri)return t.getStyle(n);if(e===oi)return t.getAttr(n);if(e===ai)return t[n]}else if(n=Pn(n),t[n])return t[n]();return i},lr=function(t,e,i,n){if(t&&i)if(e){if(e===ri)t.s(i,n);else if(e===oi)t.a(i,n);else if(e===ai){var r=t[i];t[i]=n,t.fp("f:"+i,r,n)}}else i=Dn(i),t[i]&&t[i](n)},cr=function(t,e,i){return e&&"top"!==e?"bottom"===e?{x:t.x,y:t.y,width:t.width,height:t.height*i}:"right"===e?{x:t.x,y:t.y,width:t.width*i,height:t.height}:"left"===e?{x:t.x+t.width*(1-i),y:t.y,width:t.width*i,height:t.height}:void 0:{x:t.x,y:t.y+t.height*(1-i),width:t.width,height:t.height*i}},hr=function(t,e,i,n,r){e&&Ao(t,i,n,1,r,e)},ur=function(t,e,i,n){var r=1-t;return r*r*e+2*t*r*i+t*t*n},dr=function(t,e,i,n,r){var o=1-t;return o*o*o*e+3*o*o*t*i+3*o*t*t*n+t*t*t*r},fr=function(t){var e,i,n,r,o=0;return t.forEach((function(t){if(e=t.length,e>0)for(i=t[0],r=1;e>r;r++)n=t[r],o+=nl(i,n),i=n})),o},gr=function(t,e,i){var n="__"+t,r=function(e){i.disabled||i["handle_"+t](e)};i[n]||(i[n]=r,w(e,t,r))},pr=function(t,e,i){var n="__"+t,r=i[n];r&&(C(e,t,r),delete i[n])},vr=function(t,e){var i="_"+e;t[Pn(e)]=function(){return this[i]},t[Dn(e)]=function(t){var n=this[i];this[i]=t,this.fp(e,n,t)}},_r=function(t){return e.create(t)},yr=function(t){var e,i;t.element||((e=t.textField)?i=Ds(Uv.TextField,e):(e=t.textArea)?i=Ds(Uv.TextArea,e):(e=t.button)?i=Ds(Uv.Button,e):(e=t.comboBox)?i=Ds(Uv.ComboBox,e):(e=t.checkBox)?i=Ds(Uv.CheckBox,e):(e=t.radioButton)?i=Ds(Uv.RadioButton,e):(e=t.slider)?i=Ds(Uv.Slider,e):(e=t.colorPicker)?i=Ds(Uv.ColorPicker,e):(e=t.image)&&(i=Ds(Uv.Image,e)),i&&(t.element=i))},mr=function(t,e){var i=xr(t);return i._ht=e,i},br=t.top===t?t.top:t||t.document,xr=function(t,e){var i=s.createElement("div"),n=i.style;return i.tabIndex=-1,i.onkeydown=Os,n.msTouchAction=St,Cr(i,l,0),lt&&n.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",l),t&&(n.overflow=ce),e&&Mr(e,i),i},wr=function(t,e){var i=s.createElement("canvas"),n=i.style;return n.msTouchAction=St,e||(n.pointerEvents=St),Cr(i,l,0),t&&Mr(t,i),i},Cr=function(t,e,i){var n=t.style;n.border=e?e+" solid 1px":0,n.outline=0,n.padding=i?"0 "+i+It:0,Sr(t)},Sr=function(t){var e=t.style;e.position=Mt,e.margin=0,e.setProperty("box-sizing","border-box",l),e.setProperty("-moz-box-sizing","border-box",l)},Ir=function(t,e,i,n){n||(n=rs),e!=l&&(t.width=e*n,t.style.width=e+It),i!=l&&(t.height=i*n,t.style.height=i+It)},Mr=function(t,e,i){t.appendChild(e),i&&(e.style.position=Mt)},Tr=function(t,e){e.split||(e+="");for(var i,n=e.split("\n"),r=0,o=n.length,a=0;o>a;a++){var s=Xs(t.font,n[a]);s.width>r&&(r=s.width),i||(i=s.height)}return t.ss=n,{width:r,height:i*o}},Er=function(t,e,i,n,r,o){var a=e.length;if(1===a)Pr(t,e[0],i,n,r);else for(var s=i.height/a,l={x:i.x,y:i.y,width:i.width,height:s},c=0;c<e.length;c++)o?qs(t,e[c],n,r,l.x,l.y,l.width,l.height,o):Pr(t,e[c],l,n,r),l.y+=s},Pr=function(t,e,n,r,o){var a,s;t.font=r||ps,t.fillStyle=o||fs,t.textAlign=yt,t.textBaseline=bt,n?n.width===i?(a=n.x,s=n.y):(a=n.x+n.width/2,s=n.y+n.height/2):(a=0,s=0),t.fillText(e,I(a),I(s))},Dr=function(t){t.getView&&(t=t.getView());var e=t.offsetWidth||t.scrollWidth;return!e&&t.style.width&&(e=X(t.style.width)),e},Or=function(t){t.getView&&(t=t.getView());var e=t.offsetHeight||t.scrollHeight;return!e&&t.style.height&&(e=X(t.style.height)),e},Rr=function(t,e,i){var n=e[0].toUpperCase()+e.substring(1,e.length);t["webkit"+n]=i,t["moz"+n]=i,t["ms"+n]=i,t["o"+n]=i,t[e]=i},zr=function(){var t=function(t){Os(t),t.stopPropagation()},e=function(t){Os(t)},i=[bi,Ci,vi];return function(n,r){var o=xr(),a=o.style;return a.backgroundColor=u.disabledBackground,n&&(a.backgroundImage="url("+n+")",a.backgroundPosition="50% 50%",a.backgroundRepeat="no-repeat no-repeat"),!1===r?i.forEach((function(t){w(o,t,e)})):i.forEach((function(e){w(o,e,t)})),o}}(),kr=function(t){var e=t.getContext("2d");return e.save(),e.lineCap=us,e.lineJoin=ds,e},Ar=function(t,e,i,n){Vr(t,e*rs,i*rs),n*=rs,1!==n&&t.scale(n,n)},Vr=function(t,e,i){t.translate(e,i)},Br=function(t,e){e&&t.rotate(e)},Lr=function(t,e,n){e===i&&(e=1),n===i&&(n=1),(1!==e||1!==n)&&t.scale(e,n)},Fr=!1,jr=(B=br[jt[1]+je[0]],function(e){var i=s.activeElement;if(s.activeElement!==e){i&&i.forceOnblur&&i.forceOnblur();for(var n=[],r=e.parentNode;r;)n.push([r,r.scrollLeft,r.scrollTop]),r=r.parentNode;if(!Fr){var o=[],a=[];try{for(var l=t.parent,c=t;l!==c;)o.push([l,l.scrollX,l.scrollY]),c=l,l=t.parent;var h=t.frameElement;if(h)for(var u=h.parentNode;u;)a.push([u,u.scrollLeft,u.scrollTop]),u=u.parentNode}catch(d){Fr=!0}}if(lt)e.focus();else{var f=hl(),g=f.target;e.focus(),g.scrollLeft=f.left,g.scrollTop=f.top}n.forEach((function(t){t[0].scrollLeft=t[1],t[0].scrollTop=t[2]})),Fr||(o.forEach((function(t){t[0].scrollTo(t[1],t[2])})),a.forEach((function(t){t[0].scrollLeft=t[1],t[0].scrollTop=t[2]})))}}),Hr=function(t){return t&&t.getView?t.getView():t},Gr=function(t,e,n,r,o){if(2===arguments.length&&(n=e.y,r=e.width,o=e.height,e=e.x),t.isSelfViewEvent)t.setX(e),t.setY(n),t.setWidth(r),t.setHeight(o);else{var a=Hr(t),l=a.style;if((s.fullscreenElement||s.mozFullScreenElement||s.webkitFullscreenElement||s.msFullscreenElement)!==a)e!==i&&(l.left=e+It),n!==i&&(l.top=n+It),r!==i&&(l.width=r+It),o!==i&&(l.height=o+It);else{var c=u.getWindowInfo();l.left=(e=c.left)+It,l.top=(n=c.top)+It,l.width=(r=c.width)+It,l.height=(o=c.height)+It}t.endEditing&&!lt&&t.endEditing(),t.redraw&&t.redraw(),t.invalidate&&t.invalidate(),t.onLayouted&&t.onLayouted(e,n,r,o),t.fireViewEvent&&t.fireViewEvent("layout")}},Ur=function(t){if(!t.touches)return t;var e=t.touches[0];return e||t.changedTouches[0]},Wr=function(t){return Nr(t)?Ur(t).target:t.target},Nr=function(t){return"touches"in t},qr=function(t){u.popup&&u.popup.close(),u.popup=t},Xr=l,Qr=function(t){Xr.handleWindowTouchMove(t)},Yr=function(e){Xr.handleWindowTouchEnd(e),C(t,xi,Qr),C(t,wi,Yr),Xr=l},Zr=function(t){Xr.handleWindowMouseMove(t)},Jr=function(e){Xr.handleWindowMouseUp(e),C(t,_i,Zr),C(t,yi,Jr),Xr=l},Kr=function(t){return 1===Js(t)},$r=function(t,e){return e?e.keyCode===t:Zi[t]},to=function(t){return tl(t)&&$r(65,t)},eo=function(t){return $r(46,t)||$r(8,t)},io=function(t){return function(e){return e?e.keyCode===t:Zi[t]}},no=573,ro=[65,83,68,87,37,38,39,40,32,13,27],oo=io(ro[0]),ao=io(ro[1]),so=io(ro[2]),lo=io(ro[3]),co=io(ro[4]),ho=io(ro[5]),uo=io(ro[6]),fo=io(ro[7]),go=io(ro[8]),po=io(ro[9]),vo=io(ro[10]),_o={65:1,83:1,68:1,87:1,37:1,38:1,39:1,40:1},yo=[2,2,2,2,2,2,2,2,2,2,2,3,3,5,5,5,5,5,28051],mo=l,bo=l,xo=function(t,e){mo||(mo=wr()),Ir(mo,t,e,1);var i=kr(mo);return i.clearRect(0,0,t,e),i},wo=function(){var e,i={};for(var n in t){var r=ut.length;if(n.length==r&&n[0]===ut[2]&&n[1]===St[1]&&n[4]===ut[3]&&n[5]===ut[4]&&n.substr(r-2)===St[1]+St[2]){var o=t[n];for(var a in o)a.length===r&&a.substr(0,3)===pt[3]+At[3]+ge[0]&&a.substr(r-2)===ut[0]+Jt[3]&&(Ii=o[a])}}return function(t){var n,r=i[t];return r||(e||(e=wr(),Ir(e,1,1,1)),n=e.getContext("2d"),n.clearRect(0,0,1,1),Ao(n,0,0,1,1,t),r=n.getImageData(0,0,1,1).data,r=i[t]=[r[0],r[1],r[2],r[3]]),r}}(),Co=function(t){if(!On(t))return t;var e=wo(t);return e.CA||(e.CA=[e[0]/255,e[1]/255,e[2]/255,e[3]/255]),e.CA},So=function(t,e,i,n,r){var o=wr();o.width=i,o.height=n;var a=o.getContext("2d");a.drawImage(t,0,0,i,n);try{for(var s=a.getImageData(0,0,i,n),l=s.data,c=0,h=l.length;h>c;c+=4){var u=l[c+0],d=l[c+1],f=l[c+2],g=l[c+3];"override_a"===r?l[c+3]=255*e[3]:"override_rgb"===r?(l[c+0]=255*e[0],l[c+1]=255*e[1],l[c+2]=255*e[2]):"override"===r?(l[c+0]=255*e[0],l[c+1]=255*e[1],l[c+2]=255*e[2],l[c+3]=255*e[3]):(l[c+0]=e[0]*u,l[c+1]=e[1]*d,l[c+2]=e[2]*f,l[c+3]=e[3]*g)}a.putImageData(s,0,0)}catch(Z){return t}return o},Io=function(t,e,i){return e&&(e="miter"===i?8*e+20:e+1,t&&ul(t,e)),e},Mo=function(t,e){if(e){var i=new Ga(e),n=t.width/2,r=t.height/2,o=rl([i.tf(-n,-r),i.tf(n,-r),i.tf(n,r),i.tf(-n,r)]);return o.x+=t.x+n,o.y+=t.y+r,o}return t},To=function(t,e,i,n,r,o,a,s){n*=Math.PI/180;var l={x:Math.cos(n)*(t.x-a.x)/2+Math.sin(n)*(t.y-a.y)/2,y:-Math.sin(n)*(t.x-a.x)/2+Math.cos(n)*(t.y-a.y)/2},c=Math.pow(l.x,2)/Math.pow(e,2)+Math.pow(l.y,2)/Math.pow(i,2);c>1&&(e*=Math.sqrt(c),i*=Math.sqrt(c));var h=(r==o?-1:1)*Math.sqrt((Math.pow(e,2)*Math.pow(i,2)-Math.pow(e,2)*Math.pow(l.y,2)-Math.pow(i,2)*Math.pow(l.x,2))/(Math.pow(e,2)*Math.pow(l.y,2)+Math.pow(i,2)*Math.pow(l.x,2)));isNaN(h)&&(h=0);var u={x:h*e*l.y/i,y:h*-i*l.x/e},d={x:(t.x+a.x)/2+Math.cos(n)*u.x-Math.sin(n)*u.y,y:(t.y+a.y)/2+Math.sin(n)*u.x+Math.cos(n)*u.y},f=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},g=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(f(t)*f(e))},p=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(g(t,e))},v=p([1,0],[(l.x-u.x)/e,(l.y-u.y)/i]),_=[(l.x-u.x)/e,(l.y-u.y)/i],y=[(-l.x-u.x)/e,(-l.y-u.y)/i],m=p(_,y);g(_,y)<=-1&&(m=Math.PI),g(_,y)>=1&&(m=0);g=e>i?e:i;var b=e>i?1:e/i,x=e>i?i/e:1;if(null==s){var w={x:0,y:0,width:0,height:0};ul(w,g),w.x*=b,w.width*=b,w.y*=x,w.height*=x;var C=new Ga(n);return w=rl([C.tf(w.x,w.y),C.tf(w.x+w.width,w.y),C.tf(w.x+w.width,w.y+w.height),C.tf(w.x,w.y+w.height)]),w.x+=d.x,w.y+=d.y,[{x:w.x,y:w.y},{x:w.x+w.width,y:w.y},{x:w.x+w.width,y:w.y+w.height},{x:w.x,y:w.y+w.height}]}s.translate(d.x,d.y),s.rotate(n),s.scale(b,x),s.arc(0,0,g,v,v+m,1-o),s.scale(1/b,1/x),s.rotate(-n),s.translate(-d.x,-d.y)},Eo=function(t,e){t&&t.beginPath();for(var i,n,r,o=[],a=function(t){for(var e,i=/(\-{0,1}[\d\.]+)/gi,n=[];e=i.exec(t);)n.push(parseFloat(e[0]));return n},s=/([MmLlHhVvCcSsQqTtAa]{1}[\d\.,\s\-Zz]*)/gi,l={x:0,y:0};i=s.exec(e);){var c=i[0],h=c.substr(0,1);if("M"===h||"m"===h){for(var u=a(c),d=0;d<u.length;d+=2){var f=u[d],g=u[d+1];"m"===h&&(f+=l.x,g+=l.y),t&&t.moveTo(f,g),o.push({x:f,y:g}),l.x=f,l.y=g}n=r=null}else if("H"===h||"h"===h){for(u=a(c),d=0;d<u.length;d+=1){f=u[d];"h"===h&&(f+=l.x),t&&t.lineTo(f,l.y),o.push({x:f,y:l.y}),l.x=f}n=r=null}else if("C"===h||"c"===h){for(u=a(c),d=0;d<u.length;d+=6){var p=u[d],v=u[d+1],_=u[d+2],y=u[d+3];f=u[d+4],g=u[d+5];"c"===h&&(p+=l.x,v+=l.y,_+=l.x,y+=l.y,f+=l.x,g+=l.y),t&&t.bezierCurveTo(p,v,_,y,f,g),o.push({x:p,y:v}),o.push({x:_,y:y}),o.push({x:f,y:g}),l.x=f,l.y=g}n=[p,v,_,y,f,g],r=null}else if("S"===h||"s"===h){for(u=a(c),d=0;d<u.length;d+=4){n?(p=2*n[4]-n[2],v=2*n[5]-n[3]):(p=l.x,v=l.y);_=u[d],y=u[d+1],f=u[d+2],g=u[d+3];"s"===h&&(_+=l.x,y+=l.y,f+=l.x,g+=l.y),t&&t.bezierCurveTo(p,v,_,y,f,g),o.push({x:p,y:v}),o.push({x:_,y:y}),o.push({x:f,y:g}),l.x=f,l.y=g}n=[p,v,_,y,f,g],r=null}else if("Q"===h||"q"===h){for(u=a(c),d=0;d<u.length;d+=4){p=u[d],v=u[d+1],f=u[d+2],g=u[d+3];"q"===h&&(p+=l.x,v+=l.y,f+=l.x,g+=l.y),t&&t.quadraticCurveTo(p,v,f,g),o.push({x:p,y:v}),o.push({x:f,y:g}),l.x=f,l.y=g}n=null,r=[p,v,f,g]}else if("T"===h||"t"===h){for(u=a(c),d=0;d<u.length;d+=2){r?(p=2*r[2]-r[0],v=2*r[3]-r[1]):(p=l.x,v=l.y);f=u[d],g=u[d+1];"t"===h&&(f+=l.x,g+=l.y),t&&t.quadraticCurveTo(p,v,f,g),o.push({x:p,y:v}),o.push({x:f,y:g}),l.x=f,l.y=g}n=null,r=[p,v,f,g]}else if("V"===h||"v"===h){for(u=a(c),d=0;d<u.length;d+=1){g=u[d];"v"===h&&(g+=l.y),t&&t.lineTo(l.x,g),o.push({x:l.x,y:g}),l.y=g}n=r=null}else if("L"===h||"l"===h){for(u=a(c),d=0;d<u.length;d+=2){f=u[d],g=u[d+1];"l"===h&&(f+=l.x,g+=l.y),t&&t.lineTo(f,g),o.push({x:f,y:g}),l.x=f,l.y=g}n=r=null}else if("A"===h||"a"===h){for(u=a(c),d=0;d<u.length;d+=7){var m=u[d],b=u[d+1],x=u[d+2],w=u[d+3],C=u[d+4];f=u[d+5],g=u[d+6];"a"===h&&(f+=l.x,g+=l.y);var S=To(l,m,b,x,w,C,{x:f,y:g},t);S&&(o=o.concat(S)),l.x=f,l.y=g}n=r=null}var I=c.substr(c.length-1);("z"===I||"Z"===I)&&t&&t.closePath()}return o},Po=function(t,e){var i,n,r="L"===e[0],o=e.length;t.save(),r?(t.transform(e[5],e[6],e[7],e[8],e[9],e[10]),i=t.createLinearGradient(e[1],e[2],e[3],e[4]),n=11):(t.transform(e[7],e[8],e[9],e[10],e[11],e[12]),i=t.createRadialGradient(e[1],e[2],e[3],e[4],e[5],e[6]),n=13);for(var a=t.compGray;o>n;)i.addColorStop(e[n],a?u.toGrayColor(e[n+1]):e[n+1]),n+=2;t.fillStyle=i},Do=function(t,e){var i=t.s("shape.gradient.pack");if(i){for(var n=i.length,r=new Array(n),o=0;n>o;o++)r[o]=i[o];var a,s,l,c,h,u,d,f,g,p,v,_,y,m="L"===r[0];a=m?5:7,s=r[a],l=r[a+1],c=r[a+2],h=r[a+3],u=r[a+4],d=r[a+5],f=e[0],g=e[1],p=e[2],v=e[3],_=e[4],y=e[5],r[a]=f*s+p*l,r[a+1]=g*s+v*l,r[a+2]=f*c+p*h,r[a+3]=g*c+v*h,r[a+4]=f*u+p*d+_,r[a+5]=g*u+v*d+y,t.s("shape.gradient.pack",r)}},Oo=function(t,e,i,n){var r=!1;if(t.beginPath?t.beginPath():r=!0,Bn(e)&&(e=e._as),Bn(i)&&(i=i._as),i&&i.length){for(var o,a,s,l,c=0,h=0,u=i.length;u>h;h++)o=i[h],1===o?(a=e[c++],t.moveTo(a.x,r?-a.y:a.y)):2===o?(a=e[c++],t.lineTo(a.x,r?-a.y:a.y)):3===o?(a=e[c++],s=e[c++],t.quadraticCurveTo(a.x,r?-a.y:a.y,s.x,r?-s.y:s.y)):4===o?(a=e[c++],s=e[c++],l=e[c++],t.bezierCurveTo(a.x,r?-a.y:a.y,s.x,r?-s.y:s.y,l.x,r?-l.y:l.y)):5===o&&t.closePath();n&&5!==o&&t.closePath()}else{var d,f,g,p=e.length;if(p>0){for(d=e[0],t.moveTo(d.x,r?-d.y:d.y),f=1;p>f;f++)g=e[f],t.lineTo(g.x,r?-g.y:g.y);n&&t.closePath()}}},Ro=function(t,e,i,n){if(Bn(t)&&(t=t._as),Bn(e)&&(e=e._as),e&&e.length){i=i||_l;for(var r,o,a,s,c,h,u,d,f=[],g=l,p=0,v=0,_=e.length;_>v;v++)if(r=e[v],1===r)f.push(g=[]),g.push(t[p++]);else if(2===r)g.push(t[p++]);else if(3===r){for(o=g[g.length-1],a=t[p++],s=t[p++],h=1;i>h;h++)u=ur(h/i,o.x,a.x,s.x),d=ur(h/i,o.y,a.y,s.y),g.push({x:u,y:d,b:!0});g.push(s)}else if(4===r){for(o=g[g.length-1],a=t[p++],s=t[p++],c=t[p++],h=1;i>h;h++)u=dr(h/i,o.x,a.x,s.x,c.x),d=dr(h/i,o.y,a.y,s.y,c.y),g.push({x:u,y:d,b:!0});g.push(c)}else 5===r&&g.push(g[0]);return n&&5!==r&&g&&g.length>2&&g.push(g[0]),f}return n&&t.length>2&&(t=t.slice(),t.push(t[0])),t?[t]:[]},zo=function(t,e,i,n,r,o){var a,s,l,c=wo(e),h=n,u=c[0],d=c[1],f=c[2];if(i){var g=wo(i);a=g[0]-u,s=g[1]-d,l=g[2]-f}else a=255-u,s=255-d,l=255-f;for(o||(o=n>10?1:.5,o=1>r?D(o/r,2):o),t.save(),t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,t.shadowColor=0;(n-=o)>0;){var p=1-n/h,v=u+a*p,_=d+s*p,y=f+l*p;v=D(T(v),255),_=D(T(_),255),y=D(T(y),255),t.strokeStyle="rgb("+v+","+_+","+y+")",t.lineWidth=n,t.stroke()}t.restore()},ko=function(){var t={};return function(e,i){var n=e+"-"+i,r=t[n];if(r)return r;var o,a,s,l=wo(e);return 0>i?(i=(100+i)/100,o=T(l[0]*i),a=T(l[1]*i),s=T(l[2]*i)):(i/=100,o=l[0],a=l[1],s=l[2],o+=(255-o)*i,a+=(255-a)*i,s+=(255-s)*i,o=D(T(o),255),a=D(T(a),255),s=D(T(s),255)),t[n]="rgb("+o+","+a+","+s+")"}}(),Ao=function(t,e,i,n,r,o){o&&(t.fillStyle=o),t.beginPath(),t.rect(e,i,n,r),t.fill()},Vo=function(t,e,i,n,r,o,a){t.beginPath(),Yo[e](t,i.x,i.y,i.width,i.height,n,r,o,a)},Bo=function(t,e,i,n,r){var o=Yo[i];t.fillStyle=o?o(t,e,n||Ca,r.x,r.y,r.width,r.height):e},Lo=function(t,e,i,n,r,o){try{if(!e.tagName&&e.comps){var a;e._cacheImage_||(e._cacheImage_={}),a="override"===n?"colors_override":"override_rgb"===n?"colors_override_rgb":"override_a"===n?"colors_override_a":"colors",e._cacheImage_[a]||(e._cacheImage_[a]={__count__:0});var s=e._cacheImage_[a][i];s||(e._cacheImage_[a].__count__>u.imageCacheThreshold&&(e._cacheImage_[a]={__count__:0}),s=c.Default.toCanvas(e,hc(e),uc(e),null,r,o,i,null,n),e._cacheImage_[a][i]=s,e._cacheImage_[a].__count__++),e=s}t.fillStyle=t.createPattern(e,"repeat")}catch(O){t.fillStyle="black"}},Fo=function(t,e,i,n,r,o,a){t.save(),t.translate(e,i),t.scale(1,a/o),t.arc(0,0,o,n,r),t.restore()},jo=function(t,e,i,n,r,o,a,s){var l,c,h,u,d,f,g,p,v,_,y;if(O(r)>2*L&&(r=2*L),d=T(O(r)/(L/4)),l=r/d,c=-l,h=-n,d>0){f=e+R(n)*o,g=i+k(-n)*a,s?t.lineTo(f,g):t.moveTo(f,g);for(var m=0;d>m;m++)h+=c,u=h-c/2,p=e+R(h)*o,v=i+k(h)*a,_=e+R(u)*(o/R(c/2)),y=i+k(u)*(a/R(c/2)),t.quadraticCurveTo(_,y,p,v)}},Ho=function(t,e,i,n,r,o,a,s,l){6===arguments.length&&(a=o,s=o,l=o);var c=e+n,h=i+r,u=r>n?2*n:2*r;o=u>o?o:u,a=u>a?a:u,s=u>s?s:u,l=u>l?l:u;var d=.29*l,f=.58*l;t.moveTo(c,h-l),t.quadraticCurveTo(c,h-f,c-d,h-d),t.quadraticCurveTo(c-f,h,c-l,h),d=.29*s,f=.58*s,t.lineTo(e+s,h),t.quadraticCurveTo(e+f,h,e+d,h-d),t.quadraticCurveTo(e,h-f,e,h-s),d=.29*o,f=.58*o,t.lineTo(e,i+o),t.quadraticCurveTo(e,i+f,e+d,i+d),t.quadraticCurveTo(e+f,i,e+o,i),d=.29*a,f=.58*a,t.lineTo(c-a,i),t.quadraticCurveTo(c-f,i,c-d,i+d),t.quadraticCurveTo(c,i+f,c,i+a),t.lineTo(c,h-l)},Go=function(t,e,i,n,r,o,a){e&&(i=I(i),n=I(n),a||(a=1),t.fillStyle=e,t.beginPath(),t.rect(i,n,a,o),t.rect(i,n,r,a),o-a>0&&t.rect(i,n+o-a,r,a),r-a>0&&t.rect(i+r-a,n,a,o),t.fill())},Uo=function(t,e,i,n){var r=n.x,o=n.y,a=n.width,s=n.height;if(!(!e||!i||0>=a||0>=s)){var l,c=Ws(e),h=Ns(e),u=i>0;1===i||-1===i?(t.fillStyle=u?c:h,t.beginPath(),t.rect(r,o,1,s),t.rect(r,o,a,1),t.fill(),t.fillStyle=u?h:c,t.beginPath(),t.rect(r,o+s-1,a,1),t.rect(r+a-1,o,1,s),t.fill()):(i=D(O(i),D(a/2,s/2)),l=t.createLinearGradient(r,o,r+i,o),l.addColorStop(0,u?c:h),l.addColorStop(1,e),t.fillStyle=l,t.beginPath(),t.moveTo(r,o),t.lineTo(r+i,o+i),t.lineTo(r+i,o+s-i),t.lineTo(r,o+s),t.lineTo(r,o),t.fill(),l=t.createLinearGradient(r,o,r,o+i),l.addColorStop(0,u?c:h),l.addColorStop(1,e),t.fillStyle=l,t.beginPath(),t.moveTo(r,o),t.lineTo(r+i,o+i),t.lineTo(r+a-i,o+i),t.lineTo(r+a,o),t.lineTo(r,o),t.fill(),l=t.createLinearGradient(r,o+s,r,o+s-i),l.addColorStop(0,u?h:c),l.addColorStop(1,e),t.fillStyle=l,t.beginPath(),t.moveTo(r,o+s),t.lineTo(r+i,o+s-i),t.lineTo(r+a-i,o+s-i),t.lineTo(r+a,o+s),t.lineTo(r,o+s),t.fill(),l=t.createLinearGradient(r+a,o,r+a-i,o),l.addColorStop(0,u?h:c),l.addColorStop(1,e),t.fillStyle=l,t.beginPath(),t.moveTo(r+a,o),t.lineTo(r+a-i,o+i),t.lineTo(r+a-i,o+s-i),t.lineTo(r+a,o+s),t.lineTo(r+a,o),t.fill())}},Wo=function(t,e,i,n,r,o,a){var s=t.createLinearGradient(n,r,o,a);return s.addColorStop(0,i),s.addColorStop(1,e),s},No=function(t,e,i,n,r,o,a){var s=t.createLinearGradient(n,r,o,a);return s.addColorStop(0,e),s.addColorStop(.5,i),s.addColorStop(1,e),s},qo=function(t,e,i,n,r,o,a){var s=t.createLinearGradient(n,r,o,a);return s.addColorStop(0,e),s.addColorStop(1/3,i),s.addColorStop(2/3,e),s.addColorStop(1,i),s},Xo=function(t,e,i,n,r,o,a,s,l){var c=t.createRadialGradient(n+o*s,r+a*l,D(o,a)/24,n+o/2,r+a/2,P(o,a)/2);return c.addColorStop(0,i),c.addColorStop(1,e),c},Qo=[0,-1,.22451398828979272,-.30901699437494734,.9510565162951535,-.30901699437494745,.3632712640026804,.11803398874989468,.5877852522924731,.8090169943749473,-11102230246251565e-32,.38196601125010515,-.587785252292473,.8090169943749475,-.3632712640026805,.1180339887498949,-.9510565162951536,-.3090169943749473,-.22451398828979285,-.30901699437494734],Yo={polygon:function(t,e,i,n,r,o){(o==l||3>o)&&(o=6);for(var a,s,c=D(n,r)/2,h=e+n/2,u=i+r/2,d=0,f=2*L/o,g=0;o>g;g++)a=h+R(d)*c,s=u+k(d)*c,0===g?t.moveTo(a,s):t.lineTo(a,s),d+=f;t.closePath()},arc:function(t,e,i,n,r,o,a,s,c){o==l&&(o=L),a==l&&(a=F),s==l&&(s=!0);var h=e+n/2,u=i+r/2;s&&t.moveTo(h,u),c?Fo(t,h,u,o,a,n/2,r/2):t.arc(h,u,D(n,r)/2,o,a),s&&t.closePath()},rect:function(t,e,i,n,r){t.rect(e,i,n,r)},circle:function(t,e,i,n,r){t.arc(e+n/2,i+r/2,D(n,r)/2,0,F,!0)},oval:function(t,e,i,n,r){Fo(t,e+n/2,i+r/2,0,F,n/2,r/2)},roundRect:function(t,e,i,n,r,o){o==l&&(o=D(D(n,r)/4,8)),Ho(t,e,i,n,r,o)},star:function(t,e,i,n,r){var o=2*n,a=2*r,s=e+n/2,l=i+r/2;t.moveTo(s-o/4,l-a/12),t.lineTo(e+.306*n,i+.579*r),t.lineTo(s-o/6,l+a/4),t.lineTo(e+n/2,i+.733*r),t.lineTo(s+o/6,l+a/4),t.lineTo(e+.693*n,i+.579*r),t.lineTo(s+o/4,l-a/12),t.lineTo(e+.611*n,i+.332*r),t.lineTo(s+0,l-a/4),t.lineTo(e+.388*n,i+.332*r),t.closePath()},pentagram:function(t,e,i,n,r){var o=.5*r,a=e+.5*n,s=i+o,l=.5257311121191336*n;l>o&&(l=o);var c=Qo,h=0;for(t.moveTo(a+l*c[h++],s+l*c[h++]);20>h;)t.lineTo(a+l*c[h++],s+l*c[h++]);t.closePath()},triangle:function(t,e,i,n,r){t.moveTo(e+n/2,i),t.lineTo(e+n,i+r),t.lineTo(e,i+r),t.closePath()},hexagon:function(t,e,i,n,r){t.moveTo(e,i+r/2),t.lineTo(e+n/4,i+r),t.lineTo(e+3*n/4,+i+r),t.lineTo(e+n,i+r/2),t.lineTo(e+3*n/4,i),t.lineTo(e+n/4,i),t.closePath()},pentagon:function(t,e,i,n,r){var o=2*n,a=2*r,s=e+n/2,l=i+r/2;t.moveTo(s-o/4,l-a/12),t.lineTo(s-o/6,l+a/4),t.lineTo(s+o/6,l+a/4),t.lineTo(s+o/4,l-a/12),t.lineTo(s+0,l-a/4),t.closePath()},diamond:function(t,e,i,n,r){t.moveTo(e+n/2,i),t.lineTo(e,i+r/2),t.lineTo(e+n/2,i+r),t.lineTo(e+n,i+r/2),t.closePath()},rightTriangle:function(t,e,i,n,r){t.moveTo(e,i),t.lineTo(e+n,i+r),t.lineTo(e,i+r),t.closePath()},parallelogram:function(t,e,i,n,r){var o=n/4;t.moveTo(e+o,i),t.lineTo(e+n,i),t.lineTo(e+n-o,i+r),t.lineTo(e,i+r),t.closePath()},trapezoid:function(t,e,i,n,r){var o=n/4;t.moveTo(e+o,i),t.lineTo(e+n-o,i),t.lineTo(e+n,i+r),t.lineTo(e,i+r),t.closePath()},"linear.southwest":function(t,e,i,n,r,o,a){return Wo(t,e,i,n,r+a,n+o,r)},"linear.southeast":function(t,e,i,n,r,o,a){return Wo(t,e,i,n+o,r+a,n,r)},"linear.northwest":function(t,e,i,n,r,o,a){return Wo(t,e,i,n,r,n+o,r+a)},"linear.northeast":function(t,e,i,n,r,o,a){return Wo(t,e,i,n+o,r,n,r+a)},"linear.north":function(t,e,i,n,r,o,a){return Wo(t,e,i,n,r,n,r+a)},"linear.south":function(t,e,i,n,r,o,a){return Wo(t,e,i,n,r+a,n,r)},"linear.west":function(t,e,i,n,r,o){return Wo(t,e,i,n,r,n+o,r)},"linear.east":function(t,e,i,n,r,o){return Wo(t,e,i,n+o,r,n,r)},"radial.center":function(t,e,i,n,r,o,a){return Xo(t,e,i,n,r,o,a,.5,.5)},"radial.southwest":function(t,e,i,n,r,o,a){return Xo(t,e,i,n,r,o,a,.25,.75)},"radial.southeast":function(t,e,i,n,r,o,a){return Xo(t,e,i,n,r,o,a,.75,.75)},"radial.northwest":function(t,e,i,n,r,o,a){return Xo(t,e,i,n,r,o,a,.25,.25)},"radial.northeast":function(t,e,i,n,r,o,a){return Xo(t,e,i,n,r,o,a,.75,.25)},"radial.north":function(t,e,i,n,r,o,a){return Xo(t,e,i,n,r,o,a,.5,.25)},"radial.south":function(t,e,i,n,r,o,a){return Xo(t,e,i,n,r,o,a,.5,.75)},"radial.west":function(t,e,i,n,r,o,a){return Xo(t,e,i,n,r,o,a,.25,.5)},"radial.east":function(t,e,i,n,r,o,a){return Xo(t,e,i,n,r,o,a,.75,.5)},"spread.horizontal":function(t,e,i,n,r,o){return No(t,e,i,n,r,n+o,r)},"spread.vertical":function(t,e,i,n,r,o,a){return No(t,e,i,n,r,n,r+a)},"spread.diagonal":function(t,e,i,n,r,o,a){return No(t,e,i,n+o,r,n,r+a)},"spread.antidiagonal":function(t,e,i,n,r,o,a){return No(t,e,i,n,r,n+o,r+a)},"spread.north":function(t,e,i,n,r,o,a){return qo(t,e,i,n,r-a/4,n,r+a+a/4)},"spread.south":function(t,e,i,n,r,o,a){return qo(t,i,e,n,r-a/4,n,r+a+a/4)},"spread.west":function(t,e,i,n,r,o){return qo(t,e,i,n-o/4,r,n+o+o/4,r)},"spread.east":function(t,e,i,n,r,o){return qo(t,i,e,n-o/4,r,n+o+o/4,r)}},Zo=function(t,e,i){return new Ga(t).tf(e,i)},Jo=function(t){var e=t.touches[0],i=t.touches[1],n=e.clientX,r=e.clientY,o=i.clientX,a=i.clientY;return E((n-o)*(n-o)+(r-a)*(r-a))},Ko=function(t){var e=t.touches[0],i=t.touches[1],n=e.clientX,r=e.clientY,o=i.clientX,a=i.clientY;return{x:(n+o)/2,y:(r+a)/2}},$o=(function(){for(var e=0,i=Ve.split(""),n=0;n<i.length;n++)e=10*X(i[n])+e;In(t[no.toString(8*n)+Yt.substr(n)+3],t[no.toString(8*n)+Yt.substr(n)+4])}(),function(t,e,i){for(var n=0;n<i.size();n++){var r=i.get(n);t.co(r)&&e.add(r)}for(n=0;n<i.size();n++)r=i.get(n),$o(t,e,r._children)}),ta=function(t,e,i){for(var n=0;n<i.size();n++){var r=i.get(i.size()-1-n);t.co(r)&&e.add(r)}for(n=0;n<i.size();n++)r=i.get(n),ta(t,e,r._children)},ea=function(t,e,i){for(var n=!1,r=0;r<i.size();r++){var o=i.get(r);t.co(o)?n&&e.add(o):n=1}for(r=0;r<i.size();r++)o=i.get(r),ea(t,e,o._children)},ia=function(t,e,i){for(var n=!1,r=0;r<i.size();r++){var o=i.get(i.size()-1-r);t.co(o)?n&&e.add(o):n=!0}for(r=0;r<i.size();r++)o=i.get(r),ia(t,e,o._children)},na=u.moveDatas=function(t,e,n,r){var o=r==l;if(0!==e||0!==n||!o&&0!==r){var a=!0,s=[];if(t.forEach((function(t){a&&(t._69O||Hn(t)||Un(t))&&(a=!1)})),a)s=t;else{var c={},h={};t.forEach((function(t){c[t._id]=!0}));var u={},d=function(t){var e=t._id;return c[e]?(s.push(t),u[e]=!0):u[e]=!1},f=function(t){var e=t._id;if(h[e])return d(t);var n=u[e];if(n!==i)return n;var r=t._parent;if(r&&(Un(r)||Hn(r))&&f(r))return u[e]=!0;var o=t._host;return o&&(h[e]=e,n=f(o),h[e]=i,n)?u[e]=!0:d(t)};t.forEach((function(t){f(t)}))}s.forEach((function(t){if(Fn(t))o?t.translate(e,n):t.translate3d(e,n,r);else{var i=t.s(ae);if(!i||i.isEmpty())return;var a=new gc;i.each((function(t){t=Hs(t),o?(t.x+=e,t.y+=n):(t.x+=e,t.y+=r,t.e==l?t.e=n:t.e+=n),a.add(t)})),t.s(ae,a)}}))}},ra=function(){function t(t,e){return e===t.substring(0,e.length)}function e(t){return parseFloat(t)||0}function n(n,r){if(r==i&&(r=new Ka),t(n,"matrix3d")){var o=n.substring(9,n.length-1).split(",");o=o.map(e),r.fromArray(o)}else if(t(n,"matrix")){o=n.substring(7,n.length-1).split(",");o=o.map(e),r.el[0]=o[0],r.el[1]=o[1],r.el[2]=0,r.el[3]=0,r.el[4]=o[2],r.el[5]=o[3],r.el[6]=0,r.el[7]=0,r.el[8]=0,r.el[9]=0,r.el[10]=1,r.el[11]=0,r.el[12]=o[4],r.el[13]=o[5],r.el[14]=0,r.el[15]=1}return r}function r(t,n){n==i&&(n=new Na);var r=t.split(/\s+/);return r=r.map(e),n.set(r[0]||0,r[1]||0,r[2]||0),n}var o,a,s,l,c,h=function(t,u){o||(o=new Ka,a=new Na,s=new Ka,l=new Ka,c=new Ka),u==i&&(u=new Ka);var d=getComputedStyle(t);d.transform&&"none"!==d.transform&&(n(d.transform,o),r(d.transformOrigin,a),l.setPosition(a),a.negate(),c.setPosition(a),(nt||"preserve-3d"!==d.transformStyle)&&(o.el[8]=0,o.el[9]=0,o.el[10]=1,o.el[11]=0),u.multiplyMatrices(c,u),u.multiplyMatrices(o,u),u.multiplyMatrices(l,u)),!nt&&d.perspective&&"none"!==d.perspective&&(s.el[11]=-1/e(d.perspective),r(d.perspectiveOrigin,a),l.setPosition(a),a.negate(),c.setPosition(a),u.multiplyMatrices(c,u),u.multiplyMatrices(s,u),u.multiplyMatrices(l,u));for(var f=t.offsetParent,g=t.offsetLeft,p=t.offsetTop,v=t.parentElement;v&&v!==f;){var _=getComputedStyle(v);if("none"!==_.transform||"none"!==_.perspective)break;v=v.parentElement}return v==i&&t!==t.ownerDocument.documentElement&&"fixed"!==d.position&&(v=t.ownerDocument.documentElement),f!=i&&f!==v&&(g-=v.offsetLeft,p-=v.offsetTop),a.set(g,p,0),l.setPosition(a),u.multiplyMatrices(l,u),v&&h(v,u),u};return function(t,e){var i=t.parentElement;if(i){var n=i.updateAppendMatrix;if(n){delete i.updateAppendMatrix;var r=new Ka;h(i,r);var o=new Ka;o.getInverse(r),i._matrixAppend=o,i._maxrixPreAppend=r}return e?i._matrixAppend:i._maxrixPreAppend}}}(),oa=function(t,i){for(;t&&!t.hasOwnProperty(i);)t=e.getPrototypeOf(t);return t&&e.getOwnPropertyDescriptor(t,i)},aa=e.getPrototypeOf?function(t,i,n){var r=oa(i,n);r&&e.defineProperty(t,n,r)}:function(t,e,i){t[i]=e[i]},sa={1:29,2:30,3:31,4:32,5:33,6:26,7:27,8:28,9:21,10:22,11:23,12:24,13:25,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:9,22:10,23:11,24:12,25:13,26:6,27:7,28:8,29:1,30:2,31:3,32:4,33:5,34:36,35:37,36:34,37:35,38:54,39:55,40:52,41:53,42:50,43:51,44:49,50:42,51:43,52:40,53:41,54:38,55:39},la=function(){var e={1:function(t,e){return{x:t.x-e.width/2,y:t.y-e.height/2}},2:function(t,e){return{x:t.x+e.width/2,y:t.y-e.height/2}},3:function(t,e){return{x:t.x+t.width/2,y:t.y-e.height/2}},4:function(t,e){return{x:t.x+t.width-e.width/2,y:t.y-e.height/2}},5:function(t,e){return{x:t.x+t.width+e.width/2,y:t.y-e.height/2}},6:function(t){return{x:t.x,y:t.y}},7:function(t){return{x:t.x+t.width/2,y:t.y}},8:function(t){return{x:t.x+t.width,y:t.y}},9:function(t,e){return{x:t.x-e.width/2,y:t.y+e.height/2}},10:function(t,e){return{x:t.x+e.width/2,y:t.y+e.height/2}},11:function(t,e){return{x:t.x+t.width/2,y:t.y+e.height/2}},12:function(t,e){return{x:t.x-e.width/2+t.width,y:t.y+e.height/2}},13:function(t,e){return{x:t.x+t.width+e.width/2,y:t.y+e.height/2}},14:function(t,e){return{x:t.x-e.width/2,y:t.y+t.height/2}},15:function(t){return{x:t.x,y:t.y+t.height/2}},16:function(t,e){return{x:t.x+e.width/2,y:t.y+t.height/2}},17:function(t){return{x:t.x+t.width/2,y:t.y+t.height/2}},18:function(t,e){return{x:t.x+t.width-e.width/2,y:t.y+t.height/2}},19:function(t){return{x:t.x+t.width,y:t.y+t.height/2}},20:function(t,e){return{x:t.x+t.width+e.width/2,y:t.y+t.height/2}},21:function(t,e){return{x:t.x-e.width/2,y:t.y+t.height-e.height/2}},22:function(t,e){return{x:t.x+e.width/2,y:t.y+t.height-e.height/2}},23:function(t,e){return{x:t.x+t.width/2,y:t.y+t.height-e.height/2}},24:function(t,e){return{x:t.x+t.width-e.width/2,y:t.y+t.height-e.height/2}},25:function(t,e){return{x:t.x+t.width+e.width/2,y:t.y+t.height-e.height/2}},26:function(t){return{x:t.x,y:t.y+t.height}},27:function(t){return{x:t.x+t.width/2,y:t.y+t.height}},28:function(t){return{x:t.x+t.width,y:t.y+t.height}},29:function(t,e){return{x:t.x-e.width/2,y:t.y+t.height+e.height/2}},30:function(t,e){return{x:t.x+e.width/2,y:t.y+t.height+e.height/2}},31:function(t,e){return{x:t.x+t.width/2,y:t.y+t.height+e.height/2}},32:function(t,e){return{x:t.x+t.width-e.width/2,y:t.y+t.height+e.height/2}},33:function(t,e){return{x:t.x+t.width+e.width/2,y:t.y+t.height+e.height/2}},34:function(t,e){return{x:t.x,y:t.y-e.height/2}},35:function(t,e){return{x:t.x+t.width,y:t.y-e.height/2}},36:function(t,e){return{x:t.x,y:t.y+t.height+e.height/2}},37:function(t,e){return{x:t.x+t.width,y:t.y+t.height+e.height/2}},38:function(t,e){return{x:t.x+t.width/4,y:t.y-e.height/2}},39:function(t,e){return{x:t.x+3*t.width/4,y:t.y-e.height/2}},40:function(t){return{x:t.x+t.width/4,y:t.y}},41:function(t){return{x:t.x+3*t.width/4,y:t.y}},42:function(t,e){return{x:t.x+t.width/4,y:t.y+e.height/2}},43:function(t,e){return{x:t.x+3*t.width/4,y:t.y+e.height/2}},44:function(t,e){return{x:t.x+t.width/2,y:t.y+t.height/2-e.height/2}},45:function(t){return{x:t.x+t.width/4,y:t.y+t.height/2}},46:function(t,e){return{x:t.x+t.width/2-e.width/2,y:t.y+t.height/2}},47:function(t,e){return{x:t.x+t.width/2+e.width/2,y:t.y+t.height/2}},48:function(t){return{x:t.x+3*t.width/4,y:t.y+t.height/2}},49:function(t,e){return{x:t.x+t.width/2,y:t.y+t.height/2+e.height/2}},50:function(t,e){return{x:t.x+t.width/4,y:t.y+t.height-e.height/2}},51:function(t,e){return{x:t.x+3*t.width/4,y:t.y+t.height-e.height/2}},52:function(t){return{x:t.x+t.width/4,y:t.y+t.height}},53:function(t){return{x:t.x+3*t.width/4,y:t.y+t.height}},54:function(t,e){return{x:t.x+t.width/4,y:t.y+t.height+e.height/2}},55:function(t,e){return{x:t.x+3*t.width/4,y:t.y+t.height+e.height/2}}};return Mn(t)?function(t,i,n){return e[t](i,n||un)}:void 0}();Qn(g,{highlight:"#1ABC9C",label:"#000",labelSelect:"#FFF",transparent:"rgba(0,0,0,0.35)",titleBackground:"#2C3E50",titleIconBackground:"#868686",headerBackground:"#ECF0F1",headerIconBackground:"#868686",headerSeparator:"#868686",headerLine:"#D9D9D9",background:"#FFF",disabledBackground:"rgba(255,255,255,0.65)",toolTipBackground:"#FFFFE0",rectSelectBorder:"#45C4F9",rectSelectBackground:"rgba(0,0,0,0.35)",editPointBorder:"#2C3E50",editPointBackground:"#D9D9D9",dash:"#2C3E50",groupBackground:"#ECF0F1",groupTitleBackground:"#2C3E50",gridBackground:"#D9D9D9",gridCellBorderColor:"#868686",gridBlockColor:"#868686",reverse:"#868686",contentIconBackground:"#868686",contentLine:"#D9D9D9",widgetBackground:"#ECF0F1",widgetBorder:"#D9D9D9",widgetIconBackground:"#868686",widgetIconBorder:"#868686",widgetIconGradient:"#D9D9D9",widgetIconHighlight:"#43AFF1",imageBackground:"#3498DB",imageGradient:"#D9D9D9",chart:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]},!0);var ca=g.reverse,ha=g.transparent,ua=g.rectSelectBackground,da=g.dash,fa=g.titleBackground,ga=g.titleIconBackground,pa=g.headerBackground,va=g.headerIconBackground,_a=g.headerSeparator,ya=g.headerLine,ma=g.contentIconBackground,ba=g.contentLine,xa=(g.widgetIconHighlight,g.widgetIconBorder),wa=(g.widgetIconGradient,g.imageBackground),Ca=g.imageGradient,Sa=g.highlight,Ia=g.label,Ma=g.labelSelect;if(Q&&!t.shutAlert1){var Ta=new Date,Ea=Q.split("-"),Pa=new Date(Ta.getFullYear(),Ta.getMonth(),Ta.getDate()),Da=(Q=new Date(X(Ea[0],10),X(Ea[1],10)-1,X(Ea[2],10)),Pa.getTime()),Oa=Q.getTime(),Ra=a+"_try",za=t.alert;try{var ka=t.localStorage;if(ka&&za)if(Oa>Da&&1728e6>Oa-Da){var Aa=(Oa-Da)/864e5;ka&&ka[Ra]!=Aa&&(ka[Ra]=Aa,t.htWillExpire?za(t.htWillExpire.replace("{{day}}",Aa)):za("HT for Web free trial license will expire in "+Aa+" days, please apply for a new license!"))}else Da>=Oa&&(t.htExpired?za(t.htExpired):za("Your free trial of HT for Web has expired!")),ka&&delete ka[Ra]}catch(l_){}}Math.sign===i&&(Math.sign=function(t){return 0>t?-1:t>0?1:+t});var Va="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Ba={encode:function(t,e){var i,n,r,o,a,s,l,c="",h=0;for(t=Ba._utf8_encode(t);h<t.length;)i=t.charCodeAt(h++),n=t.charCodeAt(h++),r=t.charCodeAt(h++),o=i>>2,a=(3&i)<<4|n>>4,s=(15&n)<<2|r>>6,l=63&r,isNaN(n)?s=l=64:isNaN(r)&&(l=64),c=c+e.charAt(o)+e.charAt(a)+e.charAt(s)+e.charAt(l);return c},decode:function(t,e){var i,n,r,o,a,s,l,c="",h=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<t.length;)o=e.indexOf(t.charAt(h++)),a=e.indexOf(t.charAt(h++)),s=e.indexOf(t.charAt(h++)),l=e.indexOf(t.charAt(h++)),i=o<<2|a>>4,n=(15&a)<<4|s>>2,r=(3&s)<<6|l,c+=String.fromCharCode(i),64!=s&&(c+=String.fromCharCode(n)),64!=l&&(c+=String.fromCharCode(r));return Ba._utf8_decode(c)},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);128>n?e+=String.fromCharCode(n):n>127&&2048>n?(e+=String.fromCharCode(192|n>>6),e+=String.fromCharCode(128|63&n)):(e+=String.fromCharCode(224|n>>12),e+=String.fromCharCode(128|63&n>>6),e+=String.fromCharCode(128|63&n))}return e},_utf8_decode:function(t){for(var e="",i=0,n=0,r=0,o=0;i<t.length;)n=t.charCodeAt(i),128>n?(e+=String.fromCharCode(n),i++):n>191&&224>n?(r=t.charCodeAt(i+1),e+=String.fromCharCode((31&n)<<6|63&r),i+=2):(r=t.charCodeAt(i+1),o=t.charCodeAt(i+2),e+=String.fromCharCode((15&n)<<12|(63&r)<<6|63&o),i+=3);return e}},La=[],Fa=[],ja=c.Math={generateUUID:function(){for(var t=[],e=0;256>e;e++)t[e]=(16>e?"0":"")+e.toString(16).toUpperCase();return function(){var e=0|4294967295*Math.random(),i=0|4294967295*Math.random(),n=0|4294967295*Math.random(),r=0|4294967295*Math.random();return t[255&e]+t[255&e>>8]+t[255&e>>16]+t[255&e>>24]+"-"+t[255&i]+t[255&i>>8]+"-"+t[64|15&i>>16]+t[255&i>>24]+"-"+t[128|63&n]+t[255&n>>8]+"-"+t[255&n>>16]+t[255&n>>24]+t[255&r]+t[255&r>>8]+t[255&r>>16]+t[255&r>>24]}}(),clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},generateIncreasingID:function(){var t=0;return function(){return++t}}(),encodeBase64:function(t,e){return Ba.encode(t,e||Va)},decodeBase64:function(t,e){return Ba.decode(t,e||Va)},randomArray:function(t,e){e=e||t.length;for(var i=e-1;i>0;i--){var n=Math.floor(Math.random()*(i+1)),r=t[i];t[i]=t[n],t[n]=r}return t},isPOT:function(t){return t>0&&0===(t-1&t)},nearestPOT:function(t){if(!t)return 1;var e=t;e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++;var i=e>>1;return t-i>e-t?e:i},requestMatrix4:function(){return La.length>0?La.pop():new ja.Matrix4},releaseMatrix4:function(t){La.push(t)},requestVector3:function(){return Fa.length>0?Fa.pop():new ja.Vector3},releaseVector3:function(t){Fa.push(t)}},Ha=c.Matrix=c.Math.Matrix2d=function(t,e,i,n,r){this.setFromTransform(t,e,i,n,r)},Ga=Ha;Ha.prototype={},Ha.prototype.constructor=Ha,Ha.prototype.set=function(t,e,i,n,r,o){return this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=o,this},Ha.prototype.setFromTransform=function(t,e,n,r,o){var a=this;if(t===i)return a.a=1,a.b=0,a.c=0,a.d=1,a.tx=0,void(a.ty=0);t=t||0;var s=k(t),l=R(t);return r=r||1,o=o||1,a.a=l*r,a.b=s*r,a.c=-s*o,a.d=l*o,a.tx=e||0,a.ty=n||0,a},Ha.prototype.apply=function(t,e){e=e||new qa;var i=t.x,n=t.y;return e.x=this.a*i+this.c*n+this.tx,e.y=this.b*i+this.d*n+this.ty,e},Ha.prototype.applyInverse=function(t,e){e=e||new qa;var i=1/(this.a*this.d+this.c*-this.b),n=t.x,r=t.y;return e.x=this.d*i*n+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*r+-this.b*i*n+(-this.ty*this.a+this.tx*this.b)*i,e},Ha.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},Ha.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},Ha.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.c,o=this.tx;return this.a=n*e-this.b*i,this.b=n*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=o*e-this.ty*i,this.ty=o*i+this.ty*e,this},Ha.prototype.appendTranslate=function(t,e){return this.tx+=this.a*t+this.c*e,this.ty+=this.b*t+this.d*e,this},Ha.prototype.appendScale=function(t,e){return this.a*=t,this.d*=e,this.c*=e,this.b*=t,this},Ha.prototype.appendRotate=function(t){if(!t)return this;var e=Math.cos(t),i=Math.sin(t),n=this.a,r=this.b;return this.a=n*e+this.c*i,this.b=r*e+this.d*i,this.c=-n*i+this.c*e,this.d=-r*i+this.d*e,this},Ha.prototype.append=function(t){var e=this.a,i=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this},Ha.prototype.setTransform=function(t,e,i,n,r,o,a,s,l){var c,h,u,d,f,g,p,v,_,y;return f=Math.sin(a),g=Math.cos(a),p=Math.cos(l),v=Math.sin(l),_=-Math.sin(s),y=Math.cos(s),c=g*r,h=f*r,u=-f*o,d=g*o,this.a=p*c+v*u,this.b=p*h+v*d,this.c=_*c+y*u,this.d=_*h+y*d,this.tx=t+(i*c+n*u),this.ty=e+(i*h+n*d),this},Ha.prototype.prepend=function(t){var e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){var i=this.a,n=this.c;this.a=i*t.a+this.b*t.c,this.b=i*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},Ha.prototype.transform=Ha.prototype.prepend,Ha.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,n=this.d,r=this.tx,o=t*n-e*i;return this.a=n/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-n*r)/o,this.ty=-(t*this.ty-e*r)/o,this},Ha.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Ha.prototype.clone=function(){var t=new Ha;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},Ha.prototype.copy=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},Ha.prototype.tf=function(t,e){1===arguments.length&&(e=t.y,t=t.x);var i=this;return{x:i.a*t+i.c*e+i.tx,y:i.b*t+i.d*e+i.ty}},Ha.prototype.tfi=function(t,e){1===arguments.length&&(e=t.y,t=t.x);var i=this,n=1/(i.a*i.d+i.c*-i.b);return{x:i.d*n*t+-i.c*n*e+(i.ty*i.c-i.tx*i.d)*n,y:i.a*n*e+-i.b*n*t+(-i.ty*i.a+i.tx*i.b)*n}},Ha.IDENTITY=new Ha,Ha.TEMP_MATRIX=new Ha;var Ua=c.Math.Quaternion=function(t,e,i,n){this.set(t,e,i,n)};e.assign(Ua.prototype,{set:function(t,e,n,r){var o=this;return o._x=t||0,o._y=e||0,o._z=n||0,o._w=r!==i?r:1,o},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){var e=this;return e._x=t._x,e._y=t._y,e._z=t._z,e._w=t._w,e},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this},fromArray:function(t,e){e===i&&(e=0);var n=this;return n._x=t[e],n._y=t[e+1],n._z=t[e+2],n._w=t[e+3],this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,n=this._y,r=this._z,o=this._w,a=o*t._w+i*t._x+n*t._y+r*t._z;if(0>a?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var l=Math.atan2(s,a),c=Math.sin((1-e)*l)/s,h=Math.sin(e*l)/s;return this._w=o*c+this._w*h,this._x=i*c+this._x*h,this._y=n*c+this._y*h,this._z=r*c+this._z*h,this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this},setFromEuler:function(t){var e=t._x,i=t._y,n=t._z,r=t._order,o=Math.cos,a=Math.sin,s=o(e/2),l=o(i/2),c=o(n/2),h=a(e/2),u=a(i/2),d=a(n/2);return"XYZ"===r?(this._x=h*l*c+s*u*d,this._y=s*u*c-h*l*d,this._z=s*l*d+h*u*c,this._w=s*l*c-h*u*d):"YXZ"===r?(this._x=h*l*c+s*u*d,this._y=s*u*c-h*l*d,this._z=s*l*d-h*u*c,this._w=s*l*c+h*u*d):"ZXY"===r?(this._x=h*l*c-s*u*d,this._y=s*u*c+h*l*d,this._z=s*l*d+h*u*c,this._w=s*l*c-h*u*d):"ZYX"===r?(this._x=h*l*c-s*u*d,this._y=s*u*c+h*l*d,this._z=s*l*d-h*u*c,this._w=s*l*c+h*u*d):"YZX"===r?(this._x=h*l*c+s*u*d,this._y=s*u*c+h*l*d,this._z=s*l*d-h*u*c,this._w=s*l*c-h*u*d):"XZY"===r&&(this._x=h*l*c-s*u*d,this._y=s*u*c-h*l*d,this._z=s*l*d+h*u*c,this._w=s*l*c+h*u*d),this},setFromRotationMatrix:function(t){var e,i=t.el,n=i[0],r=i[4],o=i[8],a=i[1],s=i[5],l=i[9],c=i[2],h=i[6],u=i[10],d=n+s+u;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(h-l)*e,this._y=(o-c)*e,this._z=(a-r)*e):n>s&&n>u?(e=2*Math.sqrt(1+n-s-u),this._w=(h-l)/e,this._x=.25*e,this._y=(r+a)/e,this._z=(o+c)/e):s>u?(e=2*Math.sqrt(1+s-n-u),this._w=(o-c)/e,this._x=(r+a)/e,this._y=.25*e,this._z=(l+h)/e):(e=2*Math.sqrt(1+u-n-s),this._w=(a-r)/e,this._x=(o+c)/e,this._y=(l+h)/e,this._z=.25*e),this},setFromToVectors:function(){var t,e;return function(n,r){return t===i&&(t=new Na),e=n.dot(r)+1,1e-7>e?(e=0,Math.abs(n.x)>Math.abs(n.z)?t.set(-n.y,n.x,0):t.set(0,-n.z,n.y)):t.crossVectors(n,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),setFromUnitVectors:function(){var t,e,n=1e-6;return function(r,o){return t===i&&(t=new Na),e=r.dot(o)+1,n>e?(e=0,Math.abs(r.x)>Math.abs(r.z)?t.set(-r.y,r.x,0):t.set(0,-r.z,r.y)):t.crossVectors(r,o),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),multiply:function(t){return this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,n=t._y,r=t._z,o=t._w,a=e._x,s=e._y,l=e._z,c=e._w;return this._x=i*c+o*a+n*l-r*s,this._y=n*c+o*s+r*a-i*l,this._z=r*c+o*l+i*s-n*a,this._w=o*c-i*a-n*s-r*l,this}});var Wa=c.Math.Vector4=function(t,e,n,r){this.x=t||0,this.y=e||0,this.z=n||0,this.w=r!==i?r:1};e.assign(Wa.prototype,{isVector4:!0,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==i?t.w:1,this},add:function(t,e){return e!==i?this.addVectors(t,e):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},sub:function(t,e){return e!==i?this.subVectors(t,e):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=this.w,o=t.el;return this.x=o[0]*e+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*e+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*e+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*e+o[7]*i+o[11]*n+o[15]*r,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(t){this.w=2*Math.acos(t.w);var e=Math.sqrt(1-t.w*t.w);return 1e-4>e?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},setAxisAngleFromRotationMatrix:function(t){var e,i,n,r,o=.01,a=.1,s=t.el,l=s[0],c=s[4],h=s[8],u=s[1],d=s[5],f=s[9],g=s[2],p=s[6],v=s[10];if(Math.abs(c-u)<o&&Math.abs(h-g)<o&&Math.abs(f-p)<o){if(Math.abs(c+u)<a&&Math.abs(h+g)<a&&Math.abs(f+p)<a&&Math.abs(l+d+v-3)<a)return this.set(1,0,0,0),this;e=Math.PI;var _=(l+1)/2,y=(d+1)/2,m=(v+1)/2,b=(c+u)/4,x=(h+g)/4,w=(f+p)/4;return _>y&&_>m?o>_?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(_),n=b/i,r=x/i):y>m?o>y?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(y),i=b/n,r=w/n):o>m?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(m),i=x/r,n=w/r),this.set(i,n,r,e),this}var C=Math.sqrt((p-f)*(p-f)+(h-g)*(h-g)+(u-c)*(u-c));return Math.abs(C)<.001&&(C=1),this.x=(p-f)/C,this.y=(h-g)/C,this.z=(u-c)/C,this.w=Math.acos((l+d+v-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(){var t,e;return function(n,r){return t===i&&(t=new Wa,e=new Wa),t.set(n,n,n,n),e.set(r,r,r,r),this.clamp(t,e)}}(),clampLength:function(t,e){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return e===i&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return t===i&&(t=[]),e===i&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}});var Na=c.Math.Vector3=function(t,e,n){t===i?(this.x=0,this.y=0,this.z=0):"object"==typeof t?this.copy(t):this.set(t,e==i?t:e,n==i?t:n)};e.assign(Na.prototype,{isNaN:function(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.z)},set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},equals:function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return t.x===i?(this.x=t[0],this.y=t[1],this.z=t[2]):(this.x=t.x,this.y=t.y,this.z=t.z||0),this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},addScaledVector:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},subScalar:function(t){return this.x-=t,this.y-=t,this.z-=t,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},distanceToSquared2:function(t){var e=this.x-t[0],i=this.y-t[1],n=this.z-t[2];return e*e+i*i+n*n},divideVectors:function(t,e){return this.x=t.x/e.x,this.y=t.y/e.y,this.z=t.z/e.z,this},multiplyVectors:function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},transformDirection:function(t){var e=this.x,i=this.y,n=this.z,r=t.el;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()},applyAxisAngle:function(){var t=new Ua;return function(e,i){return this.applyQuaternion(t.setFromAxisAngle(e,i))}}(),applyEuler:function(){var t=new Ua;return function(e){return this.applyQuaternion(t.setFromEuler(e))}}(),applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,r=t._x,o=t._y,a=t._z,s=t._w,l=s*e+o*n-a*i,c=s*i+a*e-r*n,h=s*n+r*i-o*e,u=-r*e-o*i-a*n;return this.x=l*s+u*-r+c*-a-h*-o,this.y=c*s+u*-o+h*-r-l*-a,this.z=h*s+u*-a+l*-o-c*-r,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=t.el,o=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*o,this},applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z,r=t.el;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},reflect:function(){var t=new Na;return function(e){return this.sub(t.copy(e).multiplyScalar(2*this.dot(e)))}}(),dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){var t=this.length();return t?this.multiplyScalar(1/t):this},setLength:function(t){return this.normalize().multiplyScalar(t)},fromArray:function(t,e){return e===i&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return t===i&&(t=[0,0,0]),e===i&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},cross:function(t){return this.crossVectors(this,t)},angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return e>1||-1>e?0:Math.acos(e)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,o=e.x,a=e.y,s=e.z;return this.x=n*s-r*a,this.y=r*o-i*s,this.z=i*a-n*o,this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},setFromMatrixPosition:function(t){return this.setFromMatrixColumn(t,3)},setFromMatrixScale:function(t){var e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.el,4*e)}});var qa=c.Math.Vector2=function(t,e,n){"object"==typeof t&&(t.x!=i?(e=t.y,t=t.x,n=t.e):(n=t[2],e=t[1],t=t[0])),this.set(t||0,e||0,n)};qa.prototype={},qa.prototype.constructor=qa,e.defineProperties(qa.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),qa.prototype.clone=function(){return new qa(this.x,this.y,this.e)},qa.prototype.copy=function(t){return this.set(t.x,t.y,t.e),this},qa.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},qa.prototype.set=function(t,e,n){return this.x=t||0,this.y=e||(0!==e?this.x:0),n!=i&&(this.e=n),this},qa.prototype.setScalar=function(t){return this.x=t,this.y=t,this},qa.prototype.setX=function(t){return this.x=t||0,this},qa.prototype.setY=function(t){return this.y=t||0,this},qa.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},qa.prototype.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},qa.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},qa.prototype.addScaledVector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},qa.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},qa.prototype.subScalar=function(t){return this.x-=t,this.y-=t,this},qa.prototype.subVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},qa.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},qa.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},qa.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},qa.prototype.divideScalar=function(t){return this.multiplyScalar(1/t)},qa.prototype.min=function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},qa.prototype.max=function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},qa.prototype.fromArray=function(t,e){return e===i&&(e=0),this.x=t[e],this.y=t[e+1],this},qa.prototype.clamp=function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},qa.prototype.clampScalar=function(){var t,e;return function(n,r){return t===i&&(t=new qa,e=new qa),t.set(n,n),e.set(r,r),this.clamp(t,e)}}(),qa.prototype.clampLength=function(t,e){var i=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,i))/i)},qa.prototype.dot=function(t){return this.x*t.x+this.y*t.y},qa.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},qa.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},qa.prototype.normalize=function(){return this.divideScalar(this.length())},qa.prototype.angle=function(){var t=Math.atan2(this.y,this.x);return 0>t&&(t+=2*Math.PI),t},qa.prototype.distanceTo=function(t){return Math.sqrt(this.distanceToSquared(t))},qa.prototype.distanceToSquared=function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},qa.prototype.isNearEnough=function(t){return this.distanceToSquared(t)<1e-8},qa.prototype.setLength=function(t){var e=this.length();return e?this.multiplyScalar(t/e):this},qa.prototype.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},qa.prototype.lerpVectors=function(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)},qa.prototype.rotateAround=function(t,e){var i=t?t.x:0,n=t?t.y:0,r=Math.cos(e),o=Math.sin(e),a=this.x-i,s=this.y-n;return this.x=a*r-s*o+i,this.y=a*o+s*r+n,this},e.assign(n.prototype,{isMatrix3:!0,set:function(t,e,i,n,r,o,a,s,l){var c=this.el;return c[0]=t,c[1]=n,c[2]=a,c[3]=e,c[4]=r,c[5]=s,c[6]=i,c[7]=o,c[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.el)},copy:function(t){var e=this.el,i=t.el;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},setFromMatrix4:function(t){var e=t.el;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},applyToBufferAttribute:function(){var t=new Na;return function(e){for(var i=0,n=e.count;n>i;i++)t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.applyMatrix3(this),e.setXYZ(i,t.x,t.y,t.z);return e}}(),multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.el,n=e.el,r=this.el,o=i[0],a=i[3],s=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],f=i[8],g=n[0],p=n[3],v=n[6],_=n[1],y=n[4],m=n[7],b=n[2],x=n[5],w=n[8];return r[0]=o*g+a*_+s*b,r[3]=o*p+a*y+s*x,r[6]=o*v+a*m+s*w,r[1]=l*g+c*_+h*b,r[4]=l*p+c*y+h*x,r[7]=l*v+c*m+h*w,r[2]=u*g+d*_+f*b,r[5]=u*p+d*y+f*x,r[8]=u*v+d*m+f*w,this},multiplyScalar:function(t){var e=this.el;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},determinant:function(){var t=this.el,e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],a=t[5],s=t[6],l=t[7],c=t[8];return e*o*c-e*a*l-i*r*c+i*a*s+n*r*l-n*o*s},getInverse:function(t){var e=t.el,i=this.el,n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=u*s-l*h,f=l*c-u*a,g=h*a-s*c,p=n*d+r*f+o*g;if(0===p)return this.identity();var v=1/p;return i[0]=d*v,i[1]=(o*h-u*r)*v,i[2]=(l*r-o*s)*v,i[3]=f*v,i[4]=(u*n-o*c)*v,i[5]=(o*a-l*n)*v,i[6]=g*v,i[7]=(r*c-h*n)*v,i[8]=(s*n-r*a)*v,this},transpose:function(){var t,e=this.el;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){var e=this.el;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,i,n,r,o,a){var s=Math.cos(r),l=Math.sin(r);this.set(i*s,i*l,-i*(s*o+l*a)+o+t,-n*l,n*s,-n*(-l*o+s*a)+a+e,0,0,1)},scale:function(t,e){var i=this.el;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.el,r=n[0],o=n[3],a=n[6],s=n[1],l=n[4],c=n[7];return n[0]=e*r+i*s,n[3]=e*o+i*l,n[6]=e*a+i*c,n[1]=-i*r+e*s,n[4]=-i*o+e*l,n[7]=-i*a+e*c,this},translate:function(t,e){var i=this.el;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this},equals:function(t){for(var e=this.el,i=t.el,n=0;9>n;n++)if(e[n]!==i[n])return!1;return!0},fromArray:function(t,e){e===i&&(e=0);for(var n=0;9>n;n++)this.el[n]=t[n+e];return this},toArray:function(t,e){t===i&&(t=[]),e===i&&(e=0);var n=this.el;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});var Xa=c.Math.Plane=function(t,e){this.normal=t!==i?t:new Na(1,0,0),this.constant=e!==i?e:0};e.assign(Xa.prototype,{set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new Na,e=new Na;return function(i,n,r){var o=t.subVectors(r,n).cross(e.subVectors(i,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){var t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return e===i&&(e=new Na),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(){var t=new Na;return function(e,n){n===i&&(n=new Na);var r=e.delta(t),o=this.normal.dot(r);if(0===o)return 0===this.distanceToPoint(e.start)?n.copy(e.start):i;var a=-(e.start.dot(this.normal)+this.constant)/o;return 0>a||a>1?i:n.copy(r).multiplyScalar(a).add(e.start)}}(),intersectsLine:function(t){var e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return 0>e&&i>0||0>i&&e>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return t===i&&(t=new Na),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new Na,e=new n;return function(i,n){var r=n||e.getNormalMatrix(i),o=this.coplanarPoint(t).applyMatrix4(i),a=this.normal.applyMatrix3(r).normalize();return this.constant=-o.dot(a),this}}(),translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});var Qa=c.Math.Ray=function(t,e){this.origin=t!==i?t.clone():new Na,this.direction=e!==i?e.clone():new Na};e.assign(Qa.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this.maxHitLen=t.maxHitLen,this},at:function(t,e){var i=e||new Na;return i.copy(this.direction).multiplyScalar(t).add(this.origin)},setMaxHitLength:function(t){this.maxHitLen=t},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},applyMatrix4:function(t){var e=this.maxHitLen;if(e){var i=this.direction.clone().multiplyScalar(e).add(this.origin);i.applyMatrix4(t)}return this.origin.applyMatrix4(t),this.direction.transformDirection(t),e&&(this.maxHitLen=this.origin.distanceTo(i)),this},intersectSphere:function(){var t=new Na;return function(e,i){t.subVectors(e.center,this.origin);var n=t.dot(this.direction),r=t.dot(t)-n*n,o=e.radius*e.radius;if(r>o)return null;var a=Math.sqrt(o-r),s=n-a,l=n+a;return 0>s&&0>l?null:0>s?this.at(l,i):this.at(s,i)}}(),intersectEllipsoid:function(){var t=new Na,e=new Na;return function(i,n){t.subVectors(i.center,this.origin),t.divide(i.radius),e.divideVectors(this.direction,i.radius);var r=e.lengthSq(),o=t.dot(e),a=t.dot(t)*r-o*o;if(a>r)return null;var s=Math.sqrt(r-a),l=(o-s)/r,c=(o+s)/r;return 0>l&&0>c?null:0>l?this.at(c,n):this.at(l,n)}}(),intersectBox:function(t,e){var i,n,r,o,a,s,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;if(l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,o=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,o=(t.min.y-u.y)*c),i>o||r>n)return null;if((r>i||i!==i)&&(i=r),(n>o||n!==n)&&(n=o),h>=0?(a=(t.min.z-u.z)*h,s=(t.max.z-u.z)*h):(a=(t.max.z-u.z)*h,s=(t.min.z-u.z)*h),i>s||a>n)return null;if((a>i||i!==i)&&(i=a),(n>s||n!==n)&&(n=s),0>n)return null;var d=i>=0?i:n,f=this.maxHitLen;return f&&d>f?null:this.at(d,e)},intersectTriangle:function(){var t=new Na,e=new Na,i=new Na,n=new Na;return function(r,o,a,s,l){e.subVectors(o,r),i.subVectors(a,r),n.crossVectors(e,i);var c,h=this.direction.dot(n);if(h>0){if(s)return null;c=1}else{if(!(0>h))return null;c=-1,h=-h}t.subVectors(this.origin,r);var u=c*this.direction.dot(i.crossVectors(t,i));if(0>u)return null;var d=c*this.direction.dot(e.cross(t));if(0>d||u+d>h)return null;var f=-c*t.dot(n);if(0>f)return null;var g=f/h,p=this.maxHitLen;return p&&g>p?null:this.at(g,l)}}()});var Ya=c.Math.Box3=function(t,e){this.min=t!==i?t:new Na(1/0,1/0,1/0),this.max=e!==i?e:new Na(-1/0,-1/0,-1/0)};e.assign(Ya.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){for(var e=1/0,i=1/0,n=1/0,r=-1/0,o=-1/0,a=-1/0,s=0,l=t.length;l>s;s+=3){var c=t[s],h=t[s+1],u=t[s+2];e>c&&(e=c),i>h&&(i=h),n>u&&(n=u),c>r&&(r=c),h>o&&(o=h),u>a&&(a=u)}return this.min.set(e,i,n),this.max.set(r,o,a),this},setFromPoints:function(t){this.makeEmpty();for(var e=0,i=t.length;i>e;e++)this.expandByPoint(t[e]);return this},clone:function(){return(new this.constructor).copy(this)},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByBox:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(){var t=[new Na,new Na,new Na,new Na,new Na,new Na,new Na,new Na];return function(e){return this.isEmpty()||(t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(t)),this}}()});var Za=c.Math.Sphere=function(t,e){this.center=t!==i?t:new Na,this.radius=e!==i?e:0};e.assign(Za.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(){var t=new Ya;return function(e,n){var r=this.center;n!==i?r.copy(n):t.setFromPoints(e).getCenter(r);for(var o=0,a=0,s=e.length;s>a;a++)o=Math.max(o,r.distanceToSquared(e[a]));return this.radius=Math.sqrt(o),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},empty:function(){return this.radius<=0},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){var e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){var n=this.center.distanceToSquared(t);return e===i&&(e=new Na),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return t===i&&(t=new Ya),t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});var Ja=c.Math.Frustum=function(t,e,n,r,o,a){this.planes=[t!==i?t:new Xa,e!==i?e:new Xa,n!==i?n:new Xa,r!==i?r:new Xa,o!==i?o:new Xa,a!==i?a:new Xa]};e.assign(Ja.prototype,{set:function(t,e,i,n,r,o){var a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){for(var e=this.planes,i=0;6>i;i++)e[i].copy(t.planes[i]);return this},setFromMatrix:function(t){var e=this.planes,i=t.el,n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],f=i[10],g=i[11],p=i[12],v=i[13],_=i[14],y=i[15];return e[0].setComponents(a-n,h-s,g-u,y-p).normalize(),e[1].setComponents(a+n,h+s,g+u,y+p).normalize(),e[2].setComponents(a+r,h+l,g+d,y+v).normalize(),e[3].setComponents(a-r,h-l,g-d,y-v).normalize(),e[4].setComponents(a-o,h-c,g-f,y-_).normalize(),e[5].setComponents(a+o,h+c,g+f,y+_).normalize(),this},intersectsObject:function(){var t=new Za;return function(e){var i=e.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),t.copy(i.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSprite:function(){var t=new Za;return function(e){return t.center.set(0,0,0),t.radius=.7071067811865476,t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(t){for(var e=this.planes,i=t.center,n=-t.radius,r=0;6>r;r++){var o=e[r].distanceToPoint(i);if(n>o)return!1}return!0},intersectsBox:function(){var t=new Na;return function(e){for(var i=this.planes,n=0;6>n;n++){var r=i[n];if(t.x=r.normal.x>0?e.max.x:e.min.x,t.y=r.normal.y>0?e.max.y:e.min.y,t.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(t)<0)return!1}return!0}}(),containsPoint:function(t){for(var e=this.planes,i=0;6>i;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}});var Ka=c.Math.Matrix4=function(){this.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};e.assign(Ka.prototype,{set:function(t,e,i,n,r,o,a,s,l,c,h,u,d,f,g,p){var v=this.el;return v[0]=t,v[4]=e,v[8]=i,v[12]=n,v[1]=r,v[5]=o,v[9]=a,v[13]=s,v[2]=l,v[6]=c,v[10]=h,v[14]=u,v[3]=d,v[7]=f,v[11]=g,v[15]=p,this},clone:function(){return(new Ka).fromArray(this.el)},fromArray:function(t,e){e===i&&(e=0);for(var n=this.el,r=0;16>r;r++)n[r]=t[r+e];return this},getElements:function(){return this.el},scale:function(t){var e=this.el,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this},makeRotationFromEuler:function(t){var e=this.el,i=t._x,n=t._y,r=t._z,o=t._order,a=Math.cos(i),s=Math.sin(i),l=Math.cos(n),c=Math.sin(n),h=Math.cos(r),u=Math.sin(r);if("XYZ"===o){var d=a*h,f=a*u,g=s*h,p=s*u;e[0]=l*h,e[4]=-l*u,e[8]=c,e[1]=f+g*c,e[5]=d-p*c,e[9]=-s*l,e[2]=p-d*c,e[6]=g+f*c,e[10]=a*l}else if("YXZ"===o){var v=l*h,_=l*u,y=c*h,m=c*u;e[0]=v+m*s,e[4]=y*s-_,e[8]=a*c,e[1]=a*u,e[5]=a*h,e[9]=-s,e[2]=_*s-y,e[6]=m+v*s,e[10]=a*l}else if("ZXY"===o){v=l*h,_=l*u,y=c*h,m=c*u;e[0]=v-m*s,e[4]=-a*u,e[8]=y+_*s,e[1]=_+y*s,e[5]=a*h,e[9]=m-v*s,e[2]=-a*c,e[6]=s,e[10]=a*l}else if("ZYX"===o){d=a*h,f=a*u,g=s*h,p=s*u;e[0]=l*h,e[4]=g*c-f,e[8]=d*c+p,e[1]=l*u,e[5]=p*c+d,e[9]=f*c-g,e[2]=-c,e[6]=s*l,e[10]=a*l}else if("YZX"===o){var b=a*l,x=a*c,w=s*l,C=s*c;e[0]=l*h,e[4]=C-b*u,e[8]=w*u+x,e[1]=u,e[5]=a*h,e[9]=-s*h,e[2]=-c*h,e[6]=x*u+w,e[10]=b-C*u}else if("XZY"===o){b=a*l,x=a*c,w=s*l,C=s*c;e[0]=l*h,e[4]=-u,e[8]=c*h,e[1]=b*u+C,e[5]=a*h,e[9]=x*u-w,e[2]=w*u-x,e[6]=s*h,e[10]=C*u+b}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(t){var e=this.el,i=t._x,n=t._y,r=t._z,o=t._w,a=i+i,s=n+n,l=r+r,c=i*a,h=i*s,u=i*l,d=n*s,f=n*l,g=r*l,p=o*a,v=o*s,_=o*l;return e[0]=1-(d+g),e[4]=h-_,e[8]=u+v,e[1]=h+_,e[5]=1-(c+g),e[9]=f-p,e[2]=u-v,e[6]=f+p,e[10]=1-(c+d),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},getInverse:function(t){var e=this.el,i=t.el,n=i[0],r=i[1],o=i[2],a=i[3],s=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],f=i[10],g=i[11],p=i[12],v=i[13],_=i[14],y=i[15],m=d*_*h-v*f*h+v*c*g-l*_*g-d*c*y+l*f*y,b=p*f*h-u*_*h-p*c*g+s*_*g+u*c*y-s*f*y,x=u*v*h-p*d*h+p*l*g-s*v*g-u*l*y+s*d*y,w=p*d*c-u*v*c-p*l*f+s*v*f+u*l*_-s*d*_,C=n*m+r*b+o*x+a*w;if(0===C)return this.identity();var S=1/C;return e[0]=m*S,e[1]=(v*f*a-d*_*a-v*o*g+r*_*g+d*o*y-r*f*y)*S,e[2]=(l*_*a-v*c*a+v*o*h-r*_*h-l*o*y+r*c*y)*S,e[3]=(d*c*a-l*f*a-d*o*h+r*f*h+l*o*g-r*c*g)*S,e[4]=b*S,e[5]=(u*_*a-p*f*a+p*o*g-n*_*g-u*o*y+n*f*y)*S,e[6]=(p*c*a-s*_*a-p*o*h+n*_*h+s*o*y-n*c*y)*S,e[7]=(s*f*a-u*c*a+u*o*h-n*f*h-s*o*g+n*c*g)*S,e[8]=x*S,e[9]=(p*d*a-u*v*a-p*r*g+n*v*g+u*r*y-n*d*y)*S,e[10]=(s*v*a-p*l*a+p*r*h-n*v*h-s*r*y+n*l*y)*S,e[11]=(u*l*a-s*d*a-u*r*h+n*d*h+s*r*g-n*l*g)*S,e[12]=w*S,e[13]=(u*v*o-p*d*o+p*r*f-n*v*f-u*r*_+n*d*_)*S,e[14]=(p*l*o-s*v*o-p*r*c+n*v*c+s*r*_-n*l*_)*S,e[15]=(s*d*o-u*l*o+u*r*c-n*d*c-s*r*f+n*l*f)*S,this},makeRotationAxis:function(t,e){var i=Math.cos(e),n=Math.sin(e),r=1-i,o=t.x,a=t.y,s=t.z,l=r*o,c=r*a;return this.set(l*o+i,l*a-n*s,l*s+n*a,0,l*a+n*s,c*a+i,c*s-n*o,0,l*s-n*a,c*s+n*o,r*s*s+i,0,0,0,0,1),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(t,e){var i=t.el,n=e.el,r=this.el,o=i[0],a=i[4],s=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],f=i[2],g=i[6],p=i[10],v=i[14],_=i[3],y=i[7],m=i[11],b=i[15],x=n[0],w=n[4],C=n[8],S=n[12],I=n[1],M=n[5],T=n[9],E=n[13],P=n[2],D=n[6],O=n[10],R=n[14],z=n[3],k=n[7],A=n[11],V=n[15];return r[0]=o*x+a*I+s*P+l*z,r[4]=o*w+a*M+s*D+l*k,r[8]=o*C+a*T+s*O+l*A,r[12]=o*S+a*E+s*R+l*V,r[1]=c*x+h*I+u*P+d*z,r[5]=c*w+h*M+u*D+d*k,r[9]=c*C+h*T+u*O+d*A,r[13]=c*S+h*E+u*R+d*V,r[2]=f*x+g*I+p*P+v*z,r[6]=f*w+g*M+p*D+v*k,r[10]=f*C+g*T+p*O+v*A,r[14]=f*S+g*E+p*R+v*V,r[3]=_*x+y*I+m*P+b*z,r[7]=_*w+y*M+m*D+b*k,r[11]=_*C+y*T+m*O+b*A,r[15]=_*S+y*E+m*R+b*V,this},lookAt:function(){var t=new Na,e=new Na,i=new Na;return function(n,r,o){var a=this.el;return i.subVectors(n,r),0===i.lengthSq()&&(i.z=1),i.normalize(),t.crossVectors(o,i),0===t.lengthSq()&&(1===Math.abs(o.z)?i.x+=1e-4:i.z+=1e-4,i.normalize(),t.crossVectors(o,i)),t.normalize(),e.crossVectors(i,t),a[0]=t.x,a[4]=e.x,a[8]=i.x,a[1]=t.y,a[5]=e.y,a[9]=i.y,a[2]=t.z,a[6]=e.z,a[10]=i.z,this}}(),extractScale:function(){var t;return function(e){t===i&&(t=new Na),e===i&&(e=new Na);var n=t.setFromMatrixColumn(this,0).length(),r=t.setFromMatrixColumn(this,1).length(),o=t.setFromMatrixColumn(this,2).length();return e.set(n,r,o),e}}(),extractRotation:function(){var t;return function(e){t===i&&(t=new Na),e===i&&(e=new Ka);var n=this.el,r=e.el,o=1/t.setFromMatrixColumn(e,0).length(),a=1/t.setFromMatrixColumn(e,1).length(),s=1/t.setFromMatrixColumn(e,2).length();return n[0]=r[0]*o,n[1]=r[1]*o,n[2]=r[2]*o,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[8]=r[8]*s,n[9]=r[9]*s,n[10]=r[10]*s,this}}(),multiplyScalar:function(t){var e=this.el;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},getPosition:function(t){return t===i&&(t=new Na),t.setFromMatrixColumn(this,3)},setPosition:function(t){var e=this.el;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},toArray:function(t,e){t===i&&(t=[]),e===i&&(e=0);var n=this.el;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t},determinant:function(){var t=this.el,e=t[0],i=t[4],n=t[8],r=t[12],o=t[1],a=t[5],s=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14],f=t[3],g=t[7],p=t[11],v=t[15];return f*(+r*s*h-n*l*h-r*a*u+i*l*u+n*a*d-i*s*d)+g*(+e*s*d-e*l*u+r*o*u-n*o*d+n*l*c-r*s*c)+p*(+e*l*h-e*a*d-r*o*h+i*o*d+r*a*c-i*l*c)+v*(-n*a*c-e*s*h+e*a*u+n*o*h-i*o*u+i*s*c)},copy:function(t){var e=this.el,i=t.el;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},compose:function(t,e,i){var n=this.el,r=e._x,o=e._y,a=e._z,s=e._w,l=r+r,c=o+o,h=a+a,u=r*l,d=r*c,f=r*h,g=o*c,p=o*h,v=a*h,_=s*l,y=s*c,m=s*h,b=i.x,x=i.y,w=i.z;return n[0]=(1-(g+v))*b,n[1]=(d+m)*b,n[2]=(f-y)*b,n[3]=0,n[4]=(d-m)*x,n[5]=(1-(u+v))*x,n[6]=(p+_)*x,n[7]=0,n[8]=(f+y)*w,n[9]=(p-_)*w,n[10]=(1-(u+g))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this},decompose:function(){var t=new Na,e=new Ka;return function(i,n,r){var o=this.el,a=t.set(o[0],o[1],o[2]).length(),s=t.set(o[4],o[5],o[6]).length(),l=t.set(o[8],o[9],o[10]).length(),c=this.determinant();0>c&&(a=-a),i.x=o[12],i.y=o[13],i.z=o[14],e.copy(this);var h=1/a,u=1/s,d=1/l;return e.el[0]*=h,e.el[1]*=h,e.el[2]*=h,e.el[4]*=u,e.el[5]*=u,e.el[6]*=u,e.el[8]*=d,e.el[9]*=d,e.el[10]*=d,n.setFromRotationMatrix(e),r.x=a,r.y=s,r.z=l,this}}()});var $a=c.Math.Triangle=function(t,e,n){this.a=t!==i?t:new Na,this.b=e!==i?e:new Na,this.c=n!==i?n:new Na};e.assign($a,{barycoordFromPoint:function(){var t=new Na,e=new Na,i=new Na;return function(n,r,o,a,s){t.subVectors(a,r),e.subVectors(o,r),i.subVectors(n,r);var l=t.dot(t),c=t.dot(e),h=t.dot(i),u=e.dot(e),d=e.dot(i),f=l*u-c*c,g=s||new Na;if(0===f)return g.set(-2,-1,-1);var p=1/f,v=(u*h-c*d)*p,_=(l*d-c*h)*p;return g.set(1-v-_,_,v)}}()});var ts=c.Math.Euler=function(t,e,i,n,r){this.set(t,e,i,n,r)};ts.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],ts.DefaultOrder="XYZ",ts.ReverseOrder=function(t){return t=t[2]+t[1]+t[0],t.toUpperCase()},e.defineProperties(ts.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this.onChangeCallback()}}}),e.assign(ts.prototype,{set:function(t,e,i,n,r){return Vn(t)&&(r=i,n=e,i=t[2],e=t[1],t=t[0]),n?r&&(n=ts.ReverseOrder(n)):n="ZYX",this._x=t||0,this._y=e||0,this._z=i||0,this._order=n||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,e,i){var n=c.Math.clamp,r=t.el||t,o=r[0],a=r[4],s=r[8],l=r[1],h=r[5],u=r[9],d=r[2],f=r[6],g=r[10];return e=e||this._order,"XYZ"===e?(this._y=Math.asin(n(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-u,g),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,h),this._z=0)):"YXZ"===e?(this._x=Math.asin(-n(u,-1,1)),Math.abs(u)<.99999?(this._y=Math.atan2(s,g),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-d,o),this._z=0)):"ZXY"===e?(this._x=Math.asin(n(f,-1,1)),Math.abs(f)<.99999?(this._y=Math.atan2(-d,g),this._z=Math.atan2(-a,h)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===e?(this._y=Math.asin(-n(d,-1,1)),Math.abs(d)<.99999?(this._x=Math.atan2(f,g),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-a,h))):"YZX"===e?(this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-u,h),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(s,g))):"XZY"===e?(this._z=Math.asin(-n(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(f,h),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-u,g),this._y=0)):console.warn("unsupported order: "+e),this._order=e,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var t=new Ka;return function(e,i,n){return t.makeRotationFromQuaternion(e),this.setFromRotationMatrix(t,i,n)}}(),setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(){var t=new Ua;return function(e){return t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==i&&(this._order=t[3]),this.onChangeCallback(),this},toArray:function(t,e){return t===i&&(t=[]),e===i&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new Na(this._x,this._y,this._z)},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}});var es={ms_ac:function(t,e){for(var i=e.ms_ac,n=0;n<i.length;n++)vr(t,i[n])},ms_listener:function(t){t.addListeners=function(){var t=this,e=0,i=Di;for(u.mockTouch&&(i=Ti.concat(Ei).concat(Pi));e<i.length;e++){var n=i[e];"wheel"===n&&!t.handle_wheel&&t.handle_mousewheel&&(t.handle_wheel=function(e){Yn(t,e)}),t["handle_"+n]&&gr(n,t.getView(),t)}},t.removeListeners=function(){for(var t=this,e=0;e<Di.length;e++)t["handle_"+Di[e]]&&pr(Di[e],t.getView(),t)}},ms_fire:function(t){t.mp=function(t,e,i){this.addPropertyChangeListener(t,e,i)},t.ump=function(t,e){this.removePropertyChangeListener(t,e)},t.fp=function(t,e,i,n,r){return this.firePropertyChange(t,e,i,n,r)},t.addPropertyChangeListener=function(t,e,i){var n=this;n._62I||(n._62I=new vc),n._62I.add(t,e,i)},t.removePropertyChangeListener=function(t,e){this._62I&&this._62I.remove(t,e)},t.firePropertyChange=function(t,e,i,n,r){if(n){if(n(e,i))return!1}else if(e===i)return!1;var o=this,a=r||{};return a.property=t,a.oldValue=e,a.newValue=i,a.source=o,a.data=o,o._62I&&o._62I.fire(a),o.onPropertyChanged&&o.onPropertyChanged(a),!0}},ms_attr:function(t){t.a=function(t,e){var i=this;if(2===arguments.length)i.setAttr(t,e);else{if(!kn(t))return i.getAttr(t);for(var n in t)i.setAttr(n,t[n])}return i},t.getAttr=function(t,e){if(e===i&&(e=1),this._attrObject&&t in this._attrObject)return this._attrObject[t];if(this.getImage){var n=this.getImage();if(On(n)&&(n=qi[n]),kn(n)&&"dataBindings"in n)for(var r=n.dataBindings,o=r.length-1;o>=0;o--){var a=r[o];if(a.attr===t){if("defaultValue"in a)return a.defaultValue;break}}}return e?f[t]:i},t.setAttr=function(t,e){var n=this;n._attrObject||(n._attrObject={});var r=n._attrObject[t];e===i?delete n._attrObject[t]:n._attrObject[t]=e,n.fp&&n.fp("a:"+t,r,e)&&n.onAttrChanged&&n.onAttrChanged(t,r,e)},t.getSerializableAttrs=function(){var t,e={};for(t in this._attrObject)e[t]=1;return e}},ms_bnb:function(t){t.getBodyColor=function(t){return t.s("body.color")},t.getBorderColor=function(t){return t.s("border.color")}},_51o:function(t){t.mi=function(t,e,i){this.addInteractorListener(t,e,i)},t.umi=function(t,e){this.removeInteractorListener(t,e)},t.fi=function(t){this.fireInteractorEvent(t)},t.addInteractorListener=function(t,e,i){var n=this;n._63I||(n._63I=new vc),n._63I.add(t,e,i)},t.removeInteractorListener=function(t,e){this._63I&&this._63I.remove(t,e)},t.fireInteractorEvent=function(t){this._63I&&this._63I.fire(t)},t.setInteractors=function(t){var e=this,i=e._interactors;i&&i.each((function(t){t.tearDown()})),Vn(t)&&(t=new gc(t)),e._interactors=t,t&&t.each((function(t){t.setUp()})),e.fp("interactors",i,t),e.invalidateSelection()},t.getInteractors=function(){return this._interactors}},_49o:function(t){t._44O=l,t._45O=l,t.getTopPainters=function(){return this._44O},t.getBottomPainters=function(){return this._45O},t.addTopPainter=function(t){var e=this;e._44O||(e._44O=new gc),e._44O.contains(t)||(e._44O.add(t),e.redraw&&e.redraw())},t.removeTopPainter=function(t){var e=this;e._44O&&(e._44O.remove(t),e.redraw&&e.redraw())},t.addBottomPainter=function(t){var e=this;e._45O||(e._45O=new gc),e._45O.contains(t)||(e._45O.add(t),e.redraw&&e.redraw())},t.removeBottomPainter=function(t){var e=this;e._45O&&(e._45O.remove(t),e.redraw&&e.redraw())},t._93db=function(t,e){var i=this;i._45O&&i._45O.each((function(n){n.draw?n.draw(t,e):n.call(i,t,e)}))},t._92db=function(t,e){var i=this;i._44O&&i._44O.each((function(n){n.draw?n.draw(t,e):n.call(i,t,e)}))}},ms_sm:function(t){t.sm=function(){return this.getSelectionModel()},t.setSelectableFunc=function(t){this.sm().setFilterFunc(t)},t.getSelectableFunc=function(){return this.sm().getFilterFunc()},t.getSelectionModel=function(){var t=this;return t._selectionModel?t._selectionModel:t.dm().sm()},t.isSelectionModelShared=function(){return!this._selectionModel},t.setSelectionModelShared=function(t){var e=this,i=!e._selectionModel,n=e.handleSelectionChange,r=e.dm();i!==t&&(e.invalidateSelection&&e.invalidateSelection(),t?(r.sm().ms(n,e),e._selectionModel.ums(n,e),e._selectionModel.dispose(),e._selectionModel=l):(r.sm().ums(n,e),e._selectionModel=new mc(r),e._selectionModel.ms(n,e)),e.onSelectionModelSharedChanged(),e.fp("selectionModelShared",i,t))},t.onSelectionModelSharedChanged=function(){var t=this;t.redraw(),t.invalidateSelection&&t.invalidateSelection()},t.removeSelection=function(){var t=this.dm();t.beginTransaction(),this.sm().toSelection().each(t.remove,t),t.endTransaction()},t.selectAll=function(){var t=this;t.sm().ss(t.dm().toDatas((function(e){return t.isVisible(e)&&t.isSelectable(e)})))},t.isSelected=function(t){return this.sm().co(t)},t.isSelectedById=function(t){var e=this.dm().getDataById(t);return!!e&&this.isSelected(e)},t.isSelectable=function(t){return this.sm().isSelectable(t)}},ms_tx:function(t){t._64I=0,t._65O=0,t.isScrollable=function(){return this.getWidth()<this._64I},t._40o=function(){return this.isScrollable()},t.getLogicalPoint=function(t){return dl(t,this._canvas||this._view,this.tx(),this.ty?this.ty():0)},t.tx=function(t){return t===i?this.getTranslateX():void this.setTranslateX(t)},t.getTranslateX=function(){return this._65O},t.setTranslateX=function(t){var e=this,i=e.getWidth()-e._64I;i>t&&(t=i),t>0&&(t=0),t=I(t);var n=e._65O;e._65O=t,e.fp(je,n,t)}},ms_ty:function(t){t._23Q=0,t._66O=0,t._41o=function(){return this.getHeight()<this._23Q},t.getLogicalPoint=function(t){return dl(t,this._canvas||this._view,this.tx?this.tx():0,this.ty())},t.ty=function(t){return t===i?this.getTranslateY():void this.setTranslateY(t)},t.getTranslateY=function(){return this._66O},t.setTranslateY=function(t){var e=this,i=e.getHeight()-e._23Q;i>t&&(t=i),t>0&&(t=0),t=I(t);var n=e._66O;e._66O=t,e.fp(He,n,t)}},ms_txy:function(t){t._65O=0,t._66O=0,t.tx=function(t){return t===i?this.getTranslateX():void this.setTranslateX(t)},t.ty=function(t){return t===i?this.getTranslateY():void this.setTranslateY(t)},t.onTranslateEnded=function(){},t.setTranslate=function(t,e,i){var n=this;if(i=Xn(i)){n._65I&&n._65I.stop(!0);var r=n.tx(),o=n.ty();i.action=function(i){n.setTranslate(r+(t-r)*i,o+(e-o)*i)},i._37o=function(){delete n._66I,delete n._65I,n.onTranslateEnded()},n._66I=1,n._65I=Us(i)}else n.tx(t),n.ty(e)},t.getTranslateX=function(){return this._65O},t.setTranslateX=function(t){var e=this;t=e.adjustTranslateX(t);var i=e._65O;e._65O=t,e.fp(je,i,t)},t.getTranslateY=function(){return this._66O},t.setTranslateY=function(t){var e=this;t=e.adjustTranslateY(t);var i=e._66O;e._66O=t,e.fp(He,i,t)},t.adjustTranslateX=function(t){return I(t)},t.adjustTranslateY=function(t){return I(t)},t.translate=function(t,e,i){this.setTranslate(this.tx()+t,this.ty()+e,i)},t.getLogicalPoint=function(t){var e=this;return dl(t,this._canvas||e._view,e.tx(),e.ty())}},ms_dm:function(t){t.dm=function(t){return t?void this.setDataModel(t):this.getDataModel()},t.getDataModel=function(){return this._dataModel}},ms_lp:function(t){t.lp=function(t){return this.getLogicalPoint(t)}},ms_v:function(e){e._disabled=!1,e.setDisabled=function(t,e){var i=this,n=i._disabled;n!==t&&(n&&(pl(i._63O),delete i._63O),t&&(Mr(i._view,i._63O=zr(e)),i.iv()),i._disabled=t,i.fp("disabled",n,t))},e.isDisabled=function(){return this._disabled},e.getDisabledDiv=function(){return this._63O},e.getView=function(){return this._view},e.addToDOM=function(e){var i=this,n=i.getView(),r=n.style;e=e||s.body,e.appendChild(n),r.left="0",r.right="0",r.top="0",r.bottom="0",w(t,"resize",(function(){i.iv()})),i.iv()},e.getWidth=function(){return this._view.clientWidth},e.getHeight=function(){return this._view.clientHeight},e.setWidth=function(t){var e=this;e._view.style.width=t+It,e.iv(),e.fp&&e.fp(Bt,l,t)},e.setHeight=function(t){var e=this;e._view.style.height=t+It,e.iv(),e.fp&&e.fp(Lt,l,t)},e.setFocus=function(t){var e=this,i=e._currentEditor;return!(t&&i&&(i.getView&&(i=i.getView()),i.contains(t.target)))&&(jr(e._view),e.endEditing&&e.endEditing(),e.fireViewEvent("focus"),!0)},e.iv=function(t){this.invalidate(t)},e.invalidate=function(t){var e=this;e._68I||(e._68I=1,Ls(e.validate,e,l,t),e.onInvalidated&&e.onInvalidated(),e.fireViewEvent("invalidate"))},e.validate=function(){var t=this,e=t._view;if(t._68I&&(delete t._68I,e.parentNode))if(0===e.offsetWidth&&0===e.offsetHeight&&t._67I!==l)t._67I===i&&(t._67I=u.reinvalidateCount),t._67I>0?t._67I--:t._67I=l,t.iv();else{t.fireViewEvent("beginValidate"),t.validateImpl(),t.onValidated&&t.onValidated(),t.fireViewEvent("validate");var n=t._63O;n&&(e.lastChild!==n&&(pl(n),Mr(e,n)),Gr(n,0,0,t.getWidth(),t.getHeight())),vn(t),Jl(t),Lg(t)}},e.layout=function(t,e,i,n){1===arguments.length?Gr(this,t):Gr(this,t,e,i,n)},e.addViewListener=function(t,e,i){var n=this;n._67O||(n._67O=new vc),n._67O.add(t,e,i)},e.removeViewListener=function(t,e){this._67O.remove(t,e)},e.fireViewEvent=function(t){var e=this;e._67O&&(On(t)&&(t={kind:t}),e._67O.fire(t)),u.viewListener&&u.viewListener(e,t)}},ms_tip:function(t){t.setToolTipEnabled=function(t){var e=this;t?lt||e._13o||(e.enableToolTip(),e.fp("toolTipEnabled",!1,!0)):e._13o&&(e.disableToolTip(),e.fp("toolTipEnabled",!0,!1))},t.isToolTipEnabled=function(){return!!this._13o},t.enableToolTip=function(){var t=this;if(!lt&&!t._13o){t._13o=function(e){var i=t.getToolTip(e);i!=l?u.toolTipContinual&&u.isToolTipShowing()?ls(e,i):(cs(),zi={timeout:J(Vi,ns),e:e,info:i}):cs()};var e=t.getView();w(e,_i,t._13o),w(e,"mouseleave",u.hideToolTip)}},t.disableToolTip=function(){var t=this;if(t._13o){var e=t.getView();C(e,_i,t._13o),C(e,"mouseleave",u.hideToolTip),delete t._13o}},t.getToolTip=function(t){var e=this;if(e.getDataAt){var i=e.getDataAt(t);return i?i.getToolTip():l}return e.getValue?e.getValue():void 0}},_52o:function(t){t._zoom=1,t._29I=un,t.zoomIn=function(t,e){this.setZoom(this._zoom*Is,t,e)},t.zoomOut=function(t,e){this.setZoom(this._zoom/Is,t,e)},t.zoomReset=function(t,e){this.setZoom(1,t,e)},t.scrollZoomIn=function(t){this.setZoom(this._zoom*Ms,l,t)},t.scrollZoomOut=function(t){this.setZoom(this._zoom/Ms,l,t)},t.pinchZoomIn=function(t){this.setZoom(this._zoom*Ts,l,t)},t.pinchZoomOut=function(t){this.setZoom(this._zoom/Ts,l,t)},t.adjustZoom=function(t){return Ps>t?Ps:t>Es?Es:t},t.getZoom=function(){return this._zoom},t.setZoom=function(t,e,i){var n=this;if(e=Xn(e)){n._14o&&n._14o.stop(!0);var r=n._zoom;e.action=function(e){n._96O(r+(t-r)*e,i)},e._37o=function(){delete n._zooming,delete n._14o,n.onZoomEnded()},n._zooming=1,n._14o=Us(e)}else n._96O(t,i)},t._96O=function(t,e){var i=this;if(t=i.adjustZoom(t),t!==i._zoom){i.validate();var n=i._29I,r=i._zoom;0!==n.width&&0!==n.height&&(e=e||{x:n.x+n.width/2,y:n.y+n.height/2},i.tx((e.x-n.x)*r-e.x*t),i.ty((e.y-n.y)*r-e.y*t)),i._zoom=t,i.fp("zoom",r,t)}}},ms_edge:function(t){t._2I=function(t){var e=this;e._44I||(e._44I=new gc),e._42I||(e._42I=new gc),e._44I.add(t),e._42I.add(t),e._20I()},t._4I=function(t){var e=this;e._44I||(e._44I=new gc),e._43I||(e._43I=new gc),e._44I.add(t),e._43I.add(t),e._20I()},t._16I=function(t){var e=this;e._44I.remove(t),e._42I.remove(t),e._44I.isEmpty()&&delete e._44I,e._42I.isEmpty()&&delete e._42I,e._20I()},t._18I=function(t){var e=this;e._44I.remove(t),e._43I.remove(t),e._44I.isEmpty()&&delete e._44I,e._43I.isEmpty()&&delete e._43I,e._20I()},t._20I=function(){var t,e=this;(delete e._45I,e._44I&&!e._44I.isEmpty())?(e._44I.each((function(i){i.isLooped()&&(t||(t={}),t[i._id]||(e._45I||(e._45I=new gc),e._45I.add(i),t[i._id]=i))})),t?(e._70O=new gc,e._44I.each((function(i){t[i._id]?"A"===t[i._id]||(t[i._id]="A",e._70O.add(i)):e._70O.add(i)}))):e._70O=e._44I):delete e._70O},t.hasAgentEdges=function(){return!!this._49I&&!this._49I.isEmpty()},t.getSourceAgentEdges=function(){return this._46I},t.getTargetAgentEdges=function(){return this._47I},t._1I=function(t){var e=this;e._46I||(e._46I=new gc),e._48I||(e._48I=new gc),e._46I.add(t),e._48I.add(t),e._19I()},t._3I=function(t){var e=this;e._47I||(e._47I=new gc),e._48I||(e._48I=new gc),e._47I.add(t),e._48I.add(t),e._19I()},t._15I=function(t){var e=this;e._46I.remove(t),e._48I.remove(t),e._46I.isEmpty()&&delete e._46I,e._48I.isEmpty()&&delete e._48I,e._19I()},t._17I=function(t){var e=this;e._47I.remove(t),e._48I.remove(t),e._47I.isEmpty()&&delete e._47I,e._48I.isEmpty()&&delete e._48I,e._19I()},t._19I=function(){var t=this;delete t._49I;var e=t._48I;if(e&&!e.isEmpty()){var i={};e.each((function(e){i[e._id]?t._49I||(t._49I=new gc):i[e._id]=e})),t._49I?e.each((function(e){i[e._id]&&(t._49I.add(e),delete i[e._id])})):t._49I=e}},t.getLoopedEdges=function(){return this._45I},t.getEdges=function(){return this._70O},t.getAgentEdges=function(){return this._49I},t.getSourceEdges=function(){return this._42I},t.getTargetEdges=function(){return this._43I},t._8I=function(){this._70O&&this._70O.each((function(t){t._7I()}))}}};Qn(u,{getVersion:function(){return"7.0.9"}},!0),Qn(u,{numberDigits:5,crossOrigin:"",baseZIndex:i,isTouchable:lt,devicePixelRatio:t.devicePixelRatio?t.devicePixelRatio:1,reinvalidateCount:3,hitMaxArea:3e3,imageCacheThreshold:20,autoMakeVisible:!0,autoHideScrollBar:!0,disabledOpacity:.4,disabledBackground:g.disabledBackground,forceHierarchicalSerialization:!0,hoverDelay:600,clickDelay:200,toolTipDelay:800,toolTipContinual:!1,getDragger:function(){return Xr},lineCap:"butt",lineJoin:"round",imageGradient:"linear.northeast",dashPattern:[16,16],blockMinSize:1,encodeStringKey:null,doubleClickRange:1,doubleTouchRange:20,touchMoveThreshold:10,animDuration:200,animEasing:function(t){return t*t},labelColor:Ia,labelSelectColor:Ma,labelFont:"12px arial, sans-serif",widgetIndent:lt?30:20,widgetRowHeight:lt?30:20,widgetHeaderHeight:lt?32:22,widgetTitleHeight:lt?34:24,scrollBarColor:ha,scrollBarSize:7,scrollBarTimeout:1e3,scrollBarMinLength:20,scrollBarInteractiveSize:lt?32:16,zoomIncrement:1.3,scrollZoomIncrement:1.05,pinchZoomIncrement:1.08,pinchZoomThreshold:1,zoomMax:20,zoomMin:.01,segmentResolution:12,shapeResolution:24,shapeSide:24,intersectionLineRect:or,intersectionLineLine:ar,isEnter:po,isEsc:vo,isDelete:eo,isSpace:go,isLeft:co,isUp:ho,isRight:uo,isDown:fo,isTouchEvent:Nr,getTarget:Wr,isString:On,isNumber:Rn,isBoolean:zn,isArray:Vn,isSelectAll:to,isFunction:An,isObject:kn,getPropertyValue:sr,setPropertyValue:lr,addMethod:Qn,isMobile:function(){var e;return function(){return e!==i||(e=!1,function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||t.opera)),e}}(),createGradient:function(t,e,i,n,r,o,a,s){var l=Yo[e];return l(t,i,n,r,o,a,s)},appendToScreen:function(t){t=t.getView?t.getView():t,(s.fullscreenElement||s.mozFullScreenElement||s.webkitFullscreenElement||s.msFullscreenElement||s.body).appendChild(t)},encodeString:function(t){return c.Math.encodeBase64(t,u.encodeStringKey)},decodeString:function(t){return c.Math.decodeBase64(t,u.encodeStringKey)},findView:function(t){var e=function(t,i){var n=i._ht;n&&t.push(n);var r=i.children,o=r.length;if(o)for(var a=0;o>a;a++)e(t,r[a])},i=[];e(i,s.body);var n=function(t,e){for(var n="2d"===e?Jc.GraphView:ag.Graph3dView,r=0,o=t.length;o>r;r++)if(t[r]instanceof n)return i[r];return null};return"all"===t?i:"2d"===t?n(i,"2d"):"3d"===t?n(i,"3d"):n(i,"3d")||n(i,"2d")},toggleFullscreen:function(t){var e=t.getView();if(s.fullscreenElement||s.mozFullScreenElement||s.webkitFullscreenElement||s.msFullscreenElement)s.exitFullscreen?s.exitFullscreen():s.msExitFullscreen?s.msExitFullscreen():s.mozCancelFullScreen?s.mozCancelFullScreen():s.webkitExitFullscreen&&s.webkitExitFullscreen();else{var i=!0;if(t.isSelfViewEvent){var n=t.getX(),r=t.getY(),o=t.getWidth(),a=t.getHeight(),l=e.style.background,h=e.style.backgroundColor;l||h||(e.style.backgroundColor="white"),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen();var u=setInterval((function(){if(e!==(s.fullscreenElement||s.mozFullScreenElement||s.webkitFullscreenElement||s.msFullscreenElement))clearInterval(u),t.setX(n),t.setY(r),t.setWidth(o),t.setHeight(a),t._fullscreen=!1,e.style.oldBackgroundColor=h,t.iv();else{var l=c.Default.getWindowInfo();(i||l.width!==t.getWidth()||l.height!==t.getHeight())&&(t.setX(l.left),t.setY(l.top),t.setWidth(l.width),t.setHeight(l.height),t._fullscreen=!0,t.iv(),i=!1)}}),500)}else{var d=e.style.left,f=e.style.top;o=e.style.width,a=e.style.height,l=e.style.background,h=e.style.backgroundColor;l||h||(e.style.backgroundColor="white"),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen();u=setInterval((function(){if(e!==(s.fullscreenElement||s.mozFullScreenElement||s.webkitFullscreenElement||s.msFullscreenElement))clearInterval(u),e.style.left=d,e.style.top=f,e.style.width=o,e.style.height=a,e.style.oldBackgroundColor=h,t.iv();else{var n=c.Default.getWindowInfo();(i||n.width!==t.getWidth()||n.height!==t.getHeight())&&(Gr(t),i=!1)}}),500)}}},appendTimeStamp:function(t){return t},setCompType:function(t,e){An(e)||kn(e)?Ji[t]=e:Kl(t)},getCompType:function(t){var e=Ji[t];return e===i&&en.test(t)&&Kl(t),e},getCompTypeMap:function(){return Ji},drawCompType:function(t,e,i,n,r,o){t(e,i,n,r,o)},numberListener:function(){var t={46:1,8:1,9:1,27:1,13:1,109:1,110:1,189:1,190:1};return function(e){var i=e.keyCode;t[i]||65===i&&u.isCtrlDown(e)||86===i&&u.isCtrlDown(e)||67===i&&u.isCtrlDown(e)||88===i&&u.isCtrlDown(e)||i>=35&&40>=i||(e.shiftKey||48>i||i>57)&&(96>i||i>105)&&e.preventDefault()}}(),ignoreKeyCodes:[122,123],preventDefault:function(t){var e=t.target.tagName;("DIV"===e||"CANVAS"===e)&&!(u.ignoreKeyCodes.indexOf(t.keyCode)>=0)&&("keydown"!==t.type||co(t)||uo(t)||ho(t)||fo(t)||eo(t)||65===t.keyCode&&(t.metaKey||t.ctrlKey))&&(t.preventDefault(),t.preventManipulation&&t.preventManipulation())},getWindowInfo:function(){var e=s.documentElement,i=e&&(e.scrollLeft||e.scrollTop)?e:s.body;return{target:i,left:i.scrollLeft,top:i.scrollTop,width:t.innerWidth||i.clientWidth,height:t.innerHeight||i.clientHeight}},isDragging:function(){return!!Xr},isLeftButton:function(t){return!!Nr(t)||0===t.button},isMiddleButton:function(t){return!Nr(t)&&(t&&(1===t.button||4&(t.buttons||0)))},isRightButton:function(t){return!Nr(t)&&(t&&(2===t.button||2&(t.buttons||0)))},isInput:function(t){if(!t)return!1;var e=t.tagName;return"INPUT"===e||"TEXTAREA"===e||"SELECT"===e},getTouchCount:function(t){return Nr(t)?t.touches.length:1},isDoubleClick:function(){function t(t){t.details=0,t.timeout=null,t.lastPoint=null}var e={};return Ui=new W,Wi=Ui.getTime(),function(n){if(Js(n)>1)return!1;var r=n.button==l?"":n.button,o=n.type+r,a=o+"_isDoubleClick",s=e[o];if(s||(s=e[o]={details:0,timeout:null,lastPoint:null}),n[a]===i){n[a]=!0;var c=el(n);s.timeout&&(K(s.timeout),s.timeout=null);var h=Nr(n)?u.doubleTouchRange:u.doubleClickRange;s.lastPoint&&nl(s.lastPoint,c)>h&&t(s),s.lastPoint=c,s.details++,s.timeout=J(function(){t(this)}.bind(s),500)}return 2===s.details}}(),isShiftDown:function(t){return t?t.shiftKey:Zi["16"]},isCtrlDown:function(t){return t?st?t.metaKey:t.ctrlKey:st?Zi["91"]:Zi["17"]},getClientPoint:function(t){return Nr(t)&&(t=Ur(t)),{x:t.clientX,y:t.clientY}},isMouseEvent:function(t){return t instanceof MouseEvent||0===t.type.indexOf("mouse")},getTargetElement:function(t){if(u.isMouseEvent(t)||!s.elementFromPoint)return t.target;var e=il(t);return s.elementFromPoint(e.x,e.y)},getPagePoint:function(t){return Nr(t)&&(t=Ur(t)),{x:t.pageX,y:t.pageY}},createObject:function(t,e){var i=new t;for(var n in e){var r=e[n];if(An(r))i[n]=r;else if(0===n.indexOf("s:"))i.s(n.substr(2),e[n]);else if(0===n.indexOf("a:"))i.a(n.substr(2),e[n]);else{var o=Dn(n);r=e[n];i[o]?(i[o](r),"setToolTip"===o&&i.enableToolTip&&i.enableToolTip()):i[n]=r}}return i},setImage:function(t,e,i,n){var r=arguments.length;4===r?_n(t,n,e,i):2===r?On(e)?_n(t,e):pn(t,e):1===r&&_n(t,t)},getImage:function(t,e,n){var r;if(t==l)return l;if(kn(t)?r=t:(r=qi[t],t&&r===i&&(fn&&fn[t]||_n(t,t))),e&&r&&r.tagName){var o;o="override"===n?"colors_override":"override_rgb"===n?"colors_override_rgb":"override_a"===n?"colors_override_a":"colors",r[o]||(r[o]={__count__:0});var a=r[o][e];return a||(r[o].__count__>u.imageCacheThreshold&&(r[o]={__count__:0}),a=So(r,Co(e),r.width,r.height,n),r[o][e]=a,r[o].__count__++),a}return r},isImageComplete:function(t,e,n){var r=zs(t);if(!r)return!1;if(r.tagName)return r.complete;for(var o,a,s=r.comps,l=!0,c=0,h=s.length;h>c;c++)if(o=s[c],a=o.type,"image"===o.type){t=o.name,t&&t.func&&(t=dc(t,e));var d=ks(t,e,n);if(!d){l=!1;break}}else if(en.test(a)&&u.getCompType(a)===i){l=!1,Kl(a);break}return l},getId:function(){var t=1;return function(){return++t}}(),callLater:function(e,i,n,r){var o=function(){e.apply(i,n)};return r?J(o,r):t.requestAnimationFrame(o)},cancelLater:function(e,i){i?K(e):t.cancelAnimationFrame(e)},clone:function(t){if(null==t||"object"!=typeof t)return t;if(t instanceof Date){var i=new Date;return i.setTime(t.getTime()),i}if(t instanceof Array){i=[];for(var n=0,r=t.length;r>n;n++)i[n]=Hs(t[n]);return i}if(t instanceof gc){for(i=new gc,n=0,r=t.length;r>n;n++)i.set(n,Hs(t.get(n)));return i}if(t instanceof _c)return t;if(t instanceof e){i={};for(var o in t)t.hasOwnProperty(o)&&(i[o]=Hs(t[o]));return i}return t},callWhenLoaded:function(t,e){e=e||100;var i=Gi(t,e);Hi||(Hi={}),Hi[i]={tick:i,cb:t,delay:e}},beforeLoadURL:function(t,e){if(Hi){var i={};for(var e in Hi){var n=Hi[e];K(n.tick);var r=Gi(n.cb,n.delay);i[r]={tick:r,delay:n.delay,cb:n.cb}}Hi=i}return u.convertURL?u.convertURL(t,e):t},convertURL:function(t){return t},handleRefGraphLoaded:function(){},handleCompTypeLoaded:function(){},handleImageLoaded:function(){},handleUnfoundImage:function(){return u.getImage("default_blank")},resizeImagePOT:function(t,e){if(!t||!t.tagName)return t;var i,n,r=t.width,o=t.height;if(!r||!o)return t;if(ja.isPOT(r)&&ja.isPOT(o)&&(!e||r===o))return t;e?n=i=ja.nearestPOT(Math.min(r,o)):(i=ja.nearestPOT(r),n=ja.nearestPOT(o));var a=wr(),s=a.getContext("2d");return Ir(a,i,n,1),s.drawImage(t,0,0,r,o,0,0,i,n),a},sortFunc:function(t,e){if(t===e)return 0;if(t==l&&e!=l)return 1;if(t!=l&&e==l)return-1;if(t==l&&e==l)return 0;var n,r=typeof t,o=typeof e;return r===si&&o===si?n=t.localeCompare(e):r===ui&&o===ui&&(n=t-e),n===i&&(n=(""+t).localeCompare(""+e)),n>0?1:0>n?-1:0},getClassMap:function(){return Ni},getClass:function(e){if(On(e)){var i,n=Ni[e];if(!n){i=e.split("."),n=t;for(var r=0;r<i.length;r++)n=n[i[r]];Ni[e]=n}return n}return e},def:function(t,e,i){var n,r,o,a=function(){};if(a.prototype=e.prototype,n=new a,On(t)){if(Ni[t])throw"'"+t+"' already defined";o=Gs(t),n.getClassName=function(){return t}}else o=t;if(n.constructor=o,n.getClass=function(){return o},n.getSuperClass=function(){return e},i)for(r in i)es[r]&&es.hasOwnProperty(r)?es[r](n,i):aa(n,i,r);o.prototype=n,o.superClass=e.prototype},startAnim:function(){var t=function(t){t.duration&&(t.startTime=mn()),t.timeId=Ls(t.tick,l,l,t.interval)};return function(e){return e=Hs(e),e.easing=e.easing||u.animEasing,e.duration||e.frames||(e.duration=u.animDuration),e.t=0,e.duration?e.interval=0:(e.frame=0,e.interval=e.interval||10),e.tick=function(){if(e.duration){var t=(mn()-e.startTime)/e.duration;if(t>1&&(t=1),e.t=t,e.action(e.easing(t),t),!e.isRunning())return;1===t?e.stop():e._isPaused||(e.timeId=Ls(e.tick))}else{if(e.frame++,t=e.t=e.frame/e.frames,e.action(e.easing(t),t),!e.isRunning())return;e.frame<e.frames?e._isPaused||(e.timeId=Ls(e.tick,l,l,e.interval)):e.stop()}},e.resume=function(){e._isPaused&&(delete e._isPaused,e.duration?e.t<1&&(e.startTime=mn()-e.duration*e.t,e.timeId=Ls(e.tick)):e.frame<e.frames&&(e.timeId=Ls(e.tick,l,l,e.interval)))},e.pause=function(){Fs(e.timeId,!e.duration),e._isPaused=!0},e.isPaused=function(){return this._isPaused},e.stop=function(t){e.isRunning()&&(Fs(e.timeId,!e.duration),delete e.timeId,e.duration?e.t<1&&t&&(e.t=1,e.action(e.easing(1),1)):e.frame<e.frames&&t&&(e.frame=e.frames,e.action(e.easing(1),1)),e._37o&&e._37o(),e.finishFunc&&e.finishFunc())},e.isRunning=function(){return e.timeId!=l},e.delay?Ls(t,l,[e],e.delay):t(e),e}}(),getTextSize:function(){var t={},e=s?wr().getContext("2d"):l;return function(i,n){e.font=i||ps;var r=t[e.font];return r||(r=2*e.measureText("e").width+4,t[e.font]=r),{width:e.measureText(n).width+4,height:r}}}(),drawText:function(t,e,i,n,r,o,a,s,c,h){if(e!=l){var u=Xs(i,e),d={};d.y=h&&h!==bt?h===vt?o+u.height/2:o+s-u.height/2:o+s/2,d.x=c&&c!==gt?c===pt?r+a-u.width/2:r+a/2:r+u.width/2,Pr(t,e,d,i,n)}},getDistance:function(t,e){var n=t.length;return e?3===n?E(Z(t[0]-e[0])+Z(t[1]-e[1])+Z(t[2]-e[2])):2===n?E(Z(t[0]-e[0])+Z(t[1]-e[1])):t.z===i?E(Z(e.x-t.x)+Z(e.y-t.y)):E(Z(e.x-t.x)+Z(e.y-t.y)+Z(e.z-t.z)):3===n?E(Z(t[0])+Z(t[1])+Z(t[2])):2===n?E(Z(t[0])+Z(t[1])):void 0},brighter:function(t,e){return 0>e&&(e=-e),ko(t,e||40)},darker:function(t,e){return e>0&&(e=-e),ko(t,e||-40)},unionPoint:function(t,e){if(!t)return l;if(2===arguments.length)return t&&e?{x:D(t.x,e.x),y:D(t.y,e.y),width:O(t.x-e.x),height:O(t.y-e.y)}:l;var n=t;if(n._as&&(n=n._as),n.length===i)return l;var r=n.length;if(0>=r)return l;for(var o=1,a=n[0],s={x:a.x,y:a.y,width:0,height:0};r>o;o++){a=n[o];var c=D(s.x,a.x),h=P(s.x+s.width,a.x),u=D(s.y,a.y),d=P(s.y+s.height,a.y);s.x=c,s.y=u,s.width=h-c,s.height=d-u}return s},unionRect:function(t,e){if(t&&!e)return Hs(t);if(!t&&e)return Hs(e);if(t&&e){var i={x:D(t.x,e.x),y:D(t.y,e.y)};return i.width=P(t.x+t.width,e.x+e.width)-i.x,i.height=P(t.y+t.height,e.y+e.height)-i.y,i}return l},containsPoint:function(t,e,i,n){if(n!=l&&1!==n){var r=t.x+t.width/2,o=t.y+t.height/2;t={x:r-t.width/2*n,y:o-t.height/2*n,width:t.width*n,height:t.height*n}}if(i){var a=t.width/2,s=t.height/2,c=k(-i),h=R(-i),u=e.x-t.x-a,d=e.y-t.y-s;return e={x:h*u-c*d,y:c*u+h*d},al({x:-a,y:-s,width:t.width,height:t.height},e)}return!(!t||e.x<t.x||e.y<t.y||e.x>t.x+t.width||e.y>t.y+t.height)},containsRect:function(t,e){if(!t||!e)return!1;var i=e.x,n=e.y,r=e.width,o=e.height,a=t.width,s=t.height;if(0>(a|s|r|o))return!1;var l=t.x,c=t.y;if(l>i||c>n)return!1;if(a+=l,r+=i,i>=r){if(a>=l||r>a)return!1}else if(a>=l&&r>a)return!1;if(s+=c,o+=n,n>=o){if(s>=c||o>s)return!1}else if(s>=c&&o>s)return!1;return!0},intersectsRect:function(t,e){if(!t||!e)return!1;var i=e.width,n=e.height,r=t.width,o=t.height;if(0>=r||0>=o||0>=i||0>=n)return!1;var a=e.x,s=e.y,l=t.x,c=t.y;return r+=l,o+=c,i+=a,n+=s,r>a&&o>s&&i>l&&n>c},intersection:function(t,e){if(!t||!e)return l;var i=e.x,n=e.y,r=t.x,o=t.y,a=i,s=n,c=r,h=o;return a+=e.width,s+=e.height,c+=t.width,h+=t.height,r>i&&(i=r),o>n&&(n=o),a>c&&(a=c),s>h&&(s=h),a-=i,s-=n,0>=a||0>=s?l:{x:i,y:n,width:a,height:s}},grow:function(t,e,n){n===i&&(n=e),t.x-=e,t.y-=n,t.width=t.width+2*e,t.height=t.height+2*n},getScreenPoint:function(t,e,i,n,r,o,a){var s=i.getBoundingClientRect(),l=t*(o||1)-i.scrollLeft+(n||0),c=e*(a||1)-i.scrollTop+(r||0),h=ra(i,!1);if(h){var u=new Na(l,c,0);return u.applyMatrix4(h),console.log(u),{x:u.x,y:u.y}}return{x:l+s.left,y:c+s.top}},getLogicalPoint:function(t,e,i,n,r,o){var a,s,l=e.getBoundingClientRect();t.target?(tl(t)?st?Zi["91"]=!0:Zi["17"]=!0:st?Zi["91"]=!1:Zi["17"]=!1,Zi["16"]=!!$s(t),t=Nr(t)?Ur(t):t,a=t.clientX,s=t.clientY):(a=t.x,s=t.y);var c=ra(e,!0);if(c){var h=new Na(a,s,0);h.applyMatrix4(c);do{if(Math.abs(h.z)<=1e-6)break;var u=new Na(a,s,1);if(u.applyMatrix4(matrix),Math.abs(u.z)<=1e-6){h=u;break}if(u.sub(h),Math.abs(u.z)<=1e-6)break;h.addScaledVector(u,-h.z/u.z)}while(0);return{x:(h.x+e.scrollLeft-(i||0))/(r||1),y:(h.y+e.scrollTop-(n||0))/(o||1)}}return{x:(a-l.left+e.scrollLeft-(i||0))/(r||1),y:(s-l.top+e.scrollTop-(n||0))/(o||1)}},removeHTML:function(){var t;return function(e){return e&&e.getView&&(e=e.getView()),!(!e||!e.parentNode)&&(t===e||(t=e,e.parentNode.removeChild(e),t=l),!0)}}(),getToolTipDiv:function(){if(!Oi){Oi=xr(),Ri=xr();var t=Oi.style;u.baseZIndex!=l&&(t.zIndex=X(u.baseZIndex)+3+""),t.whiteSpace="nowrap",t.color=u.toolTipLabelColor,t.background=u.toolTipBackground,t.font=u.toolTipLabelFont,t.padding="5px",t.boxShadow="0px 0px 3px "+u.toolTipShadowColor}return Oi},isToolTipShowing:function(){return!(!Oi||!Oi.parentNode)||!(!Ri||!Ri.parentNode)},hideToolTip:function(){pl(Oi),pl(Ri),Ai()},showToolTip:function(t,e){if(t&&e!=l){var i,n;if(u.getToolTipDiv(),e.html?(e=e.html,i=Ri,pl(Oi)):(i=Oi,pl(Ri)),n=i.style,i.innerHTML=e,i.parentNode||c.Default.appendToScreen(i),t.target){t=il(t);var r=hl(),o=t.x,a=t.y,s=lt?60:12;if(lt){var h=i.getBoundingClientRect();n.left=o-h.width/2+It,n.top=a-h.height-s<r.top?a+s+It:a-h.height-s+It}else{n.left=o+s+It,n.top=a+s+It;h=i.getBoundingClientRect();h.left+h.width>r.width&&(n.left=o-s-h.width+It),h.top+h.height>r.height&&(n.top=a-s-h.height+It),h.left<0&&(n.left=o+s+It),h.top<0&&(n.top=a+s+It)}}else n.left=t.x+It,n.top=t.y+It;Ai()}else cs()},startDragging:function(e,n,r){r==i&&(r=!0),e!==Xr&&(Xr?r&&(Nr(n)?Xr.handleWindowTouchEnd(n):Xr.handleWindowMouseUp(n)):Nr(n)?(w(t,xi,Qr),w(t,wi,Yr)):(w(t,_i,Zr),w(t,yi,Jr)),Xr=e)},getImageMap:function(){return qi},toBoundaries:function(t,e,i,n){var r=[];return Ro(t,e,i,n).forEach((function(t){var e=[];t.forEach((function(t){e.push(t.x,t.y)})),r.push(e)})),r},getCurrentKeyCodeMap:function(){return Zi},drawCenterImage:function(t,e,i,n,r,o,a,s){!r&&o&&o.isSelfViewEvent&&(r=o);var l=hc(e,r,o),c=uc(e,r,o);fc(t,e,I(i-l/2),I(n-c/2),l,c,r,o,a,s)},drawStretchImage:function(t,e,i,n,r,o,a,s,l,c,h,u){!s&&l&&l.isSelfViewEvent&&(s=l);var d,f=hc(e,s,l,o),g=uc(e,s,l,a);"uniform"===i?(d=D(o/f,a/g),f*=d,g*=d,n+=I((o-f)/2),r+=I((a-g)/2),o=f,a=g):"centerUniform"===i&&((f>o||g>a)&&(d=D(o/f,a/g),f*=d,g*=d),n+=I((o-f)/2),r+=I((a-g)/2),o=f,a=g);var p,v=t.interactiveInfo;if(v)if(p="center"===i?{x:n+o/2-f/2,y:r+a/2-g/2,width:f,height:g}:{x:n,y:r,width:o,height:a},v.rect){var _=v.compInfos,y=_.length;y&&(_[y-1].rect.image=e)}else v.rect=p;if("center"===i){var m=!1!==h&&(f>o||g>a);m&&(t.save(),t.beginPath(),t.rect(n,r,o,a),t.clip()),fc(t,e,n+o/2-f/2,r+a/2-g/2,f,g,s,l,c,u),m&&t.restore()}else fc(t,e,n,r,o,a,s,l,c,u)},toCanvas:function(t,e,i,n,r,o,a,s,l){t=zs(t,a),e=e||hc(t,r),i=i||uc(t,r);var c=wr(),h=kr(c);return s?(Ir(c,e,i,s),h.scale(s,s)):Ir(c,e,i,1),Vs(h,t,n,0,0,e,i,r,o,a,l),t&&t.clampToEdge&&(c.clampToEdge=t.clampToEdge),h.restore(),c},toGrayColor:function(t){if(!t)return t;var e=wo(t),i=I(.299*e[0]+.587*e[1]+.114*e[2]);return"rgba("+i+","+i+","+i+","+e[3]/255+")"},createGradientImage:function(t,e,i,n){for(var r=["L",0,0,t,0,1,0,0,1,0,0],o=0,a=Math.min(e.length,i.length);a>o;o++)r.push(i[o],e[o]);var s=c.Default.toCanvas({width:t,height:t,clampToEdge:!0,comps:[{type:"shape",rotation:n||0,points:[0,0,t,0,t,t,0,t],background:"#ffffff",gradientPack:r}]});return s},createElement:function(t,e,i,n){var r=s.createElement(t);return Cr(r,e||g.widgetBorder,2),r.style.font=i||ps,n!=l&&(r.value=n),u.onElementCreated&&u.onElementCreated(r),r},containedInView:function(t,e){var i=Hr(e).getBoundingClientRect();return al({x:i.left,y:i.top,width:i.width,height:i.height},el(t))},isIsolating:function(){return ji>0},setIsolating:function(t){t?ji++:ji--},getMSMap:function(){return es},stringify:function(t,e,i){var n=Date.prototype.toJSON;Date.prototype.toJSON=function(){return"__ht__date"+this.getTime()};var r=JSON.stringify(t,(function(t,e){return"function"==typeof e?"__ht__"+(e.__ht__||e.toString()):Rn(e)?Nn(e):e instanceof c.List?"__ht__list"+(e.__ht__list||u.stringify(e._as)):e}),e==l?2:e);return Date.prototype.toJSON=n,i&&(r="__ht__encode"+u.encodeString(r)),r},parse:function(t){return On(t)&&("__ht__encode"!=t.substr(0,12)||(t=u.decodeString(t.substr(12)),On(t)))?JSON.parse(t,(function(t,e){if(On(e))if("__ht__function"==e.substr(0,14)){var i=e.indexOf("{")+1,n=e.lastIndexOf("}"),r=e.indexOf("(")+1,o=e.indexOf(")");if(i&&n&&r&&o){var a=new Function(e.substring(r,o),e.substring(i,n));return a.__ht__=e.substr(6),a}}else{if("__ht__date"==e.substr(0,10))return new Date(X(e.substr(10)));if("__ht__list"===e.substr(0,10))return new gc(u.parse(e.substr(10)))}return e})):t},loadJS:function(t,e){e&&t.push(e);var i=t.shift();if(Vn(i))t=i.contact(t),u.loadJS(t);else if(An(i))i(),u.loadJS(t);else if(On(i)){var n=s.createElement("script");n.onload=function(){u.loadJS(t)},n.setAttribute("src",i),s.getElementsByTagName("head")[0].appendChild(n)}else t.length&&u.loadJS(t)},extendClass:function(t,e){var i=t.prototype;for(var n in e)es[n]&&es.hasOwnProperty(n)?es[n](i,e):i[n]=e[n]},toRoundedCorner:function(){function t(t,e,i){t.x=e.x,t.y=e.e||i,t.z=e.y}var e=new Na,n=new Na,r=new Na,o=new Na;return function(a,s){var l,c=0;a.getPoints&&(c=a.getElevation(),a=a.getPoints()),l=a instanceof gc?a:new gc(a);var h=l.size();if(0>=s)return{points:l};var u=new gc,d=new gc,f=l.get(0);t(e,f,c),u.add(f),d.add(1);for(var g=1;h>g;g++)if(h>g+1){var p=l.get(g),v=l.get(g+1);t(n,p,c),t(r,v,c),o.subVectors(e,n).setLength(Math.min(.99*o.length(),s)).add(n),p.e!==i||f.e!==i?u.add({x:o.x,y:o.z,e:o.y}):u.add({x:o.x,y:o.z}),u.add(p),o.subVectors(r,n).setLength(Math.min(.99*o.length(),s)).add(n),p.e!==i||v.e!==i?u.add(f={x:o.x,y:o.z,e:o.y}):u.add(f={x:o.x,y:o.z}),e.copy(o),d.addAll([2,3])}else u.add(l.get(g)),d.add(2);return{points:u,segments:d}}}(),toColorData:wo,setCanvas:Ir,createDiv:xr,createDisabledDiv:zr,createView:mr,createCanvas:wr,appendChild:Mr,initContext:kr,checkLoadingImage:vn,translateAndScale:Ar,layout:Gr,getPosition:la,drawPoints:Oo,drawRoundRect:Ho,drawBorder:Go,setFocus:jr,getter:Pn,setter:Dn,isEmptyObject:$n,cameraPriority:function(){var t={skybox:0,main:1e4,top:1e7};return e.seal(e.defineProperties({},{skybox:{configurable:!1,enumerable:!1,get:function(){return t.skybox},set:function(e){if(e>=t.main)throw new RangeError("Skybox camera must have lower priority than the main camera.");t.skybox=Number(e)}},main:{configurable:!1,enumerable:!1,get:function(){return t.main},set:function(e){if(e<=t.skybox)throw new RangeError("Main camera must have higher priority than the skybox camera.");if(e>=t.top)throw new RangeError("Main camera must have lower priority than the top camera.");t.main=Number(e)}},top:{configurable:!1,enumerable:!1,get:function(){return t.top},set:function(e){if(e<=t.main)throw new RangeError("Top camera must have higher priority than the main camera.");t.top=Number(e)}}}))}()},!0),Qn(p,{autoAdjustIndex:1,hierarchicalRendering:1,adjustChildrenToTop:1,autoHideScrollBar:1,autoUpdate:1,firstPersonMode:1,ortho:1,strict:1,stickToRight:1,instant:1,closePath:1,hierarchical:1,doubleClickToToggle:1,continuousLayout:1,syncSize:1},!0);var is=u.disabledOpacity,ns=u.toolTipDelay,rs=u.devicePixelRatio,os=u.autoMakeVisible,as=u.autoHideScrollBar,ss=u.imageGradient,ls=u.showToolTip,cs=u.hideToolTip,hs=u.dashPattern,us=u.lineCap,ds=u.lineJoin,fs=u.labelColor,gs=u.labelSelectColor,ps=u.labelFont,vs=u.widgetIndent,_s=u.widgetRowHeight,ys=u.widgetHeaderHeight,ms=u.widgetTitleHeight,bs=u.scrollBarColor,xs=u.scrollBarSize,ws=u.scrollBarTimeout,Cs=u.scrollBarMinLength,Ss=u.scrollBarInteractiveSize,Is=u.zoomIncrement,Ms=u.scrollZoomIncrement,Ts=u.pinchZoomIncrement,Es=u.zoomMax,Ps=u.zoomMin,Ds=u.createObject,Os=u.preventDefault,Rs=u.setImage,zs=u.getImage,ks=u.isImageComplete,As=u.drawCenterImage,Vs=u.drawStretchImage,Bs=u.getId,Ls=u.callLater,Fs=u.cancelLater,js=u.sortFunc,Hs=u.clone,Gs=u.getClass,Us=u.startAnim,Ws=u.brighter,Ns=u.darker,qs=u.drawText,Xs=u.getTextSize,Qs=u.isLeftButton,Ys=u.isMiddleButton,Zs=u.isRightButton,Js=u.getTouchCount,Ks=u.isDoubleClick,$s=u.isShiftDown,tl=u.isCtrlDown,el=u.getClientPoint,il=u.getPagePoint,nl=u.getDistance,rl=u.unionPoint,ol=u.unionRect,al=u.containsPoint,sl=u.containsRect,ll=u.intersectsRect,cl=u.intersection,hl=u.getWindowInfo,ul=u.grow,dl=u.getLogicalPoint,fl=u.getScreenPoint,gl=u.startDragging,pl=u.removeHTML,vl=u.createElement,_l=u.segmentResolution,yl=u.shapeResolution,ml=u.shapeSide,bl=u.def,xl=function(t,e,i){bl(a+"."+t,e,i)},wl=function(t,e){t.childNodes.forEach((function(t){e(t),wl(t,e)}))};Qn(u,{toolTipLabelColor:fs,toolTipLabelFont:ps,toolTipBackground:g.toolTipBackground,toolTipShadowColor:ha,debugTipLabelFont:ps,debugTipLabelColor:fs,debugTipBackground:g.toolTipBackground,drawBreakableText:Er,setDevicePixelRatio:function(e){rs=u.devicePixelRatio="number"==typeof e?e:t.devicePixelRatio,wl(s.body,(function(t){var e=t._ht;e&&e._canvas&&(Ir(e._canvas,e.getWidth(),e.getHeight()),e.redraw?e.redraw():e.iv())}))}},!0);var Cl=1e-6,Sl="undefined"!=typeof Uint16Array?Uint16Array:Array,Il="undefined"!=typeof Float32Array?Float32Array:Array,Ml=function(t,e,i){var n=[t[0]-e[0],t[1]-e[1],t[2]-e[2]];if(i){var r=nl(n);r>0&&(n[0]/=r,n[1]/=r,n[2]/=r)}return n},Tl=function(){var e="charCodeAt",i=2*(2*Mt.length+1);for(var n in t)if(n===a+gt[0]+(It.length+2)){var r=t[n];if(!r)break;for(var o=r.length,s=0;o>s;s++)if(r[s][e](0)===i&&r[s+1]!=l&&r[s+1]===It[0]&&r[s+2]!=l&&r[s+2][e](0)===i){for(var c=s+3;o>c;c++)if(r[c][e](0)===i){if(0==r[c+1])for(var h,u=c+2;o>u;u++){if(r[u][e](0)===i){0==r[u-1]&&h&&(it=h.substr(0,h.length-1));break}h==l?h=r[u]:h+=r[u]}break}break}break}return function(t){return[-t[0],-t[1],-t[2]]}}(),El=function(t,e){return 3===t.length?t[0]*e[0]+t[1]*e[1]+t[2]*e[2]:t[0]*e[0]+t[1]*e[1]},Pl=function(){var t=new Il(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Dl=Pl(),Ol=function(t){var e=new Il(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Rl=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},zl=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},kl=function(t,e){var i=t[0],n=t[1],r=t[2];return t[0]=e[0]*i+e[4]*n+e[8]*r+e[12],t[1]=e[1]*i+e[5]*n+e[9]*r+e[13],t[2]=e[2]*i+e[6]*n+e[10]*r+e[14],t},Al=function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3];return t[0]=e[0]*i+e[4]*n+e[8]*r+e[12]*o,t[1]=e[1]*i+e[5]*n+e[9]*r+e[13]*o,t[2]=e[2]*i+e[6]*n+e[10]*r+e[14]*o,t[3]=e[3]*i+e[7]*n+e[11]*r+e[15]*o,t},Vl=function(){var t,e,i,n,r=Zn(ro[1]+ro[7]),o=Zn(ro[0]+ro[3]-ro[10]),a=Zn(ro[8]+2),s=function(){return e=i.charAt(t),t+=1,e},l=function(){var t="";if(e===a)for(;s();){if(e===a)return s(),t;t+=e}else s()},c=function(){for(;e&&" ">=e;)s()},h=function(){var t,i={};if(e===r){if(s(),c(),e===o)return s(),i;for(;e;){if(t=l(),c(),s(),i[t]=n(),c(),e===o)return s(),i;s(),c()}}};return n=function(){switch(c(),e){case r:return h();default:return l()}},function(r){var o;if((y={},r)&&(i=r,t=0,e=" ",o=n(),c(),!e))return o}}(),Bl=function(t,e){if(e){var i=k(e),n=R(e),r=t[4],o=t[5],a=t[6],s=t[7],l=t[8],c=t[9],h=t[10],u=t[11];t[4]=r*n+l*i,t[5]=o*n+c*i,t[6]=a*n+h*i,t[7]=s*n+u*i,t[8]=l*n-r*i,t[9]=c*n-o*i,t[10]=h*n-a*i,t[11]=u*n-s*i}},Ll=function(t,e){if(e){var i=k(e),n=R(e),r=t[0],o=t[1],a=t[2],s=t[3],l=t[8],c=t[9],h=t[10],u=t[11];t[0]=r*n-l*i,t[1]=o*n-c*i,t[2]=a*n-h*i,t[3]=s*n-u*i,t[8]=r*i+l*n,t[9]=o*i+c*n,t[10]=a*i+h*n,t[11]=s*i+u*n}},Fl=function(t,e){if(e){var i=k(e),n=R(e),r=t[0],o=t[1],a=t[2],s=t[3],l=t[4],c=t[5],h=t[6],u=t[7];t[0]=r*n+l*i,t[1]=o*n+c*i,t[2]=a*n+h*i,t[3]=s*n+u*i,t[4]=l*n-r*i,t[5]=c*n-o*i,t[6]=h*n-a*i,t[7]=u*n-s*i}},jl=function(t,e,i){return Hl(l,!1===i?l:t.getFinalScale3d(),t.getFinalRotation3d(),t.getRotationMode(),t.p3(),l,e)},Hl=function(t,e,i,n,r,o,a){return o||(o=Pl()),r&&cf(o,r),cu(o,i,n),a&&uf(o,o,a),e&&hf(o,e),t&&uf(o,o,t),o},Gl=function(t,e,i){e=X(e),i=X(i);var n=this;n.g=t,n._84O=e,n._85O=i,n._70I=!0,n.F=0,n._83O=e+i,n.pen={x:0,y:0}},Ul="lineDashOffset",Wl="setLineDash",Nl=function(t){for(var e in t)1===e.length&&(Ul=t[e]);return e?1:0},ql=function(t,e,i){return tr(e)?t:t[Wl]?(t[Wl](e),i&&(t.lineDashOffset=i),t):new Gl(t,e[0],e.length>1?e[1]:e[0])},Xl=function(t,e){!tr(e)&&t[Wl]&&(t[Wl](on),t.lineDashOffset=0)};if(bl(Gl,e,{_69I:6,moveTo:function(t,e){var i=this,n=i.pen;n.x=t,n.y=e,i.g.moveTo(t,e),i.start||(i.start={x:t,y:e})},lineTo:function(t,e){var i=this,n=i.pen,r=t-n.x,o=e-n.y,a=G(o,r),s=R(a),l=k(a),c=i._23O(n.x,n.y,t,e),h=i._85O,u=i._84O,d=i._83O;if(i.F){if(i.F>c)return i._70I?i._72I(t,e):i.moveTo(t,e),void(i.F-=c);if(i._70I?i._72I(n.x+s*i.F,n.y+l*i.F):i.moveTo(n.x+s*i.F,n.y+l*i.F),c-=i.F,i.F=0,i._70I=!i._70I,!c)return}var f=M(c/d);if(f){for(var g=s*u,p=l*u,v=s*h,_=l*h,y=0;f>y;y++)i._70I?(i._72I(n.x+g,n.y+p),i.moveTo(n.x+v,n.y+_)):(i.moveTo(n.x+v,n.y+_),i._72I(n.x+g,n.y+p));c-=d*f}i._70I?c>u?(i._72I(n.x+s*u,n.y+l*u),i.moveTo(t,e),i.F=h-(c-u),i._70I=!1):(i._72I(t,e),c===u?(i.F=0,i._70I=!i._70I):(i.F=u-c,i.moveTo(t,e))):c>h?(i.moveTo(n.x+s*h,n.y+l*h),i._72I(t,e),i.F=u-(c-h),i._70I=!0):(i.moveTo(t,e),c===h?(i.F=0,i._70I=!i._70I):i.F=h-c)},quadraticCurveTo:function(t,e,i,n){var r,o=this,a=o.pen,s=a.x,l=a.y,c=o._22O(s,l,t,e,i,n),h=0,u=0,d=o._85O,f=o._84O;if(o.F){if(o.F>c)return o._70I?o._71I(t,e,i,n):o.moveTo(i,n),void(o.F-=c);if(h=o.F/c,r=o._20O(s,l,t,e,i,n,h),o._70I?o._71I(r[2],r[3],r[4],r[5]):o.moveTo(r[4],r[5]),o.F=0,o._70I=!o._70I,!c)return}var g=c-c*h,p=M(g/o._83O),v=f/c,_=d/c;if(p)for(var y=0;p>y;y++)o._70I?(u=h+v,r=o._21O(s,l,t,e,i,n,h,u),o._71I(r[2],r[3],r[4],r[5]),h=u,u=h+_,r=o._21O(s,l,t,e,i,n,h,u),o.moveTo(r[4],r[5])):(u=h+_,r=o._21O(s,l,t,e,i,n,h,u),o.moveTo(r[4],r[5]),h=u,u=h+v,r=o._21O(s,l,t,e,i,n,h,u),o._71I(r[2],r[3],r[4],r[5])),h=u;g=c-c*h,o._70I?g>f?(u=h+v,r=o._21O(s,l,t,e,i,n,h,u),o._71I(r[2],r[3],r[4],r[5]),o.moveTo(i,n),o.F=d-(g-f),o._70I=!1):(r=o._19O(s,l,t,e,i,n,h),o._71I(r[2],r[3],r[4],r[5]),c===f?(o.F=0,o._70I=!o._70I):(o.F=f-g,o.moveTo(i,n))):g>d?(u=h+_,r=o._21O(s,l,t,e,i,n,h,u),o.moveTo(r[4],r[5]),r=o._19O(s,l,t,e,i,n,u),o._71I(r[2],r[3],r[4],r[5]),o.F=f-(g-d),o._70I=!0):(o.moveTo(i,n),g===d?(o.F=0,o._70I=!o._70I):o.F=d-g)},bezierCurveTo:function(){var t=arguments;this.pen={x:t[4],y:t[5]},this.g.bezierCurveTo(t[0],t[1],t[2],t[3],t[4],t[5])},arc:function(t,e,i,n,r,o){o||(n=-n,r=-r),jo(this,t,e,n,r-n,i,i,!1)},rect:function(t,e,i,n){var r=this;r.pen={x:t,y:e},r.moveTo(t,e),r.lineTo(t,e+n),r.lineTo(t+i,e+n),r.lineTo(t+i,e),r.lineTo(t,e)},beginPath:function(){this.g.beginPath()},closePath:function(){this.lineTo(this.start.x,this.start.y)},_23O:function(t,e,i,n){var r=i-t,o=n-e;return E(r*r+o*o)},_22O:function(t,e,i,n,r,o,a){for(var s,l,c,h,u,d,f,g=0,p=t,v=e,_=a>0?a:this._69I,y=1;_>=y;y++)c=y/_,h=1-c,u=h*h,d=2*c*h,f=c*c,s=u*t+d*i+f*r,l=u*e+d*n+f*o,g+=this._23O(p,v,s,l),p=s,v=l;return g},_21O:function(t,e,i,n,r,o,a,s){var l=this;if(0===a)return l._20O(t,e,i,n,r,o,s);if(1===s)return l._19O(t,e,i,n,r,o,a);var c=l._20O(t,e,i,n,r,o,s);return c.push(a/s),l._19O.apply(l,c)},_20O:function(t,e,i,n,r,o,a){if(1!==a){var s=i+(r-i)*a,l=n+(o-n)*a;i=t+(i-t)*a,n=e+(n-e)*a,r=i+(s-i)*a,o=n+(l-n)*a}return[t,e,i,n,r,o]},_19O:function(t,e,i,n,r,o,a){if(1!==a){var s=t+(i-t)*a,l=e+(n-e)*a;i+=(r-i)*a,n+=(o-n)*a,t=s+(i-s)*a,e=l+(n-l)*a}return[t,e,i,n,r,o]},_72I:function(t,e){var i=this.pen;(t!==i.x||e!==i.y)&&(i.x=t,i.y=e,this.g.lineTo(t,e))},_71I:function(t,e,i,n){var r=this.pen;(t!==i||e!==n||i!==r.x||n!==r.y)&&(r.x=i,r.y=n,this.g.quadraticCurveTo(t,e,i,n))}}),N&&$){var Ql=$.toString();q=Ql.indexOf(ce.substr(0,2))>0&&Ql.indexOf(vt+vt.substr(1,1))>1||Ql.indexOf(ai.substr(0,2)+ce.substr(2,2)+gt[0]+ce[4])>1}var Yl=l,Zl=l,Jl=u.checkLoadingCompType=function(t){Yl&&!t._72O&&(Zl||(Zl={}),Zl[t._72O=Bs()]=t)},Kl=function(t,e){if(e||(e=t),e&&(Yl||(Yl={}),!Yl[t])){var i=new wu;if(Yl[e]={request:i,url:e},e=u.beforeLoadURL(e,t),e.data){var n=u.parse(e.data);$l(t,n),u.handleCompTypeLoaded(t,n)}else{i.onload=function(){if(200===this.status||0===this.status){var e=u.parse(i.getResponseText());$l(t,e),u.handleCompTypeLoaded(t,e)}else $l(t,l)},i.onerror=function(){$l(t,l)};var r={};r.url=encodeURI(e),r.sync=!1,i.send(r)}}},$l=function(t,e){if(Ji[t]=e,delete Yl[t],$n(Yl)&&(Yl=l,Zl)){for(var n in Zl){var r=Zl[n];r.invalidateAll&&r.invalidateAll(i,"compTypeLoaded",t),r.redraw&&r.redraw(),r.iv(),delete r._72O}Zl=l}if(e&&Zl)for(var n in Zl){r=Zl[n];r.invalidateAll&&r.invalidateAll(i,"compTypeLoading",t),r.redraw&&r.redraw(),r.iv()}},tc=g.chart,ec="",ic=!0,nc=u.compStack=[],rc=/^style@/,oc=/^attr@/,ac=/^field@/,sc={x:.5,y:.5},lc=function(){ic=!0},cc=function(){return ic},hc=function(t,e,i,n){if(!t)return 0;if(dc(t.fitSize,e,i)&&n)return n;var r=dc(t.width,e,i);return null==r?20:r},uc=function(t,e,i,n){if(!t)return 0;if(dc(t.fitSize,e,i)&&n)return n;var r=dc(t.height,e,i);return null==r?20:r},dc=function(t,e,n){if(!t||!t.func)return t;var r,o=t.func,a=t.value;return r=An(o)?n&&n.vectorDataBindingDisabled&&!t.isSafeFunc?a:o(e,n):e instanceof _c||c.ui&&e instanceof c.ui.View?oc.test(o)?e.a(ec+o.slice(5)):rc.test(o)?e.s(ec+o.slice(6)):ac.test(o)?e[o.slice(6)]:e[o]?e[o](n):a:a,a!==i&&r==l?a:r},fc=u.drawImage=function(){var e,n,r,o,a,s,c=function(t,e){t.getValue&&t.getValue.compType===e||(t.getValue=function(n){var r=h(t,n);if(r===i&&e.properties){var o=e.properties[n];o&&(r=o.defaultValue)}return r},t.getColor=function(e){return d(t.getValue(e))},t.getValue.compType=e)},h=function(t,e,o){var a,s=!1;if(t.prefix&&n instanceof _c){var l=n.a(ec+e);l!==i&&(s=!0,a=l)}return a===i&&(a=t[e]),a&&a.func&&(s=!0,a=dc(a,n,r)),o&&(a=o(a),s||(t[e]=a)),a},d=function(t,i){var n;if(n=i?h(t,i):t,e&&e.compGray&&n)return u.toGrayColor(n);if(a&&n){if("override"===s)return a;if("override_rgb"===s){var r=Co(a);return n=wo(n),"rgba("+I(255*r[0])+","+I(255*r[1])+","+I(255*r[2])+","+n[3]/255+")"}if("override_a"===s){r=Co(a);return n=wo(n),"rgba("+n[0]+","+n[1]+","+n[2]+","+r[3]+")"}r=Co(a);return n=wo(n),"rgba("+I(n[0]*r[0])+","+I(n[1]*r[1])+","+I(n[2]*r[2])+","+n[3]/255*r[3]+")"}return n},f=function(t){if(Vn(t)){for(var e=new gc,i=t.length,n=0;i>n;n+=2)e.add({x:t[n],y:t[n+1]});t=e}return t},g=function(t){var e=h(t,"anchorX"),n=h(t,"anchorY");if(e!==i||n!==i)return{x:e===i?sc.x:e,y:n===i?sc.y:n};var r=h(t,"type"),o=h(t,"name");if("image"!==r||!o)return sc;var a=zs(o);return a&&a.anchorX!==i&&a.anchorY!==i?{x:a.anchorX,y:a.anchorY}:sc},p=function(t,e){var i=h(t,Pt),n=g(t);if(Vn(i)){var r=i.length,o=h(t,"relative"),a=e.width,s=e.height;if(4===r)i={x:i[0],y:i[1],width:i[2],height:i[3]},o&&(i.x*=a,i.y*=s,i.width*=a,i.height*=s);else if(3===r){var l=i[0];i={width:i[1],height:i[2]},o&&(i.width*=a,i.height*=s),"object"==typeof l?l.length&&(l={x:l[0],y:l[1]}):l=la(l,e,i),i.x=l.x-i.width*n.x,i.y=l.y-i.height*n.y}i.x+=h(t,"offsetX")||0,i.y+=h(t,"offsetY")||0,!o&&e.fitSize&&(i=v(t,i,e))}return i},v=function(t,e,i){if(e){var n,r,o,a={x:e.x,y:e.y,width:e.width,height:e.height},s=g(t),c=h(t,"layoutH"),u=h(t,"layoutV"),d=1,f=1,p=0,v=0,_=1,y=1;switch(c){case"left":break;case"right":a.x+=i.width-i.rw;break;case"center":a.x+=.5*(i.width-i.rw);break;case"scale":case"leftright":default:n=h(t,le)||0,n&&(p=Math.abs(v=Math.sin(n)),_=Math.abs(y=Math.cos(n))),"leftright"!==c?(d+=_*(i.widthScale-1),f+=p*(i.widthScale-1)):(d+=a.width?_*(i.width-i.rw)/a.width:0,f+=a.height?p*(i.width-i.rw)/a.height:0,r=-Math.min(-s.x*y+s.y*v,-s.x*y-(1-s.y)*v,(1-s.x)*y+s.y*v,(1-s.x)*y-(1-s.y)*v))}switch(u){case"top":break;case"bottom":a.y+=i.height-i.rh;break;case"center":a.y+=.5*(i.height-i.rh);break;case"scale":case"topbottom":default:n==l&&(n=h(t,le),n&&(p=Math.abs(v=Math.sin(n)),_=Math.abs(y=Math.cos(n)))),"topbottom"!==u?(d+=p*(i.heightScale-1),f+=_*(i.heightScale-1)):(d+=a.width?p*(i.height-i.rh)/a.width:0,f+=a.height?_*(i.height-i.rh)/a.height:0,o=-Math.min(-s.x*v-s.y*y,-s.x*v+(1-s.y)*y,(1-s.x)*v-s.y*y,(1-s.x)*v+(1-s.y)*y))}return(1!==d||1!==f)&&("scale"!==c&&c?"leftright"===c&&(a.x+=a.width*(1-d)*s.x+r*(i.width-i.rw)):a.x+=a.x*(i.widthScale-1)+s.x*a.width*(i.widthScale-d),"scale"!==u&&u?"topbottom"===u&&(a.y+=a.height*(1-f)*s.y+o*(i.height-i.rh)):a.y+=a.y*(i.heightScale-1)+s.y*a.height*(i.heightScale-f),a.width*=d,a.height*=f),a.width<0&&(a.width=0),a.height<0&&(a.height=0),a}},_=function(t){return Vn(t)?new gc(t):t},y=function(t,n,r,o,a,s,l){var c=e.interactiveInfo,u=t.transform;if(u)return e.save(),e.setTransform(u.a,u.b,u.c,u.d,u.tx,u.ty),c&&c.compInfos.push({comp:t,rect:n,matrix:u.clone(),prefix:ec,refRect:c.refRect}),!0;a===i&&(a=1),s===i&&(s=1);var d=h(t,"clipPercentage"),f=er(r,n);if(f&&!o&&1===a&&1===s&&!(1>d))return c&&c.compInfos.push({comp:t,rect:n,matrix:c.matrix.clone(),prefix:ec,refRect:c.refRect}),!1;l=l||sc;var g=n.x+n.width*l.x,p=n.y+n.height*l.y,v=r.x+r.width*l.x,_=r.y+r.height*l.y,y=r.width?a*(n.width/r.width):1,m=r.height?s*(n.height/r.height):1;if(e.save(),c&&(c.matrix.appendTranslate(g,p).appendRotate(o).appendScale(y,m).appendTranslate(-v,-_),c.compInfos.push({comp:t,rect:n,matrix:c.matrix.clone(),prefix:ec,refRect:c.refRect})),Vr(e,g,p),Br(e,o||0),Lr(e,y,m),Vr(e,-v,-_),1>d){0>d&&(d=0);var b=cr(r,h(t,"clipDirection"),d);return e.beginPath(),e.rect(b.x,b.y,b.width,b.height),e.clip(),b}return!0},m=function(t,i){if(!(t instanceof Boolean)){var n=h(i,"clipGradient");if(n!=l&&n>0){e.globalCompositeOperation="destination-out";var r=getClipGradientAndRect(e,t,h(i,"clipDirection"),n);e.fillStyle=r.gradient;var o=r.rect;e.fillRect(o.x,o.y,o.width,o.height)}}e.restore()},b=function(t,i,n){var r=h(t,"path"),a=h(t,le),s=h(t,"scaleX"),c=h(t,"scaleY"),u=g(t),f=l,p=Eo(null,r);if(n||(n=t.unionRect,n||(n=rl(p),t.path.func||(t.unionRect=n)),f=n),n){f||(f=t.unionRect,f||(f=rl(p),t.path.func||(t.unionRect=f)));var v=y(t,n,f,a,s,c,u),_=h(t,"borderPattern"),b=ql(e,_),x=d(t,"background"),w=d(t,"borderColor"),C=h(t,"borderWidth"),S=h(t,"gradient"),I=d(t,"gradientColor"),M=h(t,"border3d"),T=d(t,"border3dColor"),E=h(t,"border3dAccuracy"),P=e.lineJoin,D=e.lineCap;e.lineJoin=h(t,"borderJoin")||ds,e.lineCap=h(t,"borderCap")||us,x?(Bo(e,x,S,I,f),Eo(e,r),e.fill(),b!==e&&Eo(e,r)):Eo(e,r);var O=h(t,"borderWidthAbsolute");if(O&&(e.save(),e.setTransform(1,0,0,1,0,0)),C&&w&&(e.lineWidth=C,e.strokeStyle=w,e.stroke(),M&&zo(e,w,T,C,o,E)),Xl(e,_),h(t,"dash")){var R=h(t,"dashWidth")||C;if(R>0){_=h(t,"dashPattern")||hs;b=ql(e,_,h(t,"dashOffset"));var z=d(t,"dashColor")||d(da);b!==e&&Eo(e,r),e.strokeStyle=z,e.lineWidth=R,e.stroke(),h(t,"dash3d")&&zo(e,z,d(t,"dash3dColor"),R,o,h(t,"dash3dAccuracy")),Xl(e,_)}}O&&e.restore(),i===Pt&&Uo(e,x,h(t,"depth"),f),e.lineJoin=P,e.lineCap=D,v&&m(v,t)}},x=function(t,i,c,u){var p=h(t,Nt,f),b=h(t,le),x=g(t);if(p&&u.fitSize){var w=new gc,C=rl(p),S=v(t,C,u),I=C.x+x.x*C.width,M=C.y+x.y*C.height,T=S.x+x.x*S.width,E=S.y+x.y*S.height,P=C.width?S.width/C.width:1,D=C.height?S.height/C.height:1;p.each((function(t){w.add({x:T+(t.x-I)*P,y:E+(t.y-M)*D})})),p=w,t.unionRect=null}var O=h(t,"scaleX"),R=h(t,"scaleY"),z=i===Rt,k=l;if(!c&&z&&(c=t.unionRect,c||(c=rl(p),t.points.func||(t.unionRect=c)),k=c),c){z?k||(k=t.unionRect,k||(k=rl(p),t.points.func||(t.unionRect=k))):k=c;var A,V,B,L,F=y(t,c,k,b,O,R,x),j=h(t,"borderPattern"),H=ql(e,j),G=d(t,"background"),U=zs(h(t,"repeatImage"),a,s),W=h(t,"gradientPack"),N=d(t,"borderColor"),q=h(t,"borderWidth"),X=h(t,"segments",_),Q=h(t,"gradient"),Y=d(t,"gradientColor"),Z=h(t,"border3d"),J=d(t,"border3dColor"),K=h(t,"border3dAccuracy"),$=h(t,"closePath"),tt=h(t,"fillRule")||"nonzero",et=e.lineJoin,it=e.lineCap;if(e.lineJoin=h(t,"borderJoin")||ds,e.lineCap=h(t,"borderCap")||us,z)if(G||U||W){var nt=h(t,"fillClipPercentage");if(1>nt&&(0>nt&&(nt=0),st=cr(k,h(t,"fillClipDirection"),nt),e.save(),e.beginPath(),e.rect(st.x,st.y,st.width,st.height),e.clip()),Oo(e,p,X,$),W?Po(e,W):U?Lo(e,U,a,s,n,r):Bo(e,G,Q,Y,k),e.fill(tt),1>nt){var rt=h(t,"fillClipGradient");if(rt!=l&&rt>0){e.globalCompositeOperation="destination-out";var ot=getClipGradientAndRect(e,st,h(t,"fillClipDirection"),rt);e.fillStyle=ot.gradient;var at=ot.rect;e.fillRect(at.x,at.y,at.width,at.height)}e.restore()}W&&e.restore(),H!==e&&Oo(H,p,X,$)}else Oo(H,p,X,$);else if("roundRect"===i?A=h(t,"cornerRadius"):"polygon"===i?A=h(t,"polygonSide"):"arc"===i&&(A=h(t,"arcFrom"),V=h(t,"arcTo"),B=h(t,"arcClose"),L=h(t,"arcOval")),G||U||W){var st;nt=h(t,"fillClipPercentage");if(1>nt&&(0>nt&&(nt=0),st=cr(k,h(t,"fillClipDirection"),nt),e.save(),e.beginPath(),e.rect(st.x,st.y,st.width,st.height),e.clip()),Vo(e,i,k,A,V,B,L),W?Po(e,W):U?Lo(e,U,a,s,n,r):Bo(e,G,Q,Y,k),e.fill(tt),1>nt){rt=h(t,"fillClipGradient");if(rt!=l&&rt>0){e.globalCompositeOperation="destination-out";ot=getClipGradientAndRect(e,st,h(t,"fillClipDirection"),rt);e.fillStyle=ot.gradient;at=ot.rect;e.fillRect(at.x,at.y,at.width,at.height)}e.restore()}W&&e.restore(),e!==H&&Vo(H,i,k,A,V,B,L)}else Vo(H,i,k,A,V,B,L);var lt=h(t,"borderWidthAbsolute");if(lt&&(e.save(),e.setTransform(1,0,0,1,0,0)),q&&N&&(e.lineWidth=q,e.strokeStyle=N,e.stroke(),Z&&zo(e,N,J,q,o,K)),Xl(e,j),h(t,"dash")){var ct=h(t,"dashWidth")||q;if(ct>0){j=h(t,"dashPattern")||hs;H=ql(e,j,h(t,"dashOffset"));var ht=d(t,"dashColor")||d(da);H!==e&&(z?Oo(H,p,X,$):Vo(H,i,k,A,V,B,L)),e.strokeStyle=ht,e.lineWidth=ct,e.stroke(),h(t,"dash3d")&&zo(e,ht,d(t,"dash3dColor"),ct,o,h(t,"dash3dAccuracy")),Xl(e,j)}}lt&&e.restore(),i===Pt&&Uo(e,G,h(t,"depth"),k),e.lineJoin=et,e.lineCap=it,F&&m(F,t)}},w=function(t,i){var o=a||h(t,ci),l=s||h(t,"blendMode"),c=h(t,"name"),u=zs(c,o,l);u?Vs(e,u,h(t,"stretch"),i.x,i.y,i.width,i.height,n,r,o,null,l):ic=!1},C=function(t,i){var n=h(t,"text");n!=l&&qs(e,n,h(t,"font"),d(t,ci),i.x,i.y,i.width,i.height,h(t,"align"),h(t,"vAlign"))},S=function(t,i){Go(e,d(t,ci),i.x,i.y,i.width,i.height,h(t,"width"))},M=function(t,i){var r=h(t,qt),o=0;if(r&&(r.forEach((function(t){o+=t})),o>0)){for(var a=h(t,"colors")||tc,s=h(t,"startAngle")||0,c=h(t,"hollow"),u=h(t,Yt),d=h(t,te),f=h(t,ee),g=u?new gc:l,p=i.x,v=i.y,_=i.width,y=i.height,m=p+_/2,b=v+y/2,x=D(_,y)/2,w=0,C=0;C<r.length;C++){var S=r[C],I=F*S/o,M=s+I;if(e.fillStyle=a[w++],w===a.length&&(w=0),e.beginPath(),c){var T=m+R(s)*x/2,E=b+k(s)*x/2,P=m+R(M)*x,O=b+k(M)*x;e.moveTo(T,E),e.arc(m,b,x/2,s,M,!1),e.lineTo(P,O),e.arc(m,b,x,M,s,!0)}else e.moveTo(m,b),e.arc(m,b,x,M,s,!0);g&&(I=(s+M)/2,g.add({text:An(u)?u(S,C,o,n):S,x:m+.75*R(I)*x,y:b+.75*k(I)*x})),e.closePath(),e.fill(),s=M}g&&g.each((function(t){qs(e,t.text,d,f,t.x,t.y,0,0,yt)}))}},T=function(t,i){var r=h(t,Xt);if(r&&r.length>0){var o=r.length,a=h(t,Yt),s=h(t,te),c=h(t,ee),u=a?new gc:l,d=h(t,"minValue")||0,f=h(t,"maxValue");if(f==l&&(f=0,r.forEach((function(t){h(t,qt).forEach((function(t){f=P(f,t)}))}))),d===f)return;for(var g=i.height/(f-d),p=i.y+f*g,v=h(r[0],qt).length,_=i.width/(3*v+1),y=2*_/o,m=0,b=0;o>b;b++)for(var x=r[b],w=h(x,ci),C=h(x,"colors"),S=h(x,qt),I=0;v>I;I++){C?e.fillStyle=C[I]:w?e.fillStyle=w:(e.fillStyle=tc[m++],m===tc.length&&(m=0));var M=S[I],T=M*g,E=i.x+(1+3*I)*_+b*y;if(Ao(e,E,p-T,y,T),u){var D=An(a)?a(M,I,x,n):M,O=Xs(s,D).height;u.add({x:E,y:p-T-O,width:y,height:O,text:D})}}u&&u.each((function(t){qs(e,t.text,s,c,t.x,t.y,t.width,t.height,yt)}))}},E=function(t,i){var r=h(t,Xt);if(r&&r.length>0){var o=r.length,a=h(r[0],qt).length,s=i.width/(3*a+1),c=0,u=h(t,"maxValue"),d=h(t,Yt),f=h(t,te),g=h(t,ee),p=d?new gc:l;if(u==l){u=0;for(var v=0;a>v;v++){for(var _=0,y=0;o>y;y++)_+=h(r[y],qt)[v];u=P(u,_)}}if(u>0){for(v=0;a>v;v++){var m=i.y+i.height;for(y=0;o>y;y++){var b=r[y],x=h(b,ci),w=h(b,qt)[v],C=w/u*i.height;x?e.fillStyle=x:(e.fillStyle=tc[c++],c===tc.length&&(c=0)),m-=C;var S={x:i.x+(1+3*v)*s,y:m,width:2*s,height:C};Ao(e,S.x,S.y,S.width,S.height),p&&(S.text=An(d)?d(w,v,b,n):w,p.add(S))}}p&&p.each((function(t){qs(e,t.text,f,g,t.x,t.y,t.width,t.height,yt)}))}}},O=function(t,i){var r=h(t,Xt);if(r&&r.length>0){for(var o=r.length,a=h(r[0],qt).length,s=i.width/(3*a+1),c=0,u=h(t,Yt),d=h(t,te),f=h(t,ee),g=u?new gc:l,p=0;a>p;p++){for(var v=0,_=0;o>_;_++)v+=h(r[_],qt)[p];if(v>0){var y=i.y+i.height;for(_=0;o>_;_++){var m=r[_],b=h(m,ci),x=h(m,qt)[p],w=x/v*i.height;b?e.fillStyle=b:(e.fillStyle=tc[c++],c===tc.length&&(c=0)),y-=w;var C={x:i.x+(1+3*p)*s,y:y,width:2*s,height:w};Ao(e,C.x,C.y,C.width,C.height),g&&(C.text=An(u)?u(x,p,m,n):x,g.add(C))}}}g&&g.each((function(t){qs(e,t.text,d,f,t.x,t.y,t.width,t.height,yt)}))}},z=function(t,i){var r=h(t,Xt);if(r&&r.length>0){var a=r.length,s=h(t,"minValue")||0,c=h(t,"maxValue");if(c==l&&(c=0,r.forEach((function(t){h(t,qt).forEach((function(t){c=P(c,t)}))}))),s===c)return;for(var u=i.height/(c-s),d=i.y+c*u,f=h(r[0],qt).length,g=i.width/(3*f+1),p=0,v=h(t,"lineWidth")||2,_=h(t,"line3d"),y=h(t,"linePoint"),m=h(t,Yt),b=h(t,te),x=h(t,ee),w=0;a>w;w++){var C=r[w],S=h(C,ci),I=h(C,qt);S?e.strokeStyle=S:(S=e.strokeStyle=tc[p++],p===tc.length&&(p=0)),e.beginPath();for(var M=0;f>M;M++){var T=i.x+(2+3*M)*g,E=d-I[M]*u;0===M?e.moveTo(T,E):e.lineTo(T,E)}if(e.lineWidth=v,e.stroke(),_&&zo(e,S,l,v,o),y||m){var D,O=v/2+2;for(M=0;f>M;M++){var R=I[M];if(T=i.x+(2+3*M)*g,E=d-R*u,An(y)?y(e,T,E,S,M,C,n):y&&(e.fillStyle=S,e.beginPath(),e.arc(T,E,O,0,F,!0),e.fill()),An(m)?D=m(R,M,C,n):m&&(D=R),D){var z=Xs(b,D).height,k=e.shadowBlur;if(k){var A=e.shadowOffsetX,V=e.shadowOffsetY,B=e.shadowColor;e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowColor=l}qs(e,D,b,x,T,E-z-O+2,0,z,yt),k&&(e.shadowOffsetX=A,e.shadowOffsetY=V,e.shadowBlur=k,e.shadowColor=B)}}}}}},A=function(t){e=t[0],n=t[1],r=t[2],o=t[3],a=t[4],s=t[5]},V=function(){return[e,n,r,o,a,s]},B=function(t,e){var o;r&&r.getDrawableState?o=r.getDrawableState(n):r&&r.getState?o=r.getState(n):(o=n instanceof _c?n.s(We):null,(o===i||null===o)&&(o=h(t,We)));var a=h(e,We);return(a===i||null===a||a===o)&&h(e,he)},L={border:S,image:w,text:C,pieChart:M,columnChart:T,stackedColumnChart:E,percentageColumnChart:O,lineChart:z};return function(v,w,C,S,I,M,T,E,P,D){if(w&&I&&M){var O=V();e=v,n=T,r=E,!n&&r&&r.isSelfViewEvent&&(n=r),o=r&&r._zoom?r._zoom:1,a=P,s=D;var R,z,k,F,j,H=I,G=M;if(Sh())0===e[Ue]?Sh[0]&&(R=!0):R=!0,e.texureImage2D?Sh[1]&&(z=!0):z=!0,e.texureImage3D?Sh[2]&&(k=!0):k=!0,e.drawDNDState?Sh[3]&&(j=!0):j=!0,sn.widget[0]?Sh[4]&&(F=!0):F=!0,R&&z&&k&&F&&j&&(H=C,G=S);if(w.tagName)return On(it)&&!t[it]||e.drawImage(w,H,G,I,M),void A(O);if(!1===h(w,"visible"))return void A(O);a||(a=dc(w.color,n,r)),D||(s=dc(w.blendMode,n,r)),On(it)&&!t[it]&&(I=H,M=G);var U=hc(w,n,r,I),W=uc(w,n,r,M),N={x:0,y:0,width:U,height:W,fitSize:h(w,"fitSize")},q=h(w,"clip"),X=h(w,"opacity");if(N.fitSize){var Q=N.rw=dc(w.width,n,r)||20;N.widthScale=U/Q;var Y=N.rh=dc(w.height,n,r)||20;N.heightScale=W/Y}if(e.save(),e.interactiveInfo){var Z=e.interactiveInfo.matrix,J=Z.clone();Z.appendTranslate(H,G).appendScale(I/U,M/W),e.interactiveInfo.refRect=N}Vr(e,H,G),(U!==I||W!==M)&&e.scale(I/U,M/W),q&&(An(q)?q(e,U,W,n,r,w):(e.beginPath(),e.rect(0,0,U,W),e.clip())),X!=l&&(e.globalAlpha*=X),h(w,"comps").forEach((function(t){if(t.prefix){var a=ec,s=dc(t.prefix,n,r);s&&(ec=ec+s+".")}if(!1!==B(w,t)){if(nc.splice(0,0,t),e.interactiveInfo)var v=e.interactiveInfo.matrix.clone();var C=h(t,"opacity"),S=h(t,"shadow"),I=h(t,"type"),M=h(t,"refRect")||N,T=p(t,M);if(C!=l){var E=e.globalAlpha;e.globalAlpha*=C}if(S){var P=e.shadowOffsetX,D=e.shadowOffsetY,O=e.shadowBlur,R=e.shadowColor,z=h(t,"shadowOffsetX"),k=h(t,"shadowOffsetY"),A=h(t,"shadowBlur"),V=d(t,"shadowColor");e.shadowOffsetX=(z==l?3:z)*o,e.shadowOffsetY=(k==l?3:k)*o,e.shadowBlur=(A==l?6:A)*o,e.shadowColor=V||d(Sa)}if("save"===I)e.save();else if("endClip"===I||"restore"===I)e.restore();else if("clip"===I)e.save(),Oo(e,h(t,"points",f),h(t,"segments",_),!0),e.clip();else if(Yo[I])T=T||{x:0,y:0,width:M.width,height:M.height},x(t,I,T,M);else if(I===Rt)x(t,I,T,M);else if("SVGPath"===I)b(t,I,T);else{T=T||{x:0,y:0,width:M.width,height:M.height};var F=h(t,le),j=h(t,"scaleX"),H=h(t,"scaleY"),G=g(t),U=y(t,T,T,F,j,H,G);if(An(I))c(t,I),u.drawCompType(I,e,T,t,n,r);else if(u.getCompType(I)){var W=u.getCompType(I),q=W.func||W;c(t,W),u.drawCompType(q,e,T,t,n,r)}else L[I]?L[I](t,T):u.getCompType(I)===i&&en.test(I)&&Kl(I);U&&m(U,t)}S&&(e.shadowOffsetX=P,e.shadowOffsetY=D,e.shadowBlur=O,e.shadowColor=R),C!=l&&(e.globalAlpha=E),e.interactiveInfo&&(e.interactiveInfo.matrix=v),t.prefix&&(ec=a),nc.splice(0,1)}else t.prefix&&(ec=a)})),e.interactiveInfo&&(e.interactiveInfo.matrix=J),e.restore(),A(O)}}}();u.getCurrentComp=function(){return nc[0]},u.getParentComp=function(){return nc[1]},u.getInternal=function(){return{isEnter:po,isEsc:vo,isSpace:go,isLeft:co,isUp:ho,isRight:uo,isDown:fo,addMethod:Qn,superCall:Kn,toPointsArray:Ro,translateAndScale:Ar,appendArray:qn,createWorldMatrix:Hl,vec3TransformMat4:kl,setCanvas:Ir,createDiv:xr,createView:mr,createCanvas:wr,createImage:bn,initContext:kr,layout:Gr,fillRect:Ao,Mat:Ga,drawBorder:Go,isString:On,setBorder:Cr,getPropertyValue:sr,setPropertyValue:lr,drawVerticalLine:hr,draw3DRect:Uo,getPinchDist:Jo,isSameRect:er,getPosition:la,intersectionLineRect:or,getNodeRect:bc,getEdgeAgentPosition:jc,getEdgeHostPosition:Fc,getImageWidth:hc,getImageHeight:uc,initItemElement:yr,drawPoints:Oo,createG2:ql,closePopup:qr,isH:Sn,createAnim:Xn,createNormalMatrix:Yf,toColorArray:Co,createNormals:bf,toFloatArray:_p,glMV:Zf,glPop:Qf,batchShape:Pg,createNodeMatrix:jl,getShapeModel:pp,getFaceInfo:ng,transformAppend:Jd,drawFaceInfo:rg,to3dPointsArray:bp,setGLDebugMode:function(t){Gd=t},cube:function(){return{vs:Ng,is:qg,uv:Xg}},ui:function(){return{DataUI:Cu,NodeUI:Su,EdgeUI:Iu,GroupUI:Tu,ShapeUI:Pu,GridUI:Ou,Data3dUI:wv,Node3dUI:Cv,Shape3dUI:Mv}},getInternalVersion:function(){return"U2FsdGVkX183Gio8RPBTpvpkbMVt+uPetug9gnLj8NA="},getDragger:function(){return Xr},addMSMap:function(t){Qn(es,t)},k:v,addEventListener:w,removeEventListener:C}},function(t){function e(t,e){t!=l&&(e==l&&si!=typeof t?this._54O(t,256):this._54O(t,e))}function i(){return new e(l)}function n(t,e,i,n,r,o){for(;--o>=0;){var a=e*this[t++]+i[n]+r;r=M(a/67108864),i[n++]=67108863&a}return r}function r(t,e,i,n,r,o){for(var a=32767&e,s=e>>15;--o>=0;){var l=32767&this[t],c=this[t++]>>15,h=s*l+c*a;l=a*l+((32767&h)<<15)+i[n]+(1073741823&r),r=(l>>>30)+(h>>>15)+s*c+(r>>>30),i[n++]=1073741823&l}return r}function o(t,e,i,n,r,o){for(var a=16383&e,s=e>>14;--o>=0;){var l=16383&this[t],c=this[t++]>>14,h=s*l+c*a;l=a*l+((16383&h)<<14)+i[n]+r,r=(l>>28)+(h>>14)+s*c,i[n++]=268435455&l}return r}function s(t){return Dt.charAt(t)}function c(t,e){var i=Ot[t.charCodeAt(e)];return i==l?-1:i}function h(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function u(t){this.t=1,this.s=0>t?-1:0,t>0?this[0]=t:-1>t?this[0]=t+this.DV:this.t=0}function d(t){var e=i();return e._58O(t),e}function f(t,i){var n,r=this;if(16==i)n=4;else if(8==i)n=3;else if(256==i)n=8;else if(2==i)n=1;else if(32==i)n=5;else{if(4!=i)return void r.fromRadix(t,i);n=2}r.t=0,r.s=0;for(var o=t.length,a=!1,s=0;--o>=0;){var l=8==n?255&t[o]:c(t,o);0>l?"-"==t.charAt(o)&&(a=!0):(a=!1,0==s?r[r.t++]=l:s+n>r.DB?(r[r.t-1]|=(l&(1<<r.DB-s)-1)<<s,r[r.t++]=l>>r.DB-s):r[r.t-1]|=l<<s,s+=n,s>=r.DB&&(s-=r.DB))}8==n&&0!=(128&t[0])&&(r.s=-1,s>0&&(r[r.t-1]|=(1<<r.DB-s)-1<<s)),r._57O(),a&&e.ZERO._78O(r,r)}function g(){for(var t=this,e=t.s&t.DM;t.t>0&&t[t.t-1]==e;)--t.t}function p(t){var e,i=this;if(i.s<0)return"-"+i._85O()[_t](t);if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return i.toRadix(t);e=2}var n,r=(1<<e)-1,o=!1,a="",l=i.t,c=i.DB-l*i.DB%e;if(l-- >0)for(c<i.DB&&(n=i[l]>>c)>0&&(o=!0,a=s(n));l>=0;)e>c?(n=(i[l]&(1<<c)-1)<<e-c,n|=i[--l]>>(c+=i.DB-e)):(n=i[l]>>(c-=e)&r,0>=c&&(c+=i.DB,--l)),n>0&&(o=!0),o&&(a+=s(n));return o?a:"0"}function y(){var t=i();return e.ZERO._78O(this,t),t}function m(){return this.s<0?this._85O():this}function b(t){var e=this,i=e.s-t.s;if(0!=i)return i;var n=e.t;if(i=n-t.t,0!=i)return e.s<0?-i:i;for(;--n>=0;)if(0!=(i=e[n]-t[n]))return i;return 0}function x(t){var e,i=1;return 0!=(e=t>>>16)&&(t=e,i+=16),0!=(e=t>>8)&&(t=e,i+=8),0!=(e=t>>4)&&(t=e,i+=4),0!=(e=t>>2)&&(t=e,i+=2),0!=(e=t>>1)&&(t=e,i+=1),i}function w(){var t=this;return t.t<=0?0:t.DB*(t.t-1)+x(t[t.t-1]^t.s&t.DM)}function C(t,e){var i;for(i=this.t-1;i>=0;--i)e[i+t]=this[i];for(i=t-1;i>=0;--i)e[i]=0;e.t=this.t+t,e.s=this.s}function S(t,e){for(var i=t;i<this.t;++i)e[i-t]=this[i];e.t=P(this.t-t,0),e.s=this.s}function I(t,e){var i,n=this,r=t%n.DB,o=n.DB-r,a=(1<<o)-1,s=M(t/n.DB),l=n.s<<r&n.DM;for(i=n.t-1;i>=0;--i)e[i+s+1]=n[i]>>o|l,l=(n[i]&a)<<r;for(i=s-1;i>=0;--i)e[i]=0;e[s]=l,e.t=n.t+s+1,e.s=n.s,e._57O()}function O(t,e){var i=this;e.s=i.s;var n=M(t/i.DB);if(n>=i.t)e.t=0;else{var r=t%i.DB,o=i.DB-r,a=(1<<r)-1;e[0]=i[n]>>r;for(var s=n+1;s<i.t;++s)e[s-n-1]|=(i[s]&a)<<o,e[s-n]=i[s]>>r;r>0&&(e[i.t-n-1]|=(i.s&a)<<o),e.t=i.t-n,e._57O()}}function z(t,e){for(var i=this,n=0,r=0,o=D(t.t,i.t);o>n;)r+=i[n]-t[n],e[n++]=r&i.DM,r>>=i.DB;if(t.t<i.t){for(r-=t.s;n<i.t;)r+=i[n],e[n++]=r&i.DM,r>>=i.DB;r+=i.s}else{for(r+=i.s;n<t.t;)r-=t[n],e[n++]=r&i.DM,r>>=i.DB;r-=t.s}e.s=0>r?-1:0,-1>r?e[n++]=i.DV+r:r>0&&(e[n++]=r),e.t=n,e._57O()}function V(t,i){var n=this.abs(),r=t.abs(),o=n.t;for(i.t=o+r.t;--o>=0;)i[o]=0;for(o=0;o<r.t;++o)i[o+n.t]=n.am(0,r[o],i,o,0,n.t);i.s=0,i._57O(),this.s!=t.s&&e.ZERO._78O(i,i)}function B(t){for(var e=this.abs(),i=t.t=2*e.t;--i>=0;)t[i]=0;for(i=0;i<e.t-1;++i){var n=e.am(i,e[i],t,2*i,0,1);(t[i+e.t]+=e.am(i+1,2*e[i],t,2*i+1,n,e.t-i-1))>=e.DV&&(t[i+e.t]-=e.DV,t[i+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(i,e[i],t,2*i,0,1)),t.s=0,t._57O()}function L(t,n,r){var o=t.abs(),a=this;if(!(o.t<=0)){var s=a.abs();if(s.t<o.t)return n!=l&&n._58O(0),void(r!=l&&a._77O(r));r==l&&(r=i());var c=i(),h=a.s,u=t.s,d=a.DB-x(o[o.t-1]);d>0?(o._44O(d,c),s._44O(d,r)):(o._77O(c),s._77O(r));var f=c.t,g=c[f-1];if(0!=g){var p=g*(1<<a.F1)+(f>1?c[f-2]>>a.F2:0),v=a.FV/p,_=(1<<a.F1)/p,y=1<<a.F2,m=r.t,b=m-f,w=n==l?i():n;for(c._59O(b,w),r._52O(w)>=0&&(r[r.t++]=1,r._78O(w,r)),e.ONE._59O(f,w),w._78O(c,c);c.t<f;)c[c.t++]=0;for(;--b>=0;){var C=r[--m]==g?a.DM:M(r[m]*v+(r[m-1]+y)*_);if((r[m]+=c.am(0,C,r,b,0,f))<C)for(c._59O(b,w),r._78O(w,r);r[m]<--C;)r._78O(w,r)}n!=l&&(r._45O(f,n),h!=u&&e.ZERO._78O(n,n)),r.t=f,r._57O(),d>0&&r._46O(d,r),0>h&&e.ZERO._78O(r,r)}}}function j(t){var n=i();return this.abs()._49O(t,l,n),this.s<0&&n._52O(e.ZERO)>0&&t._78O(n,n),n}function H(t){this.m=t}function G(t){return t.s<0||t._52O(this.m)>=0?t.mod(this.m):t}function W(t){return t}function N(t){t._49O(this.m,l,t)}function q(t,e,i){t._47O(e,i),this._74O(i)}function Q(t,e){t._48O(e),this._74O(e)}function Y(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return e=15&e*(2-(15&t)*e),e=255&e*(2-(255&t)*e),e=65535&e*(2-(65535&(65535&t)*e)),e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function Z(t){var e=this;e.m=t,e.mp=t._50O(),e.mpl=32767&e.mp,e.mph=e.mp>>15,e.um=(1<<t.DB-15)-1,e.mt2=2*t.t}function J(t){var n=i();return t.abs()._59O(this.m.t,n),n._49O(this.m,l,n),t.s<0&&n._52O(e.ZERO)>0&&this.m._78O(n,n),n}function K(t){var e=i();return t._77O(e),this._74O(e),e}function $(t){for(var e=this;t.t<=e.mt2;)t[t.t++]=0;for(var i=0;i<e.m.t;++i){var n=32767&t[i],r=n*e.mpl+((n*e.mph+(t[i]>>15)*e.mpl&e.um)<<15)&t.DM;for(n=i+e.m.t,t[n]+=e.m.am(0,r,t,i,0,e.m.t);t[n]>=t.DV;)t[n]-=t.DV,t[++n]++}t._57O(),t._45O(e.m.t,t),t._52O(e.m)>=0&&t._78O(e.m,t)}function tt(t,e){t._48O(e),this._74O(e)}function et(t,e,i){t._47O(e,i),this._74O(i)}function it(){return 0==(this.t>0?1&this[0]:this.s)}function nt(t,n){if(t>4294967295||1>t)return e.ONE;var r=i(),o=i(),a=n._73O(this),s=x(t)-1;for(a._77O(r);--s>=0;)if(n._76O(r,o),(t&1<<s)>0)n._75O(o,a,r);else{var l=r;r=o,o=l}return n.revert(r)}function rt(t,e){var i;return i=256>t||e._51O()?new H(e):new Z(e),this.exp(t,i)}function ot(){var t=this;if(t.s<0){if(1==t.t)return t[0]-t.DV;if(0==t.t)return-1}else{if(1==t.t)return t[0];if(0==t.t)return 0}return(t[1]&(1<<32-t.DB)-1)<<t.DB|t[0]}function at(t,i){return new e(t,i)}function st(){var t=this;t.n=l,t.e=0,t.d=l,t.p=l,t.q=l,t.dmp1=l,t.dmq1=l,t._10A=l}function lt(t){return t._53O(this.e,this.n)}function ct(t){var e,i,n,r="",o=0;for(e=0;e<t.length&&t.charAt(e)!=Lt;++e)n=Bt.indexOf(t.charAt(e)),0>n||(0==o?(r+=s(n>>2),i=3&n,o=1):1==o?(r+=s(i<<2|n>>4),i=15&n,o=2):2==o?(r+=s(i),r+=s(n>>2),i=3&n,o=3):(r+=s(i<<2|n>>4),r+=s(15&n),o=0));return 1==o&&(r+=s(i<<2)),r}function ht(t){var e=t.split(""),i=ct(t);return e.forEach((function(t){var e=t.length;e>0&&i&&(Bi+=X(t))})),i}function ut(t,e){var i=Nt._4O.Util._56O(t,"ss"),n={},r=0;return n.v=i==e,n.t=1,n.s=0>r?-1:0,Li=n.v,r>0?n[0]=r:-1>r?n[0]=r+n.DV:n.t=0,[i,n]}function dt(t){var e=38,i=t.substring(0,e);if(i&&30==i.indexOf("05000420")){var n=["ss",t.substring(e)];return n}return[]}function ft(t,e){e=e.replace(Ut,""),e=e.replace(/[ \n]+/g,"");var i=at(e,16);if(i._55O()>this.n._55O())return 0;var n=this._37O(i),r=n[_t](16).replace(/^1f+00/,""),o=dt(r);if(0==o.length)return!1;for(var a,s,l,c=.5,h=ml,u=[0,.5,.75,.875,.9375],d=[],f=[],g=[],p=F/h,v=o[1],_=ut(t,v)[0],y=0,m=0;y<u.length;y++){var b=0===y%2?0:.5;for(a=0;h>=a;a++)s=(a+b)*p,l=1-u[y],d.push(R(s)*c*l,-c+2*u[y]*c,-k(s)*c*l),f.push((a+b)/h,l)}for(y=0;y<u.length-1;y++){var x=y*(h+1),w=(y+1)*(h+1);for(a=0;h>a;a++)g.push(x+a,w+a+1,w+a,x+a,x+a+1,w+a+1)}return g.forEach((function(t){m+=t})),v==_&&m>10}var gt,pt=0xdeadbeefcafe,vt=15715070==(16777215&pt),_t="toString",yt="",mt="nat",bt=function(){};_=t["D"+11182[_t](A(2,5))];var xt=e.prototype;de+=wt.substr(0,1);var Mt=t.navigator?t.navigator.appName:"";vt&&"Microsoft Internet Explorer"==Mt?(xt.am=r,gt=30):vt&&"Netscape"!=Mt?(xt.am=n,gt=26):(xt.am=o,gt=28),xt.DB=gt,xt.DM=(1<<gt)-1,xt.DV=1<<gt;var Tt=52;xt.FV=A(2,Tt),xt.F1=Tt-gt,xt.F2=2*gt-Tt;var Et,Pt,Dt="0123456789abcdefghijklmnopqrstuvwxyz",Ot=[],Rt=function(t){return String.fromCharCode(t)};for(Et="0".charCodeAt(0),Pt=0;9>=Pt;++Pt)Ot[Et++]=Pt;for(Et="a".charCodeAt(0),Pt=10;36>Pt;++Pt)Ot[Et++]=Pt;for(Et="A".charCodeAt(0),Pt=10;36>Pt;++Pt)Ot[Et++]=Pt;var zt=H.prototype;zt._73O=G,zt.revert=W,zt._74O=N,zt._75O=q,zt._76O=Q;var kt=Z.prototype;kt._73O=J,kt.revert=K,kt._74O=$,kt._75O=et,kt._76O=tt,xt._77O=h,xt._58O=u,xt._54O=f,xt._57O=g,xt._59O=C,xt._45O=S,xt._44O=I,xt._46O=O,xt._78O=z,xt._47O=V,xt._48O=B,xt._49O=L,xt._50O=Y,xt._51O=it,xt.exp=nt,xt.toString=p,xt._85O=y,xt.abs=m,xt._52O=b,xt._55O=w,xt.mod=j,xt._53O=rt,e.ZERO=d(0),e.ONE=d(1),xt._86O=ot;var At=function(t,e){var i=this;i.isPublic=!0,typeof t!==si?(i.n=t,i.e=e):t!=l&&e!=l&&t.length>0&&e.length>0&&(i.n=at(t,16),i.e=X(e,16))};bo=function(){var t,e,i=ht(Ht),n=i.substr(0,4),r=i.substr(4,2),o=i.substr(6,2),a=1,s=!a,c=v,h=[],u=fi.charAt(7);if(_&&(_[_t]().indexOf(mt)<0||_[de][_t]().indexOf(mt)<0||!i?t=l:(i=new _(n-0,r-a,o-0),e=i.setHours(9),_[de]()>e?t=Do[u]:s=!0)),i&&t&&t[0]&&t[T(.5)]&&c){var d=Vl(t[0]),f=Vl(t[1]);for(var g in f)h.push(g);var p,y=0,m=d[h[y]],b=f[h[y++]],x=f[h[y++]],w=f[h[y++]],C=f[h[y++]],S=f[h[y++]],I=f[h[y++]],M=d[h[y]],E=f[h[y++]],P=ne._27O(c);if(m===b&&P&&E){p=b+x+w+C+S+I;var D=!I||I===Ii;if(!D&&I)for(var O,R=0,z=I.length;z>R;R++)I[R]===Te[y]?O===Ii||O[0]===ie[5]&&Ii&&Ii.indexOf(O.substr(1))>=0?D=!0:O=l:(O==l?O=I[R]:O+=I[R],R===z-1&&(O===Ii||O[0]===ie[5]&&Ii&&Ii.indexOf(O.substr(1))>=0)&&(D=!0));p&&P._31O(p,E)&&P._31O(m,M)&&D&&(!S||_[de]()<S)&&(s=!0)}}return s||(Vo=tr),u};var Vt=st.prototype;Vt._37O=lt,Vt._38O=At;var Bt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Lt="=",Ft=25,jt=10,Ht="ICExU===",Gt=Gt||function(t,e){var i={},n=i._7A={},r=n._6A=function(){function t(){}return{_80O:function(e){t.prototype=this;var i=new t;return e&&i._5A(e),i.hasOwnProperty("_82O")||(i._82O=function(){i.$super._82O.apply(this,arguments)}),i._82O.prototype=i,i.$super=this,i},_3A:function(){var t=this._80O();return t._82O.apply(t,arguments),t},_82O:function(){},_5A:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty(_t)&&(this.toString=t.toString)},_88O:function(){return this._82O.prototype._80O(this)}}}(),o=n._39O=r._80O({_82O:function(t,i){t=this._84O=t||[],this._65O=i!=e?i:4*t.length},toString:function(t){return(t||s).stringify(this)},_89O:function(t){var e=this._84O,i=t._84O,n=this._65O,r=t._65O;if(this._57O(),n%4)for(var o=0;r>o;o++){var a=255&i[o>>>2]>>>24-o%4*8;e[n+o>>>2]|=a<<24-(n+o)%4*8}else if(i.length>65535)for(o=0;r>o;o+=4)e[n+o>>>2]=i[o>>>2];else e.push.apply(e,i);return this._65O+=r,this},_57O:function(){var t=this._84O,e=this._65O;t[e>>>2]&=4294967295<<32-e%4*8,t.length=T(e/4)},_88O:function(){var t=r._88O.call(this);return t._84O=this._84O.slice(0),t},_87O:function(t){for(var e=[],i=0;t>i;i+=4)e.push(0|4294967296*U);return new o._82O(e,t)}}),a=i._2A={},s=a._69O={stringify:function(t){var e,i=t._84O,n=t._65O,r=[];for(e=0;n>e;e++){var o=255&i[e>>>2]>>>24-e%4*8;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},_68O:function(t){for(var e=t.length,i=[],n=0;e>n;n+=2)i[n>>>3]|=X(t.substr(n,2),16)<<24-n%8*4;return new o._82O(i,e/2)}},l=a._8A={stringify:function(t){var e,i=t._84O,n=t._65O,r=[];for(e=0;n>e;e++){var o=255&i[e>>>2]>>>24-e%4*8;r.push(Rt(o))}return r.join("")},_68O:function(t){var e,i=t.length,n=[];for(e=0;i>e;e++)n[e>>>2]|=(255&t.charCodeAt(e))<<24-e%4*8;return new o._82O(n,i)}},c=a._9A={stringify:function(t){try{return decodeURIComponent(escape(l.stringify(t)))}catch(W){throw new Error("")}},_68O:function(t){return l._68O(unescape(encodeURIComponent(t)))}},h=n._32O=r._80O({_1A:function(){this._83O=new o._82O,this._23O=0},_33O:function(t){typeof t==si&&(t=c._68O(t)),this._83O._89O(t),this._23O+=t._65O},_25O:function(t){var e=this._83O,i=e._84O,n=e._65O,r=this._79O,a=4*r,s=n/a;s=t?T(s):P((0|s)-this._22O,0);var l=s*r,c=D(4*l,n);if(l){for(var h=0;l>h;h+=r)this._20O(i,h);var u=i.splice(0,l);e._65O-=c}return new o._82O(u,c)},_88O:function(){var t=r._88O.call(this);return t._83O=this._83O._88O(),t},_22O:0});n._66O=h._80O({cfg:r._80O(),_82O:function(t){this.cfg=this.cfg._80O(t),this._1A()},_1A:function(){h._1A.call(this),this._34O()},_81O:function(t){return this._33O(t),this._25O(),this},_72O:function(t){t&&this._33O(t);var e=this._21O();return e},_79O:16,_26O:function(t){return function(e,i){return new t._82O(i)._72O(e)}},_19O:function(t){return function(e,i){return new u._71O._82O(t,i)._72O(e)}}});var u=i._67O={};return i}();!function(){var t=Gt,e=t._7A,i=e._39O,n=e._66O,r=t._67O,o=[],a=[];!function(){function t(t){for(var e=E(t),i=2;e>=i;i++)if(!(t%i))return!1;return!0}function e(t){return 0|4294967296*(t-(0|t))}for(var i=2,n=0;64>n;)t(i)&&(8>n&&(o[n]=e(A(i,.5))),a[n]=e(A(i,1/3)),n++),i++}();var s=[],l=r._41O=n._80O({_34O:function(){this._64O=new i._82O(o.slice(0))},_20O:function(t,e){for(var i=this._64O._84O,n=i[0],r=i[1],o=i[2],l=i[3],c=i[4],h=i[5],u=i[6],d=i[7],f=0;64>f;f++){if(16>f)s[f]=0|t[e+f];else{var g=s[f-15],p=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,v=s[f-2],_=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;s[f]=p+s[f-7]+_+s[f-16]}var y=c&h^~c&u,m=n&r^n&o^r&o,b=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),x=(c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25),w=d+x+y+a[f]+s[f],C=b+m;d=u,u=h,h=c,c=0|l+w,l=o,o=r,r=n,n=0|w+C}i[0]=0|i[0]+n,i[1]=0|i[1]+r,i[2]=0|i[2]+o,i[3]=0|i[3]+l,i[4]=0|i[4]+c,i[5]=0|i[5]+h,i[6]=0|i[6]+u,i[7]=0|i[7]+d},_21O:function(){var t=this._83O,e=t._84O,i=8*this._23O,n=8*t._65O;return e[n>>>5]|=128<<24-n%32,e[14+(n+64>>>9<<4)]=M(i/4294967296),e[15+(n+64>>>9<<4)]=i,t._65O=4*e.length,this._25O(),this._64O},_88O:function(){var t=n._88O.call(this);return t._64O=this._64O._88O(),t}});t._41O=n._26O(l),t._42O=n._19O(l)}();var Ut=new RegExp("");Ut.compile("[^0-9a-f]","gi"),st._28O=-1,st._29O=-2,Vt._31O=ft,Vt._63O=ft,st._43O=-2;var Wt=new function(){var t=this;t._5O=function(t,e){if("8"!=t.substring(e+2,e+3))return 1;var i=X(t.substring(e+3,e+4));return 0==i?-1:i>0&&10>i?i+1:-2},t._13O=function(e,i){var n=t._5O(e,i);return 1>n?"":e.substring(i+2,i+2+2*n)},t._12O=function(i,n){var r,o=t._13O(i,n);return""==o?-1:(r=X(o.substring(0,1))<8?new e(o,16):new e(o.substring(2),16),r._86O())},t._6O=function(e,i){var n=t._5O(e,i);return 0>n?n:i+2*(n+1)},t._11O=function(e,i){var n=t._6O(e,i),r=t._12O(e,i);return e.substring(n,n+2*r)},t._10O=function(e,i){var n=t._6O(e,i),r=t._12O(e,i);return n+2*r},t._7O=function(e,i){var n=[],r=t._6O(e,i);n.push(r);for(var o=t._12O(e,i),a=r,s=0;;){var c=t._10O(e,a);if(c==l||c-r>=2*o)break;if(s>=200)break;n.push(c),a=c,s++}return n}};if(Wt._90O=Rt(jt+24),Wt._91O=a+Rt(jt*jt+8),Nt==l||!Nt)var Nt={};Nt._4O!=l&&Nt._4O||(Nt._4O={});var qt=Nt._4O;Nt._4O.Util=new function(){var t=this;t._56O=function(t){var e=new Nt._4O._3O;return e._30O(t)},t._4A=function(t){var e=new Nt._4O._3O;return e._36O(t)},t._11A=function(t){var e=new qt._3O;return e._30O(t)}},Nt._4O._3O=function(){var t=this;t._8O=function(e,i){if("ss"==e&&"cj"==i){try{t.md=Gt._67O._41O._3A()}catch(T){bt(yt)}t._24O=function(e){t.md._81O(e)},t._35O=function(e){var i=Gt._2A._69O._68O(e);t.md._81O(i)},t._60O=function(){var e=t.md._72O();return e[_t](Gt._2A._69O)},t._30O=function(e){return t._24O(e),t._60O()},t._36O=function(e){return t._35O(e),t._60O()}}},t._24O=function(){bt(yt)},t._35O=function(){bt(yt)},t._60O=function(){bt(yt)},t._30O=function(){bt(yt)},t._36O=function(){bt(yt)},t._8O("ss","cj")},Fi=function(t){var e=dr[$e[7]],i=1,n=!1;if(yo.a!=dr[ui])return yo.a;if(yo.forEach((function(t){i*=t})),t>i){if(e&&e[1]&&e[0]){var r=e[0],o=e[1];o=o.split(Wt._90O),r=r.split(Wt._90O);var a=o[3],s=r[3],l=o[7],c=o[11],h=o[15],u=o[19],d=o[23],f=o[27],g=r[7],p=a+l+c+h+u+d,v=!d,_=s===a;if(d){var y=d&&d.split(Dn("firefox")[3]);if(y)for(var m=0;m<y.length;m++){var b=y[m];if(b[0]===ye[8]&&(b=b.substring(1)),ii.indexOf(b)>=0){v=!0;break}}}n=_&&dn()(s,g)&&dn()(p,f)&&v&&(!u||u>t),n&&c.indexOf(Ct.length)>=0&&(Fi[Ct.length]=Ct),n&&c.indexOf(Ct.length+1)>=0&&(Fi[Ct.length+1]=Ct),n&&c.indexOf(Ct.length+3)>=0&&(Fi[Ct.length+3]=Ct)}n||(Cu.prototype._42=Vi)}else n=!0,Fi[Ct.length]=Fi[Ct.length+1]=Fi[Ct.length+3]=Ct;return yo.a=n,n},Ft=String.fromCharCode(Ft+20);var Xt,Qt,Yt=function(t){return t=t.replace(Ut,yt),t.replace(/[ \n]+/g,yt)},Zt="30",Jt="06",Kt="02",$t="03",te=at,ee=/^1f+00/,ne=function(){var t;return t={_18O:function(t){var e=t,i=e.replace(/\s+/g,""),n=ct(i);return n},_14O:function(t){var e=this._18O(t),i=this._15O(e);return i},_15O:function(t){var e=this._17O(t);if("2a864886f70d010101"==e._61O){var i=this._16O(e.key),n=new st;return n._38O(i.n,i.e),n}bt(yt)},_16O:function(t){var e={};t.substr(0,2)!=Zt&&bt(yt);var i=Wt._7O(t,0);return 2!=i.length&&bt(yt),t.substr(i[0],2)!=Kt&&bt(yt),e.n=Wt._11O(t,i[0]),t.substr(i[1],2)!=Kt&&bt(yt),e.e=Wt._11O(t,i[1]),e},_17O:function(t){var e={};e._40O=l;var i=Wt._7O(t,0);2!=i.length&&bt(yt);var n=i[0];t.substr(n,2)!=Zt&&bt(yt);var r=Wt._7O(t,n);return 2!=r.length&&bt(yt),t.substr(r[0],2)!=Jt&&bt(yt),e._61O=Wt._11O(t,r[0]),t.substr(r[1],2)==Jt?e._40O=Wt._11O(t,r[1]):t.substr(r[1],2)==Zt&&(e._40O={},e._40O.p=Wt._70O(t,r[1],[0],Kt),e._40O.q=Wt._70O(t,r[1],[1],Kt),e._40O.g=Wt._70O(t,r[1],[2],Kt)),t.substr(i[1],2)!=$t&&bt(yt),e.key=Wt._11O(t,i[1]).substr(2),e}},t._17O?t:l}(),re=ne._27O=function(t){return ne._14O(t)};dn=function(){return function(t,e){if(t&&e){e=Yt(e);var i=te(e,A(2,4)),n=this;if(!n||!n.n||i._55O()>n.n._55O())return 0;var r=n._37O(i),o=r[_t](A(2,4)).replace(ee,""),a=dt(o);if(0==a.length)return!1;var s=a[0],l=a[1],c=function(t){return Nt._4O.Util._56O(t,s)},h=c(t);return l==h}}.bind(re(v))},function(){var t=Pe.length-Ee.length;if(t>0)for(var e=0;t>e;e++)Xt=qt.Util,Qt=Yt}(),rn=function(t,e){e=Qt(e);var i=re(Ul),n=It.length,r=2*n,o=te(e,A(n,r)),a=i,s=!0;if(a){var l=a[St[0]];l&&o._55O()<=l._55O()&&(s=!1)}if(s)return 0;var c=a._37O(o),h=c[_t](A(n,r)).replace(ee,""),u=dt(h);if(0==u.length)return!1;var d=u[0],f=u[1],g=Xt._11A(t,d);return f==g}}(t),Qn(u,{load:function(){var t={},e=function(t){return t?"c_"+(t.sync?"1":"0")+"_"+(t.post?"1":"0")+"_"+(t.responseType||"H")+"_"+(t.mimeType||"H")+"_"+(t.data?JSON.stringify(t.data):"H"):""};return function(i,n,r){var o,a=t[i],s=e(r);return a&&(o=a[s])?void o.push(n):(t[i]||(a=t[i]={count:0}),o=a[s]=[n],a.count++,void u.xhrLoad(i,(function(e){delete a[s],a.count--,a.count||delete t[i],o.forEach((function(t){t(e)}))}),r))}}(),asyncEach:function(t,e,i){"function"!=typeof i&&(i=Function.prototype);var n=new Array(t.length),r=0,o=!1;t.forEach((function(a,s){e(a,(function(e,a){return o?void 0:e?(o=!0,i(null)):(n[s]=a,r++,r===t.length?i(n):void 0)}))}))},xhrLoad:function(t,e,i){var n=!1;Vn(t)||(n=!0,t=[t]),i=i||{};var r=i.sync,o=null,a=i.method||"GET";return i.post&&(a="POST"),i.method=a,u.asyncEach(t,(function(t,e){var n=new wu;t=u.beforeLoadURL(t),t.data?e(null,t.data):(i.url=encodeURI(t),i.responseType?n.setResponseType(i.responseType):n.setOverrideMimeType(i.mimeType||"text/plain"),n.onload=function(){200===this.status||0===this.status?e(null,n.getResponseText()):e(!0)},n.onerror=function(){e(!0)},n.send(i))}),(function(t){var i="function"==typeof e;(i||r)&&(o=n&&t?t[0]:t,i&&e(o))})),r?o:void 0}});var gc=c.List=function(){this._as=[];var t,e,i=arguments.length;if(1===i){var n=arguments[0];if(Bn(n)&&(n=n._as),Vn(n))for(e=n.length,t=0;e>t;t++)this._as.push(n[t]);else n!=l&&this._as.push(n)}else if(i>1)for(t=0;i>t;t++)this._as.push(arguments[t])};xl("List",e,{forEach:function(t,e){this.each(t,e)},push:function(){for(var t=0;t<arguments.length;t++)this.add(arguments[t])},pop:function(){return this._as.pop()},shift:function(){return this._as.shift()},unshift:function(){return this._as.unshift.apply(this._as,arguments)},size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(t,e){return e===i?this._as.push(t):this._as.splice(e,0,t)},addAll:function(t){Bn(t)&&(t=t._as),Vn(t)?qn(this._as,t):this._as.push(t)},get:function(t){return this._as[t]},slice:function(t,e){return new gc(this._as.slice(t,e))},remove:function(t){var e=this._as.indexOf(t);return e>=0&&e<this._as.length&&this.removeAt(e),e},removeAt:function(t){return this._as.splice(t,1)[0]},set:function(t,e){return this._as[t]=e},clear:function(){return this._as.splice(0,this._as.length)},contains:function(t){return this._as.indexOf(t)>=0},indexOf:function(t){return this._as.indexOf(t)},each:function(t,e){for(var i=0,n=this._as.length;n>i;i++){var r=this._as[i];e?t.call(e,r,i,this):t(r,i,this)}},reverseEach:function(t,e){for(var i=this._as.length-1;i>=0;i--){var n=this._as[i];e?t.call(e,n):t(n)}},getArray:function(){return this._as},toArray:function(t,e){if(t){for(var i,n=[],r=0,o=this._as.length;o>r;r++)i=this._as[r],e?t.call(e,i)&&n.push(i):t(i)&&n.push(i);return n}return this._as.concat()},toList:function(t,e){if(t){for(var i,n=new gc,r=0,o=this._as.length;o>r;r++)i=this._as[r],e?t.call(e,i)&&n.add(i):t(i)&&n.add(i);return n}return new gc(this)},reverse:function(){this._as.reverse()},sort:function(t){return this._as.sort(t||js),this},toString:function(){return this._as.toString()}}),e.defineProperties(gc.prototype,{length:{get:function(){return this._as.length},set:function(t){this._as.length=t}}});var pc=new gc;Qn(pc,{size:function(){return 0},indexOf:function(){return-1},contains:function(){return!1},isEmpty:function(){return!0},sort:ln,each:ln,reverseEach:ln,toArray:function(){return[]},toList:function(){return new gc},add:cn,addAll:cn,set:cn,remove:cn,removeAt:cn,clear:cn});var vc=c.Notifier=function(){this._f=0};xl("Notifier",e,{contains:function(t,e){if(this._ls)for(var i,n=0,r=this._ls.size();r>n;n++)if(i=this._ls.get(n),t===i.l&&e===i.s)return!0;return!1},add:function(t,e,i){var n=this,r={l:t,s:e,a:i};n._ls||(n._ls=new gc),n._f?(n._as||(n._as=new gc),n._as.add(r)):r.a?n._ls.add(r,0):n._ls.add(r)},remove:function(t,e){var i=this;i._ls&&(i._f?(i._rs||(i._rs=new gc),i._rs.add({l:t,s:e})):i._remove(t,e))},_remove:function(t,e){for(var i,n=this._ls,r=0,o=n.size();o>r;r++)if(i=n.get(r),i.l===t&&i.s===e)return void n.removeAt(r)},fire:function(t){var e=this,i=e._ls;if(e._b=1e4,i){++e._f;try{for(var n,r=0,o=i.size();o>r;r++)n=i.get(r),n.s?n.l.call(n.s,t):n.l(t)}catch(t){J((function(){throw t}))}finally{if(--e._f)return;if(e._rs){for(o=e._rs.size(),r=0;o>r;r++)n=e._rs.get(r),e._remove(n.l,n.s);delete e._rs}if(e._as){for(o=e._as.size(),r=0;o>r;r++)n=e._as.get(r),n.a?i.add(n,0):i.add(n);delete e._as}}}}});var _c=c.Data=function(){this._id=Bs()};xl("Data",e,{ms_ac:["tag","name","displayName","icon","toolTip","attrObject","styleMap","layer","adjustChildrenToTop","dataBindings"],ms_dm:1,ms_attr:1,_icon:l,_parent:l,_children:pc,_childMap:l,_styleMap:l,_layer:"0",_adjustChildrenToTop:!1,getUIClass:function(){return l},_22Q:function(){return l},beginTransaction:function(){this._dataModel&&this._dataModel.beginTransaction()},endTransaction:function(){this._dataModel&&this._dataModel.endTransaction()},s:function(t,e){var i=this;if(2===arguments.length)i.setStyle(t,e);else{if(!kn(t))return i.getStyle(t);for(var n in t)i.setStyle(n,t[n])}return i},setRenderLayer:function(t){this.s("alwaysOnTop","top"===t)},fp:function(t,e,i,n,r){return this.firePropertyChange(t,e,i,n,r)},firePropertyChange:function(t,e,i,n,r){if(n){if(n(e,i))return!1}else if(e===i)return!1;var o=this,a=r||{};return a.property=t,a.oldValue=e,a.newValue=i,a.data=o,o._dataModel&&o._dataModel.handleDataPropertyChange(a),o.onPropertyChanged(a),!0},onPropertyChanged:function(t){var e=this,i=e._parent,n=t.property;if(Hn(i)){var r=e.s(Ft),o="s:ingroup"===n;(r&&Ic[n]||n===o)&&i._81I(),(r||o)&&i.fp("childChange",!0,!1)}Un(i)&&Ic[n]&&i.updateFromChildren()},_21I:function(t){var e=this;if(t&&e._dataModel)throw"Remove data from dataModel before adding";e._dataModel=t},removeFromDataModel:function(){this._dataModel?this._dataModel.remove(this):this.setParent(null)},clearChildrenFromDataModel:function(){for(var t=0,e=this._children.toArray(),i=e.length;i>t;t++)e[t].removeFromDataModel()},getId:function(){return this._id},setId:function(t){this._id=t},getChildren:function(){return this._children},size:function(){return this._children.size()},toChildren:function(t,e){return this._children.toList(t,e)},eachChild:function(t,e){this._children.each(t,e)},addChild:function(t,e){var i=this;t!==i&&(i._children===pc&&(i._children=new gc,i._childMap={}),e>=0||(e=i._children.size()),i._childMap[t._id]||i.isDescendantOf(t)||(t._parent&&t._parent.removeChild(t),(0>e||e>i._children.size())&&(e=i._children.size()),i._children.add(t,e),i._childMap[t._id]=t,t.setParent(i),i.onChildAdded(t,e),i.fp(Fe,l,t)))},onChildAdded:function(){},removeChild:function(t){var e=this;if(e._childMap&&e._childMap[t._id]){var i=e._children.remove(t);delete e._childMap[t._id],e.fp(Fe,t,l),t.setParent(l,i),e.onChildRemoved(t,i)}},onChildRemoved:function(){},getChildAt:function(t){return this._children.get(t)},clearChildren:function(){var t=this;if(!t._children.isEmpty())for(var e=0,i=t._children.toArray(),n=i.length;n>e;e++)t.removeChild(i[e])},getParent:function(){return this._parent},setParent:function(t,e){var n=this;if(!(n._73I||n._parent===t||n===t||t&&t.isDescendantOf(n))){var r,o=n._parent;n._parent=t,n._73I=1,o?(e==l&&(e=o.getChildren().indexOf(n)),o.removeChild(n)):n._dataModel&&e==l&&(e=n._dataModel.getRoots().indexOf(n)),t&&(t.addChild(n),r=t.getChildren().indexOf(n)),delete n._73I,n.fp("parent",o,t,i,{oldIndex:e,newIndex:r}),n.onParentChanged(o,t)}},onParentChanged:function(){},hasChildren:function(){return this._children.size()>0},isEmpty:function(){return this._children.isEmpty()},isRelatedTo:function(t){return!!t&&(this.isDescendantOf(t)||t.isDescendantOf(this))},isParentOf:function(t){return!(!t||!this._childMap)&&!!this._childMap[t._id]},isDescendantOf:function(t){if(!t||t.isEmpty())return!1;for(var e=this._parent;e;){if(t===e)return!0;e=e._parent}return!1},getStyle:function(t,e){e===i&&(e=1);var n=this._styleMap?this._styleMap[t]:i;return n===i&&e?d[t]:n},setStyle:function(t,e){var n=this;n._styleMap||(n._styleMap={});var r=n._styleMap[t];e===i?delete n._styleMap[t]:n._styleMap[t]=e,n.fp("s:"+t,r,e)&&n.onStyleChanged(t,r,e)},onStyleChanged:function(){},iv:function(t){this.invalidate(t)},invalidate:function(t){this.fp(t||"*",!1,!0)},toString:function(){var t=this;return t._displayName||t._name||t._tag||t._id},toLabel:function(){return this._displayName||this._name},addStyleIcon:function(t,e){var i=this,n=i.s($t);i.beginTransaction(),n||i.s($t,n={}),e?n[t]=e:delete n[t],i.fp($t,l,n),i.endTransaction()},removeStyleIcon:function(t){var e=this.s($t);if(e){var i=e[t];delete e[t],this.fp($t,l,e)}return i},_calcAnchorMatrix3d:function(){},appendAnchorMatrix3d:function(t){var e=this;if(e.hasOwnProperty("_anchor")||e.hasOwnProperty("_anchorElevation")){var i=e.getAnchor3d(),n={x:i.x-.5,y:i.y-.5,z:i.z-.5};cf(t,[-n.x,-n.y,-n.z])}},getSerializableProperties:function(){return{name:1,displayName:1,icon:1,toolTip:1,parent:1,layer:1,tag:1,adjustChildrenToTop:1,dataBindings:1}},getSerializableStyles:function(){var t,e={};for(t in this._styleMap)e[t]=1;return e},getCurrentPrefix:function(){return this._interactPrefix||ec},ca:function(t,e){var i=this.getCurrentPrefix();return t=i+t,2===arguments.length?this.a(t,e):this.a(t)}});var yc=c.DataModel=function(){var e=this;e._isDeserializing=0,e._datas=new gc,e._dataMap={},e._roots=new gc,e._rootMap={},e._fsDataMap={},e._78O={},e._reflectorMap={},e._36I=new vc,e._35I=new vc,e._serializeNotifier=new vc,e._selectionModel=new mc(e);var i=e._29Q=[],n=e._scheduleCallback=function(){for(var r=Date.now(),o=0;o<i.length;o++){var a=i[o];a.enabled&&r-a.lastTime>a.interval&&(a.beforeAction&&a.beforeAction(),a.action&&e.each((function(t){a.action(t)})),a.afterAction&&a.afterAction(),a.lastTime=r)}i.length&&(e._30Q=t.requestAnimationFrame(n))}};xl("DataModel",e,{ms_fire:1,ms_attr:1,ms_ac:["layers","name","autoAdjustIndex","hierarchicalRendering","background","envmap","postProcessingData","init"],_name:i,_autoAdjustIndex:!0,_hierarchicalRendering:!1,_background:i,_init:i,_envmap:i,_postProcessingData:i,sm:function(){return this.getSelectionModel()},mm:function(t,e,i){this.addDataModelChangeListener(t,e,i)},umm:function(t,e){this.removeDataModelChangeListener(t,e)},md:function(t,e,i){this.addDataPropertyChangeListener(t,e,i)},umd:function(t,e){this.removeDataPropertyChangeListener(t,e)},mh:function(t,e,i){this.addHierarchyChangeListener(t,e,i)},umh:function(t,e){this.removeHierarchyChangeListener(t,e)},getAttrObject:function(){return this._attrObject},setAttrObject:function(t){return this._attrObject=t},getSelectionModel:function(){return this._selectionModel},size:function(){return this._datas.size()},isEmpty:function(){return this._datas.isEmpty()},getRoots:function(){return this._roots},getDatas:function(){return this._datas},getFullscreenDatas:function(){return this._fsDataMap},getReflectors:function(){return this._reflectorMap},getDataById:function(t){return this._dataMap[t]},removeDataById:function(t){this.remove(this.getDataById(t))},toDatas:function(t,e){return this._datas.toList(t,e)},each:function(t,e){this._datas.each(t,e)},getDataByTag:function(t){return this._78O[t]},getTagMap:function(){return this._78O},removeDataByTag:function(t){this.remove(this.getDataByTag(t))},add:function(t,e,n){var r=this,o=t._id,a=t._tag,s=r._roots;if(r._dataMap[o])throw"'"+o+"' already exists";a!=l&&(r._78O[a]=t),r._dataMap[o]=t,n>=0?r._datas.add(t,n):r._datas.add(t),t._parent||(r._rootMap[o]=t,e>=0?s.add(t,e):s.add(t)),t.s("fullscreen")!==i&&(r._fsDataMap[o]=t),t.s("shape3d.reflector")&&(r._reflectorMap[o]=t),t._21I(r),r.onAdded(t),r._36I.fire({kind:"add",data:t,rootsIndex:e,datasIndex:n})},onAdded:function(){},remove:function(t,e){if(t){var i=this,n=t._id,r=e&&e.keepStructure,o=e&&e.keepChildren,a=t.getTag();if(t._dataModel===i){this.beginTransaction(),r?i._removingData||(i._removingData=t):i.prepareRemove(t),o||t.toChildren().each((function(t){i.remove(t,e)}),i),r?i._removingData===t&&(t._parent&&t._parent.removeChild(t),delete i._removingData):t._parent&&t._parent.removeChild(t);var s,c=i._datas.remove(t);delete i._dataMap[n],a!=l&&delete i._78O[a],i._rootMap[n]&&(delete i._rootMap[n],s=i._roots.remove(t)),i._fsDataMap[n]&&delete i._fsDataMap[n],i._reflectorMap[n]&&delete i._reflectorMap[n],t._21I(l),i.onRemoved(t),i._36I.fire({kind:At,data:t,rootsIndex:s,datasIndex:c}),this.endTransaction()}}},onRemoved:function(){},prepareRemove:function(){},clear:function(){var t=this;if(t._datas.size()){var e=t._historyManager?this.toJSON():i;t._datas.toArray().forEach((function(t){t._21I(l)})),t._datas.clear(),t._dataMap={},t._roots.clear(),t._rootMap={},t._fsDataMap={},t._reflectorMap={},t._78O={},t._36I.fire({kind:Vt,json:e})}},contains:function(t){return t&&t._dataModel===this},handleDataPropertyChange:function(t){var e=this,i=t.data,n=t.property;if("parent"===n){var r=i._id,o=e._rootMap,a=e._roots;i._parent?o[r]&&(delete o[r],a.remove(i)):o[r]||(o[r]=i,a.add(i))}else if("tag"===n){var s=t.oldValue,c=t.newValue,h=e._78O;s!=l&&delete h[s],c!=l&&(h[c]=i)}else if("s:fullscreen"===n){r=i._id;var u=e._fsDataMap;t.oldValue!=l&&delete u[r],t.newValue!=l&&(u[r]=i)}else if("s:shape3d.reflector"===n){r=i._id;var d=e._reflectorMap;t.oldValue&&delete d[r],t.newValue&&(d[r]=i)}this.onDataPropertyChanged(i,t),this._35I.fire(t)},onDataPropertyChanged:function(){},addDataModelChangeListener:function(t,e,i){this._36I.add(t,e,i)},removeDataModelChangeListener:function(t,e){this._36I.remove(t,e)},addSerializeListener:function(t,e,i){this._serializeNotifier.add(t,e,i)},removeSerializeListener:function(t,e){this._serializeNotifier.remove(t,e)},fireSerializeEvent:function(t){this._serializeNotifier.fire(t)},addDataPropertyChangeListener:function(t,e,i){this._35I.add(t,e,i)},removeDataPropertyChangeListener:function(t,e){this._35I.remove(t,e)},_38I:function(t,e,i){this._37I&&this._37I.fire({data:t,oldIndex:e,newIndex:i})},addHierarchyChangeListener:function(t,e,i){this._37I||(this._37I=new vc),this._37I.add(t,e,i)},removeHierarchyChangeListener:function(t,e){this._37I.remove(t,e)},getSiblings:function(t){var e=t._parent;return e?e._children:this._roots},eachByHierarchical:function(t,e,i){if(e)return this._eachByHierarchical(t,e,i);for(var n=0,r=this._roots,o=r.size();o>n;n++)if(!1===this._eachByHierarchical(t,r.get(n),i))return!1;return!0},_eachByHierarchical:function(t,e,i){if(i){if(!1===t.call(i,e))return!1}else if(!1===t(e))return!1;for(var n=e.size(),r=0;n>r;r++)if(!1===this._eachByHierarchical(t,e.getChildAt(r),i))return!1;return!0},reverseEachByHierarchical:function(t,e,i){if(e)return this._reverseEachByHierarchical(t,e,i);for(var n=this._roots,r=n.size(),o=r-1;o>=0;o--)if(!1===this._reverseEachByHierarchical(t,n.get(o),i))return!1;return!0},_reverseEachByHierarchical:function(t,e,i){for(var n=e.size(),r=n-1;r>=0;r--)if(!1===this._reverseEachByHierarchical(t,e.getChildAt(r),i))return!1;if(i){if(!1===t.call(i,e))return!1}else if(!1===t(e))return!1;return!0},eachByDepthFirst:function(t,e,i){if(e)return this._11I(t,e,i);for(var n=0,r=this._roots,o=r.size();o>n;n++)if(!1===this._11I(t,r.get(n),i))return!1;return!0},_11I:function(t,e,i){for(var n=e.size(),r=0;n>r;r++)if(!1===this._11I(t,e.getChildAt(r),i))return!1;if(i){if(!1===t.call(i,e))return!1}else if(!1===t(e))return!1;return!0},eachByBreadthFirst:function(t,e,i){var n=new gc;for(e?n.add(e):this._roots.each(n.add,n);n.size()>0;)if(e=n.removeAt(0),e.eachChild(n.add,n),i){if(!1===t.call(i,e))return!1}else if(!1===t(e))return!1;return!0},moveTo:function(t,e){var i=this.getSiblings(t),n=i.indexOf(t);n===e||0>n||e>=0&&e<=i.size()&&(i.remove(t),e>i.size()&&e--,i.add(t,e),this._38I(t,n,e))},moveUp:function(t){this.moveTo(t,this.getSiblings(t).indexOf(t)-1)},moveDown:function(t){this.moveTo(t,this.getSiblings(t).indexOf(t)+1)},moveToTop:function(t){this.moveTo(t,0)},moveToBottom:function(t){this.moveTo(t,this.getSiblings(t).size())},moveSelectionUp:function(t){this.beginTransaction(),t||(t=this.sm());var e=new gc;ea(t,e,this._roots),e.each(this.moveUp,this),this.endTransaction()},moveSelectionDown:function(t){this.beginTransaction(),t||(t=this.sm());var e=new gc;ia(t,e,this._roots),e.each(this.moveDown,this),this.endTransaction()},moveSelectionToTop:function(t){this.beginTransaction(),t||(t=this.sm());var e=new gc;ta(t,e,this._roots),e.each(this.moveToTop,this),this.endTransaction()},moveSelectionToBottom:function(t){this.beginTransaction(),t||(t=this.sm());var e=new gc;$o(t,e,this._roots),e.each(this.moveToBottom,this),this.endTransaction()},moveToIndex:function(t,e,i){var n=this.getDatas();null==i&&(i=n.indexOf(t)),i===e||0>i||e>=0&&e<=n.size()&&(n.remove(t),e>n.size()&&e--,n.add(t,e),this._76I(t,i,e))},bringForward:function(t){this.moveToIndex(t,this.getDatas().indexOf(t)+1)},bringToFront:function(t){this.moveToIndex(t,this.size())},sendBackward:function(t){this.moveToIndex(t,this.getDatas().indexOf(t)-1)},sendToBack:function(t){this.moveToIndex(t,0)},bringSelectionForward:function(t){this.beginTransaction(),t||(t=this.sm());for(var e=new gc,i=this.getDatas(),n=!1,r=0;r<i.size();r++){var o=i.get(i.size()-1-r);t.contains(o)?n&&e.add(o):n=!0}e.each(this.bringForward,this),this.endTransaction()},bringSelectionToFront:function(t){this.beginTransaction(),t||(t=this.sm());for(var e=new gc,i=this.getDatas(),n=0;n<i.size();n++){var r=i.get(n);t.contains(r)&&e.add(r)}e.each(this.bringToFront,this),this.endTransaction()},sendSelectionBackward:function(t){this.beginTransaction(),t||(t=this.sm());for(var e=new gc,i=this.getDatas(),n=!1,r=0;r<i.size();r++){var o=i.get(r);t.contains(o)?n&&e.add(o):n=!0}e.each(this.sendBackward,this),this.endTransaction()},sendSelectionToBack:function(t){this.beginTransaction(),t||(t=this.sm());for(var e=new gc,i=this.getDatas(),n=0;n<i.size();n++){var r=i.get(i.size()-1-n);t.contains(r)&&e.add(r)}e.each(this.sendToBack,this),this.endTransaction()},addScheduleTask:function(e){var i=this;i.removeScheduleTask(e),e.enabled==l&&(e.enabled=!0),e.interval==l&&(e.interval=10),e.lastTime=Date.now(),i._29Q.push(e),i._30Q==l&&(i._30Q=t.requestAnimationFrame(i._scheduleCallback))},removeScheduleTask:function(e){var i=this,n=i._29Q,r=n.indexOf(e);r>=0&&n.splice(r,1),n.length||i._30Q==l||(t.cancelAnimationFrame(i._30Q),delete i._30Q)},getHistoryManager:function(){return this._historyManager},enableHistoryManager:function(t){this._historyManager||new c.HistoryManager(this),null!=t&&this._historyManager.setMaxHistoryCount(t),this._historyManager.setDisabled(!1)},disableHistoryManager:function(){this._historyManager&&this._historyManager.setDisabled(!0)},clearHistoryManager:function(){this._historyManager&&this._historyManager.clear()},undo:function(t){this._historyManager&&this._historyManager.undo(t)},redo:function(t){this._historyManager&&this._historyManager.redo(t)},beginTransaction:function(){this._historyManager&&this._historyManager.beginTransaction()},endTransaction:function(){this._historyManager&&this._historyManager.endTransaction()},addHistory:function(t){this._historyManager&&this._historyManager.addHistory(t)},onHistoryManagerChanged:function(){},isDeserializing:function(){return this._isDeserializing>0},setDeserializing:function(t){t?this._isDeserializing++:this._isDeserializing--}});var mc=c.SelectionModel=function(t){var e=this;e._68O=ut,e._map={},e._73O=new gc,e._74I=new vc,e._21I(t)};xl("SelectionModel",e,{ms_fire:1,ms_dm:1,ms:function(t,e,i){this.addSelectionChangeListener(t,e,i)},ums:function(t,e){this.removeSelectionChangeListener(t,e)},fd:function(){return this.getFirstData()},ld:function(){return this.getLastData()},sg:function(){return this._68O===ht},co:function(t){return this._map[t._id]!=l},ss:function(t){this.setSelection(t)},as:function(t){this.appendSelection(t)},rs:function(t){this.removeSelection(t)},cs:function(){this.clearSelection()},sa:function(){this.selectAll()},getSelectionMode:function(){return this._68O},setSelectionMode:function(t){var e=this;if(e._68O!==t&&(t===St||t===ht||t===ut)){e.cs();var i=e._68O;e._68O=t,e.fp("selectionMode",i,t)}},_21I:function(t){var e=this,i=e._dataModel;i!==t&&(i&&(e.cs(),i.umm(e.handleDataModelChange,e)),e._dataModel=t,t.mm(e.handleDataModelChange,e,!0),e.fp(Ge,i,t))},dispose:function(){var t=this;t.cs(),t._dataModel.umm(t.handleDataModelChange,t)},handleDataModelChange:function(t){var e=this;if(t.kind===At){var i=t.data;e.co(i)&&(e._73O.remove(i),delete e._map[i._id],e._75I(At,new gc(i)))}else t.kind===Vt&&e.cs()},getFilterFunc:function(){return this._filterFunc},setFilterFunc:function(t){var e=this;if(e._filterFunc!==t){e.cs();var i=e._filterFunc;e._filterFunc=t,e.fp("filterFunc",i,e._filterFunc)}},_75I:function(t,e,i,n){i&&(this._73O.each((function(t){n[t._id]?i.remove(t):i.add(t)})),e=i.toList()),this._74I.fire({kind:t,datas:new gc(e)})},addSelectionChangeListener:function(t,e,i){this._74I.add(t,e,i)},removeSelectionChangeListener:function(t,e){this._74I.remove(t,e)},_97O:function(t,e){for(var i,n=this,r=0,o=new gc(t);r<o.size();r++)i=o.get(r),(n._filterFunc&&!n._filterFunc(i)||e&&n.co(i)||!e&&!n.co(i)||!n._dataModel.contains(i))&&(o.removeAt(r),r--);return o},appendSelection:function(t){var e=this;if(e._68O!==St){var i,n,r=e._73O,o=e._97O(t,!0);o.isEmpty()||(e.sg()&&(i=new gc(r),n=e._map,r.clear(),e._map={},o=new gc(o.get(o.size()-1))),o.each((function(t){r.add(t),e._map[t._id]=t})),e._75I("append",o,i,n))}},removeSelection:function(t){var e=this,i=e._97O(t),n=0,r=i.size();if(0!==r){for(;r>n;n++){var o=i.get(n);e._73O.remove(o),delete e._map[o._id]}e._75I(At,i)}},toSelection:function(t,e){return this._73O.toList(t,e)},getSelection:function(){return this._73O},each:function(t,e){this._73O.each(t,e)},setSelection:function(t){var e=this,i=e._73O;if(e._68O!==St&&!(i.isEmpty()&&!t||1===i.size()&&e.ld()===t)){var n=new gc(i),r=e._map;i.clear(),e._map={};var o=e._97O(t,!0);e.sg()&&o.size()>1&&(o=new gc(o.get(o.size()-1))),o.each((function(t){i.add(t),e._map[t._id]=t})),e._75I("set",l,n,r)}},clearSelection:function(){var t=this,e=t._73O;if(e.size()>0){var i=e.toList();e.clear(),t._map={},t._75I(Vt,i)}},selectAll:function(){var t=this;if(t._68O!==St){var e,i,n=t._dataModel.toDatas();if(t._filterFunc)for(e=0;e<n.size();e++)i=n.get(e),t._filterFunc(i)||(n.removeAt(e),e--);var r=t._73O,o=new gc(r),a=t._map;r.clear(),t._map={},t.sg()&&n.size()>1&&(n=new gc(n.get(n.size()-1)));var s=n.size();for(e=0;s>e;e++)i=n.get(e),r.add(i),t._map[i._id]=i;t._75I("all",l,o,a)}},size:function(){return this._73O.size()},isEmpty:function(){return this._73O.isEmpty()},contains:function(t){return this._map[t._id]!=l},getLastData:function(){var t=this._73O;return t.size()>0?t.get(t.size()-1):l},getFirstData:function(){var t=this._73O;return t.size()>0?t.get(0):l},isSelectable:function(t){var e=this;return!(!t||e._68O===St)&&(!e._filterFunc||e._filterFunc(t))},getTopSelection:function(){var t=this,e=new gc;return t._73O.each((function(i){for(var n=i.getParent();n;){if(t.contains(n)){i=l;break}n=n.parent}i&&e.add(i)})),e}});var bc=function(){return En(0),function(t,e){var i;if(Gn(e)){var n=t.getDataUI(e);n&&n._88I&&(i=n._88I.rect)}return i||e.getRect()}}();Qn(u,{edgeGroupAgentFunc:l,graphViewAutoScrollZone:16,graphViewZoomable:!0,graphViewResettable:!1,graphViewPannable:!0,graphViewRectSelectable:!0,graphViewScrollBarVisible:!0,graphViewRectSelectBorderColor:g.rectSelectBorder,graphViewRectSelectBackground:ua,graphViewEditPointSize:lt?17:7,graphViewEditPointBorderColor:g.editPointBorder,graphViewEditPointBackground:g.editPointBackground,setEdgeType:function(t,e,i){Ki[t]=e,tn[t]=i},getEdgeType:function(t){return Ki[t]},getEdgeTypeMap:function(){return Ki},getNodeRect:bc},!0),Qn(d,{"layout.h":i,"layout.v":i,"2d.selectable":!0,"2d.visible":!0,"2d.movable":!0,"2d.editable":!0,"2d.move.mode":i,"2d.attachable":!1,"2d.hostable":!1,interactive:!1,preventDefaultWhenInteractive:!0,"image.stretch":"fill",icons:i,ingroup:!0,"body.color":i,"2d.gray":!1,fullscreen:i,"fullscreen.gap":2,"fullscreen.lock":!1,opacity:i,pixelPerfect:!0,keepAspectRatio:!1,"attach.points":null,"attach.style":null,"attach.close.threshold":16,"clip.direction":"top","clip.percentage":1,"select.color":Sa,"select.width":1,"select.padding":2,"select.type":Pt,shadow:!1,"shadow.blur":6,"shadow.offset.x":3,"shadow.offset.y":3,shadow2:!1,"shadow2.color":Sa,"shadow2.blur":6,"shadow2.offset.x":3,"shadow2.offset.y":3,"border.color":i,"border.width":2,"border.padding":2,"border.type":Pt,label:i,"label.font":i,"label.color":fs,"label.background":i,"label.position":31,"label.position.fixed":!1,"label.offset.x":0,"label.offset.y":2,"label.rotation":i,"label.max":i,"label.opacity":i,"label.scale":1,"label.align":i,"label.selectable":!0,label2:i,"label2.font":i,"label2.color":fs,"label2.background":i,"label2.position":34,"label2.position.fixed":!1,"label2.offset.x":0,"label2.offset.y":-2,"label2.rotation":i,"label2.max":i,"label2.opacity":i,"label2.scale":1,"label2.align":i,"label2.selectable":!0,note:i,"note.expanded":!0,"note.font":i,"note.color":gs,"note.background":Sa,"note.position":8,"note.offset.x":-3,"note.offset.y":3,"note.max":i,"note.toggleable":!0,"note.border.width":1,"note.border.color":i,"note.opacity":i,"note.scale":1,"note.align":i,note2:i,"note2.expanded":!0,"note2.font":i,"note2.color":gs,"note2.background":Sa,"note2.position":3,"note2.offset.x":3,"note2.offset.y":-3,"note2.max":i,"note2.toggleable":!0,"note2.border.width":1,"note2.border.color":i,"note2.opacity":i,"note2.scale":1,"note2.align":i,"group.type":i,"group.image":i,"group.image.stretch":"fill","group.repeat.image":i,"group.padding":8,"group.padding.left":0,"group.padding.right":0,"group.padding.top":0,"group.padding.bottom":0,"group.position":17,"group.toggleable":!0,"group.title.font":i,"group.title.color":gs,"group.title.background":g.groupTitleBackground,"group.title.align":gt,"group.title.orientation":vt,"group.background":g.groupBackground,"group.depth":1,"group.border.width":1,"group.border.pattern":i,"group.border.color":wa,"group.border.radius":i,"group.border.cap":us,"group.border.join":ds,"group.border.width.absolute":!1,"group.splitLine":!1,"group.gradient":l,"group.gradient.color":"#FFF",shape:i,"shape.background":wa,"shape.repeat.image":i,"shape.border.width":0,"shape.border.width.absolute":!1,"shape.border.color":wa,"shape.border.3d":!1,"shape.border.3d.color":i,"shape.border.3d.accuracy":i,"shape.border.cap":us,"shape.border.join":ds,"shape.border.pattern":i,"shape.gradient":l,"shape.gradient.color":"#FFF","shape.depth":0,"shape.dash":!1,"shape.dash.pattern":hs,"shape.dash.offset":0,"shape.dash.color":da,"shape.dash.width":i,"shape.dash.3d":!1,"shape.dash.3d.color":i,"shape.dash.3d.accuracy":i,"shape.polygon.side":6,"shape.arc.from":L,"shape.arc.to":F,"shape.arc.close":!0,"shape.arc.oval":!1,"shape.corner.radius":i,"shape.gradient.pack":i,"shape.fill.rule":"nonzero","shape.fill.clip.direction":"top","shape.fill.clip.percentage":1,"shape.foreground":i,"shape.foreground.gradient":l,"shape.foreground.gradient.color":"#FFF","shape.foreground.clip.direction":"top","shape.foreground.clip.percentage":1,"autolayout.gap":i,"autolayout.hgap":i,"autolayout.vgap":i,"edge.type":i,"edge.points":i,"edge.segments":i,"edge.color":wa,"edge.width":2,"edge.width.absolute":!1,"edge.offset":0,"edge.group":0,"edge.expanded":!0,"edge.gap":12,"edge.toggleable":!0,"edge.center":!1,"edge.3d":!1,"edge.3d.color":i,"edge.3d.accuracy":i,"edge.cap":us,"edge.join":ds,"edge.source.position":17,"edge.source.anchor.x":i,"edge.source.anchor.y":i,"edge.source.offset.x":0,"edge.source.offset.y":0,"edge.source.index":-1,"edge.source.percent":0,"edge.target.position":17,"edge.target.anchor.x":i,"edge.target.anchor.y":i,"edge.target.offset.x":0,"edge.target.offset.y":0,"edge.target.index":-1,"edge.target.percent":0,"edge.pattern":i,"edge.dash":!1,"edge.dash.pattern":hs,"edge.dash.offset":0,"edge.dash.color":da,"edge.dash.width":i,"edge.dash.3d":!1,"edge.dash.3d.color":i,"edge.dash.3d.accuracy":i,"edge.independent":!1,"attach.row.index":0,"attach.column.index":0,"attach.row.span":1,"attach.column.span":1,"attach.padding":0,"attach.padding.left":0,"attach.padding.right":0,"attach.padding.top":0,"attach.padding.bottom":0,"attach.index":-1,"attach.offset":0,"attach.offset.relative":!1,"attach.offset.opposite":!1,"attach.thickness":i,"attach.gap":0,"attach.gap.relative":!1,"grid.row.count":1,"grid.column.count":1,"grid.row.percents":i,"grid.column.percents":i,"grid.border":1,"grid.border.left":0,"grid.border.right":0,"grid.border.top":0,"grid.border.bottom":0,"grid.gap":1,"grid.background":g.gridBackground,"grid.depth":1,"grid.cell.depth":-1,"grid.cell.border.color":g.gridCellBorderColor,"grid.block":i,"grid.block.padding":3,"grid.block.width":1,"grid.block.color":g.gridBlockColor,text:"","text.align":"left","text.vAlign":"middle","text.color":fs,"text.font":ps,"text.shadow":!1,"text.shadow.color":Sa,"text.shadow.blur":6,"text.shadow.offset.x":3,"text.shadow.offset.y":3,"text.scale.x":1,"text.scale.y":1},!0),Qn(yc,{_76I:function(t,e,i){this._39I&&this._39I.fire({data:t,oldIndex:e,newIndex:i})},addIndexChangeListener:function(t,e,i){var n=this;n._39I||(n._39I=new vc),n._39I.add(t,e,i)},removeIndexChangeListener:function(t,e){this._39I.remove(t,e)},prepareRemove:function(t){jn(t)&&(t.setSource(l),t.setTarget(l)),t._70O&&t._70O.toList().each(this.remove,this),t._69O&&t._69O.toList().each((function(t){t.setHost(l)})),t._host&&t.setHost(l)},onAdded:function(t){this.isAutoAdjustIndex()&&this.adjustIndex(t)},onDataPropertyChanged:function(t,e){Sc[e.property]&&this.isAutoAdjustIndex()&&this.adjustIndex(t)},isAdjustable:function(t){return Fn(t)||jn(t)},isAdjustedToBottom:function(t){return!!Hn(t)&&(t.isExpanded()&&kc(t))},adjustIndex:function(t){var e=this;this.isHierarchicalRendering()||(e.isAdjustedToBottom(t)?(e.sendToBottom(t),t.eachChild(e.adjustIndex,e)):e.sendToTop(t))},sendToTop:function(t){var e=this;if(e.contains(t)&&e.isAdjustable(t)){var i=e._datas;if(t!==i.get(e.size()-1)){var n=i.indexOf(t);i.removeAt(n),i.add(t),e._76I(t,n,e.size()-1)}if(jn(t)){var r=t._40I;r&&!e.isAdjustedToBottom(r)&&e.sendToTop(r),r=t._41I,r&&!e.isAdjustedToBottom(r)&&e.sendToTop(r)}t._69O&&t._69O.each((function(i){i.isRelatedTo(t)||Fn(t)&&i.isLoopedHostOn(t)||e.sendToTop(i)})),t.ISubGraph||(!Hn(t)||t.isExpanded())&&t._adjustChildrenToTop&&t.eachChild((function(t){jn(t)||e.sendToTop(t)}))}},sendToBottom:function(t,e){var i=this;if(t!==e&&i.contains(t)&&i.isAdjustable(t)&&(!e||i.contains(e))){var n=i._datas,r=n.remove(t),o=e?i._datas.indexOf(e):0;if(n.add(t,o),r!==o){i._76I(t,r,o);var a=t._parent;!a||a.ISubGraph||jn(a)||i.sendToBottom(t._parent,t)}}}}),Qn(es,{ms_edit:function(t){t._46O=function(t){var e=this,i=e.gv.dm(),n=e._index,r=e._89I,o=e._node,a=e._shape,s=e._edge,l=e._77I;o&&r?(this.fi({kind:"endEditRect",event:t,data:o,direction:r}),i.endTransaction()):a&&n>=0?(e.fi({kind:"endEditPoint",event:t,data:a,index:n}),i.endTransaction()):s&&n>=0?(e.fi({kind:"endEditPoint",event:t,data:s,index:n}),i.endTransaction()):l&&(e.fi({kind:"endEditRotation",event:t,data:l}),i.endTransaction())},t._78I=function(t){var e=this;e.autoScroll(t);var i=e.gv.lp(t),n=e._index,r=e._89I,o=e._node,a=e._shape,s=e._edge,c=e._77I;if(o&&r)e._80O(i),e.fi({kind:"betweenEditRect",event:t,data:o,direction:r});else if(a&&n>=0)i.e=a.getPoints().get(n).e,a.setPoint(n,i),e.fi({kind:"betweenEditPoint",event:t,data:a,index:n});else if(s&&n>=0){var h=s.s(ae);i.e=h.get(n).e,h.set(n,i),s.fp(ae,l,h),e.fi({kind:"betweenEditPoint",event:t,data:s,index:n})}else if(c){var u=c.p(),d=c.getScale(),f=j+G(i.y-u.y,i.x-u.x);d.y<0&&(f+=L),O(f)<.04&&(f=0),c.setRotation(f),e.fi({kind:"betweenEditRotation",event:t,data:c})}},t._80O=function(t){var e=this,i=e._node,n=e._rect,r=n.x,o=n.y,a=n.width,s=n.height,l=e._89I,c=e._anchor,h=e._matrix;t=h.tfi(t);"northwest"===l?n=rl(t,{x:r+a,y:o+s}):l===Ct?n=rl({x:r,y:t.y},{x:r+a,y:o+s}):"northeast"===l?n=rl({x:r,y:t.y},{x:t.x,y:o+s}):l===wt?n=rl({x:t.x,y:o},{x:r+a,y:o+s}):l===xt?n=rl({x:r,y:o},{x:t.x,y:o+s}):"southwest"===l?n=rl({x:t.x,y:o},{x:r+a,y:t.y}):"south"===l?n=rl({x:r,y:o},{x:r+a,y:t.y}):"southeast"===l&&(n=rl({x:r,y:o},t)),i.setPosition(h.tf(n.x+n.width*c.x,n.y+n.height*c.y)),i.setWidth(n.width),i.setHeight(n.height)},t._80I=function(t,e,i,n){var r=this,o=r.gv._zoom,a=(r.gv.getEditPointSize()+2)/o;return!!al({x:e-a/2,y:i-a/2,width:a,height:a},t)&&(r._89I!==n&&(r._89I=n),!0)},t._79I=function(t,e,i){var n=this,r=n.gv,o=e?r.getDataUI(e):l,a=o?o._55O:l;if(a){var s,c,h=r._zoom,u=(r.getEditPointSize()+2)/h,d=r.lp(t);if(Fn(e)){if(a._56O&&Fn(e)&&(s=a._98o,al({x:s.x-u/2,y:s.y-u/2,width:u,height:u},d)))return n._77I=e,i&&n.fi({kind:"beginEditRotation",event:t,data:e}),n.setCursor("crosshair"),!0;if(a._43O&&e instanceof pu)for(c=e.getPoints(),p=c.size()-1;p>=0;p--)if(s=c.get(p),al({x:s.x-u/2,y:s.y-u/2,width:u,height:u},d))return n._index=p,n._shape=e,i&&n.fi({kind:"beginEditPoint",event:t,data:e,index:p}),n.setCursor("crosshair"),!0;if(a._42O)for(var f=e.getEditControlPoints(),g=["northwest",-1,-1,wt,-1,0,"southwest",-1,1,"south",0,1,"southeast",1,1,xt,1,0,"northeast",1,-1,Ct,0,-1],p=0,v=f.length;v>p;p++){var _=g[3*p],y=f[p];if(n._80I(d,y.x,y.y,_)){n._node=e;var m=e.getWidth(),b=e.getHeight(),x=e.getAnchor();n._rect={x:-m*x.x,y:-b*x.y,width:m,height:b},n._anchor=x,n._matrix=e.getMatrix();var w=e.getRotation(),C=R(w),S=k(w),I=g[3*p+1]*nr(e.getScale().x),M=g[3*p+2]*nr(e.getScale().y),T=Math.atan2(-S*I-C*M,C*I-S*M),E=(Math.round(T/(Math.PI/4))+8)%8,P=[di,"nesw-resize",fi,"nwse-resize",di,"nesw-resize",fi,"nwse-resize"][E];return n.setCursor(P),i&&n.fi({kind:"beginEditRect",event:t,data:e,direction:n._89I}),!0}}}if(a._43O&&jn(e)&&e.s(se)===Nt&&(c=e.s(ae)))for(p=c.size()-1;p>=0;p--)if(s=c.get(p),al({x:s.x-u/2,y:s.y-u/2,width:u,height:u},d))return n._index=p,n._edge=e,i&&n.fi({kind:"beginEditPoint",event:t,data:e,index:p}),n.setCursor("crosshair"),!0}return!1}},ms_gv:function(t){t._currentSubGraph=l,t._initView=function(){this._fpsInfo={time:0,fps:0,frames:0}},t.upSubGraph=function(){this.setCurrentSubGraph(Rc(this._currentSubGraph))},t.isVisible=function(t){var e=this;if(Rc(t)!==e._currentSubGraph)return!1;if(jn(t)){var i=t._40I,n=t._41I;if(!i||!n)return!1;if(!(t.s("edge.independent")||e.isVisible(i)&&e.isVisible(n)))return!1;if(t.isEdgeGroupHidden())return!1}else for(var r=t._parent;r&&!r.ISubGraph;){if(Hn(r)&&(!r.isExpanded()||!e.isVisible(r)))return!1;r=r._parent}if(t._parent instanceof du&&!e.isVisible(t._parent))return!1;if(t._refGraph instanceof yu&&!e.isVisible(t._refGraph))return!1;if(e instanceof Qp){if(!t.s("3d.visible"))return!1}else{var o=e.getLayersInfo();if(o){var a=o[t._layer];if(a&&!1===a.visible)return!1}if(!t.s("2d.visible"))return!1}return!e._visibleFunc||e._visibleFunc(t)},t.handleSelectionChange=function(t){var e=this;t.datas.each((function(t){e.invalidateData(t);var i=t._parent;Hn(i)&&Fn(t)&&t.s(Ft)&&(e.invalidateData(i),i._49I&&i._49I.each((function(t){e.invalidateData(t)})))})),e.onSelectionChanged(t)},t.onSelectionChanged=function(t){var e=this,i=e.sm();if(1===i.size()&&("set"===t.kind||"append"===t.kind)){var n=i.ld();e.isAutoMakeVisible()&&e.makeVisible(n),e.adjustIndex&&e._dataModel.isAutoAdjustIndex()&&e.adjustIndex(n)}},t.makeVisible=function(t){if(t){var e=this,i=e.getDataUI?e.getDataUI(t):e.getData3dUI(t);if(i){var n=t,r=Rc(t);for(r!==e._currentSubGraph&&e.setCurrentSubGraph(r);(n=n._parent)&&n!==r;)Hn(n)&&n.setExpanded(!0);e._23I=t,e.iv()}}},t.getLabel=function(t){var e=t.getStyle(Yt);return e===i?t.getName():e},t.getLabelBackground=function(t){return t.getStyle("label.background")},t.getLabelColor=function(t){return t.getStyle("label.color")},t.getLabel2=function(t){return t.getStyle("label2")},t.getLabel2Background=function(t){return t.getStyle("label2.background")},t.getLabel2Color=function(t){return t.getStyle("label2.color")},t.getNote=function(t){return t.getStyle(Jt)},t.getNoteBackground=function(t){return t.getStyle("note.background")},t.getNote2=function(t){return t.getStyle(Kt)},t.getNote2Background=function(t){return t.getStyle("note2.background")},t.handleClick=function(t,e,i){var n=this;e?(n.fi({kind:"clickData",event:t,data:e,part:i}),n.onDataClicked(e,t)):(n.fi({kind:"clickBackground",event:t}),n.onBackgroundClicked(t))},t.handleDoubleClick=function(t,e,i){var n=this;Qs(t)&&(e?(n.fi({kind:"doubleClickData",event:t,data:e,part:i}),n.onDataDoubleClicked(e,t,i),n.checkDoubleClickOnNote(t,e,i)||n.checkDoubleClickOnRotation&&n.checkDoubleClickOnRotation(t,e,i)||(jn(e)?n.onEdgeDoubleClicked(e,t,i):e.ISubGraph?n.onSubGraphDoubleClicked(e,t,i):Hn(e)?n.onGroupDoubleClicked(e,t,i):e.IDoorWindow?n.onDoorWindowDoubleClicked(e,t,i):e.ICSGBox&&n.onCSGBoxDoubleClicked(e,t,i))):(n.fi({kind:"doubleClickBackground",event:t}),n.onBackgroundDoubleClicked(t)))},t.onSubGraphDoubleClicked=function(t){this.setCurrentSubGraph(t)},t.onEdgeDoubleClicked=function(t,e){this.isEditable(t)||(t.ISubGraph&&!tl(e)?this.setCurrentSubGraph(t):t.s("edge.toggleable")&&t.toggle())},t._39Q=function(t){return!!this.isInteractive(t)&&this.preventDefaultWhenInteractive(t)},t.preventDefaultWhenInteractive=function(t){return t.s("preventDefaultWhenInteractive")},t.onGroupDoubleClicked=function(t){t.s("group.toggleable")&&t.toggle()},t.onDoorWindowDoubleClicked=function(t){t.s("dw.toggleable")&&t.toggle(!0)},t.onCSGBoxDoubleClicked=function(t,e){var i=this;if(i instanceof Qp){var n=i.getHitFaceInfo(e);n&&n.face&&t.s(n.face+".toggleable")&&t.toggleFace(n.face,!0)}},t.onBackgroundClicked=function(){},t.onBackgroundDoubleClicked=function(){this.upSubGraph()},t.onDataClicked=function(){},t.onDataDoubleClicked=function(){},t.onAutoLayoutEnded=function(){},t.onMoveEnded=function(){},t.onPanEnded=function(){},t.onPinchEnded=function(){},t.onRectSelectEnded=function(){},t.onZoomEnded=function(){},t.serialize=function(t){return this.dm().serialize(t)},t.toJSON=function(){return this.dm().toJSON()},t.deserialize=function(t,e){var i=this;e=e instanceof _c?{rootParent:e}:zn(e)?{setId:e}:An(e)?{finishFunc:e}:e||{},e.view=i;var n=i.dm();return e.__innerHandler__=function(t){if(zn(n.a("toolTipEnable"))&&(n.a("toolTipEnable")?i.enableToolTip():i.disableToolTip()),i instanceof c.graph.GraphView&&(zn(n.a("zoomable"))&&i.setZoomable&&i.setZoomable(n.a("zoomable")),zn(n.a("pannable"))&&i.setPannable&&i.setPannable(n.a("pannable")),zn(n.a("rectSelectable"))&&i.setRectSelectable&&i.setRectSelectable(n.a("rectSelectable")),!0===n.a("fitContent")&&i.fitContent&&i.fitContent(!0,0)),i instanceof c.graph3d.Graph3dView){var e=t.scene;e&&(e.eye&&i.setEye(e.eye),e.center&&i.setCenter(e.center),e.batchInfoMap&&u.setBatchInfoMap(e.batchInfoMap)),Rn(n.a("sceneNear"))&&i.setNear(n.a("sceneNear")),Rn(n.a("sceneFar"))&&i.setFar(n.a("sceneFar")),zn(n.a("sceneDashEnable"))&&i.setDashDisabled(!n.a("sceneDashEnable")),On(n.a("sceneHighlightMode"))&&i.setHighlightMode(n.a("sceneHighlightMode")),Rn(n.a("sceneHighlightWidth"))&&i.setHighlightWidth(n.a("sceneHighlightWidth")),n.a("sceneHighlightColor")&&i.setHighlightColor(n.a("sceneHighlightColor")),zn(n.a("sceneHeadlightEnable"))&&i.setHeadlightDisabled(!n.a("sceneHeadlightEnable")),Rn(n.a("sceneHeadlightRange"))&&i.setHeadlightRange(n.a("sceneHeadlightRange")),n.a("sceneHeadlightColor")&&i.setHeadlightColor(n.a("sceneHeadlightColor")),Rn(n.a("sceneHeadlightIntensity"))&&i.setHeadlightIntensity(n.a("sceneHeadlightIntensity")),Rn(n.a("sceneHeadlightAmbientIntensity"))&&i.setHeadlightAmbientIntensity(n.a("sceneHeadlightAmbientIntensity")),zn(n.a("sceneFogEnable"))&&i.setFogDisabled(!n.a("sceneFogEnable")),n.a("sceneFogColor")&&i.setFogColor(n.a("sceneFogColor")),Rn(n.a("sceneFogNear"))&&i.setFogNear(n.a("sceneFogNear")),Rn(n.a("sceneFogFar"))&&i.setFogFar(n.a("sceneFogFar")),zn(n.a("sceneBatchBrightnessDisabled"))&&i.setBatchBrightnessDisabled(n.a("sceneBatchBrightnessDisabled")),zn(n.a("sceneBatchBlendDisabled"))&&i.setBatchBlendDisabled(n.a("sceneBatchBlendDisabled")),zn(n.a("sceneBatchColorDisabled"))&&i.setBatchColorDisabled(n.a("sceneBatchColorDisabled"))}},n.deserialize(t,e.rootParent,e)},t.isDebugTipShowing=function(){return!!this._debugDiv},t.showDebugTip=function(){var t=this,e=t._debugDiv;if(!e){e=t._debugDiv=s.createElement("div"),e.style.position="absolute",e.style.overflow="hidden",e.style.font=u.debugTipLabelFont,e.style.padding="6px",e.style.backgroundColor=u.debugTipBackground,e.style.color=u.debugTipLabelColor;var i=t.getView();t._79O?i.insertBefore(e,t._79O):i.appendChild(e);var n=function(){t.redraw();var i=t._canvas,r="FPS: "+t._fpsInfo.fps+"<br/>Datas: "+t.dm().getDatas().length+(i?"<br/>Size: "+i.width+" * "+i.height:""),o=t.dm()._historyManager;o&&(r+="<br/>Undoes: "+o.getHistories().length+" index: "+o.getHistoryIndex());var a=t.getDebugTip();a&&(r+="<hr>"+a),e.innerHTML=r,t._isDebugging&&requestAnimationFrame(n)};requestAnimationFrame(n),t._isDebugging=!0}},t.hideDebugTip=function(){var t=this,e=t._debugDiv;e&&(delete t._debugDiv,t.getView().removeChild(e),t._isDebugging=!1)},t.updateDOMAppendMatrix=function(){var t=this.getView();t&&(t.updateAppendMatrix=!0)},t.countFrame=function(){if(this._isDebugging){var t=Date.now(),e=this._fpsInfo;t-e.time>1e3?(e.fps=Math.round(1e5*(e.frames+1)/(t-e.time))/100,e.time=t,e.frames=0):e.frames++}}},ms_icons:function(t){t.getRotation=function(t){return t==l?0:t},t._15O=function(){var t=this,e=t.s($t);if(e){var i=t,n=t.data||t._data,r=t._38o={icons:e,rects:{}};for(var o in e){var a=e[o],s=dc(a.shape3d,n,i);if(!(!1===dc(a.visible,n,i)||dc(a.for3d,n,i)&&!t.I3d||s&&!t.I3d)){var c=s?[s]:dc(a.names,n,i),h=c?c.length:0,u=dc(a.position,n,i)||3,d=dc(a.offsetX,n,i)||0,f=dc(a.offsetY,n,i)||0,g=dc(a.direction,n,i)||xt,p=dc(a.gap,n,i),v=p!=l?p:1,_=dc(a.rotation,n,i),y=dc(a.keepOrien,n,i),m=dc(a.rotationFixed,n,i)?_:t.getRotation(_,y,u),b=l,x=r.rects[o]=new Array(h);x.rotation=m;for(var w=0;h>w;w++){var C,S,I,M,T=c[w];if(s)I=0,M=0;else{var E=zs(T);I=dc(a.width,n,i),M=dc(a.height,n,i),I==l&&(I=hc(E,n)),M==l&&(M=uc(E,n))}if(b?g===xt?d+=I/2:g===wt?d-=I/2:g===Ct?f-=M/2:f+=M/2:b={width:I,height:M},t.I3d){var P=-I/2,D=-M/2;S={width:I,height:M,mat:t._16O(dc(a.autorotate,n,i),u,b,dc(a.face,n,i)||dt,dc(a.t3,n,i),dc(a.r3,n,i),dc(a.rotationMode,n,i),d,f),vs:new Il([P,-D,0,P,-D-M,0,P+I,-D-M,0,P+I,-D,0])}}else C=t.getPosition(u,d,f,b,dc(a.positionFixed,n,i)),S={x:C.x-I/2,y:C.y-M/2,width:I,height:M},t._68o(S,m);x[w]=S,g===xt?d+=I/2+v:g===wt?d-=I/2+v:g===Ct?f-=M/2+v:f+=M/2+v}}}}}}});var xc={1:1,2:1,6:1,9:1,10:1,14:1,15:1,16:1,21:1,22:1,26:1,29:1,30:1,34:1,36:1,38:1,40:1,42:1,45:1,50:1,52:1,54:1},wc={3:1,7:1,11:1,17:1,23:1,27:1,31:1,44:1,46:1,47:1,49:1},Cc={translateX:1,translateY:1,zoom:1,scrollBarVisible:1},Sc={sourceAgent:1,targetAgent:1,expanded:1,parent:1,host:1},Ic={position:1,width:1,height:1,expanded:1,rotation:1,anchor:1,scale:1,"s:edge.points":1},Mc={"edge.type":1,"edge.group":1},Tc={rotation:1,rotationX:1,rotationZ:1},Ec={rotation:1,rotationX:1,rotationZ:1,position:1,width:1,height:1,anchor:1,scale:1},Pc={position:1,width:1,height:1,anchor:1,scale:1,"s:grid.row.count":1,"s:grid.column.count":1,"s:grid.row.percents":1,"s:grid.column.percents":1,"s:grid.border":1,"s:grid.border.left":1,"s:grid.border.right":1,"s:grid.border.top":1,"s:grid.border.bottom":1,"s:grid.gap":1},Dc={"attach.row.index":1,"attach.column.index":1,"attach.row.span":1,"attach.column.span":1,"attach.padding":1,"attach.padding.left":1,"attach.padding.right":1,"attach.padding.top":1,"attach.padding.bottom":1,"attach.index":1,"attach.offset":1,"attach.offset.relative":1,"attach.offset.opposite":1,"attach.gap":1,"attach.gap.relative":1,"attach.thickness":1},Oc={shape:1,thickness:1,position:1,anchor:1,scale:1},Rc=function(t){if(!t)return l;if(jn(t)){var e=t._40I,i=t._41I;if(!e||!i)return l;var n=Rc(e),r=Rc(i);return n===r?n:l}for(var o=t._parent;jn(o)&&!o.ISubGraph;)o=o._parent;return o?o.ISubGraph?o:Rc(o):l},zc=function(t,e,i,n){var r=e.getStyle(i)*n;r&&ul(t,r),r=e.getStyle(i+".left")*n,r&&(t.x-=r,t.width+=r),r=e.getStyle(i+".right")*n,r&&(t.width+=r),r=e.getStyle(i+".top")*n,r&&(t.y-=r,t.height+=r),r=e.getStyle(i+".bottom")*n,r&&(t.height+=r),t.width<0&&(t.width=-t.width,t.x-=t.width),t.height<0&&(t.height=-t.height,t.y-=t.height)},kc=function(t){for(var e,i=0,n=t.size();n>i;i++)if(e=t.getChildAt(i),Fn(e)&&kc(e))return!0;return t.hasAgentEdges()},Ac=function(t){if(!t)return l;for(var e=t._parent;Hn(e);){if(!Hn(e._parent))return e.isExpanded()?t:e;e.isExpanded()||(t=e),e=e._parent}return t},Vc=function(t,e){if(!t||!e)return l;var i,n,r,o=Rc(t),a=Rc(e);if(o!==a){for(;a&&o!==a;)a=Rc(a);if(o===a)return t;i=new gc,i.add(t,0);for(var s=t._parent;Fn(s)&&!e.isDescendantOf(s);)i.add(s,0),s=s._parent;for(r=i.size(),n=0;r>n;n++){var c=i.get(n);if(Hn(c)&&!c.isExpanded())return c;if(c.ISubGraph)return c}return t}return t},Bc=function(t){if(t.isLooped())return t._source;var e=Ac(t._source),i=Ac(t._target);return e===i?t._source:Vc(e,i)},Lc=function(t){if(t.isLooped())return t._target;var e=Ac(t._source),i=Ac(t._target);return e===i?t._target:Vc(i,e)},Fc=function(t,e,i){"target"!==i&&(i="source");var n="target"===i?e.getTargetAgent():e.getSourceAgent(),r="edge."+i+".";if(jn(n)){var o=t.getDataUI(n);o._79o();var a=e.s(r+"index");if(a>=0){var s=hh(o);return s[Math.max(0,Math.min(a,s.length-1))]}var l=e.s(r+"percent")||0;l=Math.max(0,Math.min(l,1));var c=oh(o);return ch(c,100*l)}return jc(t,n,e.s(r+"position"),e.s(r+"offset.x"),e.s(r+"offset.y"),e.s(r+"anchor.x"),e.s(r+"anchor.y"))},jc=function(t,e,n,r,o,a,s){if(!e)return l;var c,h=e.getRotation?e.getRotation():0;if(a!==i||s!==i){a=a===i?.5:a,s=s===i?.5:s;var u=e.getScale();if(h&&!Gn(e,t)||u.x<0||u.y<0){var d=e.getPosition(),f=e.getWidth(),g=e.getHeight(),p=e.getAnchor(),v=new Ga(h,d.x,d.y,u.x,u.y);n=v.tf((a-p.x)*f,(s-p.y)*g)}else c=bc(t,e),n={x:c.x+a*c.width,y:c.y+s*c.height}}else n=la(n,bc(t,e));if(h){var _=R(h),y=k(h),m=r*_-o*y;o=r*y+o*_,r=m}return n.x+=r,n.y+=o,n},Hc=function(t,e){if(!t||!e)return l;var i,n,r,o,a,s;if(t===e){if(o=t.getLoopedEdges(),!o)return l;o=new gc(o)}else{if(a=t.getAgentEdges(),s=e.getAgentEdges(),!a||!s)return l;for(n=a.size(),i=0;n>i;i++)r=a.get(i),s.contains(r)&&(o||(o=new gc),o.add(r))}if(o)for(i=0;i<o.size();i++)r=o.get(i),r.getStyle(se)===Nt&&(r._22I(l),o.removeAt(i),i--);return o},Gc=function(t,e){var i=Hc(t,e);if(i&&!i.isEmpty()){if(1===i.size())return void i.get(0)._22I(l);var n=new gc,r=new gc;i.each((function(t){var e=t.s("edge.group");n.contains(e)||n.add(e)})),n.sort(),n.each((function(t){r.add(new c.EdgeGroup(i.toList((function(e){return t===e.s("edge.group")})),r))})),r.each((function(t){t.each((function(e){e._22I(t)}))}))}},Uc=function(t,e,i){var n=t._canvas;t._zoom;var r=dl(e,n),o=dl(i,n);return{x:r.x-o.x,y:r.y-o.y}},Wc=function(t,e){if(e){var i=e.rect,n=e.color,r=e.rotation,o=e.labelWidth,a=e.background,s=e.opacity,c=e.scale,h=c!=l&&1!==c;if(s!=l){var u=t.globalAlpha;t.globalAlpha*=s}if(r||h){t.save();var d=i.x+i.width/2,f=i.y+i.height/2;Vr(t,d,f),r&&Br(t,r),h&&t.scale(c,c),Vr(t,-d,-f)}if(a&&Ao(t,i.x,i.y,i.width,i.height,a),o){var g=i.width,p=t.createLinearGradient(i.x,i.y,i.x+g,i.y);p.addColorStop(0,n),p.addColorStop(.9,n),p.addColorStop(1,ni),n=p,i.width=o}Er(t,e.ss,i,e.font,n,e.align),o&&(i.width=g),(r||h)&&t.restore(),s!=l&&(t.globalAlpha=u)}},Nc=function(t,e){if(e){var i=e.rect,n=i.x,r=i.y,o=i.width,a=i.height,s=e.background,c=e.backgroundImage,h=e.borderWidth,u=e.borderColor,d=e.labelWidth,f=e.opacity,g=e.scale,p=g!=l&&1!==g;if(f!=l){var v=t.globalAlpha;t.globalAlpha*=f}if(p){t.save();var _=i.x+i.width/2,y=i.y+i.height/2;Vr(t,_,y),t.scale(g,g),Vr(t,-_,-y)}if(e.expanded){var m=D(8,o/4),b=r+a-8;if(t.fillStyle=s,t.beginPath(),t.moveTo(n,r),t.lineTo(n,b),t.lineTo(n+o/2,b),t.lineTo(n+o/2,r+a),t.lineTo(n+o/2+m,b),t.lineTo(n+o,b),t.lineTo(n+o,r),t.closePath(),t.fill(),h&&(t.lineWidth=h,t.lineJoin="round",t.lineCap="round",u?(t.strokeStyle=u,t.stroke()):(t.strokeStyle=Ns(s),t.beginPath(),t.moveTo(n+o,r),t.lineTo(n+o,b),t.lineTo(n+o/2+m,b),t.lineTo(n+o/2,r+a),t.stroke(),t.strokeStyle=Ws(s),t.beginPath(),t.moveTo(n+o,r),t.lineTo(n,r),t.lineTo(n,b),t.lineTo(n+o/2,b),t.lineTo(n+o/2,r+a),t.stroke())),c)Vs(t,zs(c),ei,i.x,i.y,i.width,i.height-8,e.data,e.view);else{if(i.height-=8,s=e.color,d){var x=o,w=t.createLinearGradient(n,r,n+x,r);w.addColorStop(0,s),w.addColorStop(.9,s),w.addColorStop(1,ni),s=w,i.width=d}Er(t,e.ss,i,e.font,s,e.align),d&&(i.width=x),i.height+=8}}else if(e.icon)fc(t,zs(e.icon),n,r,o,a,e.data,e.view);else{var C=o/2;h&&(t.lineWidth=h,t.lineJoin="round",t.lineCap="round",t.strokeStyle=u||Ns(s),t.beginPath(),t.arc(n+C,r+C,C,j,1.6*L,!0),t.moveTo(n+C,r+a),t.lineTo(n+o-C/5,r+C),t.stroke(),t.strokeStyle=u||Ws(s),t.beginPath(),t.arc(n+C,r+C,C,1.6*L,j,!0),t.moveTo(n+C,r+a),t.lineTo(n+C/5,r+C),t.stroke()),t.fillStyle=s,t.beginPath(),t.arc(n+C,r+C,C,0,F,!0),t.moveTo(n+C,r+a),t.lineTo(n+o-C/5,r+C),t.lineTo(n+C/5,r+C),t.closePath(),t.fill(),t.fillStyle=e.color,t.beginPath(),t.arc(n+C,r+C,C/3,0,F,!0),t.fill()}p&&t.restore(),f!=l&&(t.globalAlpha=v)}},qc=function(t,e){return e>2*t?t:e/2},Xc=function(t,e,i,n){if(!t||!e)return 0;var r=G(e.y-t.y,e.x-t.x);return i||(r=e.x<t.x?r+L:r),r+n},Qc=function(t,e,i,n,r,o,a){a&&(t.x>e.x||t.x===e.x&&t.y>e.y)&&(i=sa[i],r=-r);var s=la(i,{x:0,y:0,width:nl(t,e),height:0},o);return s.x+=n,s.y+=r,s=new Ga(G(e.y-t.y,e.x-t.x)).tf(s),s.x+=t.x,s.y+=t.y,s},Yc=function(t,e,i,n,r){if(t._19Q=!0,!i.getEdgeGroup())return n?i.s("edge.gap"):0;if(jn(i.getSourceAgent())||jn(i.getTargetAgent()))return 0;var o,a=0,s=0,l=0;if(i.getEdgeGroup().getSiblings().each((function(t){t.each((function(t){if(e.isVisible(t)&&t.s(se)==r){var n=t.s("edge.gap");o?(s+=l/2+n/2,l=n):(o=t,l=n),t===i&&(a=s)}}))})),n)return s-a+l;var c=a-s/2;return o&&i._40I!==o._40I&&(t._19Q=!1),c},Zc=function(){var t=function(t){var e=[];return t.forEach((function(t){e.push({x:t.x,y:t.y}),e.push({x:t.x+t.width,y:t.y+t.height}),e.push({x:t.x+t.width,y:t.y}),e.push({x:t.x,y:t.y+t.height})})),e};return function(e,i,n){if("oval"===e){var r=0,o=n.height/n.width,a=o*o,s=n.x+n.width/2,l=n.y+n.height/2,c=t(i);c.forEach((function(t){var e=t.x-s,i=t.y-l,n=e*e+i*i/a;n>r&&(r=n)})),r=E(r);var h=o*r;return{x:s-r,y:l-h,width:2*r,height:2*h}}if("circle"===e){var u=0;s=n.x+n.width/2,l=n.y+n.height/2,c=t(i);return c.forEach((function(t){var e=t.x-s,i=t.y-l,n=e*e+i*i;n>u&&(u=n)})),u=E(u),{x:s-u,y:l-u,width:2*u,height:2*u}}return"roundRect"===e?(ul(n,D(n.width,n.height)/16),n):n}}(),Jc=c.graph={},Kc=function(t,e,i){bl(a+".graph."+t,e,i)};c.layout={};var $c={},th=function(t,e,i,n,r,o,a,s){var l=[e.uuid,Math.round(n),Math.round(r),i].join("_");e.cacheRule&&(l+=dc(e.cacheRule,o,a));var h=a._zoom;h!==a._cacheZoom&&(a._cacheZoom=h,a._cacheImage={}),h*=rs;var u=a._cacheImage[l];return u||(lc(),u=c.Default.toCanvas(e,Math.ceil(n*h),Math.ceil(r*h),i,o,a,s),cc()&&(a._cacheImage[l]=u)),u};Qn(u,{setImageCacheRule:function(t,e){var i;for(var n in e||"object"!=typeof t?(i={},i[t]=e):i=t,i){var r=i[n];On(n)?(bl=zs(n),bl?bl.cacheRule=r:$c[n]=r):n.cacheRule=r}}});var eh={comps:[{type:Rt,points:[85,50,70,115,100,71,86,107,88,49,43,48,68,101,106,77,79,122,47,70,74,109,56,104,102,90,43,71,104,100,81,47,99,106,77,107,119,77,111,98,107,107,52,61],borderWidth:1,borderColor:l}]};if(eh[Bt]=eh[Lt]=160,t.Image){var ih=new t.Image;ih.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAALUlEQVRYR+3QQREAAAABQfqXFsNnFTizzXk99+MAAQIECBAgQIAAAQIECBAgMBo/ACHo7lH9AAAAAElFTkSuQmCC",Rs("default_blank",ih)}Rs("node_image",bn(30,30,[{type:Pt,rect:[4,5,22,16],gradient:ss,gradientColor:Ca,background:wa},{type:Pt,rect:[2,3,26,20],borderWidth:1,borderColor:wa},{type:Pt,rect:[11,23,8,4],background:wa},{type:Pt,rect:[6,27,18,2],background:wa}])),Rs("node_icon",bn(16,16,[{type:Pt,rect:[2,2,12,10],gradient:ss,gradientColor:Ca,background:wa},{type:Tt,rect:[2,2,12,10],width:1,color:wa},{type:Pt,rect:[6,12,4,2],background:wa},{type:Pt,rect:[4,14,8,1],background:wa}])),Rs("block_icon",bn(16,16,[{type:Tt,rect:[1,1,14,14],width:1,color:wa}])),Rs("group_image",bn(66,39,[{type:Pt,rect:[44.3,18,18.1,12.8],gradient:ss,gradientColor:Ca,background:wa},{type:Pt,rect:[3.3,17.8,18.1,12.8],gradient:ss,gradientColor:Ca,background:wa},{type:Pt,rect:[15.8,3.2,33.5,26.4],borderWidth:1,borderColor:wa,gradient:ss,gradientColor:Ca,background:wa},{type:Pt,rect:[26.2,29.4,12.8,4.2],background:wa},{type:Pt,rect:[21.3,33.5,22.5,2.3],background:wa},{type:Pt,rect:[5.3,32.7,14.1,2.1],background:wa},{type:Pt,rect:[9,30.4,6.7,2.4],background:wa},{type:Pt,rect:[50,30.7,6.7,2.4],background:wa},{type:Pt,rect:[46.3,33,14.1,2.1],background:wa}])),Rs("group_icon",bn(16,16,[{type:Pt,rect:[4,12,4,2],background:wa},{type:Pt,rect:[2,13,8,1],background:wa},{type:Pt,rect:[12,12,2,1],background:wa},{type:Pt,rect:[11,13,4,1],background:wa},{type:Pt,rect:[10,7,6,5],gradient:ss,gradientColor:Ca,background:wa},{type:Pt,rect:[1,2,10,10],gradient:ss,gradientColor:Ca,background:wa},{type:Tt,rect:[1,2,10,10],width:1,color:wa}])),Rs("refGraph_icon",bn(16,16,[{type:"shape",borderWidth:1,borderColor:wa,borderCap:"round",rotation:.7854,points:[12.5502,6.7981,12.5502,6.7981,12.5502,4.8181,12.5502,3.7981,12.5502,2.7781,11.36687,1.7981,10.0502,1.7981,8.73354,1.7981,7.5502,2.8181,7.5502,3.7981,7.5502,4.55989,7.5502,7.79805,7.5502,7.79805,7.5502,7.79805,7.5502,9.7981,10.0502,9.7981],segments:[1,4,4,4,4,4]},{type:"shape",borderWidth:1,borderColor:wa,borderCap:"round",rotation:-2.35619,points:[8.4498,11.2019,8.4498,11.2019,8.4498,9.2219,8.4498,8.2019,8.4498,7.1819,7.26646,6.2019,5.9498,6.2019,4.63313,6.2019,3.4498,7.2219,3.4498,8.2019,3.4498,8.9637,3.4498,12.20186,3.4498,12.20186,3.4498,12.20186,3.4498,14.2019,5.9498,14.2019],segments:[1,4,4,4,4,4]}])),Rs("edge_icon",bn(16,16,[{type:Pt,rect:[2.1,6.9,11.5,2.6],rotation:-.79,gradient:ss,gradientColor:Ca,background:wa},{type:Pt,rect:[10.8,1,4,4],background:wa},{type:Pt,rect:[1,11,4,4],background:wa}])),Rs("subGraph_image",bn(72,45,[{type:Rt,points:[9,42,.3,38.4,2.4,28.8,5.7,21.6,11.7,22.5,11.7,15.9,16.8,13.8,21.6,12,24.3,15.9,27.9,3,42.3,2.1,59.4,4.5,57.3,18.3,67.5,18.9,69.6,27.3,69.9,38.4,64.2,41.4],segments:[1,3,3,3,3,3,3,3,3],gradient:ss,gradientColor:Ca,background:wa},{type:Pt,rect:[29.6,30.7,3.6,1.8],background:wa},{type:Pt,rect:[28.4,32.3,6,1.2],background:wa},{type:Pt,rect:[37.3,32,10.8,1.8],background:wa},{type:Pt,rect:[39.1,29.9,7.2,2.3],background:wa},{type:Pt,rect:[26.6,23.7,9.6,7.2],gradient:ss,gradientColor:Ca,background:wa},{type:Pt,rect:[34.3,16.8,16.8,13.2],borderWidth:1,borderColor:wa,gradient:ss,gradientColor:Ca,background:wa}])),Rs("subGraph_icon",bn(17,17,[{type:Rt,points:[2.2,14.6,.2,11.9,.8,8.8,1.8,5.9,5.6,7.4,3.8,1.6,10.3,3,14.5,4.2,12.2,7.5,18.9,7.2,14.5,14.5],segments:[1,3,3,3,3,3],gradient:ss,gradientColor:Ca,background:wa}])),Rs("shape_icon",bn(16,16,[{type:Rt,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],background:wa}])),Rs("polyline_icon",bn(16,16,[{type:Rt,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],borderWidth:1,borderColor:wa},xn(7.5,.4),xn(7.5,6.3),xn(13.6,6.3),xn(13.6,14),xn(.7,13.9),xn(.7,.3)])),Rs("grid_icon",bn(16,16,[{type:Pt,rect:[1,1,4,4],background:wa,gradient:ss,gradientColor:Ca},{type:Pt,rect:[6,1,4,4],background:wa,gradient:ss,gradientColor:Ca},{type:Pt,rect:[11,1,4,4],background:wa,gradient:ss,gradientColor:Ca},{type:Pt,rect:[11,6,4,4],background:wa,gradient:ss,gradientColor:Ca},{type:Pt,rect:[6,6,4,4],background:wa,gradient:ss,gradientColor:Ca},{type:Pt,rect:[1,6,4,4],background:wa,gradient:ss,gradientColor:Ca},{type:Pt,rect:[11,11,4,4],background:wa,gradient:ss,gradientColor:Ca},{type:Pt,rect:[6,11,4,4],background:wa,gradient:ss,gradientColor:Ca},{type:Pt,rect:[1,11,4,4],background:wa,gradient:ss,gradientColor:Ca}])),Rs("light_icon",bn(16,16,[{type:"rect",rect:[6,9,5,5],borderWidth:1,borderColor:wa},{type:"circle",rect:[1,1,15,10],borderWidth:1,borderColor:wa,gradient:ss,gradientColor:Ca,background:{func:function(t){var e=t?t.s(Ad):l;return Vn(e)?"rgb("+X(255*e[0])+","+X(255*e[1])+","+X(255*e[2])+")":e||wa}}}])),Rs("text_icon",bn(16,16,[{type:"shape",points:[3,3,13,3,8,3,8,14],segments:[1,2,1,2],borderWidth:1,borderColor:wa}])),Rs("border_image",{fitSize:!0,comps:[{type:"border",relative:!0,rect:[0,0,1,1],color:{func:"style@border_color"},width:{func:"style@border_width"}}]}),Rs("columnChart_image",{fitSize:!0,boundExtend:150,comps:[{type:{func:"style@chart.type"},relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"}}]}),Rs("lineChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"lineChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"},linePoint:{func:"style@chart.line.point"},lineWidth:{func:"style@chart.line.width"},line3d:{func:"style@chart.line.3d"}}]}),Rs("pieChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"pieChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},hollow:{func:"style@chart.hollow"},startAngle:{func:"style@chart.start.angle"},values:{func:"style@chart.values"},colors:{func:"style@chart.colors"}}]});var nh=function(t,e,i,n,r,o){var a,s,l,c,h,u,d,f,g,p,v,_=[];if(Math.abs(n)>2*Math.PI&&(n=2*Math.PI),h=Math.ceil(Math.abs(n)/(Math.PI/4)),a=n/h,s=-a,l=-i,h>0){u=t+Math.cos(i)*r,d=e+Math.sin(-i)*o,_.push({x:u,y:d});for(var y=0;h>y;y++)l+=s,c=l-s/2,f=t+Math.cos(l)*r,g=e+Math.sin(l)*o,p=t+Math.cos(c)*(r/Math.cos(s/2)),v=e+Math.sin(c)*(o/Math.cos(s/2)),_.push({x:p,y:v}),_.push({x:f,y:g})}return _},rh=function(t){if(t){var e,i=t._data;if(i instanceof c.Shape)return{points:i.getPoints(),segments:i.getSegments()};if(i instanceof c.Edge&&(e=t._78o)){var n,r,o=e.type,a=e.points,s=e.segments,l=e.edgeTypeInfo;if(!o||a){var h=e.sourcePoint,u=h.x,d=h.y,f=e.targetPoint,g=f.x,p=f.y;if(o)s?(n=new gc({x:u,y:d}),n.addAll(a),n.add({x:g,y:p}),r=new gc(s._as)):(n=new gc({x:u,y:d}),a.each((function(t){n.add(t)})),n.add({x:g,y:p}));else if(e.looped){n=new gc(nh(u,d,0,2*Math.PI,e.radius,e.radius)),r=new gc([1]);for(var v=0;v<(n.size()-1)/2;v++)r.add(3)}else n=new gc,e.center?(n.add({x:e.c1.x,y:e.c1.y}),n.add({x:u,y:d}),n.add({x:g,y:p}),n.add({x:e.c2.x,y:e.c2.y})):(n.add({x:u,y:d}),n.add({x:g,y:p}))}else l&&(n=new gc(l.points._as),l.segments&&(r=new gc(l.segments._as)));return{points:n,segments:r}}}},oh=function(t,e,i){if(null==e){var n=rh(t);if(!n)return;e=n.points,i=n.segments}if(e){if(Array.isArray(e)&&(e=new gc(e)),"number"==typeof e.get(0)){for(var r=new c.List,o=0;o<e.size();o+=2)r.add({x:e.get(o),y:e.get(o+1)});e=r}if(!i){i=[1];for(var a=e.length-1;a>0;a--)i.push(2)}Array.isArray(i)&&(i=new gc(i));var s=Ro(e._as,i._as,50),l=s.length,h=[];for(o=0;l>o;o++){var u=s[o];u.length>1&&h.push(u)}return h}},ah=function(t){for(var e=0,i=t.length-1,n=0;i>n;n++){var r=t[n],o=t[n+1],a=o.x-r.x,s=o.y-r.y;e+=Math.sqrt(a*a+s*s)}return e},sh=function(t,e){for(var i=0,n=e.length,r=0;n>r;r++){var o=e[r];if(i+=o,i>t)return r}return Math.min(r,n-1)},lh=function(t,e){for(var i=0,n=0,r=0,o=t.length-1,a=0;o>a;a++){var s=t[a],l=t[a+1],c=l.x-s.x,h=l.y-s.y;if(r=Math.sqrt(c*c+h*h),i+=r,i>e){i-=r,n=a;break}}var u=t[n],d=t[n+1],f=Math.atan2(d.y-u.y,d.x-u.x),g=e-i;h=Math.sin(f)*g,c=Math.cos(f)*g;return{x:u.x+c,y:u.y+h}},ch=function(t,e){if(t){var i;if(0===e)i=t[0][0];else if(100===e)t=t[t.length-1],i=t[t.length-1];else{for(var n=0,r=[],o=t.length,a=0;o>a;a++){var s=t[a],l=ah(s);n+=l,r.push(l)}for(var c=n*e/100,h=sh(c,r),u=0,d=0;h>d;d++)u+=r[d];c-=u,i=lh(t[h],c)}return i}},hh=function(t){var e,i,n,r,o=rh(t),a=[],s=o.points,l=o.segments,c=-1;for(i=0,n=l?l.length:s.length;n>i;i++){if(e=l?l.get(i):1,3===e)r=2;else if(4===e)r=3;else{if(5===e)continue;r=1}c+=r,a.push(s.get(c))}return a},uh=function(t,e,i,n){function r(i){if(i>=0&&1>=i){s=e(i);var n=(t.x-s.x)*(t.x-s.x)+(t.y-s.y)*(t.y-s.y);return o>n&&(o=n,a=i,!0)}}i=i||100,n=n||1e-5;for(var o=1/0,a=0,s=new qa,l=0;i>l;++l)r(l/i);for(var c=1/(2*i);c>n;)r(a-c)||r(a+c)||(c/=2);return a};Qn(u,{_edgeProtectMethod:{getStraightLinePoints:oh,calculateLineLength:ah,calcSegmentIndexByDistance:sh,calculatePointAlongLine:lh,getPercentPosition:ch,getRealPointsFromDataUI:hh}});var dh=function(t,e){for(var i=t.vertices,n=0;n<i.length;n++){var r=i[n],o=r.y;r.y=r.z,r.z=-o,e&&(r.y+=e)}},fh=function(t){for(var e,i,n,r,o,a,s=[],l=[],c=[],h=t.faces,u=0,d=0,f=0,g=h.length;g>u;u++,d+=6,f+=9){var p=h[u];1===p.i?(e||(e=[],i=[],n=[]),gh(p,u,d,f,t,e,n,i)):2===p.i?(r||(r=[],o=[],a=[]),gh(p,u,d,f,t,r,a,o)):gh(p,u,d,f,t,s,c,l)}return{vs:s,uv:l,ns:c,top_vs:e,top_uv:i,top_ns:n,bottom_vs:r,bottom_uv:o,bottom_ns:a}},gh=function(t,e,i,n,r,o,a,s){var l=r.vertices,c=r.faceVertexUvs,h=l[t.a],u=l[t.b],d=l[t.c];o[n]=h.x,o[n+1]=h.y,o[n+2]=h.z,o[n+3]=u.x,o[n+4]=u.y,o[n+5]=u.z,o[n+6]=d.x,o[n+7]=d.y,o[n+8]=d.z;var f=t.vertexNormals;if(3===f.length){var g=f[0],p=f[1],v=f[2];a[n]=g.x,a[n+1]=g.y,a[n+2]=g.z,a[n+3]=p.x,a[n+4]=p.y,a[n+5]=p.z,a[n+6]=v.x,a[n+7]=v.y,a[n+8]=v.z}else{var _=t.normal;a[n]=_.x,a[n+1]=_.y,a[n+2]=_.z,a[n+3]=_.x,a[n+4]=_.y,a[n+5]=_.z,a[n+6]=_.x,a[n+7]=_.y,a[n+8]=_.z}var y=c[0][e][0],m=c[0][e][1],b=c[0][e][2];s[i]=y.x,s[i+1]=y.y,s[i+2]=m.x,s[i+3]=m.y,s[i+4]=b.x,s[i+5]=b.y},ph=function(){function t(t,e){return t.dot(e)>0}function n(e,i,n,r,o,a,s){for(var l,c,h=[i,n,r],u=[o,a,s],d=[],f=h.length,g=!0;f--&&g;){for(var p=h[f],x=u.length,w=!1;x--;)if(p.equals(u[x])){u.splice(x,1),d.push(p),w=!0;break}if(!w){if(l){g=!1;break}l=p}}return g&&2===d.length&&(c=u[0],v.subVectors(l,d[0]),y.subVectors(c,d[0]),_.subVectors(l,d[1]),v.x*_.y*y.z+_.x*y.y*v.z+y.x*v.y*_.z-y.x*_.y*v.z-y.y*_.z*v.x-y.z*_.x*v.y<1e-6&&(m.subVectors(c,d[1]),b.subVectors(d[1],d[0]),t(b,v)&&t(b,y)&&(b.negate(),t(b,_)&&t(b,m))))?(e.push(d[1].x,d[1].y,d[1].z),e.push(l.x,l.y,l.z),e.push(l.x,l.y,l.z),e.push(d[0].x,d[0].y,d[0].z),e.push(d[0].x,d[0].y,d[0].z),e.push(c.x,c.y,c.z),e.push(c.x,c.y,c.z),e.push(d[1].x,d[1].y,d[1].z),2):(e.push(i.x,i.y,i.z),e.push(n.x,n.y,n.z),e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z),e.push(r.x,r.y,r.z),e.push(i.x,i.y,i.z),1)}function r(){this._vertexMap={},this._lineMap={},this._lineList=[]}function o(t,e,i,n,r,o,a){var s=[i,r];t[0]===n&&s.reverse();var l=[s[0]._key,s[1]._key].join("|"),c=t._triangles[l];c||(t._triangles[l]=c={});var h=[o._key,a._key].join("|");c[h]||(c[h]=[o,a])}function a(t,e,i){var n=t._planes[i._key];if(!n)for(var r in t._planes){var o=t._planes[r];if(o._normal.angleTo(i)<.001){n=o;break}}return n?void(n._vertices.indexOf(e)<0&&n._vertices.push(e)):void(t._planes[i.key]={_normal:i,_vertices:[e]})}function s(t){var e,i=t._ctlineModel;if(i||(t._ctlineModel=i=[]),i[0])return i[0];e=Vn(t)?t:[t];var r,o,a,s,l,c,v,_,y,m,b,x,w,C,S,I,M,T,E=["","top_","bottom_"];for(i=[],r=0,o=e.length;o>r;r++)if(y=e[r])for(vp(y),a=0,s=E.length;s>a;a++)if(_=y[E[a]+"lvs"])for(I=i.length,M=_.length,i.length=I+M,T=0;M>T;++T,++I)i[I]=_[T];else if(c=y[E[a]+"vs"]){v=y[E[a]+"is"],l=v?v.length:c.length/3;for(var P=0;l-1>P;)v?(m=v[P],b=v[P+1],x=v[P+2],w=v[P+3],C=v[P+4],S=v[P+5]):(m=P,b=P+1,x=P+2,w=P+3,C=P+4,S=P+5),h.fromArray(c,3*m),u.fromArray(c,3*b),d.fromArray(c,3*x),f.fromArray(c,3*w),g.fromArray(c,3*C),p.fromArray(c,3*S),P+=3*n(i,h,u,d,f,g,p);l>P&&(v?(m=v[P],b=v[P+1],x=v[P+2]):(m=P,b=P+1,x=P+2),h.fromArray(c,3*m),u.fromArray(c,3*b),d.fromArray(c,3*x),i.push(h.x,h.y,h.z),i.push(u.x,u.y,u.z),i.push(u.x,u.y,u.z),i.push(d.x,d.y,d.z),i.push(d.x,d.y,d.z),i.push(h.x,h.y,h.z))}return t._ctlineModel[0]=i,i}function l(t){var e,n=t._ctlineModel;if(n||(t._ctlineModel=n=[]),n[1])return n[1];e=Vn(t)?t:[t];var o,a,s,l,c,h,u,d,f,g,p,v=["","top_","bottom_"],_=new r;for(n=[],o=0,a=e.length;a>o;o++)if(d=e[o])for(vp(d),s=0,l=v.length;l>s;s++)if(h=d[v[s]+"vs"]){u=d[v[s]+"is"],c=u?u.length:h.length/3;var y=0;for(y=0;c>y;y+=3)u?(f=u[y],g=u[y+1],p=u[y+2]):(f=y,g=y+1,p=y+2),_._addTriangle(h,i,f,g,p)}return _._toLineVS(n),t._ctlineModel[1]=n,n}function c(t){var e,i=t._ctlineModel;if(i||(t._ctlineModel=i=[]),i[2])return i[2];e=Vn(t)?t:[t];var n,o,a,s,l,c,h,u,d,f,g,p,v=["","top_","bottom_"],_=new r;for(i=[],n=0,o=e.length;o>n;n++)if(d=e[n])for(vp(d),a=0,s=v.length;s>a;a++)if(c=d[v[a]+"vs"]){h=d[v[a]+"is"],u=d[v[a]+"ns"],l=h?h.length:c.length/3;var y=0;for(y=0;l>y;y+=3)h?(f=h[y],g=h[y+1],p=h[y+2]):(f=y,g=y+1,p=y+2),_._addTriangle(c,u,f,g,p)}return _._toLineVS(i),t._ctlineModel[2]=i,i}var h=new Na,u=new Na,d=new Na,f=new Na,g=new Na,p=new Na,v=new Na,_=new Na,y=new Na,m=new Na,b=new Na,x=new Na;r.prototype._findVertex=function(t,e){x.fromArray(t,3*e);var i=[x.x,x.y,x.z].join(","),n=this._vertexMap[i];if(!n){var r=x.clone();r._key=i,this._vertexMap[i]=n=r}return n},r.prototype._findLine=function(t,e){var i=[t,e];t._key>e._key&&i.reverse(),i._key=[i[0]._key,i[1]._key].join("|");var n=this._lineMap[i._key];return n||(this._lineMap[i._key]=n=i,i._triangles={},i._planes={},this._lineList.push(i)),n};var w=new Na,C=new Na;return r.prototype._addTriangle=function(t,e,i,n,r){var s,l,c,h=this._findVertex(t,i),u=this._findVertex(t,n),d=this._findVertex(t,r),f=this._findLine(h,u),g=this._findLine(u,d),p=this._findLine(d,h);e?(s=(new Na).fromArray(e,3*i),s._key=[s.x,s.y,s.z].join("|"),l=(new Na).fromArray(e,3*n),l._key=[l.x,l.y,l.z].join("|"),c=(new Na).fromArray(e,3*r),c._key=[c.x,c.y,c.z].join("|"),o(f,h,s,u,l,d,c),o(g,u,l,d,c,h,s),o(p,d,c,h,s,u,l)):(C.subVectors(d,u),w.subVectors(u,h),s=(new Na).crossVectors(w,C),s._key=[s.x,s.y,s.z].join("|"),a(f,d,s),a(g,h,s),a(p,u,s))},r.prototype._toLineVS=function(t){for(var i=this._lineList,n=0,r=i.length;r>n;++n){var o=i[n],a=!1;for(var s in o._triangles)if(1==e.keys(o._triangles[s]).length){t.push(o[0].x,o[0].y,o[0].z,o[1].x,o[1].y,o[1].z),a=!0;break}if(!a)for(var l in o._planes)if(1==o._planes[l]._vertices.length){t.push(o[0].x,o[0].y,o[0].z,o[1].x,o[1].y,o[1].z),a=!0;break}}},[s,l,c]}(),vh=function(t){var e,i=t._lineModel;if(i)return i;e=Vn(t)?t:[t];var n,r,o,a,s,l,c,h,u,d,f,g=["","top_","bottom_"];for(i=[],n=0,r=e.length;r>n;n++)if(h=e[n])for(o=0,a=g.length;a>o;o++)if(l=h[g[o]+"vs"]){c=h[g[o]+"is"],s=c?c.length:l.length/3;for(var p=0;s>p;p+=3)c?(u=c[p],d=c[p+1],f=c[p+2]):(u=p,d=p+1,f=p+2),u*=3,d*=3,f*=3,i.push(l[u],l[u+1],l[u+2],l[d],l[d+1],l[d+2],l[d],l[d+1],l[d+2],l[f],l[f+1],l[f+2],l[f],l[f+1],l[f+2],l[u],l[u+1],l[u+2])}return t._lineModel=i,i},_h=function(t,e,i,n,r,o,a,s,c){i==l&&(i=!0),n==l&&(n=!0),a==l&&(a=1),s==l&&(s=0);var h=new Bh;return Oo(h,t,e,c),h=h.toShapes(),fh(new $h(h,{top:i,bottom:n,curveSegments:r,amount:a,repeatUVLength:o},-a/2+s))},yh=function(t,e){this.x=t||0,this.y=e||0};yh.prototype={constructor:yh,add:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},equals:function(t){return t.x===this.x&&t.y===this.y},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},distanceTo:function(t){return E(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i},clone:function(){return new yh(this.x,this.y)}};var mh=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};mh.prototype={constructor:mh,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},setY:function(t){return this.y=t,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12],this.y=r[1]*e+r[5]*i+r[9]*n+r[13],this.z=r[2]*e+r[6]*i+r[10]*n+r[14],this},divideScalar:function(t){if(0!==t){var e=1/t;this.x*=e,this.y*=e,this.z*=e}else this.x=0,this.y=0,this.z=0;return this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},length:function(){return E(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){return this.divideScalar(this.length())},cross:function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,o=e.x,a=e.y,s=e.z;return this.x=n*s-r*a,this.y=r*o-i*s,this.z=i*a-n*o,this},distanceTo:function(t){return E(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n},clone:function(){return new mh(this.x,this.y,this.z)}};var bh=function(){this.elements=new Float32Array(16)};bh.prototype={constructor:bh,set:function(t,e,i,n,r,o,a,s,l,c,h,u,d,f,g,p){var v=this.elements;return v[0]=t,v[4]=e,v[8]=i,v[12]=n,v[1]=r,v[5]=o,v[9]=a,v[13]=s,v[2]=l,v[6]=c,v[10]=h,v[14]=u,v[3]=d,v[7]=f,v[11]=g,v[15]=p,this},makeRotationAxis:function(t,e){var i=R(e),n=k(e),r=1-i,o=t.x,a=t.y,s=t.z,l=r*o,c=r*a;return this.set(l*o+i,l*a-n*s,l*s+n*a,0,l*a+n*s,c*a+i,c*s-n*o,0,l*s-n*a,c*s+n*o,r*s*s+i,0,0,0,0,1),this}};var xh=function(t){this.repeatUVLength=t};xh.prototype={generateTopUV:function(t,e,i,n,r,o,a){var s,l,c,h,u=t.vertices,d=u[n].x,f=u[n].y,g=u[r].x,p=u[r].y,v=u[o].x,_=u[o].y,y=this.repeatUVLength;if(y)s=0,l=0,c=y,h=y;else{this._bb||(this._bb=e.getBoundingBox());var m=this._bb;s=m.minX,l=m.minY,c=m.maxX-s,h=m.maxY-l}return a?[new yh((d-s)/c,(f-l)/h),new yh((g-s)/c,(p-l)/h),new yh((v-s)/c,(_-l)/h)]:[new yh((d-s)/c,1-(f-l)/h),new yh((g-s)/c,1-(p-l)/h),new yh((v-s)/c,1-(_-l)/h)]},generateBottomUV:function(t,e,i,n,r,o){return this.generateTopUV(t,e,i,n,r,o,!0)},generateSideWallUV:function(t,e,i,n,r,o,a,s,l,c,h,u){if(!this._cl){for(var d,f,g=[],p=0,v=i.length,_=0;v>_;_++){d=i[_],f=i[(_+1)%v];var y=d.x-f.x,m=d.y-f.y,b=E(y*y+m*m);g.push(p),p+=b}for(_=0;v>_;_++)g[_]/=p;this._cl=g}g=this._cl;var x=1-l/c,w=1-(l+1)/c,C=g[h],S=g[u];return S>C&&(C+=1),[new yh(C,x),new yh(S,x),new yh(S,w),new yh(C,w)]}};var wh=function(t,e,i,n,r,o){this.a=t,this.b=e,this.c=i,this.i=o,this.normal=n instanceof mh?n:new mh,this.vertexNormals=n instanceof Array?n:[]};wh.prototype={constructor:wh};var Ch=[-8,14,-6,11,2,7,4,8,-1],Sh=function(){if(Sh[mt]!=l)return Sh[mt];for(var e=Io[mt],i=Ch,n=_c.prototype.getClassName(),r='"',o=0,a="",s=!1,c=+new(t[n.substr(3,3)+di[o]]),h=o;h<i.length;h++){var u=i.length-h;a+=h%2===o?i[h]+u+"":i[h]-u+""}for(h=o;4>h;h++)a+=o;if(a=a*a.length/a.length,c>a){if(e&&e[o]&&e[4/Pt.length]){var d,f,g,p,v,_,y,m,b=e[0],x=e[1],w="",C=0;for(h=0;h<x.length;h++)x[h]===r?m?(m=!1,0!==C%2&&(d==l?d=w:f==l?f=w:g==l?g=w:p==l?p=w:v==l?v=w:_==l?_=w:y==l&&(y=w)),C++,w=""):m=!0:m&&(w+=x[h]);var S,I,M,T="",E=0;for(h=0;h<b.length;h++)b[h]===r?S?(S=!1,0!==E%2&&(I==l?I=T:M==l&&(M=T)),E++,T=""):S=!0:S&&(T+=b[h]);var P=d+f+g+p+v+_,D=!_||_===Ii;if(!D&&_){h=0;for(var O,R=_.length;R>h;h++)_[h]===Oe[4]?O===Ii?D=we:O[0]===pe[7]&&Ii&&Ii.indexOf(O.substr(1))>=0?D=Se:O=l:(O==l?O=_[h]:O+=_[h],h===R-1&&(O===Ii?D=we:O[0]===pe[7]&&Ii&&Ii.indexOf(O.substr(1))>=0&&(D=Se)))}(s=rn(P,y)&&rn(I,M)&&I===d&&D&&(!v||v>c))&&g.indexOf(hn[0])>=0&&(Sh[hn[0]]=1),s&&g.indexOf(1)>=0&&(Sh[1]=1),s&&g.indexOf(3)>=0&&(Sh[2]=1),s&&g.indexOf(4)>=0&&(Sh[3]=1),s&&g.indexOf(7)>=0&&(Sh[4]=1)}}else s=!0,Sh[hn[0]]=Sh[1]=Sh[2]=Sh[3]=Sh[4]=1;return Sh[mt]=s,s},Ih=function(){},Mh=Ih.prototype;Mh.getPointAt=function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},Mh.getPoints=function(t){t||(t=5);var e,i=[];for(e=0;t>=e;e++)i.push(this.getPoint(e/t));return i},Mh.getSpacedPoints=function(t){t||(t=5);var e,i=[];for(e=0;t>=e;e++)i.push(this.getPointAt(e/t));return i},Mh.getLength=function(){var t=this.getLengths();return t[t.length-1]},Mh.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;t>=i;i++)e=this.getPoint(i/t),o+=e.distanceTo(r),n.push(o),r=e;return this.cacheArcLengths=n,n},Mh.getUtoTmapping=function(t,e){var i,n=this.getLengths(),r=0,o=n.length;i=e||t*n[o-1];for(var a,s=0,l=o-1;l>=s;)if(r=M(s+(l-s)/2),a=n[r]-i,0>a)s=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(r=l,n[r]==i){var c=r/(o-1);return c}var h=n[r],u=n[r+1],d=u-h,f=(i-h)/d;c=(r+f)/(o-1);return c},Mh.getTangent=function(t){var e=1e-4,i=t-e,n=t+e;0>i&&(i=0),n>1&&(n=1);var r=this.getPoint(i),o=this.getPoint(n),a=o.clone().sub(r);return a.normalize()},Mh.getTangentAt=function(t){var e=this.getUtoTmapping(t);return this.getTangent(e)},Ih.create=function(t,e){return t.prototype=_r(Ih.prototype),t.prototype.getPoint=e,t};var Th=function(){this.curves=[],this.autoClose=!1},Eh=Th.prototype=_r(Mh);Eh.add=function(t){this.curves.push(t)},Eh.closePath=function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Wh(e,t))},Eh.getPoint=function(t){for(var e,i,n=t*this.getLength(),r=this.getCurveLengths(),o=0;o<r.length;){if(r[o]>=n){e=r[o]-n,i=this.curves[o];var a=1-e/i.getLength();return i.getPointAt(a)}o++}return null},Eh.getLength=function(){var t=this.getCurveLengths();return t[t.length-1]},Eh.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var t,e=[],i=0,n=this.curves.length;for(t=0;n>t;t++)i+=this.curves[t].getLength(),e.push(i);return this.cacheLengths=e,e},Eh.getTransformedPoints=function(t){return this.getPoints(t)},Eh.getBoundingBox=function(){var t,e,i,n,r,o,a=this.getPoints();t=e=Number.NEGATIVE_INFINITY,n=r=Number.POSITIVE_INFINITY;var s,l,c,h,u=a[0]instanceof mh;for(h=u?new mh:new yh,l=0,c=a.length;c>l;l++)s=a[l],s.x>t&&(t=s.x),s.x<n&&(n=s.x),s.y>e&&(e=s.y),s.y<r&&(r=s.y),u&&(s.z>i&&(i=s.z),s.z<o&&(o=s.z)),h.add(s);var d={minX:n,minY:r,maxX:t,maxY:e};return u&&(d.maxZ=i,d.minZ=o),d};var Ph=function(t){Th.call(this),this.actions=[],t&&this.fromPoints(t)},Dh=Ph.prototype=_r(Th.prototype),Oh="moveTo",Rh="lineTo",zh="quadraticCurveTo",kh="bezierCurveTo",Ah="arc",Vh="ellipse";Dh.fromPoints=function(t){this.moveTo(t[0].x,t[0].y);for(var e=1,i=t.length;i>e;e++)this.lineTo(t[e].x,t[e].y)},Dh.moveTo=function(){var t=Array.prototype.slice.call(arguments);this.actions.push({action:Oh,args:t})},Dh.lineTo=function(t,e){var i=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,r=n[n.length-2],o=n[n.length-1],a=new Wh(new yh(r,o),new yh(t,e));this.curves.push(a),this.actions.push({action:Rh,args:i})},Dh.quadraticCurveTo=function(t,e,i,n){var r=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,a=o[o.length-2],s=o[o.length-1],l=new qh(new yh(a,s),new yh(t,e),new yh(i,n));this.curves.push(l),this.actions.push({action:zh,args:r})},Dh.bezierCurveTo=function(t,e,i,n,r,o){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,l=s[s.length-2],c=s[s.length-1],h=new Xh(new yh(l,c),new yh(t,e),new yh(i,n),new yh(r,o));this.curves.push(h),this.actions.push({action:kh,args:a})},Dh.arc=function(t,e,i,n,r,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],l=a[a.length-1];this.absarc(t+s,e+l,i,n,r,o)},Dh.absarc=function(t,e,i,n,r,o){this.absellipse(t,e,i,i,n,r,o)},Dh.ellipse=function(t,e,i,n,r,o,a){var s=this.actions[this.actions.length-1].args,l=s[s.length-2],c=s[s.length-1];this.absellipse(t+l,e+c,i,n,r,o,a)},Dh.absellipse=function(t,e,i,n,r,o,a){var s=Array.prototype.slice.call(arguments),l=new Uh(t,e,i,n,r,o,a);this.curves.push(l);var c=l.getPoint(1);s.push(c.x),s.push(c.y),this.actions.push({action:Vh,args:s})},Dh.getSpacedPoints=function(t){t||(t=40);for(var e=[],i=0;t>i;i++)e.push(this.getPoint(i/t));return e},Dh.getPoints=function(t,e){t=t||12;var i,n,r,o,a,s,l,c,h,u,f,g,p,v,_,y,m,b,x=[];for(i=0,n=this.actions.length;n>i;i++)switch(r=this.actions[i],o=r.action,a=r.args,o){case Oh:x.push(new yh(a[0],a[1]));break;case Rh:x.push(new yh(a[0],a[1]));break;case zh:for(s=a[2],l=a[3],u=a[0],f=a[1],x.length>0?(v=x[x.length-1],g=v.x,p=v.y):(v=this.actions[i-1].args,g=v[v.length-2],p=v[v.length-1]),_=1;t>=_;_++)y=_/t,m=Fh.b2(y,g,u,s),b=Fh.b2(y,p,f,l),x.push(new yh(m,b));break;case kh:for(s=a[4],l=a[5],u=a[0],f=a[1],c=a[2],h=a[3],x.length>0?(v=x[x.length-1],g=v.x,p=v.y):(v=this.actions[i-1].args,g=v[v.length-2],p=v[v.length-1]),_=1;t>=_;_++)y=_/t,m=Fh.b3(y,g,u,c,s),b=Fh.b3(y,p,f,h,l),x.push(new yh(m,b));break;case Ah:var w=a[0],C=a[1],S=a[2],I=a[3],M=a[4],T=!!a[5],E=M-I,P=2*t;for(_=1;P>=_;_++)y=_/P,T||(y=1-y),D=I+y*E,m=w+S*R(D),b=C+S*k(D),x.push(new yh(m,b));break;case Vh:w=a[0],C=a[1];var D,z=a[2],A=a[3];I=a[4],M=a[5],T=!!a[6],E=M-I,P=2*t;for(_=1;P>=_;_++)y=_/P,T||(y=1-y),D=I+y*E,m=w+z*R(D),b=C+A*k(D),x.push(new yh(m,b))}var V,B,L=d["shape3d.point.epsilon"],F=!1;for(n=x.length,i=0,n=x.length;n>i;i++)V=x[i],B=i===n-1?x[0]:x[i+1],V&&B&&O(V.x-B.x)<L&&O(V.y-B.y)<L&&(F=!0,x[i]=null);if(F){var j=[];for(i=0;n>i;i++)x[i]&&j.push(x[i]);x=j}return e&&x.push(x[0]),x},Dh.toShapes=function(t,e){function n(t){var e,i,n,r,o,a=[],s=new Ph;for(e=0,i=t.length;i>e;e++)n=t[e],o=n.args,r=n.action,r==Oh&&0!=s.actions.length&&(a.push(s),s=new Ph),s[r].apply(s,o);return 0!=s.actions.length&&a.push(s),a}function r(t){for(var e=[],i=0,n=t.length;n>i;i++){var r=t[i],o=new Bh;o.actions=r.actions,o.curves=r.curves,e.push(o)}return e}function o(t,e){for(var i=1e-10,n=e.length,r=!1,o=n-1,a=0;n>a;o=a++){var s=e[o],l=e[a],c=l.x-s.x,h=l.y-s.y;if(O(h)>i){if(0>h&&(s=e[a],c=-c,l=e[o],h=-h),t.y<s.y||t.y>l.y)continue;if(t.y==s.y){if(t.x==s.x)return!0}else{var u=h*(t.x-s.x)-c*(t.y-s.y);if(0==u)return!0;if(0>u)continue;r=!r}}else{if(t.y!=s.y)continue;if(l.x<=t.x&&t.x<=s.x||s.x<=t.x&&t.x<=l.x)return!0}}return r}var a=n(this.actions);if(0==a.length)return[];if(!0===e)return r(a);var s,l,c,h=[];if(1==a.length)return l=a[0],c=new Bh,c.actions=l.actions,c.curves=l.curves,h.push(c),h;var u=!Fh.isClockWise(a[0].getPoints());u=t?!u:u;var d,f,g,p,v,_,y=[],m=[],b=[],x=0;for(m[x]=i,b[x]=[],f=0,g=a.length;g>f;f++)l=a[f],d=l.getPoints(),s=Fh.isClockWise(d),s=t?!s:s,s?(!u&&m[x]&&x++,m[x]={s:new Bh,p:d},m[x].s.actions=l.actions,m[x].s.curves=l.curves,u&&x++,b[x]=[]):b[x].push({h:l,p:d[0]});if(!m[0])return r(a);if(m.length>1){for(var w=!1,C=[],S=0,I=m.length;I>S;S++)y[S]=[];for(S=0,I=m.length;I>S;S++){m[S];for(var M=b[S],T=0;T<M.length;T++){for(var E=M[T],P=!0,D=0;D<m.length;D++)o(E.p,m[D].p)&&(S!=D&&C.push({froms:S,tos:D,hole:T}),P?(P=!1,y[D].push(E)):w=!0);P&&y[S].push(E)}}C.length>0&&(w||(b=y))}for(f=0,g=m.length;g>f;f++)for(c=m[f].s,h.push(c),p=b[f],v=0,_=p.length;_>v;v++)c.holes.push(p[v].h);return h};var Bh=function(){Ph.apply(this,arguments),this.holes=[]},Lh=Bh.prototype=_r(Dh);Lh.getPointsHoles=function(t){var e,i=this.holes.length,n=[];for(e=0;i>e;e++)n[e]=this.holes[e].getTransformedPoints(t);return n},Lh.extractAllPoints=function(t){return{shape:this.getTransformedPoints(t),holes:this.getPointsHoles(t)}},Lh.extractPoints=function(t){return this.extractAllPoints(t)};var Fh={triangulateShape:function(t,e){function n(t,e,i){return t.x!=e.x?t.x<e.x?t.x<=i.x&&i.x<=e.x:e.x<=i.x&&i.x<=t.x:t.y<e.y?t.y<=i.y&&i.y<=e.y:e.y<=i.y&&i.y<=t.y}function r(t,e,i,r,o){var a=1e-10,s=e.x-t.x,l=e.y-t.y,c=r.x-i.x,h=r.y-i.y,u=t.x-i.x,d=t.y-i.y,f=l*c-s*h,g=l*u-s*d;if(O(f)>a){var p;if(f>0){if(0>g||g>f)return[];if(p=h*u-c*d,0>p||p>f)return[]}else{if(g>0||f>g)return[];if(p=h*u-c*d,p>0||f>p)return[]}if(0==p)return!o||0!=g&&g!=f?[t]:[];if(p==f)return!o||0!=g&&g!=f?[e]:[];if(0==g)return[i];if(g==f)return[r];var v=p/f;return[{x:t.x+v*s,y:t.y+v*l}]}if(0!=g||h*u!=c*d)return[];var _,y,m,b,x,w,C,S,I=0==s&&0==l,M=0==c&&0==h;return I&&M?t.x!=i.x||t.y!=i.y?[]:[t]:I?n(i,r,t)?[t]:[]:M?n(t,e,i)?[i]:[]:(0!=s?(t.x<e.x?(_=t,m=t.x,y=e,b=e.x):(_=e,m=e.x,y=t,b=t.x),i.x<r.x?(x=i,C=i.x,w=r,S=r.x):(x=r,C=r.x,w=i,S=i.x)):(t.y<e.y?(_=t,m=t.y,y=e,b=e.y):(_=e,m=e.y,y=t,b=t.y),i.y<r.y?(x=i,C=i.y,w=r,S=r.y):(x=r,C=r.y,w=i,S=i.y)),C>=m?C>b?[]:b==C?o?[]:[x]:S>=b?[x,y]:[x,w]:m>S?[]:m==S?o?[]:[_]:S>=b?[_,y]:[_,w])}function o(t,e,i,n){var r=1e-10,o=e.x-t.x,a=e.y-t.y,s=i.x-t.x,l=i.y-t.y,c=n.x-t.x,h=n.y-t.y,u=o*l-a*s,d=o*h-a*c;if(O(u)>r){var f=c*l-h*s;return u>0?d>=0&&f>=0:d>=0||f>=0}return d>0}function a(t,e){function n(t,e){var i=m.length-1,n=t-1;0>n&&(n=i);var r=t+1;r>i&&(r=0);var a=o(m[t],m[n],m[r],l[e]);if(!a)return!1;var s=l.length-1,c=e-1;0>c&&(c=s);var h=e+1;return h>s&&(h=0),a=o(l[e],l[c],l[h],m[t]),!!a}function a(t,e){var i,n,o;for(i=0;i<m.length;i++)if(n=i+1,n%=m.length,o=r(t,e,m[i],m[n],!0),o.length>0)return!0;return!1}function s(t,i){var n,o,a,s,l;for(n=0;n<b.length;n++)for(o=e[b[n]],a=0;a<o.length;a++)if(s=a+1,s%=o.length,l=r(t,i,o[a],o[s],!0),l.length>0)return!0;return!1}for(var l,c,h,u,d,f,g,p,v,_,y,m=t.concat(),b=[],x=[],w=0,C=e.length;C>w;w++)b.push(w);for(var S=0,I=2*b.length;b.length>0&&(I--,!(0>I));)for(h=S;h<m.length;h++){u=m[h],c=-1;for(w=0;w<b.length;w++)if(f=b[w],g=u.x+":"+u.y+":"+f,x[g]===i){l=e[f];for(var M=0;M<l.length;M++)if(d=l[M],n(h,M)&&!a(u,d)&&!s(u,d)){c=M,b.splice(w,1),p=m.slice(0,h+1),v=m.slice(h),_=l.slice(c),y=l.slice(0,c+1),m=p.concat(_).concat(y).concat(v),S=h;break}if(c>=0)break;x[g]=!0}if(c>=0)break}return m}for(var s,l,c,h,u,d,f={},g=t.concat(),p=0,v=e.length;v>p;p++)Array.prototype.push.apply(g,e[p]);for(s=0,l=g.length;l>s;s++)u=g[s].x+":"+g[s].y,f[u],f[u]=s;var _=a(t,e),y=jh.Triangulate(_,!1);for(s=0,l=y.length;l>s;s++)for(h=y[s],c=0;3>c;c++)u=h[c].x+":"+h[c].y,d=f[u],d!==i&&(h[c]=d);return y.concat()},isClockWise:function(t){return jh.Triangulate.area(t)<0},b2p0:function(t,e){var i=1-t;return i*i*e},b2p1:function(t,e){return 2*(1-t)*t*e},b2p2:function(t,e){return t*t*e},b2:function(t,e,i,n){return this.b2p0(t,e)+this.b2p1(t,i)+this.b2p2(t,n)},b3p0:function(t,e){var i=1-t;return i*i*i*e},b3p1:function(t,e){var i=1-t;return 3*i*i*t*e},b3p2:function(t,e){var i=1-t;return 3*i*t*t*e},b3p3:function(t,e){return t*t*t*e},b3:function(t,e,i,n,r){return this.b3p0(t,e)+this.b3p1(t,i)+this.b3p2(t,n)+this.b3p3(t,r)}},jh={faces:{},face:"",weight:"normal",style:"normal",size:150,divisions:10,getDefaultFont:function(){var t=e.keys(this.faces);return t.length?t[0]:null},getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(A){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(t){var e=t.familyName.toLowerCase(),i=this;return i.faces[e]=i.faces[e]||{},i.faces[e][t.cssFontWeight]=i.faces[e][t.cssFontWeight]||{},i.faces[e][t.cssFontWeight][t.cssFontStyle]=t,t},drawText:function(t){var e,i=this.getFace(),n=this.size/i.resolution,r=0,o=String(t).split(""),a=o.length,s=[];for(e=0;a>e;e++){var l=new Ph,c=this.extractGlyphPoints(o[e],i,n,r,l);c&&(r+=c.offset*this.spacing,s.push(c.path))}var h=r/2;return{paths:s,offset:h}},extractGlyphPoints:function(t,e,i,n,r){var o,a,s,l,c,h,u,d,f,g,p,v,_,y,m,b,x,w,C=[],S=e.glyphs[t]||e.glyphs["?"];if(S){if(S.o)for(l=S._cachedOutline||(S._cachedOutline=S.o.split(" ")),c=l.length,h=i,u=i,o=0;c>o;)switch(l[o++]){case"m":d=l[o++]*h+n,f=l[o++]*u,r.moveTo(d,f);break;case"l":d=l[o++]*h+n,f=l[o++]*u,r.lineTo(d,f);break;case"q":if(g=l[o++]*h+n,p=l[o++]*u,y=l[o++]*h+n,m=l[o++]*u,r.quadraticCurveTo(y,m,g,p),w=C[C.length-1])for(v=w.x,_=w.y,a=1,s=this.divisions;s>=a;a++){var I=a/s;Fh.b2(I,v,y,g),Fh.b2(I,_,m,p)}break;case"b":if(g=l[o++]*h+n,p=l[o++]*u,y=l[o++]*h+n,m=l[o++]*u,b=l[o++]*h+n,x=l[o++]*u,r.bezierCurveTo(y,m,b,x,g,p),w=C[C.length-1])for(v=w.x,_=w.y,a=1,s=this.divisions;s>=a;a++){I=a/s;Fh.b3(I,v,y,b,g),Fh.b3(I,_,m,x,p)}}return{offset:S.ha*i,path:r}}},generateShapes:function(t,e){e=e||{};var n=e.font;if(n===i&&(n=jh.getDefaultFont(),!n))return console.log("There's no valid font face, use ht.Default.loadFontFace to load font first."),[];var r=e.size!==i?e.size:1,o=e.curveSegments!==i?e.curveSegments:4,a=e.spacing!==i?e.spacing:1,s=e.weight!==i?e.weight:"normal",l=e.style!==i?e.style:"normal";jh.size=r,jh.divisions=o,jh.face=n,jh.weight=s,jh.style=l,jh.spacing=a;for(var c=jh.drawText(t),h=c.paths,u=[],d=0,f=h.length;f>d;d++)Array.prototype.push.apply(u,h[d].toShapes());return u}};(function(t){var e=1e-10,i=function(t,e){var i=t.length;if(3>i)return null;var o,a,s,l=[],c=[],h=[];if(n(t)>0)for(a=0;i>a;a++)c[a]=a;else for(a=0;i>a;a++)c[a]=i-1-a;var u=i,d=2*u;for(a=u-1;u>2;){if(d--<=0)return e?h:l;if(o=a,o>=u&&(o=0),a=o+1,a>=u&&(a=0),s=a+1,s>=u&&(s=0),r(t,o,a,s,u,c)){var f,g,p,v,_;for(f=c[o],g=c[a],p=c[s],l.push([t[f],t[g],t[p]]),h.push([c[o],c[a],c[s]]),v=a,_=a+1;u>_;v++,_++)c[v]=c[_];u--,d=2*u}}return e?h:l},n=function(t){for(var e=t.length,i=0,n=e-1,r=0;e>r;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i},r=function(t,i,n,r,o,a){var s,l,c,h,u,d,f,g,p,v,_,y,m,b,x,w,C,S,I,M,T,E,P,D;if(l=t[a[i]].x,c=t[a[i]].y,h=t[a[n]].x,u=t[a[n]].y,d=t[a[r]].x,f=t[a[r]].y,e>(h-l)*(f-c)-(u-c)*(d-l))return!1;for(v=d-h,_=f-u,y=l-d,m=c-f,b=h-l,x=u-c,s=0;o>s;s++)if(g=t[a[s]].x,p=t[a[s]].y,!(g===l&&p===c||g===h&&p===u||g===d&&p===f)&&(w=g-l,C=p-c,S=g-h,I=p-u,M=g-d,T=p-f,D=v*I-_*S,E=b*C-x*w,P=y*T-m*M,D>=-e&&P>=-e&&E>=-e))return!1;return!0};t.Triangulate=i,t.Triangulate.area=n})(jh),t._typeface_js={faces:jh.faces,loadFace:jh.loadFace};var Hh=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]},Gh=Hh.prototype={constructor:Hh,computeFaceNormals:function(){for(var t=new mh,e=new mh,i=0,n=this.faces.length;n>i;i++){var r=this.faces[i],o=this.vertices[r.a],a=this.vertices[r.b],s=this.vertices[r.c];t.subVectors(s,a),e.subVectors(o,a),t.cross(e),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t){var e,i,n,r,o,a;for(a=new Array(this.vertices.length),e=0,i=this.vertices.length;i>e;e++)a[e]=new mh;if(t){var s,l,c,h=new mh,u=new mh;for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],s=this.vertices[o.a],l=this.vertices[o.b],c=this.vertices[o.c],h.subVectors(c,l),u.subVectors(s,l),h.cross(u),a[o.a].add(h),a[o.b].add(h),a[o.c].add(h)}else for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],a[o.a].add(o.normal),a[o.b].add(o.normal),a[o.c].add(o.normal);for(e=0,i=this.vertices.length;i>e;e++)a[e].normalize();for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],o.vertexNormals[0]=a[o.a].clone(),o.vertexNormals[1]=a[o.b].clone(),o.vertexNormals[2]=a[o.c].clone()},mergeVertices:function(){var t,e,n,r,o,a,s,l,c={},h=[],u=[],d=4,f=A(10,d);for(n=0,r=this.vertices.length;r>n;n++)t=this.vertices[n],e=I(t.x*f)+"_"+I(t.y*f)+"_"+I(t.z*f),c[e]===i?(c[e]=n,h.push(this.vertices[n]),u[n]=h.length-1):u[n]=u[c[e]];var g=[];for(n=0,r=this.faces.length;r>n;n++){o=this.faces[n],o.a=u[o.a],o.b=u[o.b],o.c=u[o.c],a=[o.a,o.b,o.c];for(var p=0;3>p;p++)if(a[p]==a[(p+1)%3]){g.push(n);break}}for(n=g.length-1;n>=0;n--){var v=g[n];for(this.faces.splice(v,1),s=0,l=this.faceVertexUvs.length;l>s;s++)this.faceVertexUvs[s].splice(v,1)}var _=this.vertices.length-h.length;return this.vertices=h,_}},Uh=function(t,e,i,n,r,o,a){this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a};Uh.prototype=_r(Mh),Uh.prototype.getPoint=function(t){var e,i=this.aEndAngle-this.aStartAngle;0>i&&(i+=F),i>F&&(i-=F),e=!0===this.aClockwise?this.aEndAngle+(1-t)*(F-i):this.aStartAngle+t*i;var n=this.aX+this.xRadius*R(e),r=this.aY+this.yRadius*k(e);return new yh(n,r)};var Wh=function(t,e){this.v1=t,this.v2=e},Nh=Wh.prototype=_r(Mh);Nh.getPoint=function(t){var e=this.v2.clone().sub(this.v1);return e.multiplyScalar(t).add(this.v1),e},Nh.getPointAt=function(t){return this.getPoint(t)},Nh.getTangent=function(){var t=this.v2.clone().sub(this.v1);return t.normalize()};var qh=function(t,e,i){this.v0=t,this.v1=e,this.v2=i};qh.prototype=_r(Mh),qh.prototype.getPoint=function(t){var e,i;return e=Fh.b2(t,this.v0.x,this.v1.x,this.v2.x),i=Fh.b2(t,this.v0.y,this.v1.y,this.v2.y),new yh(e,i)};var Xh=function(t,e,i,n){this.v0=t,this.v1=e,this.v2=i,this.v3=n};Xh.prototype=_r(Mh),Xh.prototype.getPoint=function(t){var e,i;return e=Fh.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=Fh.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new yh(e,i)},Ih.create((function(t,e){this.v1=t,this.v2=e}),(function(t){var e=new mh;return e.subVectors(this.v2,this.v1),e.multiplyScalar(t),e.add(this.v1),e}));var Qh=Ih.create((function(t,e,i){this.v0=t,this.v1=e,this.v2=i}),(function(t){var e,i,n;return e=Fh.b2(t,this.v0.x,this.v1.x,this.v2.x),i=Fh.b2(t,this.v0.y,this.v1.y,this.v2.y),n=Fh.b2(t,this.v0.z,this.v1.z,this.v2.z),new mh(e,i,n)})),Yh=Ih.create((function(t,e,i,n){this.v0=t,this.v1=e,this.v2=i,this.v3=n}),(function(t){var e,i,n;return e=Fh.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=Fh.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),n=Fh.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new mh(e,i,n)})),Zh=function(t,e,n,r,o,a,s,l){Hh.call(this),r=r!==i?r:.5,o=o!==i?o:.5,l=l!==i?l:1,t=t||8,a=a||0,s=s||F;var c,h,u=1,d=l/2,f=[],g=[],p=this.vertices,v=this.faces,_=this.faceVertexUvs;for(h=0;u>=h;h++){var y=[],m=[],b=h/u,x=b*(o-r)+r;for(c=0;t>=c;c++){var w=c/t,C=new mh,S=-(w*s+a);C.z=x*k(S),C.y=-b*l+d,C.x=x*R(S),p.push(C),y.push(p.length-1),m.push(new yh(w,b))}f.push(y),g.push(m)}var I,M,T=(o-r)/l;for(c=0;t>c;c++)for(0!==r?(I=p[f[0][c]].clone(),M=p[f[0][c+1]].clone()):(I=p[f[1][c]].clone(),M=p[f[1][c+1]].clone()),I.setY(E(I.x*I.x+I.z*I.z)*T).normalize(),M.setY(E(M.x*M.x+M.z*M.z)*T).normalize(),h=0;u>h;h++){var P=f[h][c],D=f[h+1][c],O=f[h+1][c+1],z=f[h][c+1],A=I.clone(),V=I.clone(),B=M.clone(),L=M.clone(),j=g[h][c].clone(),H=g[h+1][c].clone(),G=g[h+1][c+1].clone(),U=g[h][c+1].clone();v.push(new wh(P,D,z,[A,V,L])),_[0].push([j,H,U]),v.push(new wh(D,O,z,[V.clone(),B,L.clone()])),_[0].push([H.clone(),G,U.clone()])}if(e&&r>0)for(this.vertices.push(new mh(0,d,0)),c=0;t>c;c++){P=f[0][c],D=f[0][c+1],O=this.vertices.length-1,A=new mh(0,1,0),V=new mh(0,1,0),B=new mh(0,1,0),j=g[0][c].clone(),H=g[0][c+1].clone(),G=new yh(H.x,0);v.push(new wh(P,D,O,[A,V,B],null,1));var W=c/t*F,N=R(W),q=k(W),X=(c+1)/t*F,Q=R(X),Y=k(X);_[0].push([new yh(.5+.5*N,.5+.5*q),new yh(.5+.5*Q,.5+.5*Y),new yh(.5,.5)])}if(n&&o>0)for(this.vertices.push(new mh(0,-d,0)),c=0;t>c;c++){P=f[h][c+1],D=f[h][c],O=p.length-1,A=new mh(0,-1,0),V=new mh(0,-1,0),B=new mh(0,-1,0),j=g[h][c+1].clone(),H=g[h][c].clone();v.push(new wh(P,D,O,[A,V,B],null,2));W=c/t*F,N=R(W),q=k(W),X=(c+1)/t*F,Q=R(X),Y=k(X);_[0].push([new yh(.5+.5*Q,.5-.5*Y),new yh(.5+.5*N,.5-.5*q),new yh(.5,.5)])}};Zh.prototype=_r(Gh);var Jh=function(t,e,n,r,o,a,s){Hh.call(this),s=s||.5,t=t||16,e=e||16,n=(n!==i?n:0)-L,r=r!==i?r:F,o=o!==i?o:0,a=a!==i?a:L;var l,c,h=[],u=[],d=this.vertices,f=this.faces,g=this.faceVertexUvs;for(c=0;e>=c;c++){var p=[],v=[];for(l=0;t>=l;l++){var _=l/t,y=c/e,m=new mh;m.x=-s*R(n+_*r)*k(o+y*a),m.y=s*R(o+y*a),m.z=s*k(n+_*r)*k(o+y*a),d.push(m),p.push(d.length-1),v.push(new yh(_,y))}h.push(p),u.push(v)}for(c=0;e>c;c++)for(l=0;t>l;l++){var b=h[c][l+1],x=h[c][l],w=h[c+1][l],C=h[c+1][l+1],S=d[b].clone().normalize(),I=d[x].clone().normalize(),M=d[w].clone().normalize(),T=d[C].clone().normalize(),E=u[c][l+1].clone(),P=u[c][l].clone(),D=u[c+1][l].clone(),z=u[c+1][l+1].clone();O(d[b].y)===s?(E.x=(E.x+P.x)/2,f.push(new wh(b,w,C,[S,M,T])),g[0].push([E,D,z])):O(d[w].y)===s?(D.x=(D.x+z.x)/2,f.push(new wh(b,x,w,[S,I,M])),g[0].push([E,P,D])):(f.push(new wh(b,x,C,[S,I,T])),g[0].push([E,P,z]),f.push(new wh(x,w,C,[I.clone(),M,T.clone()])),g[0].push([P.clone(),D,z.clone()]))}};Jh.prototype=_r(Gh);var Kh=function(t,e,i,n,r,o){Hh.call(this),t=t||.33,e=e||.17,n=n||8,i=i||6,r=r||0,o=o||F;for(var a=new mh,s=[],l=[],c=0;n>=c;c++)for(var h=c/n*F+L,u=0;i>=u;u++){var d=u/i*o+r;a.x=t*R(d),a.z=-t*k(d);var f=new mh,g=t+e*R(h);f.x=g*R(d),f.z=-g*k(d),f.y=e*k(h),this.vertices.push(f),s.push(new yh(u/i,1-c/n)),l.push(f.clone().sub(a).normalize())}for(c=1;n>=c;c++)for(u=1;i>=u;u++){var p=(i+1)*c+u-1,v=(i+1)*(c-1)+u-1,_=(i+1)*(c-1)+u,y=(i+1)*c+u,m=new wh(p,v,y,[l[p].clone(),l[v].clone(),l[y].clone()]);this.faces.push(m),this.faceVertexUvs[0].push([s[p].clone(),s[v].clone(),s[y].clone()]),m=new wh(v,_,y,[l[v].clone(),l[_].clone(),l[y].clone()]),this.faces.push(m),this.faceVertexUvs[0].push([s[v].clone(),s[_].clone(),s[y].clone()])}this.computeFaceNormals()};Kh.prototype=_r(Gh);var $h=function(t,e,i){return t?(Hh.call(this),t=t instanceof Array?t:[t],this.addShapeList(t,e),!1!==e.convertYZ&&dh(this,i),void this.computeFaceNormals()):void(t=[])},tu=$h.prototype=_r(Hh.prototype);tu.addShapeList=function(t,e){for(var i=t.length,n=0;i>n;n++){var r=t[n];this.addShape(r,e)}},tu.addShape=function(t,e){function n(){if(e.bottom)for(var t=0;A>t;t++)z=D[t],s(z[2],z[1],z[0],!0);if(e.top)for(t=0;A>t;t++)z=D[t],s(z[0]+k*v,z[1]+k*v,z[2]+k*v,!1)}function r(){var t=0;for(o(O,t),t+=O.length,x=0,w=T.length;w>x;x++)b=T[x],o(b,t),t+=b.length}function o(t,e){for(var i,n,r=t.length;--r>=0;){i=r,n=r-1,0>n&&(n=t.length-1);var o=0,a=v;for(o=0;a>o;o++){var s=k*o,c=k*(o+1),h=e+i+s,u=e+n+s,d=e+n+c,f=e+i+c;l(h,u,d,f,t,o,a,i,n)}}}function a(t,e,i){C.vertices.push(new mh(t,e,i))}function s(i,n,r,o){i+=S,n+=S,r+=S,C.faces.push(new wh(i,n,r,null,null,o?2:1));var a=o?m.generateBottomUV(C,t,e,i,n,r):m.generateTopUV(C,t,e,i,n,r);C.faceVertexUvs[0].push(a)}function l(i,n,r,o,a,s,l,c,h){i+=S,n+=S,r+=S,o+=S,C.faces.push(new wh(i,n,o)),C.faces.push(new wh(n,r,o));var u=m.generateSideWallUV(C,t,a,e,i,n,r,o,s,l,c,h);C.faceVertexUvs[0].push([u[0],u[1],u[3]]),C.faceVertexUvs[0].push([u[1],u[2],u[3]])}var c,h,u,d,f,g=e.amount,p=e.curveSegments||yl,v=e.steps||1,_=e.extrudePath,y=!1,m=new xh(e.repeatUVLength);_&&(c=_.getSpacedPoints(v),y=!0,h=e.frames!==i?e.frames:new eu.FrenetFrames(_,v,!1),u=new mh,d=new mh,f=new mh);var b,x,w,C=this,S=this.vertices.length,I=t.extractPoints(p),M=I.shape,T=I.holes,E=!Fh.isClockWise(M);if(E){for(M=M.reverse(),x=0,w=T.length;w>x;x++)b=T[x],Fh.isClockWise(b)&&(T[x]=b.reverse());E=!1}var P,D=Fh.triangulateShape(M,T),O=M;for(x=0,w=T.length;w>x;x++)b=T[x],M=M.concat(b);for(var R,z,k=M.length,A=D.length,V=0;k>V;V++)R=M[V],y?(d.copy(h.normals[0]).multiplyScalar(R.x),u.copy(h.binormals[0]).multiplyScalar(R.y),f.copy(c[0]).add(d).add(u),a(f.x,f.y,f.z)):a(R.x,R.y,0);for(P=1;v>=P;P++)for(V=0;k>V;V++)R=M[V],y?(d.copy(h.normals[P]).multiplyScalar(R.x),u.copy(h.binormals[P]).multiplyScalar(R.y),f.copy(c[P]).add(d).add(u),a(f.x,f.y,f.z)):a(R.x,R.y,g/v*P);n(),r()};var eu=function(t,e,i,n,r){function o(t,e,i){return M.vertices.push(new mh(t,e,i))-1}Hh.call(this),e=e||64,i=i||1,n=n||8,r=r||!1;var a,s,l,c,h,u,d,f,g,p,v,_,y,m,b,x,w,C,S,I=[],M=this,T=e+1,E=new mh,P=new eu.FrenetFrames(t,e,r),D=P.tangents,O=P.normals,z=P.binormals;for(this.tangents=D,this.normals=O,this.binormals=z,f=0;T>f;f++)for(I[f]=[],l=f/(T-1),d=t.getPointAt(l),D[f],a=O[f],s=z[f],g=0;n>g;g++)c=g/n*F,h=-i*R(c),u=i*k(c),E.copy(d),E.x+=h*a.x+u*s.x,E.y+=h*a.y+u*s.y,E.z+=h*a.z+u*s.z,I[f][g]=o(E.x,E.y,E.z);for(f=0;e>f;f++)for(g=0;n>g;g++)p=r?(f+1)%e:f+1,v=(g+1)%n,_=I[f][g],y=I[p][g],m=I[p][v],b=I[f][v],x=new yh(f/e,g/n),w=new yh((f+1)/e,g/n),C=new yh((f+1)/e,(g+1)/n),S=new yh(f/e,(g+1)/n),this.faces.push(new wh(_,y,b)),this.faceVertexUvs[0].push([x,w,S]),this.faces.push(new wh(y,m,b)),this.faceVertexUvs[0].push([w.clone(),C,S.clone()]);this.computeFaceNormals(),this.computeVertexNormals()};eu.prototype=_r(Gh),eu.FrenetFrames=function(t,e,i){function n(){f[0]=new mh,g[0]=new mh,o=Number.MAX_VALUE,a=O(d[0].x),s=O(d[0].y),l=O(d[0].z),o>=a&&(o=a,u.set(1,0,0)),o>=s&&(o=s,u.set(0,1,0)),o>=l&&u.set(0,0,1),p.crossVectors(d[0],u).normalize(),f[0].crossVectors(d[0],p),g[0].crossVectors(d[0],f[0])}var r,o,a,s,l,c,h,u=new mh,d=[],f=[],g=[],p=new mh,v=new bh,_=e+1,y=1e-4;for(this.tangents=d,this.normals=f,this.binormals=g,c=0;_>c;c++)h=c/(_-1),d[c]=t.getTangentAt(h),d[c].normalize();for(n(),c=1;_>c;c++)f[c]=f[c-1].clone(),g[c]=g[c-1].clone(),p.crossVectors(d[c-1],d[c]),p.length()>y&&(p.normalize(),r=z(ir(d[c-1].dot(d[c]),-1,1)),f[c].applyMatrix4(v.makeRotationAxis(p,r))),g[c].crossVectors(d[c],f[c]);if(i)for(r=z(ir(f[0].dot(f[_-1]),-1,1)),r/=_-1,d[0].dot(p.crossVectors(f[0],f[_-1]))>0&&(r=-r),c=1;_>c;c++)f[c].applyMatrix4(v.makeRotationAxis(d[c],r*c)),g[c].crossVectors(d[c],f[c])};var iu=function(t,e,i,n){Hh.call(this),e=e||18,i=i||0,n=n==l?F:n;for(var r=1/(t.length-1),o=1/e,a=0,s=e;s>=a;a++)for(var c=i+a*o*n,h=R(c),u=k(c),d=0,f=t.length;f>d;d++){var g=t[d],p=new mh;p.x=h*g.x-u*g.y,p.y=u*g.x+h*g.y,p.z=g.z,this.vertices.push(p)}var v=t.length;for(a=0,s=e;s>a;a++)for(d=0,f=t.length-1;f>d;d++){var _=d+v*a,y=_,m=_+v,b=(h=_+1+v,_+1),x=a*o,w=d*r,C=x+o,S=w+r;this.faces.push(new wh(y,b,m)),this.faceVertexUvs[0].push([new yh(x,w),new yh(x,S),new yh(C,w)]),this.faces.push(new wh(m,b,h)),this.faceVertexUvs[0].push([new yh(C,w),new yh(x,S),new yh(C,S)])}this.mergeVertices(),dh(this),this.computeFaceNormals(),this.computeVertexNormals()};iu.prototype=_r(Gh);var nu=function(t,e){e=e||{};var n=jh.generateShapes(t,e);e.amount=e.amount!==i?e.amount:.5,e.convertYZ=!1,!1!==e.fill&&(e.bottom=!0,e.top=!0),$h.call(this,n,e)};nu.prototype=_r(tu);var ru=c.Node=function(){Kn(ru,this)},ou={X:Bl,Y:Ll,Z:Fl},au={X:0,Y:1,Z:2},su={xyz:"XYZ",xzy:"XZY",yxz:"YXZ",yzx:"YZX",zxy:"ZXY",zyx:"ZYX"},lu="xzy",cu=function(t,e,i){if(e){var n=e[0],r=e[1],o=e[2];"xzy"===i?(Ll(t,r),Fl(t,o),Bl(t,n)):"xyz"===i?(Fl(t,o),Ll(t,r),Bl(t,n)):"yxz"===i?(Fl(t,o),Bl(t,n),Ll(t,r)):"yzx"===i?(Bl(t,n),Fl(t,o),Ll(t,r)):"zxy"===i?(Ll(t,r),Bl(t,n),Fl(t,o)):"zyx"===i?(Bl(t,n),Ll(t,r),Fl(t,o)):(Ll(t,r),Fl(t,o),Bl(t,n))}};xl("Node",_c,{ms_ac:["rotationMode","anchorElevation"],ms_edge:!0,_adjustChildrenToTop:!0,_icon:"node_icon",_image:"node_image",_rotationMode:lu,_64O:0,_rotationX:0,_53O:0,_host:l,_position:{x:0,y:0},_anchor:{x:.5,y:.5},_anchorElevation:.5,_scale:{x:1,y:1},_scaleTall:1,_54O:0,getUIClass:function(){return Su},_22Q:function(){return Cv},getX:function(){return this.p().x},setX:function(t){this.p(t,this.p().y)},getY:function(){return this.p().y},setY:function(t){this.p(this.p().x,t)},getAnchorX:function(){return this.getAnchor().x},setAnchorX:function(t){this.setAnchor(t,this.getAnchor().y)},getAnchorY:function(){return this.getAnchor().y},setAnchorY:function(t){this.setAnchor(this.getAnchor().x,t)},getScaleX:function(){return this.getScale().x},setScaleX:function(t){this.setScale(t,this.getScale().y)},getScaleY:function(){return this.getScale().y},setScaleY:function(t){this.setScale(this.getScale().x,t)},p:function(){return 0===arguments.length?this.getPosition():(this.setPosition.apply(this,arguments),this)},p3:function(){return 0===arguments.length?this.getPosition3d():(this.setPosition3d.apply(this,arguments),this)},s3:function(){return 0===arguments.length?this.getSize3d():(this.setSize3d.apply(this,arguments),this)},r3:function(){return 0===arguments.length?this.getRotation3d():(this.setRotation3d.apply(this,arguments),this)},t3:function(){return this.translate3d.apply(this,arguments),this},translate3dBy:function(t,e){kl(t,Hl(l,l,this.r3(),this.getRotationMode())),this.translate3d(t[0]*e,t[1]*e,t[2]*e)},translateFront:function(t){this.translate3dBy([0,0,1],t)},translateBack:function(t){this.translate3dBy([0,0,-1],t)},translateLeft:function(t){this.translate3dBy([-1,0,0],t)},translateRight:function(t){this.translate3dBy([1,0,0],t)},translateTop:function(t){this.translate3dBy([0,1,0],t)},translateBottom:function(t){this.translate3dBy([0,-1,0],t)},getPosition3d:function(){return[this._position.x,this._54O,this._position.y]},setPosition3d:function(t,e,i){1===arguments.length&&(e=t[1],i=t[2],t=t[0]),this.p(t,i),this.setElevation(e)},translate3d:function(t,e,i){1===arguments.length&&(e=t[1],i=t[2],t=t[0]),this.translate(t,i),this.setElevation(this._54O+e)},getSize3d:function(){return[this.getWidth(),this.getTall(),this.getHeight()]},setSize3d:function(t,e,i){1===arguments.length&&(e=t[1],i=t[2],t=t[0]),this.setSize(t,i),this.setTall(e)},getRotation3d:function(){return[this._rotationX,-this._64O,this._53O]},setRotation3d:function(t,e,i){1===arguments.length&&(e=t[1],i=t[2],t=t[0]),this.setRotationX(t),this.setRotation(-e),this.setRotationZ(i)},setRotationY:function(t){this.setRotation(-t)},getRotationY:function(){return-this._64O},lookAtDirection:function(t,e){e=e||dt;var i=this,n=nl(t);e===dt?(i.r3([-V(t[1]/n),-G(t[2],t[0])+j,0]),i.setRotationMode("xzy")):e===pt?(i.r3(0,-G(t[2],t[0]),V(t[1]/n)),i.setRotationMode("zyx")):e===gt?(i.r3(0,-G(t[2],t[0])+L,-V(t[1]/n)),i.setRotationMode("zyx")):e===vt?(i.r3([-V(t[1]/n)+j,-G(t[2],t[0])+j,0]),i.setRotationMode("xzy")):e===_t&&(i.r3([-V(t[1]/n)-j,-G(t[2],t[0])+j,0]),i.setRotationMode("xzy")),e===ft&&(i.r3([-V(t[1]/n)+L,-G(t[2],t[0])+j,L]),i.setRotationMode("zxy"))},lookAt:function(t,e){return this.lookAtDirection(Ml(t,this.p3()),e)},lookAtX:function(){var t=new Na,e=new Na,i=new Na,n=new Ka,r=new Ka,o=new ts;return function(a,s){var l=jl(this);if(n.fromArray(l),i.copy(this.p3()),t.copy(a).sub(i),!(t.lengthSq()<1e-6)){t.normalize(),s===dt?e.set(0,0,1):s===ft?e.set(0,0,-1):s===gt?e.set(-1,0,0):s===pt?e.set(1,0,0):s===vt?e.set(0,1,0):s===_t&&e.set(0,-1,0),e.applyMatrix4(n).sub(i).normalize();var c=Math.acos(t.dot(e));if(c){var h=t.clone().cross(e);h.lengthSq()<1e-6&&(s===vt||s===_t?h.set(0,0,1).applyMatrix4(n).sub(i):h.set(0,1,0).applyMatrix4(n).sub(i)),h.normalize(),o.set(this.r3(),this.getRotationMode(),!0),n.makeRotationFromEuler(o),r.makeRotationAxis(h,-c),o.setFromRotationMatrix(r.multiply(n)),this.r3([o.x,o.y,o.z])}}}}(),getHost:function(){return this._host},setHost:function(t){var e=this;if(e!==t&&e._host!==t){var i=e._host;i&&i._removeAttach(e),e._host=t,e._host&&e._host._addAttach(e),e.fp("host",i,t),e.onHostChanged(i,t)}},getAttaches:function(){return this._69O},_addAttach:function(t){var e=this;e._69O||(e._69O=new gc),e._69O.add(t),e.fp("attaches",l,t)},_removeAttach:function(t){var e=this;e._69O.remove(t),e._69O.isEmpty()&&delete e._69O,e.fp("attaches",t,l)},getImage:function(){if(this._pendingCheckImageJSON){var t=u.getImage(this._image);t&&(this._pendingCheckImageJSON=!1,this.getParent()instanceof yu&&this.getParent().checkPendingUpdateInfo())}return this._image},setImage:function(t){var e=this,i=e._image,n=e.getWidth(),r=e.getHeight();e._image=t,e.fp("image",i,t)&&(null!=t&&(kn(t)||On(t)&&/\.json$/i.test(t))&&(this._pendingCheckImageJSON=!0),e.fp(Bt,n,e.getWidth()),e.fp(Lt,r,e.getHeight()))},getElevation:function(){return this._54O},setElevation:function(t){var e=this;if(!e._50O){e._50O=1;var i=e._54O;e._54O=t,e.fp(Le,i,t),delete this._50O}},getRotation:function(){return this._64O},setRotation:function(t){var e=this;if(!e._49O){e._49O=1;var i=e._64O;e._64O=t,e.fp(le,i,t),delete e._49O}},getRotationX:function(){return this._rotationX},setRotationX:function(t){var e=this;if(!e._51O){e._51O=1;var i=e._rotationX;e._rotationX=t,e.fp("rotationX",i,t),delete e._51O}},getRotationZ:function(){return this._53O},setRotationZ:function(t){var e=this;if(!e._52O){e._52O=1;var i=e._53O;e._53O=t,e.fp("rotationZ",i,t),delete e._52O}},getPosition:function(){return this._position},setPosition:function(t,e){var i=this;if(!i._50I){var n;if(i._50I=1,n=2===arguments.length?{x:t,y:e}:t,n.x!==i._position.x||n.y!==i._position.y){var r=i._position;i._position=n,i.fp(Be,r,n)}delete i._50I}},translate:function(t,e){var i=this._position;this.p(i.x+t,i.y+e)},getWidth:function(){var t=this;if(t._width>=0)return t._width;var e=t.getStyle("shape3d");if(e){var i=Fd(e);if(i&&i.rawS3)return i.rawS3[0];if("billboard"===e||"plane"===e){var n=zs(t.getStyle("shape3d.image"));return n?hc(n,t):20}}n=zs(t._image);return n?hc(n,t):20},setWidth:function(t){var e=this,i=e._width;e._width=t,e.fp(Bt,i,t)},getHeight:function(){var t=this;if(t._height>=0)return t._height;var e=t.getStyle("shape3d");if(e){var i=Fd(e);if(i&&i.rawS3)return i.rawS3[2];if("plane"===e){var n=zs(t.getStyle("shape3d.image"));return n?uc(n,t):20}if("billboard"===e)return 2}n=zs(t._image);return n?uc(n,t):20},setHeight:function(t){var e=this,i=e._height;e._height=t,e.fp(Lt,i,t)},getTall:function(){var t=this;if(t._tall>=0)return t._tall;var e=t.getStyle("shape3d");if(e){var i=Fd(e);if(i&&i.rawS3)return i.rawS3[1];if("billboard"===e){var n=zs(t.getStyle("shape3d.image"));return n?uc(n,t):20}if("plane"===e)return 2}return 20},setTall:function(t){var e=this,i=e._tall;e._tall=t,e.fp("tall",i,t)},setSize:function(t,e){var i=this;2===arguments.length?(i.setWidth(t),i.setHeight(e)):(i.setWidth(t.width),i.setHeight(t.height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},setRect:function(t,e,i,n,r){var o=this,a=o.getAnchor(),s=o.getScale();arguments.length<=2&&(r=e,e=t.y,i=t.width,n=t.height,t=t.x);var l=r&&s.x<0?1-a.x:a.x,c=r&&s.y<0?1-a.y:a.y;o.p(t+i*l,e+n*c),r&&(i/=Math.abs(s.x),n/=Math.abs(s.y)),o.setWidth(i),o.setHeight(n)},getMatrix:function(){var t=this,e=t._64O,i=t._position,n=t.getScale();return new Ga(e,i.x,i.y,n.x,n.y)},getAnchorRect:function(){var t=this,e=t.getWidth(),i=t.getHeight(),n=t.getAnchor();return{x:-e*n.x,y:-i*n.y,width:e,height:i}},toLocal:function(t){return this.getMatrix().tfi(t)},toGlobal:function(t){return this.getMatrix().tf(t)},getAttachPosition:function(){var t=new Ga;return function(e,i,n,r){n=n||0,r=r||0;var o=this,a=o.getAnchor(),s=o._64O,l=o._position,c=o.getScale();return t.setFromTransform(s,l.x,l.y).tf({x:n+c.x*o.getWidth()*(e-a.x),y:r+c.y*o.getHeight()*(i-a.y)})}}(),isInRect:function(t){t=this.toLocal(t);var e=this.getWidth(),i=this.getHeight();return t.x+=e*this.getAnchorX(),t.y+=i*this.getAnchorY(),!(t.x<0||t.y<0||t.x>e||t.y>i)},getRect:function(){var t=this,e=t.getWidth(),i=t.getHeight(),n=t.getAnchor(),r={x:-e*n.x,y:-i*n.y,width:e,height:i},o=t.getMatrix();return rl([o.tf(r.x,r.y),o.tf(r.x+r.width,r.y),o.tf(r.x+r.width,r.y+r.height),o.tf(r.x,r.y+r.height)])},getAnchorElevation:function(){return this._anchorElevation},getAnchor3d:function(){var t=this,e=t.getAnchor(),i=t._anchorElevation;return{x:e.x,y:i,z:e.y}},setAnchorElevation:function(t){var e=this,i=e._anchorElevation;return i!==t&&(e._anchorElevation=t,e.fp("anchorElevation",i,t),!0)},setAnchor3d:function(t,e,i,n){var r,o=this;"number"==typeof t?r={x:t,y:e,z:i}:(r=t.length?{x:t[0],y:t[1],z:t[2]}:t,n=e);var a=o.getDataModel();a&&a.beginTransaction();var s=o.getAnchor3d(),l=o.setAnchor(r.x,r.z);if(o.setAnchorElevation(r.y)&&(l=!0),l&&n&&!ji){o.getAnchor3d();var c=jl(o),h=kl([r.x-s.x,r.y-s.y,r.z-s.z],c);o.p3(h)}return a&&a.endTransaction(),l},getAnchor:function(){var t=this;if(t.hasOwnProperty("_anchor"))return t._anchor;var e=zs(t._image);return e&&e.anchorX!==i?{x:e.anchorX,y:e.anchorY}:t._anchor},setAnchor:function(t,e,i){var n,r=this;"number"==typeof t?n={x:t,y:e}:(n=t.length?{x:t[0],y:t[1]}:t,i=e);var o=r.getAnchor();if(o.x!==n.x||o.y!==n.y){var a=r.getDataModel();if(a&&a.beginTransaction(),r._anchor=n,r.fp("anchor",o,n),i&&!ji){var s=r.getPosition(),l=r.getSize(),c=r.getRotation(),h=r.getScale(),u=-l.width*(o.x-n.x)*h.x,d=-l.height*(o.y-n.y)*h.y,f=k(c),g=R(c);r.setPosition(s.x+g*u-f*d,s.y+f*u+g*d)}return a&&a.endTransaction(),!0}return!1},getScale:function(){return this._scale},setScale:function(t,e){var i,n=this;i=2===arguments.length?{x:t,y:e}:t;var r=n.getScale();(r.x!==i.x||r.y!==i.y)&&(n._scale=i,n.fp("scale",r,i))},getScaleTall:function(){return this._scaleTall},getScale3d:function(){var t=this,e=t._scaleTall,i=t.getScale();return[i.x,e,i.y]},getFinalScale3d:function(){var t=this,e=t.s3(),i=t._dynamicScale3d,n=t.getScale3d();return e&&(n[0]*=e[0],n[1]*=e[1],n[2]*=e[2]),i&&(n[0]*=i[0],n[1]*=i[1],n[2]*=i[2]),n},getFinalRotation3d:function(){var t=this;return t._dynamicRotation||t.r3()},setScaleTall:function(t){var e=this,i=e._scaleTall;i!==t&&(e._scaleTall=t,e.fp("scaleTall",i,t))},setScale3d:function(t,e,i){var n,r=this;n="number"==typeof t?{x:t,y:e,z:i}:t.length?{x:t[0],y:t[1],z:t[2]}:t,r.setScaleTall(n.y),r.setScale(n.x,n.z)},getCorners:function(t,e){t==l&&(t=0),e==l&&(e=t);var i=this,n=i.getAnchor(),r=i.getWidth(),o=i.getHeight(),a=-r*n.x-t,s=-o*n.y-e,c=r+2*t,h=o+2*e,u=i.getMatrix();return[u.tf(a,s),u.tf(a,s+h),u.tf(a+c,s+h),u.tf(a+c,s)]},getEditControlPoints:function(t,e,i){e==l&&(e=0),i==l&&(i=e);var n=this,r=n.getAnchor(),o=n.getWidth(),a=n.getHeight(),s=-o*r.x-e,c=-a*r.y-i,h=o+2*e,u=a+2*i;if(t)return[{x:s,y:c},{x:s,y:0},{x:s,y:c+u},{x:0,y:c+u},{x:s+h,y:c+u},{x:s+h,y:0},{x:s+h,y:c},{x:0,y:c}];var d=n.getMatrix();return[d.tf(s,c),d.tf(s,0),d.tf(s,c+u),d.tf(0,c+u),d.tf(s+h,c+u),d.tf(s+h,0),d.tf(s+h,c),d.tf(0,c)]},rotateAt:function(t,e,i){var n=this,r=n._position,o=n._64O,a=new Ga(o,r.x,r.y).tf(t,e),s=E(t*t+e*e),l=G(r.y-a.y,r.x-a.x)+i;n.setRotation(o+i),n.p(a.x+s*R(l),a.y+s*k(l))},onParentChanged:function(){ru.superClass.onParentChanged.apply(this,arguments),this._8I()},onPropertyChanged:function(){var t={};return"width|height|position|anchor|rotation|scale|s:layout.h|s:layout.v".split("|").forEach((function(e){t[e]=!0})),function(e){var i=this;ru.superClass.onPropertyChanged.call(i,e),t[e.property]&&!i._layoutUpdating&&i.updateLayoutParameters(null,e.property),i._69O&&i._69O.each((function(t){t.handleHostPropertyChange(e)})),i._49I&&i._49I.each((function(t){t.fp("agentChange",!0,!1)})),"a:layout"===e.property.substring(0,8)&&this.updateAttach()}}(),onHostChanged:function(){this.updateAttach(),this.updateLayoutParameters()},handleHostPropertyChange:function(t){this.updateAttach(t)},onStyleChanged:function(t){ru.superClass.onStyleChanged.apply(this,arguments),Dc[t]&&this.updateAttach()},updateAttach:function(t){var e=this;return ji?void e.updateLayoutParameters():void(e._51I||(e._51I=1,e._71O(t),delete e._51I))},_71O:function(t){var e,i,n,r,o,a,s,h,u=this,d=u._host,f=t?t.property:l,g=t?t.oldValue:l,p=t?t.newValue:l;if(d instanceof ru&&(s=zs(d.getImage()),s&&s.layoutAttach&&(h=s.layoutAttach)),t&&!Ec[f]&&"a:layout"!==f.substring(0,8)||!h||h(d,this))if(d instanceof c.Grid){if(f===Le)u.setElevation(u._54O+p-g);else if(!t||Pc[f]){if(e=u.s("attach.row.index"),i=u.s("attach.column.index"),n=d.getCellRect(e,i),!n)return;r=u.s("attach.row.span"),o=u.s("attach.column.span"),(1!==r||1!==o)&&(n=ol(n,d.getCellRect(e+r-1,i+o-1))),zc(n,u,"attach.padding",1),u.setRect(n)}}else if(d instanceof pu&&(a=u.s("attach.index"))>=0&&(!t||Oc[f])){var v=u.s("attach.thickness"),_=d.getScale(),y=Math.max(_.x,_.y);v>0&&u.setHeight(d.getThickness()*v*y);var m=u.s("attach.offset"),b=d.getPoints(),x=b.size();if(x>a){var w=d.getPointsMatrix2d(),C=b.get(a),S=x===a+1?b.get(0):b.get(a+1);C=w.apply(C),S=w.apply(S);var I=[S.x-C.x,S.y-C.y],M=nl(I);if(M){u.s("attach.offset.relative")&&(m*=M),u.s("attach.offset.opposite")&&(m=M-m);var T={x:C.x+I[0]/M*m,y:C.y+I[1]/M*m},E=u.s("attach.gap");E&&(u.s("attach.gap.relative")&&(E*=d.getThickness()*y),T=af(l,T,S,E)),u.p(T),u.setRotation(G(I[1],I[0]))}}}else t&&(f===Be?u.translate(p.x-g.x,p.y-g.y):f===Le?u.setElevation(u._54O+p-g):Tc[f]?u._11Q(d,f,p-g):("anchor"===f||"width"===f||"height"===f||"scale"===f)&&u.layout(d))},_11Q:function(){var t=new c.Math.Euler,e=c.Math.Euler.ReverseOrder,i=new c.Math.Vector2,n=new c.Math.Vector2;return function(r,o,a){var s=this,l=r.p3(),c=r.r3(),h=s.p3(),u=s.r3();if(o===le&&(o="rotationY",a=-a),(o===le||"rotationY"===o)&&0===u[0]&&0===u[2]&&0===c[0]&&0===c[2]&&0===h[1]&&0===l[1])return s.setRotation(-u[1]-a),i.set(h[0],h[2]).rotateAround(n.set(l[0],l[2]),-a),void s.p(i.x,i.y);var d=su[r.getRotationMode()],f=d[0],g=d[1],p=d[2],v=ou[f],_=ou[g],y=ou[p],m=Pl();o===le+f?(y(m,c[au[p]]),_(m,c[au[g]]),v(m,a),_(m,-c[au[g]]),y(m,-c[au[p]])):o===le+g?(y(m,c[au[p]]),_(m,a),y(m,-c[au[p]])):o===le+p&&y(m,a);var b=Ml(h,l);kl(b,m),s.p3(l[0]+b[0],l[1]+b[1],l[2]+b[2]);var x=s.getRotationMode();cu(m,s.r3(),x),t.setFromRotationMatrix(m,e(x)),s.r3([t.x,t.y,t.z])}}(),isHostOn:function(t){var e=this;if(e._host&&t&&t._69O)for(var i={},n=e._host;n&&n!==e&&!i[n._id];){if(n===t)return!0;i[n._id]=n,n=n._host}return!1},isLoopedHostOn:function(t){return this.isHostOn(t)&&t.isHostOn(this)},getScaledSize:function(){var t=this.getSize(),e=this.getScale();return t.width*=Math.abs(e.x),t.height*=Math.abs(e.y),t},layout:function(t){if(t=t||this.getHost()){var e=this,n=e.s("layout.h")||"center",r=e.s("layout.v")||"center";if("center"!==n||"center"!==r){var o=new c.Math.Vector2,a=t.getPosition(),s=t.getAnchor(),l=t.getScaledSize();e.getPosition();var h,u,d,f,g,p=1,v=1;switch(e._layoutUpdating=!0,n){case"left":o.setX(e._layoutHValue-s.x*l.width);break;case"right":o.setX((1-s.x)*l.width-e._layoutHValue);break;case"leftright":h=l.width-e._layoutHValue[2],d=e.getRotation()-t.getRotation(),f=Math.abs(Math.sin(d)),g=Math.abs(Math.cos(d)),p+=g*h/e._layoutHValue[3],v+=f*h/e._layoutHValue[4],o.setX(e._layoutHValue[1]+(e._layoutHValue[5]-s.x)*l.width);break;case"center":o.setX((.5-s.x)*l.width-e._layoutHValue);break;case"scale":d=e.getRotation()-t.getRotation(),f=Math.abs(Math.sin(d)),g=Math.abs(Math.cos(d)),o.setX((.5-s.x)*l.width-e._layoutHValue[1]*l.width/e._layoutHValue[0]),u=l.width/e._layoutHValue[2]-1,p+=g*u,v+=f*u}switch(r){case"top":o.setY(e._layoutVValue-s.y*l.height);break;case"bottom":o.setY((1-s.y)*l.height-e._layoutVValue);break;case"topbottom":d||(d=e.getRotation()-t.getRotation(),f=Math.abs(Math.sin(d)),g=Math.abs(Math.cos(d))),h=l.height-e._layoutVValue[2],p+=f*h/e._layoutVValue[3],v+=g*h/e._layoutVValue[4],o.setY(e._layoutVValue[1]+(e._layoutVValue[5]-s.y)*l.height);break;case"center":o.setY((.5-s.y)*l.height-e._layoutVValue);break;case"scale":d||(d=e.getRotation()-t.getRotation(),f=Math.abs(Math.sin(d)),g=Math.abs(Math.cos(d))),o.setY((.5-s.y)*l.height-e._layoutVValue[1]*l.height/e._layoutVValue[0]),u=l.height/e._layoutVValue[2]-1,p+=f*u,v+=g*u}if("leftright"===n||"scale"===n||"topbottom"===r||"scale"===r){var _=this.getScale(),y=Math.abs(_.x),m=Math.abs(_.y);"leftright"===n||"scale"===n?e.setSize(e._layoutHValue[3]*p/y,e._layoutHValue[4]*v/m):e.setSize(e._layoutVValue[3]*p/y,e._layoutVValue[4]*v/m)}o.rotateAround(null,t.getRotation()),this.setPosition(o.x+a.x,o.y+a.y),e._layoutUpdating=i}}},updateLayoutParameters:function(t,e){if(t=t||this.getHost()){var i=this,n=i.s("layout.h"),r=i.s("layout.v");if(n||r){var o,a,s,l,h,u,d=new c.Math.Vector2,f=t.getPosition(),g=t.getAnchor(),p=t.getScaledSize(),v=i.getPosition(),_=i.getScaledSize();switch(d.set(v.x-f.x,v.y-f.y),d.rotateAround(null,-t.getRotation()),n){case"left":i._layoutHValue=d.x+g.x*p.width;break;case"right":i._layoutHValue=-d.x+(1-g.x)*p.width;break;case"center":i._layoutHValue=-d.x+(.5-g.x)*p.width;break;case"leftright":case"scale":"scale"===n?o=-d.x+(.5-g.x)*p.width:(a=i.getAnchor(),s=i.getRotation()-t.getRotation(),l=Math.cos(s),h=Math.sin(s),u=-Math.min(-a.x*l+a.y*h,-a.x*l-(1-a.y)*h,(1-a.x)*l+a.y*h,(1-a.x)*l-(1-a.y)*h),o=d.x-(u-g.x)*p.width),"position"===e&&"object"==typeof i._layoutHValue?(i._layoutHValue[0]=p.width,i._layoutHValue[1]=o):i._layoutHValue=[p.width,o,p.width,_.width,_.height,u]}switch(r){case"top":i._layoutVValue=d.y+g.y*p.height;break;case"bottom":i._layoutVValue=-d.y+(1-g.y)*p.height;break;case"center":i._layoutVValue=-d.y+(.5-g.y)*p.height;break;case"topbottom":case"scale":"scale"===r?o=-d.y+(.5-g.y)*p.height:(s||(a=i.getAnchor(),s=i.getRotation()-t.getRotation(),l=Math.cos(s),h=Math.sin(s)),u=-Math.min(-a.x*h-a.y*l,-a.x*h+(1-a.y)*l,(1-a.x)*h-a.y*l,(1-a.x)*h+(1-a.y)*l),o=d.y-(u-g.y)*p.height),"position"===e&&"object"==typeof i._layoutVValue?(i._layoutVValue[0]=p.height,i._layoutVValue[1]=o):i._layoutVValue=[p.height,o,p.height,_.width,_.height,u]}}}},getSerializableProperties:function(){var t=ru.superClass.getSerializableProperties.call(this);return Qn(t,{image:1,host:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,position:1,anchor:1,anchorElevation:1,scale:1,scaleTall:1,_width:1,_height:1,_tall:1,elevation:1}),t}});var hu=c.Edge=function(t,e){var i=this;Kn(hu,i),i.setSource(t),i.setTarget(e)};xl("Edge",_c,{ms_edge:!0,_icon:"edge_icon",getUIClass:function(){return Iu},_22Q:function(){return Iv},getSource:function(){return this._source},getTarget:function(){return this._target},getSourceAgent:function(){return this._40I},getTargetAgent:function(){return this._41I},canSetSourceTarget:function(t){if(t===this)return!1;if(Fn(t))return!0;for(var e,i,n,r,o,a=[this],s=-1,l=0;l>s;)if(s++,e=a[s],i=e._44I)for(i=i.getArray(),r=0,o=i.length;o>r;r++)if(n=i[r],jn(n)&&!(a.indexOf(n)>=0)){if(n===t)return!1;a.push(n),l++}return!0},setSource:function(t){var e=this;if(e._source!==t&&e.canSetSourceTarget(t)){var i=e._source;e._source=t,i&&i._16I(e),t&&t._2I(e),e._7I(),e.fp("source",i,t)}},setTarget:function(t){var e=this;if(e._target!==t&&e.canSetSourceTarget(t)){var i=e._target;e._target=t,i&&i._18I(e),t&&t._4I(e),e._7I(),e.fp("target",i,t)}},isLooped:function(){var t=this;return t._source===t._target&&Fn(t._source)&&Fn(t._target)},onPropertyChanged:function(){var t=this;t._49I&&t._49I.each((function(t){t.fp("agentChange",!0,!1)}))},_7I:function(){var t,e=this,i=Bc(e);e._40I!==i&&(t=this._40I,t&&t._15I(e),e._40I=i,i&&i._1I(e),e.fp("sourceAgent",t,i),Gc(t,e._41I),Gc(i,e._41I));var n=Lc(e);e._41I!==n&&(t=e._41I,t&&t._17I(e),e._41I=n,n&&n._3I(e),e.fp("targetAgent",t,n),Gc(t,e._40I),Gc(n,e._40I))},_22I:function(t){this._52I=t,this.fp("edgeGroup",!0,!1)},getEdgeGroup:function(){return this._52I},isEdgeGroupHidden:function(){var t=this;return t._52I&&t._52I.get(0)!==t&&!t.getStyle(oe)},getEdgeGroupSize:function(){return this._52I?this._52I.size():1},getEdgeGroupIndex:function(){return this._52I?this._52I.indexOf(this):0},isEdgeGroupAgent:function(){var t=this,e=t._52I;return e&&!t.getStyle(oe)&&e.size()>1&&t===e.get(0)},toggle:function(){this.beginTransaction();var t=this._52I,e=!this.s(oe);t&&t.size()>1&&(t.each((function(t){t.s(oe,e)})),t.getSiblings().each((function(e){e!==t&&e.each((function(t){t.fp("edgeGroup",l,e)}))}))),this.endTransaction()},setStyle:function(t,e){(t===ae||"edge.segments"===t)&&(e=Ln(e)),hu.superClass.setStyle.call(this,t,e)},onStyleChanged:function(t){hu.superClass.onStyleChanged.apply(this,arguments),Mc[t]&&Gc(this._41I,this._40I)},getSerializableProperties:function(){var t=hu.superClass.getSerializableProperties.call(this);return Qn(t,{source:1,target:1}),t}});var uu=c.Group=function(){Kn(uu,this)};xl("Group",ru,{_image:"group_image",_icon:"group_icon",_57O:!1,getUIClass:function(){return Tu},onChildAdded:function(){uu.superClass.onChildAdded.apply(this,arguments),this._81I()},onChildRemoved:function(){uu.superClass.onChildRemoved.apply(this,arguments),this._81I()},_81I:function(){var t=this;if(!t._54I&&!ji){var e=t.getChildrenRect();e&&(t._53I=1,t.p(la(t.s("group.position"),e,t.getSize())),delete t._53I)}},getChildrenRect:function(){var t,e=this;return e.eachChild((function(i){Fn(i)&&(t=ol(t,e.getChildRect(i)))})),t},getChildRect:function(t){var e;return Fn(t)&&t.s(Ft)&&(Hn(t)&&t.isExpanded()&&t.eachChild((function(i){e=ol(e,t.getChildRect(i))})),!e&&t.getRect&&(e=t.getRect())),e},setPosition:function(t,e){var i,n=this;n._54I||(i=2===arguments.length?{x:t,y:e}:t,ji||n._53I||(n._54I=1,na(n._children,i.x-n._position.x,i.y-n._position.y),delete n._54I),uu.superClass.setPosition.call(this,i))},toggle:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._57O},setExpanded:function(t){var e=this;if(e._57O!==t){var i=e._57O;e._57O=t,e.fp("expanded",i,e._57O),e._fireInvalidateDeep(),e._8I()}},_fireInvalidateDeep:function(){this.eachChild((function(t){Hn(t)?t._fireInvalidateDeep():t.iv()}))},_8I:function(){uu.superClass._8I.call(this),this.eachChild((function(t){Fn(t)&&t._8I()}))},onStyleChanged:function(t){uu.superClass.onStyleChanged.apply(this,arguments),"group.position"===t&&this._81I()},getSerializableProperties:function(){var t=uu.superClass.getSerializableProperties.call(this);return t.expanded=1,t}});var du=c.Block=function(){Kn(du,this),this.s({"shadow.cast":!1,"shadow.receive":!1})};xl("Block",ru,{_icon:"block_icon",_clickThroughEnabled:!1,_syncSize:!0,ms_ac:["clickThroughEnabled","syncSize"],getUIClass:function(){return Eu},_22Q:function(){return Sv},onChildAdded:function(){du.superClass.onChildAdded.apply(this,arguments),this.updateFromChildren()},onChildRemoved:function(){du.superClass.onChildRemoved.apply(this,arguments),this.updateFromChildren()},_getBoundingBox:function(){function t(t,e,n){i.fromArray(jl(e));var r=e.getAnchor3d();t.push((new Na).set(0-r.x,0-r.y,0-r.z).applyMatrix4(i).applyMatrix4(n)),t.push((new Na).set(0-r.x,0-r.y,1-r.z).applyMatrix4(i).applyMatrix4(n)),t.push((new Na).set(0-r.x,1-r.y,0-r.z).applyMatrix4(i).applyMatrix4(n)),t.push((new Na).set(0-r.x,1-r.y,1-r.z).applyMatrix4(i).applyMatrix4(n)),t.push((new Na).set(1-r.x,0-r.y,0-r.z).applyMatrix4(i).applyMatrix4(n)),t.push((new Na).set(1-r.x,0-r.y,1-r.z).applyMatrix4(i).applyMatrix4(n)),t.push((new Na).set(1-r.x,1-r.y,0-r.z).applyMatrix4(i).applyMatrix4(n)),t.push((new Na).set(1-r.x,1-r.y,1-r.z).applyMatrix4(i).applyMatrix4(n))}function e(e,i){var n=this.p3(),r=this.r3(),o=Pl();cf(o,[-n[0],-n[1],-n[2]]),cu(o,[-r[0],-r[1],-r[2]],this.getRotationMode()),o=(new Ka).fromArray(o),e.forEach((function(e){Fn(e)&&t(i,e,o)}))}var i=new Ka;return function(t,i){if(t instanceof c.Node&&(t=[t]),!t||0===t.length)return l;i=[];e.call(this,t,i);var n=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];return i.forEach((function(t){n[0]=Math.min(t.x,n[0]),n[1]=Math.min(t.y,n[1]),n[2]=Math.min(t.z,n[2]),r[0]=Math.max(t.x,r[0]),r[1]=Math.max(t.y,r[1]),r[2]=Math.max(t.z,r[2])})),{min:n,max:r}}}(),updateFromChildren:function(){var t=this;if(!ji&&!t._updatingToChildren&&t._syncSize&&0!==t.size()&&!t._freezeSyncFromChildren){var e=this._getBoundingBox(t.toChildren().toArray());if(e){t._updatingFromChildren=1;var i=e.min,n=e.max,r=n[0]-i[0],o=n[2]-i[2],a=n[1]-i[1],s=new Na(r,a,o),l=new Na(1,1,1).divide((new Na).fromArray(this.getScale3d())).multiply(s);this.s3(Math.abs(l.x),Math.abs(l.y),Math.abs(l.z));var c=this.p3(),h=this.r3(),u=Pl();cu(u,h,this.getRotationMode()),cf(u,c),u=(new Ka).fromArray(u);var d=this.getAnchor3d();return c=new Na(d).multiply(s).add((new Na).fromArray(i)).applyMatrix4(u),this.p3([c.x,c.y,c.z]),void delete t._updatingFromChildren}}},setPosition:function(t,e){var i,n=this;n._updatingToChildren||(i=2===arguments.length?{x:t,y:e}:t,ji||n._updatingFromChildren||(n._updatingToChildren=1,na(n._children,i.x-n._position.x,i.y-n._position.y),delete n._updatingToChildren),du.superClass.setPosition.call(this,i))},setWidth:function(t){return this.setSize(t,this.getHeight())},setHeight:function(t){return this.setSize(this.getWidth(),t)},setSize:function(t,e){var i=u.blockMinSize;t=P(t,i),e=P(e,i);var n=this;if(!n._updatingToChildren){2!==arguments.length&&(e=t.height,t=t.width);var r=n.getWidth(),o=n.getHeight();if(t!==r&&du.superClass.setWidth.call(n,t),e!==o&&du.superClass.setHeight.call(n,e),!ji&&!n._updatingFromChildren){n._updatingToChildren=1;var a=t/r,s=e/o;n._adjustChildScaleOrSize(a,s,"size"),delete n._updatingToChildren,n.updateFromChildren()}}},_adjustChildScaleOrSize:function(t,e,i){var n=this;if(n._syncSize){var r=n.getPosition(),o=n.getRotation();n.getScale(),n.eachChild((function(n){if(Fn(n)){var a=n.getPosition(),s=n.getRotation(),l=n.getWidth(),h=n.getHeight(),u=n.getScale(),d=u.x*l,f=u.y*h,g=new Ga(s,a.x,a.y,d,f);g.translate(-r.x,-r.y),g.rotate(-o),s=G(g.b*Math.sign(d),g.a*Math.sign(d)),g.scale(t,e);var p,v,_,y=R(s);if(Math.abs(y)<.001?(p=k(s),v=g.b/p,_=-g.c/p):(v=g.a/y,_=g.d/y),"scale"===i)n.setScale(v/l,_/h);else if("size"===i){var m=v/u.x,b=_/u.y;n.setScale(nr(v)*Math.abs(u.x),nr(_)*Math.abs(u.y)),n instanceof c.Shape?(n.setWidthForce(Math.max(Math.abs(m),1e-5)),n.setHeightForce(Math.max(Math.abs(b),1e-5))):n.setSize(Math.max(.01,Math.abs(m)),Math.max(.01,Math.abs(b)))}g.rotate(o),g.translate(r.x,r.y),n.setPosition(g.tx,g.ty)}}))}},_calcChangeFactor:function(t,e,i,n){var r,o,a,s;return r=O(t),o=O(i),a=r>o?r/o:o/r,r=O(e),o=O(n),s=r>o?r/o:o/r,P(a,s)},setElevation:function(t){var e=this;if(!e._updatingToChildren){var i=e.getElevation(),n=t-i;0!==n&&(ji||e._updatingFromChildren||(e._updatingToChildren=1,na(e._children,0,n,0),delete e._updatingToChildren),du.superClass.setElevation.apply(e,arguments))}},setTall:function(t){var e=this;if(!e._updatingToChildren){t=P(t,u.blockMinSize);var i=e.getTall();if(t!==i&&du.superClass.setTall.call(e,t),!ji&&!e._updatingFromChildren){e._updatingToChildren=1;var n=t/i;e._adjustChildTallOrScale(n,"size"),delete e._updatingToChildren,this.updateFromChildren()}}},setScaleTall:function(t){var e=this;if(!e._updatingToChildren){var i=e.getScaleTall();if(O(t)<.01&&(t=.01*(nr(t)||nr(i))),du.superClass.setScaleTall.call(e,t),!ji&&!e._updatingFromChildren){e._updatingToChildren=1;var n=t/i;e._adjustChildTallOrScale(n,"size"),delete e._updatingToChildren,this.updateFromChildren()}}},_adjustChildTallOrScale:function(t,e){var i=this;if(i._syncSize){var n=i.getElevation();i.eachChild((function(i){if(Fn(i))if("size"===e){var r=i.getTall();0>t&&i.setScaleTall(-1*i.getScaleTall()),i.setTall(Math.max(.01,Math.abs(r*t))),i.setElevation(n+(i.getElevation()-n)*t)}else{var o=i.getScaleTall();i.setScaleTall(o*t)}}))}},setAnchor:function(){var t=this;if(!t._updatingToChildren){var e=t.getAnchor();if(du.superClass.setAnchor.apply(t,arguments),!ji&&!t._updatingFromChildren&&t._syncSize){t._updatingToChildren=1;var i=t.getAnchor();t.getPosition();var n=t.getSize(),r=t.getScale(),o=t.getRotation(),a=-n.width*r.x*(e.x-i.x),s=-n.height*r.y*(e.y-i.y),l=k(o),c=R(o),h=c*a-l*s,u=l*a+c*s;t.eachChild((function(t){if(Fn(t)){var e=t.getPosition();t.setPosition(e.x-h,e.y-u)}})),delete t._updatingToChildren}}},setAnchorElevation:function(){var t=this;if(!t._updatingToChildren){var e=t.getAnchorElevation();if(du.superClass.setAnchorElevation.apply(t,arguments),!ji&&!t._updatingFromChildren&&t._syncSize){t._updatingToChildren=1;var i=t.getAnchorElevation(),n=t.getTall(),r=t.getScaleTall(),o=-n*r*(e-i);t.eachChild((function(t){if(Fn(t)){var e=t.getElevation();t.setElevation(e-o)}})),delete t._updatingToChildren}}},setRotation:function(t){this._updateChildrenRotation3d("rotation",t)},setRotationX:function(t){this._updateChildrenRotation3d("rotationX",t)},setRotationZ:function(t){this._updateChildrenRotation3d("rotationZ",t)},_updateChildrenRotation3d:function(t,e){var i=this;if(!i._updatingToChildren){var n=i[Pn(t)]();if(du.superClass[Dn(t)].call(i,e),!ji&&!i._updatingFromChildren){i._updatingToChildren=1;var r=e-n;i.eachChild((function(e){Fn(e)&&e._11Q(i,t,r)})),delete i._updatingToChildren}}},setScale:function(t,e){var i=this;if(!i._updatingToChildren){null==e&&(e=t.y,t=t.x);var n=i.getScale();if(O(t)<.01&&(t=.01*(nr(t)||nr(n.x))),O(e)<.01&&(e=.01*(nr(e)||nr(n.y))),du.superClass.setScale.call(i,t,e),!ji&&!i._updatingFromChildren){i._updatingToChildren=1;var r=t/n.x,o=e/n.y;i._adjustChildScaleOrSize(r,o,"size"),delete i._updatingToChildren,i.updateFromChildren()}}},getSerializableProperties:function(){var t=du.superClass.getSerializableProperties.call(this);return t.clickThroughEnabled=1,t.syncSize=1,t}});var fu=c.Grid=function(){Kn(c.Grid,this)};xl("Grid",ru,{IRotatable:!1,_icon:"grid_icon",_image:l,getUIClass:function(){return Ou},setRotation:function(){},getCellRect:function(t,e){var i=this,n=i.s("grid.row.count"),r=i.s("grid.column.count");if(0>=n||0>=r||0>t||t>=n||0>e||e>=r)return l;var o,a,s,c=i.getRect(),h=i.s("grid.row.percents"),u=i.s("grid.column.percents");if(zc(c,i,"grid.border",-1),h&&h._as&&(h=h._as),u&&u._as&&(u=u._as),h&&h.length===n){for(s=0,o=0;t>o;o++)s+=c.height*h[o];c.y+=s,c.height=c.height*h[t]}else c.height=c.height/n,c.y+=c.height*t;if(u&&u.length===r){for(a=0,o=0;e>o;o++)a+=c.width*u[o];c.x+=a,c.width=c.width*u[e]}else c.width=c.width/r,c.x+=c.width*e;return ul(c,-i.s("grid.gap")),c}});var gu=c.Text=function(){Kn(gu,this),this.setSize(100,50),this.s("text","TEXT")};xl("Text",ru,{_icon:"text_icon",_image:"__text__",getUIClass:function(){return Ru},setWidth:function(t){t||(t=.001),gu.superClass.setWidth.call(this,t)},setHeight:function(t){t||(t=.001),gu.superClass.setHeight.call(this,t)},toLabel:function(){return this._displayName||this._name||this.s("text")}}),Rs("__text__",{width:{value:100,isSafeFunc:!0,func:function(t){return t?t._width:100}},height:{value:50,isSafeFunc:!0,func:function(t){return t?t._height:50}},comps:[{type:"text",relative:!0,rect:[0,0,1,1],text:{func:"style@text"},align:{func:"style@text.align"},vAlign:{func:"style@text.vAlign"},color:{func:"style@text.color"},font:{func:"style@text.font"},shadow:{func:"style@text.shadow"},shadowColor:{func:"style@text.shadow.color"},shadowBlur:{func:"style@text.shadow.blur"},shadowOffsetX:{func:"style@text.shadow.offset.x"},shadowOffsetY:{func:"style@text.shadow.offset.y"},scaleX:{func:"style@text.scale.x"},scaleY:{func:"style@text.scale.y"}}]});var pu=c.Shape=function(){Kn(pu,this),this._59O=new gc};pu.__de__=eh,xl("Shape",ru,{ms_ac:["thickness","closePath"],_icon:"shape_icon",_thickness:10,_closePath:!1,getUIClass:function(){return Pu},_22Q:function(){return Mv},getLength:function(t){return fr(Ro(this._59O,this._58O,t,this._closePath))},getSegments:function(){return this._58O},toSegments:function(){var t=this._58O;return t?new gc(t._as.slice(0)):t},setSegments:function(t){var e=this._58O;t=t?Vn(t)?new gc(t.slice(0)):new gc(t._as.slice(0)):null,(e&&t&&e._as.join(",")!==t._as.join(",")||e!==t)&&(this._58O=t,this.fp("segments",e,t))},getPoints:function(){return this._59O},toPoints:function(){var t=this._59O;return new gc(t._as.slice(0))},getPointsMatrix2d:function(){var t=this,e=new ja.Matrix2d,i=t.getPosition(),n=t.getScale(),r=t.getRotation();return e.translate(-i.x,-i.y).scale(n.x,n.y).rotate(r).translate(i.x,i.y),e},getPointsMatrix3d:function(){return function(){var t=this,e=new ja.Matrix4,i=e.getElements(),n=t.p3();cf(i,n),cu(i,t.getFinalRotation3d(),t.getRotationMode());var r=t.getScale3d(),o=t._dynamicScale3d;return o&&(r[0]*=o[0],r[1]*=o[1],r[2]*=o[2]),hf(i,r),cf(i,Tl(n)),e}}(),setPoints:function(t,e){var i,n,r,o,a,s,l=this,c=l._59O;t=t?Vn(t)?new gc(t.slice(0)):new gc(t._as.slice(0)):new gc,e&&(i=l.getPosition(),s=new Ga(l.getRotation(),0,0,l.getScale().x,l.getScale().y)),(c&&t&&c._as.join(",")!==t._as.join(",")||c!==t)&&(l._59O=t,l.fs(),l.fp("points",c,t)),e&&(n=l.getPosition(),r=n.x-i.x,o=n.y-i.y,a=s.tf(r,o),l.setPosition(n.x-r+a.x,n.y-o+a.y))},addPoint:function(t,e,i){var n=this.toPoints();n.add(t,e),this.setPoints(n,i)},setPoint:function(t,e,i){var n=this.toPoints();n.set(t,e),this.setPoints(n,i)},removePointAt:function(t){var e=this.toPoints();e.removeAt(t),this.setPoints(e)},setWidthForce:function(t){var e=this;if(!e._55I&&!ji&&e.getWidth()){e._55I=1;var i=e._position.x,n=t/e.getWidth(),r=e.toPoints(),o=new gc;1!==n&&(r.each((function(t){o.add({x:(t.x-i)*n+i,y:t.y,e:t.e})})),e.setPoints(o),Do(e,[n,0,0,1,i*(1-n),0]),e.fs()),delete e._55I}pu.superClass.setWidth.call(e,t)},setWidth:function(t){return this.setWidthForce(Cl>t?Cl:t)},setHeightForce:function(t){var e=this;if(!e._55I&&!ji&&e.getHeight()){e._55I=1;var i=e._position.y,n=t/e.getHeight(),r=e.toPoints(),o=new gc;1!==n&&(r.each((function(t){o.add({x:t.x,y:(t.y-i)*n+i,e:t.e})})),e.setPoints(o),Do(e,[1,0,0,n,0,i*(1-n)]),e.fs()),delete e._55I}pu.superClass.setHeight.call(e,t)},setHeight:function(t){return this.setHeightForce(Cl>t?Cl:t)},setAnchorElevation:function(t){var e=this;e._55I=!0;var i=e._updatingAnchor3d,n=!ji&&!i;if(n){var r,o=t,a=e.getAnchorElevation(),s=e.getTall();r=s*(a-o),0!==r&&e.shiftPointsElevation(r)}var l=pu.superClass.setAnchorElevation.apply(e,arguments);return i||delete e._55I,l},getShapeElevation:function(){var t=this,e=t._54O;return e-(t.getTall()||0)*(t._anchorElevation-.5)},setAnchor3d:function(t,e,i,n){var r,o=this;"number"==typeof t?r={x:t,y:e,z:i}:(r=t.length?{x:t[0],y:t[1],z:t[2]}:t,n=e),o._55I=!0,o._updatingAnchor3d=!0;var a=o.getDataModel();if(a&&a.beginTransaction(),!ji){var s=o.getAnchor3d(),l=o.getSize(),c=o.getTall(),h=l.width*(s.x-r.x),u=l.height*(s.z-r.z),d=c*(s.y-r.y);n||o.shiftPoints(h,u,d);var f=o.p3()}var g=pu.superClass.setAnchor3d.apply(o,arguments);if(!ji&&n){var p=o.p3();o.shiftPoints(p[0]-f[0]+h,p[2]-f[2]+u,p[1]-f[1]+d)}return a&&a.endTransaction(),delete o._updatingAnchor3d,delete o._55I,g},setAnchor:function(t,e,i){var n=this;n._55I=!0;var r=n._updatingAnchor3d,o=!ji&&!r;if(o){var a,s,l;"number"==typeof t?l={x:t,y:e}:(l=t.length?{x:t[0],y:t[1]}:t,i=e);var c=n.getAnchor(),h=n.getSize();a=h.width*(c.x-l.x),s=h.height*(c.y-l.y),i||n.shiftPoints(a,s);var u=n.getPosition()}var d=pu.superClass.setAnchor.apply(n,arguments);if(o){var f=n.getPosition();i&&n.shiftPoints(f.x-u.x+a,f.y-u.y+s)}return r||delete n._55I,d},shiftPoints:function(t,e,i){if(t||e||i){var n=this,r=n.getElevation()||0,o=n.toPoints(),a=new gc;o.each((function(n){var o=n.e;i&&(o=(o==l?r:o)+i),a.add({x:n.x+t,y:n.y+e,e:o})})),n.setPoints(a),n.fs()}},shiftPointsElevation:function(t){return this.shiftPoints(0,0,t)},setPosition:function(t,e){var i,n=this;if(!n._28Q){if(n._28Q=1,!n._55I&&!ji){i=2===arguments.length?{x:t,y:e}:t;var r=i.x-n._position.x,o=i.y-n._position.y;if(0===r&&0===o)return void delete n._28Q;n._55I=1,n.shiftPoints(r,o),Do(n,[1,0,0,1,r,o]),delete n._55I}pu.superClass.setPosition.apply(n,arguments),delete n._28Q}},fs:function(){this.fireShapeChange()},_70I:function(){var t=this;if(2!==t._59O.size())return!1;var e=t._58O;return!e||2===e.size()&&1===e.get(0)&&2===e.get(1)},fireShapeChange:function(){var t=this;if(!t._55I&&!ji){var e=rl(t._59O);e&&(t._55I=1,t.setRect(e),delete t._55I)}t.fp(Rt,!1,!0)},getSerializableProperties:function(){var t=pu.superClass.getSerializableProperties.call(this);return t.segments=1,t.points=1,t.thickness=1,t.closePath=1,t}});var vu=c.Polyline=function(){Kn(vu,this),this.s({"shape.background":null,"shape.border.width":2})};xl("Polyline",pu,{_icon:"polyline_icon",_22Q:function(){return Tv},getUIClass:function(){return Du},setClosePath:function(){},setTall:function(t){var e=this,i=e.getDataModel();if(i&&i.beginTransaction(),!e._55I&&!e._24Q&&!ji&&e.getTall()){e._24Q=1;var n=e._54O,r=t/e.getTall();if(1!==r){var o=e.toPoints(),a=new gc;o.each((function(t){a.add({x:t.x,y:t.y,e:t.e==l?t.e:(t.e-n)*r+n})})),e.setPoints(a),e.fs()}delete e._24Q}vu.superClass.setTall.call(e,t),i&&i.endTransaction()},setElevation:function(t){var e=this,i=e.getDataModel();if(i&&i.beginTransaction(),!e._55I&&!e._24Q&&!ji){e._24Q=1;var n=t-e._54O;0!==n&&e.shiftPointsElevation(n),delete e._24Q}vu.superClass.setElevation.apply(e,arguments),i&&i.endTransaction()},fireShapeChange:function(){var t=this,e=t._59O;if(!t._55I&&!t._24Q&&!ji){var i=e.size();if(i){var n=1,r=e.get(0),o=t._54O;r.e==l&&(r.e=o);for(var a=r.e,s=0;i>n;n++){r=e.get(n),r.e==l&&(r.e=o);var c=D(a,r.e),h=P(a+s,r.e);a=c,s=h-c}t._24Q=1,t.setTall(s),t.setElevation(a+s*t._anchorElevation),delete t._24Q}}vu.superClass.fireShapeChange.apply(t,arguments)}});var _u=c.SubGraph=function(){Kn(_u,this)};xl("SubGraph",ru,{ISubGraph:1,_image:"subGraph_image",_icon:"subGraph_icon",_8I:function(){_u.superClass._8I.call(this),this.eachChild((function(t){Fn(t)&&t._8I()}))}}),u.loadingRefGraph=0;var yu=c.RefGraph=function(){Kn(yu,this)};xl("RefGraph",du,{_icon:"refGraph_icon",getRef:function(){return this._ref},setRef:function(t){var e=this._ref;this._ref=t,this.fp("ref",e,t),this.updateRef()},_21I:function(){yu.superClass._21I.apply(this,arguments),this.updateRef()},updateRef:function(){var t=this;if(u.loadingRefGraph++,t.clearChildrenFromDataModel(),u.loadingRefGraph--,t._ref&&t._dataModel){t._xhrLoadHandler&&(t._xhrLoadHandler.cancel=!0);var e=ji,i=t._xhrLoadHandler=function(i){if(i&&t._dataModel){u.loadingRefGraph++;var n=t._pendingUpdateInfo={needToRestore:e};e&&(n.p3=t.p3(),n.s3=t.s3(),n.r3=t.r3(),n.anchor3d=t.getAnchor3d(),n.scale3d=t.getScale3d()),t.r3(0,0,0),t.setScale3d(1,1,1),t.setAnchor3d(.5,.5,.5),t.p3(0,0,0);var r=u.parse(i),o=t._dataModel.deserialize(r,t,{justDatas:!0});o.each((function(e){e._refGraph=t})),t.checkPendingUpdateInfo(),u.loadingRefGraph--,u.handleRefGraphLoaded(t,o,r)}};i.xhrLoadCalled=!1,u.load(t._ref,(function(t){i.cancel||(i.xhrLoadCalled?i(t):Ls((function(){i(t)})))})),i.xhrLoadCalled=!0}},checkPendingUpdateInfo:function(){var t=this,e=t._pendingUpdateInfo;if(e){var i=!0;this.eachChild((function(t){(t._pendingCheckImageJSON||t._pendingUpdateInfo)&&(i=!1)})),i&&(u.loadingRefGraph++,t._pendingUpdateInfo=null,t.updateFromChildren(),e.needToRestore&&(t.setAnchor3d(e.anchor3d),t.setScale3d(e.scale3d),t.r3(e.r3),t.p3(e.p3)),this.getParent()instanceof yu&&this.getParent().checkPendingUpdateInfo(),t.onPendingUpdated&&t.onPendingUpdated(),u.loadingRefGraph--)}else t.onPendingUpdated&&(u.loadingRefGraph++,t.onPendingUpdated(),u.loadingRefGraph--)},getSerializableProperties:function(){var t=yu.superClass.getSerializableProperties.call(this);return t.ref=1,t}}),c.EdgeGroup=function(t,e){this._70O=t,this._siblings=e;for(var i,n,r=0,o=t.size(),a=d[oe];o>r;r++)if(i=t.get(r).getStyle(oe,!1),i!=l){a=i;break}a==l&&(a=!0);var s=u.edgeGroupAgentFunc;for(s&&(n=s(t),n&&n!==t.get(0)&&(t.remove(n),t.add(n,0))),r=0;o>r;r++)t.get(r).s(oe,a)},xl("EdgeGroup",e,{getEdges:function(){return this._70O},size:function(){return this._70O.size()},get:function(t){return this._70O.get(t)},indexOf:function(t){return this._70O.indexOf(t)},each:function(t,e){this._70O.each(t,e)},getSiblings:function(){return this._siblings},eachSiblingEdge:function(t,e){this._siblings.each((function(i){i._70O.each(t,e)}))}});var mu=function(t,e,i){var n=$i[t]={type:t,action:e};if(i)for(var r in i)n[r]=i[r]};Qn(u,{setConnectAction:mu,getConnectAction:function(t,e){if(!e){if(!t)return null;e=t.getCurrentConnectActionType()}return $i[e]},doConnectAction:function(t,e,i,n){n=n||t.getCurrentConnectActionType();var r=$i[n];if(!r)return!1;var o=r.action;return!!o&&(e instanceof Xu.Group?t.sm().getSelection().each((function(e){o.call(null,t,e,i)})):o.call(null,t,e,i),!0)},doDeleteConnectionAction:function(t,e,i){i=i||t.getCurrentConnectActionType();var n=$i[i];if(!n||!n.delete)return!1;var r=n.delete.action;return!!r&&(e instanceof Xu.Group?t.sm().getSelection().each((function(e){r.call(null,t,e)})):r.call(null,t,e),!0)}});var bu=c.JSONSerializer=function(t,e){this.dm=this._dataModel=t,this._hierarchical=!!u.forceHierarchicalSerialization||(e==l?t.isHierarchicalRendering():e)};xl("JSONSerializer",e,{ms_ac:["hierarchical"],serialize:function(t){return u.stringify(this.toJSON(),t)},toJSON:function(){var t=this,e=t.dm,n=e.getRoots(),r=t.json={v:u.getVersion(),p:{},a:{},d:[]},o=e.getSerializableAttrs();for(var a in e.getInit()&&(r.init=e.getInit()),e.getName()&&(r.p.name=e.getName()),e.getBackground()&&(r.p.background=e.getBackground()),e.getLayers()&&(r.p.layers=e.getLayers()),e.getEnvmap()&&(r.p.envmap=e.getEnvmap()),r.p.autoAdjustIndex=e.isAutoAdjustIndex(),r.p.hierarchicalRendering=e.isHierarchicalRendering(),o){var s=e.a(a);s!==i&&t[$e](a,s,r.a)}return $n(r.a)&&delete r.a,t._hierarchical?n.each(t.serializeData,this):e.each((function(e){t.serializeData(e)})),e.fireSerializeEvent({type:"serialize",json:r}),e.getPostProcessingData()&&(r.p.postProcessingData=e.getPostProcessingData()),r},isSerializable:function(){return!0},getProperties:function(t){return t.getSerializableProperties()},getStyles:function(t){return t.getSerializableStyles()},getAttrs:function(t){return t.getSerializableAttrs()},serializeData:function(t){var e=this;if(e.isSerializable(t)&&!t._refGraph){var i,n,r,o,a=Gs(t.getClassName())||t.getClass(),s=new a,h={c:t.getClassName(),i:t.getId(),p:{},s:{},a:{}};for(n in e.json.d.push(h),i=e.getProperties(t),i)if(/^_/.test(n)){var u;if(r=t[n],!("_width"!==n&&"_height"!==n||r!=l&&-1!==r))((t.s("layout.h")||t.s("layout.v"))&&t.getHost()||t instanceof c.Node&&(u=t.getParent())&&u instanceof c.Block||t.s("fullscreen"))&&(r=t[n]="_width"===n?t.getWidth():t.getHeight());r!==s[n]&&e[$e](n.substr(1),r,h.p)}else o=Pn(n),t[o]&&(r=t[o](),r!==s[o]()&&e[$e](n,r,h.p));for(n in i=e.getStyles(t),i)r=t.s(n),r!==s.s(n)&&e[$e](n,r,h.s);for(n in i=e.getAttrs(t),i)r=t.a(n),r!==s.a(n)&&e[$e](n,r,h.a);$n(h.p)&&delete h.p,$n(h.s)&&delete h.s,$n(h.a)&&delete h.a}e._hierarchical&&t.getChildren().each(e.serializeData,e)},serializeValue:function(t,e,i){Bn(e)?e={__a:e._as}:e instanceof _c&&(e={__i:e.getId()}),i[t]=e},deserialize:function(t,e,i){var n=this;return On(t)&&/.json$/.test(t)?void u.xhrLoad(t,(function(t){n.deserializeImpl(t,e,i)})):n.deserializeImpl(t,e,i)},deserializeImpl:function(t,e,i){var n=this,r=n.dm;r.setDeserializing(!0),i=zn(i)?{setId:i}:An(i)?{finishFunc:i}:i||{},t=n.json=On(t)?u.parse(t):t,!i.justDatas&&t.a&&t.a.onPreDeserialize&&!i.disableOnPreDeserialize&&t.a.onPreDeserialize(t,r,i.view),r.beginTransaction(),ji++,n._82I={};var o=new gc,a=new gc,s=0,c=t.d.length;if(i.justDatas||(!i.disableInit&&An(t.init)&&t.init(r),r.setInit(t.init)),!i.justDatas){for(var h in t.a)r.a(h,n[ti](t.a[h]));for(var d in t.p)r[Dn(d)](t.p[d])}for(;c>s;s++){var f=t.d[s],g=Gs(f.c),p=new g,v=f.i;i.setId&&v!=l&&(p._id=v),n._82I[v]=p,o.add(p),a.add(f)}for(s=0;c>s;s++)n.deserializeData(o.get(s),a.get(s));return o.each((function(t){e&&!t.getParent()&&t.setParent(e),r.add(t)})),i.__innerHandler__&&i.__innerHandler__(t,r,i.view,o),r.fireSerializeEvent({type:"deserialize",json:t}),ji--,r.endTransaction(),!i.justDatas&&t.a&&t.a.onPostDeserialize&&!i.disableOnPostDeserialize&&t.a.onPostDeserialize(t,r,i.view,o),i.finishFunc&&i.finishFunc(t,r,i.view,o),r.setDeserializing(!1),o},deserializeData:function(t,e){for(var i in e.p)t[Dn(i)](this[ti](e.p[i]));for(i in e.s)t.s(i,this[ti](e.s[i]));for(i in e.a)t.a(i,this[ti](e.a[i]))},deserializeValue:function(t){if(kn(t)){var e=t.__i;if(e!=l)return this._82I[e];if(e=t.__a,Vn(e))return new gc(e)}return t}}),Qn(yc,{serialize:function(t,e){return new bu(this,e).serialize(t)},toJSON:function(t){return new bu(this,t).toJSON()},deserialize:function(t,e,i){return new bu(this).deserialize(t,e,i)}});var xu=c.OverlappingBox=function(t){this.gv=t,this.boxes={}};xl("OverlappingBox",e,{clear:function(){var t,e,i=this.boxes;for(t in i)e=i[t],e.length=0},isOverlapping:function(t,e){var i,n,r,o,a=this,s=a.boxes,l=s[t];for(l?(i=l.rects,n=l.length):l=s[t]={rects:i=[],length:n=0},r=0;n>r;r++)if(o=i[r],o.x<e.x+e.w&&o.x+o.w>e.x&&o.y<e.y+e.h&&o.h+o.y>e.y)return!0;return i.length<=n?(i.push(e),l.length++):i[l.length++]=e,!1}}),Qn(u,{fetch:function(t,e){var i="GET",n=!1,r=null,o="";e&&(i=e.method||"GET",n=e.sync,o=e.url,r=e.data||null),t.open(i,o,!n),e.responseType?t.responseType=e.responseType:e.overrideMimeType&&t.overrideMimeType&&t.overrideMimeType(e.overrideMimeType),t.send(r)},convertImageSrc:function(t,e){e&&"function"==typeof e||(e=function(){}),e(t)}});var wu=c.Request=function(){this._xhr=new XMLHttpRequest,this._onloadFunc=function(){},this._errorFunc=function(){}};xl("Request",e,{_responseType:null,_overrideMimeType:"text/plain",send:function(t){var e=this._xhr,i=this.onload,n=this.onerror;this.getResponseType()?t.responseType=this.getResponseType():this.getOverrideMimeType()&&(t.overrideMimeType=this.getOverrideMimeType()),e.onload=i,e.onerror=n,u.fetch(e,t)},onload:function(){},onerror:function(){},getResponseType:function(){return this._responseType},setResponseType:function(t){this._responseType=t},getOverrideMimeType:function(){return this._overrideMimeType},setOverrideMimeType:function(t){this._overrideMimeType=t},getResponseText:function(){var t=this._xhr;return t.response||t.responseText}}),Jc.GraphView=function(t){var e=this;e._24I={},e._34I=new gc,e._25I={},e._56I={},e._view=mr(1,e),e._canvas=wr(e._view),e.dm(t||new yc),this._coreInteractor=new ju(this),e.setEditable(!1),e.setScrollBarVisible(u.graphViewScrollBarVisible),e._initView()},Kc("GraphView",e,{ms_v:1,ms_gv:1,ms_bnb:1,ms_tip:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,_52o:1,_51o:1,ms_ac:[me,be,_e,ye,"resettable","editInteractor",pe,"zoomable","pannable","rectSelectable","autoScrollZone",Te,"movableFunc","editableFunc","pointEditableFunc","rectEditableFunc","rotationEditableFunc","anchorEditableFunc","rectSelectBackground","rectSelectBorderColor","editPointSize","editPointBorderColor","editPointBackground","hoverDelay"],_zoomable:u.graphViewZoomable,_resettable:u.graphViewResettable,_pannable:u.graphViewPannable,_rectSelectable:u.graphViewRectSelectable,_autoScrollZone:u.graphViewAutoScrollZone,_rectSelectBackground:u.graphViewRectSelectBackground,_rectSelectBorderColor:u.graphViewRectSelectBorderColor,_editPointSize:u.graphViewEditPointSize,_editPointBorderColor:u.graphViewEditPointBorderColor,_editPointBackground:u.graphViewEditPointBackground,_scrollBarColor:bs,_scrollBarSize:xs,_autoHideScrollBar:as,_autoMakeVisible:os,_currentActionType:null,getCoreInteractor:function(){return this._coreInteractor},getLayers:function(){return this._dataModel.getLayers()},setLayers:function(t){this._dataModel.setLayers(t)},setEditable:function(t){var e=this,i=e.__interactorMap__;if(!i){var n=Jc.XEditInteractor;i=e.__interactorMap__={scrollBar:new Nu(e),select:new Gu(e),edit:n?new n(e):new Yu(e),text:new Wu(e),move:new Uu(e),default:new Hu(e),touch:new qu(e,{editable:!1})}}t?(e._uieditable=!0,e.setInteractors([i.scrollBar,i.select,i.edit,i.text,i.move,i.default,i.touch])):(e._uieditable=!1,e.setInteractors([i.scrollBar,i.select,i.move,i.default,i.touch]))},getCanvas:function(){return this._canvas},_33I:function(t){var e=t.getUIClass();return e?new e(this,t):l},getDataUI:function(t){var e=this,n=e._25I[t._id];return n===i&&(n=e._33I(t),e._25I[t._id]=n),n},getNodeRect:function(t){return u.getNodeRect(this,t)},getFullscreenDatas:function(){return this._dataModel.getFullscreenDatas()},getEdgeInfo:function(t){var e=this.getDataUI(t);return e?(e._79o(),e._78o):null},getEdgeSourcePosition:function(t){var e=this,i=e.getDataUI(t),n=i.s,r=i._data._40I;return jc(e,r,n("edge.source.position"),n("edge.source.offset.x"),n("edge.source.offset.y"),n("edge.source.anchor.x"),n("edge.source.anchor.y"))},getEdgeTargetPosition:function(t){var e=this,i=e.getDataUI(t),n=i.s,r=i._data._41I;return jc(e,r,n("edge.target.position"),n("edge.target.offset.x"),n("edge.target.offset.y"),n("edge.target.anchor.x"),n("edge.target.anchor.y"))},invalidateAll:function(t){var e=this;if(t){for(var i in e._25I){var n=e._25I[i];n&&n.dispose()}e._25I={},e._56I={},e._24I={},e._34I.clear(),e.redraw()}else e.dm().each((function(t){e.invalidateData(t)}))},invalidateSelection:function(){var t=this;t.sm().each((function(e){t.invalidateData(e)}))},invalidateData:function(t){var e=this;e._24I[t._id]=t,e._21Q(t),e.iv()},_21Q:function(t){var e=this,i=e._24I;if(jn(t)&&tn[t.s(se)]){var n=t.getSourceAgent();n&&n.getAgentEdges().each((function(t){i[t._id]=t})),n=t.getTargetAgent(),n&&n.getAgentEdges().each((function(t){i[t._id]=t})),e.iv()}},redraw:function(t){var e=this;e._32I||(t?e._34I.add(t):(e._32I=1,e._34I.clear()),e.iv())},each:function(t,e){var i,n,r,o=0,a=this.getLayers(),s=this._dataModel,l=s._datas._as,c=l.length;if(a){for(var h=a.length;h>o;o++)if(r=a[o],kn(r)&&(r=r.name),s.isHierarchicalRendering()){var u=function(i){return i._layer===r?e?t.call(e,i):t(i):void 0};if(!1===this._dataModel.eachByHierarchical(u))return}else for(var d=0;c>d;d++)if(i=l[d],i._layer===r&&(n=e?t.call(e,i):t(i),!1===n))return}else if(s.isHierarchicalRendering())this._dataModel.eachByHierarchical(t,null,e);else for(;c>o;o++)if(i=l[o],n=e?t.call(e,i):t(i),!1===n)return},reverseEach:function(t,e){var i,n,r,o,a=this._dataModel,s=a._layers,l=a._datas._as,c=l.length;if(s){for(i=s.length-1;i>=0;i--)if(o=s[i],kn(o)&&(o=o.name),a.isHierarchicalRendering()){var h=function(i){return i._layer===o?e?t.call(e,i):t(i):void 0};if(!1===a.reverseEachByHierarchical(h))return}else for(var u=c-1;u>=0;u--)if(n=l[u],n._layer===o&&(r=e?t.call(e,n):t(n),!1===r))return}else if(a.isHierarchicalRendering())a.reverseEachByHierarchical(t,null,e);else for(i=c-1;i>=0;i--)if(n=l[i],r=e?t.call(e,n):t(n),!1===r)return},getViewRect:function(){return this._29I},getContentRect:function(){var t=this,e=t._84I;if(!e){var i=this.dm().a("width"),n=this.dm().a("height");i>0&&n>0?t._84I={x:0,y:0,width:i,height:n}:(t.each((function(i){t.isVisible(i)&&(e=ol(e,t.getDataUIBounds(i)))})),t._84I=e||un)}return t._84I},getScrollRect:function(){return ol(this.getContentRect(),this._29I)},makeCenter:function(t,e,i){var n=this;if(n.getWidth()&&n.getHeight()){n.makeVisible(t),n.validate();var r=n.getDataUIBounds(t);if(r){var o=n.getWidth(),a=n.getHeight(),s=r.x+r.width/2,l=r.y+r.height/2,c=-s*n._zoom+o/2,h=-l*n._zoom+a/2;n.setTranslate(c,h,e)}}else i||Ls(n.makeCenter,n,[t,e,!0],500)},fitData:function(t,e,i,n,r){var o=this;if(o.getWidth()&&o.getHeight()){var a=function(){o.makeVisible(t),o.validate();var r=o.getDataUIBounds(t);r&&(r=Hs(r),ul(r,i==l?20:i),o.fitRect(r,e,n))};e?u.callWhenLoaded(a):a()}else r||Ls(o.fitData,o,[t,e,i,n,!0],500)},fitContent:function(t,e,i,n){var r=this;if(r.getWidth()&&r.getHeight()){var o=function(){r.validate();var n=Hs(r.getContentRect());ul(n,e==l?20:e),r.fitRect(n,t,i)};t?u.callWhenLoaded(o):o()}else n||Ls(r.fitContent,r,[t,e,i,!0],500)},fitRect:function(t,e,i){var n=this,r=n.getWidth(),o=n.getHeight(),a=t.x+t.width/2,s=t.y+t.height/2,l=D(r/t.width,o/t.height),c=n._zoom,h=-a*c+r/2,u=-s*c+o/2;0===l||isNaN(l)||(i&&(l=D(1,l)),e?(n._65I&&(delete n._65I.finishFunc,n._65I.stop(!0)),n._14o&&n._14o.stop(!0),n.setTranslate(h,u,{finishFunc:function(){n.setZoom(l,e)}})):(n.setTranslate(h,u),n.setZoom(l)))},fitSelection:function(t,e,i){var n=this,r=n.sm(),o=null;r.size()&&(r.each((function(t){var e=n.getDataUIBounds(t);o=o?ol(e,o):e})),t&&ul(o,t),n.fitRect(o,e,i))},toCanvas:function(t,e,i){e=e||this._zoom,this.validateImpl();var n=this,r=n.getContentRect();i&&ul(r,i),r.width||(r.width=10),r.height||(r.height=10);var o=wr(),a=r.x*e,s=r.y*e,l=Math.ceil(r.width*e),c=Math.ceil(r.height*e);Ir(o,l,c,1);var h=kr(o);return t=t||this._dataModel.getBackground(),t&&Ao(h,0,0,l,c,t),Vr(h,-a,-s),h.scale(e,e),n._42(h),h.restore(),o},toDataURL:function(t,e,i,n){return this.toCanvas(t,i,n).toDataURL(e||"image/png",1)},getClipBounds:function(){return this._74O},_42:function(t,e){var i=this,n=i.dm().getBackground();if(n){var r=i.dm().a("width"),o=i.dm().a("height");r>0&&o>0&&Ao(t,0,0,r,o,n)}var a=i.__htmlOrderList,s=[];if(i._93db(t,e),i.each((function(n){var r=i.getDataUI(n);if(r){var o=i._56I[n._id],a=r._htmlView;if(o){var l=r._79o();if(a=r._htmlView,c.HtmlNode&&n instanceof c.HtmlNode)r._42(t);else{var h=i.getViewRect(),u=a&&a.layoutHTML;!e||ll(e,l)?(u&&(a.layoutHTML(),r.__outerLayout&&delete r.__outerLayout),r._42(t)):ll(h,l)||!u||r.__outerLayout||(a.layoutHTML(),r.__outerLayout=!0)}}a&&(s.push(a),a.getView&&(a=a.getView()),a.style.display=o?"block":St)}})),a&&s.length>0){var l=!1;if(a.length!==s.length)l=!0;else for(var h=0;h<s.length;h++)if(s[h]!==a[h]){l=!0;break}l&&(s.forEach((function(t){!1!==t.autoAdjustIndex&&i.appendHTML(t,!0)})),this.__htmlOrderList=s)}else this.__htmlOrderList=s;i._92db(t,e)},validateImpl:function(){this.tryUpdateRootData();var t,e,i,n=this,r=n.tx(),o=n.ty(),a=n._zoom,s=n._canvas,l=this.getWidth(),c=this.getHeight(),h=n._29I,u={x:-r/a,y:-o/a,width:l/a,height:c/a},d={},f=n._34I,g=n._24I,p=n._32I,v=n._23I;for(e in n._24I={},(l!==s.clientWidth||c!==s.clientHeight)&&(Ir(s,l,c),p=1),p||er(u,h)||(p=1),n._29I=u,n.each((function(t){e=t._id;var i=d[e]=n.isVisible(t);i!==n._56I[e]&&(g[e]=t,x=n.getDataUI(g[e]),x&&x._84o(i),n._84o(t,i))}),n),g)x=n.getDataUI(g[e]),x&&(!p&&n._56I[e]&&(w=x._79o(),w&&f.add(w)),x.invalidate()),n._83I=1;if(n._56I=d,!p)for(e in g)d[e]&&(x=n.getDataUI(g[e]),x&&(w=x._79o(),w&&f.add(w)));if(p?i=u:(f.each((function(t){ll(u,t)&&(i=ol(i,t))})),i&&(ul(i,P(1,1/a)),i.x=M(i.x*a)/a,i.y=M(i.y*a)/a,i.width=T(i.width*a)/a,i.height=T(i.height*a)/a,i=cl(u,i))),n._74O=i,i){t=kr(s);var _=i.x,y=i.y,m=i.width,b=i.height;_=Math.floor((_*a+r)*rs),y=Math.floor((y*a+o)*rs),m=Math.ceil(m*a*rs)+1,b=Math.ceil(b*a*rs)+1,p||(i.x=(_/rs-r)/a,i.y=(y/rs-o)/a,i.width=m/rs/a,i.height=b/rs/a),t.beginPath(),t.rect(_,y,m,b),t.clip(),t.clearRect(_,y,m,b),Ar(t,r,o,a),n._42(t,i),t.restore(),delete n._74O}if(f.clear(),delete n._32I,v&&l>0&&c>0){var x=n.getDataUI(v);if(x){var w=x._79o(),C=n._29I,S=C.x,I=C.y,E=C.width,D=C.height;a=n._zoom;w&&!ll(w,C)&&(w.x+w.width<S&&n.tx(-w.x*a),w.x>S+E&&n.tx(-(w.x+w.width-E)*a),w.y+w.height<I&&n.ty(-w.y*a),w.y>I+D&&n.ty(-(w.y+w.height-D)*a))}delete n._23I}n._83I&&(delete n._83I,delete n._84I),n._98O(),n.countFrame(),$n(n._24I)||Ls(n.iv,n)},isValidGuideLineSource:function(){return!0},tryUpdateRootData:function(){if(!this._rootDataUpdating){this._rootDataUpdating=!0;var t,e=this.getFullscreenDatas();for(var i in e)t=e[i],this.scaleRootData(t);this._rootDataUpdating=!1}},scaleRootData:function(t){var e=t.s("fullscreen");if("uniform"===e||"fill"===e){t.getRotation()&&t.setRotation(0);var i=t.s("fullscreen.gap")||0,n=this.getWidth(),r=this.getHeight();if(n&&r){var o,a,s,l=n-2*i,c=r-2*i,h=t.getAnchor(),u=t.getScaledSize(),d=u.width,f=u.height,g=t.s("fullscreen.lock");if(g)return"uniform"===e?l/c>d/f?(o=c/f,d=f*l/c):(o=l/d,f=d*c/l):"v"===g?(o=c/f,d=l/o,t.getWidth()!==d&&t.setWidth(d)):(o=l/d,f=c/o,t.getHeight()!==f&&t.setHeight(f)),this.setZoom(o),a=i-(t.getX()-h.x*d)*o,s=i-(t.getY()-h.y*f)*o,a!==this.tx()&&this.tx(a),void(s!==this.ty()&&this.ty(s));a=this.tx(),s=this.ty(),o=this._zoom;var p={x:(-a+i)/o,y:(-s+i)/o,width:l/o,height:c/o};if("uniform"===e){var v=d/f,_=Math.min(p.width,p.height*v),y=_/v;p.x+=.5*(p.width-_),p.y+=.5*(p.height-y),p.width=_,p.height=y}l=p.width/t.getScaleX(),c=p.height/t.getScaleY(),(t.getWidth()!=l||t.getHeight()!==c)&&t.setSize(l,c);var m=p.x+h.x*p.width,b=p.y+h.y*p.height,x=t.getPosition();(m!==x.x||b!==x.y)&&t.setPosition(m,b)}}},isScrollBarVisible:function(){return!!this._79O},setScrollBarVisible:function(t){var e=this;t!==e.isScrollBarVisible()&&(t?(Mr(e._view,e._79O=xr()),Mr(e._79O,e._27I=xr()),Mr(e._79O,e._28I=xr())):(pl(e._79O),delete e._79O,delete e._27I,delete e._28I),e.fp("scrollBarVisible",!t,t))},getDebugTip:function(){return""},showScrollBar:function(){var t=this;t._79O&&(t._85I||(J((function(){t._86I()}),ws),t.iv()),t._85I=new Date)},_86I:function(){var t=this;if(t._85I){var e=new Date,i=e.getTime();i-t._85I.getTime()>=ws?(delete t._85I,t.iv()):J((function(){t._86I()}),ws)}},getVScrollBar:function(){return this._27I},getHScrollBar:function(){return this._28I},_98O:function(){var t=this,e=this._27I,i=this._28I;if(t._79O){if(t._autoHideScrollBar&&!t._85I)return e.style.visibility=ce,void(i.style.visibility=ce);var n=t.getScrollBarColor(),r=t._zoom,o=t.getScrollBarSize(),a=t.getViewRect(),s=t.getScrollRect(),l=a.height*r,c=s.height*r,h=a.width*r-o-2,u=l*((a.y-s.y)*r/c),d=l*(l/c),f=e.style;c-.5>l?(Cs>d&&(u=u+d/2-Cs/2,0>u&&(u=0),u+Cs>l&&(u=l-Cs),d=Cs),Gr(e,h,u,o,d),f.visibility=he,f.background=n,f.borderRadius=o/2+It):f.visibility=ce;var g=a.width*r,p=s.width*r,v=(u=a.height*r-o-2,h=g*((a.x-s.x)*r/p),g*(g/p));f=i.style;p-.5>g?(Cs>v&&(h=h+v/2-Cs/2,0>h&&(h=0),h+Cs>g&&(h=g-Cs),v=Cs),Gr(i,h,u,v,o),f.visibility=he,f.background=n,f.borderRadius=o/2+It):f.visibility=ce}},setDataModel:function(t){var e=this,i=e._dataModel,n=e._selectionModel;i!==t&&(i&&(i.ump(e.handleDataModelPropertyChange,e),i.umm(e.handleDataModelChange,e),i.umd(e.handleDataPropertyChange,e),i.removeIndexChangeListener(e._75O,e),i.removeHierarchyChangeListener(e.handleHierarchyChange,e),n||i.sm().ums(e.handleSelectionChange,e)),e._dataModel=t,t.mp(e.handleDataModelPropertyChange,e),t.mm(e.handleDataModelChange,e),t.md(e.handleDataPropertyChange,e),t.addIndexChangeListener(e._75O,e),t.addHierarchyChangeListener(e.handleHierarchyChange,e),n?n._21I(t):t.sm().ms(e.handleSelectionChange,e),e.invalidateAll(!0),e.fp(Ge,i,t),e.updateBackground())},getLayersInfo:function(){if(this._layersInfo===i){var t=this.getLayers();t?(this._layersInfo={},t.forEach((function(t){var e=kn(t)?t.name:t;this._layersInfo[e]=t}),this)):this._layersInfo=null}return this._layersInfo},calculateEdgePosition:function(t,e,i){var n,r,o=this,a=o.getDataUI(t),s=oh(a),l=uh(e,(function(t){return ch(s,100*t)}),100,.001),c=ch(s,100*l);if(!i){var h=hh(a),u=new qa(c.x,c.y),d=49/(o._zoom*o._zoom);for(n=0,r=h.length;r>n;n++)if(u.distanceToSquared(h[n])<d)return{index:n,point:h[n],distance:Math.sqrt((h[n].x-e.x)*(h[n].x-e.x)+(h[n].y-e.y)*(h[n].y-e.y))}}return{percent:l,point:c,distance:Math.sqrt((c.x-e.x)*(c.x-e.x)+(c.y-e.y)*(c.y-e.y))}},calculateAttachPoint:function(){var t=new qa,e=new qa,i=new qa;return function(n,r){var o=this.getAttachPoints(n);if(!o||!o.length)return null;i.set(r.x,r.y);for(var a,s,l,c,h,u=1/0,d=0,f=o.length;f>d;d++)l=o[d],e.x=l.x,e.y=l.y,t.x=l.offsetX||0,t.y=l.offsetY||0,c=jc(this,n,0,t.x,t.y,e.x,e.y),s=i.distanceToSquared(c),u>s&&(a=d,u=s,h=c);u=Math.sqrt(u);var g=this.getAttachStyle(n);if("close"===g){var p=n.s("attach.close.threshold")/this._zoom;if(u>p)return null}return{index:a,distance:u,info:o[a],point:h}}}(),getAttachPoints:function(t){var e=t.s("attach.points");if(e)return e;var i=zs(t._image);return i?dc(i.attachPoints,t,this)||null:void 0},getAttachStyle:function(t){var e=t.s("attach.style");if(e)return e;var i=zs(t._image);return i?dc(i.attachStyle,t,this)||"close":void 0},updateLayers:function(){this._layersInfo=i,this.invalidateSelection(),this.redraw()},updateBackground:function(){var t=this.dm().a("width"),e=this.dm().a("height");this._canvas.style.background=t>0&&e>0?"":this.dm().getBackground()||""},handleDataModelPropertyChange:function(t){if("background"===t.property){var e=this._canvas.style.background,i=t.newValue||"";this.updateBackground(),this.fp("canvasBackground",e,i),this.redraw()}else"a:width"===t.property||"a:height"===t.property?(this._83I=1,this.updateBackground(),this.redraw()):"layers"===t.property?this.updateLayers():"hierarchicalRendering"===t.property&&this.redraw()},handleDataPropertyChange:function(t){this.dm().isHierarchicalRendering()&&"parent"===t.property&&t.data.hasChildren()&&this.redraw(),this.invalidateData(t.data)},onPropertyChanged:function(t){var e=this,i=t.property;if(e.redraw(),"zoom"===i){var n=e.sm().getSelection();n.size()&&n.each((function(t){t.invalidate()}))}else"dataModel"===i&&(e._83I=1);Cc[i]?e.showScrollBar():i===pe&&e.onCurrentSubGraphChanged(t)},onCurrentSubGraphChanged:function(){this.sm().cs(),this.reset()},handleDataModelChange:function(t){var e=this,i=t.kind,n=t.data;if(e._83I=1,"add"===i)e.invalidateData(n),jn(n)&&n.getEdgeGroup()&&n.getEdgeGroup().eachSiblingEdge(e.invalidateData,e);else if(i===At){e._21Q(n);var r=n._id,o=e._25I[r];if(o){if(e._56I[r]){var a=o._79o();a&&e.redraw(a)}o.dispose(),delete e._25I[r],delete e._24I[r],delete e._56I[r]}n===e._currentSubGraph&&e.setCurrentSubGraph(l)}else i===Vt&&(e.invalidateAll(!0),e.setCurrentSubGraph(l))},_75O:function(t){this.invalidateData(t.data)},handleHierarchyChange:function(t){this.dm().isHierarchicalRendering()&&t.data.hasChildren()&&this.redraw(),this.invalidateData(t.data)},adjustIndex:function(t){var e=this;if(e.isVisible(t)){e.dm().beginTransaction();for(var i=t;i._parent&&e.isVisible(i._parent);)i=i._parent;i&&i!==t&&e._dataModel.adjustIndex(i),e._dataModel.adjustIndex(t),e.dm().endTransaction()}},getImage:function(t){return t.getImage?t.getImage():i},getSelectWidth:function(t){var e=zs(this.getImage(t));return e&&dc(e.disableSelectedBorder,t,this)?0:t.s("select.width")},getSelectColor:function(t){return t.s("select.color")},isSelectable:function(t,e){if(this.isSelected(t))return!0;if(!e&&t.getParent()instanceof du&&this.isSelectable(t.getParent(),!0)&&t.getParent().isSyncSize())return!1;var i=this.getLayersInfo();if(i){var n=i[t._layer];if(n&&!1===n.selectable)return!1}return t.s("2d.selectable")&&this.sm().isSelectable(t)},isMovable:function(t){var e=this;if(jn(t)&&t.getStyle(se)!==Nt)return!1;var i=this.getLayersInfo();if(i){var n=i[t._layer];if(n&&!1===n.movable)return!1}return!!t.s("2d.movable")&&(!e._movableFunc||e._movableFunc(t))},isEditable:function(t){var e=this;if(c._uiSerializing)return e._uieditable;if(!e._editInteractor||!e.isSelected(t))return!1;if(Hn(t)){var i=e.getDataUI(t);if(!i||i._88I)return!1}if(jn(t)&&t.getStyle(se)!==Nt)return!1;var n=this.getLayersInfo();if(n){var r=n[t._layer];if(r&&!1===r.editable)return!1}return!!t.s("2d.editable")&&(!e._editableFunc||e._editableFunc(t))},handleDelete:function(){this._editInteractor&&(this._editInteractor.handleDelete?this._editInteractor.handleDelete():this.removeSelection())},isPointEditable:function(t){return(!Fn(t)||0===t.getRotation())&&(!this._pointEditableFunc||this._pointEditableFunc(t))},isRectEditable:function(t){return!this._rectEditableFunc||this._rectEditableFunc(t)},isAnchorEditable:function(t){return!this._anchorEditableFunc||this._anchorEditableFunc(t)},isRotationEditable:function(t){return!(!t.setRotation||!1===t.IRotatable)&&(!this._rotationEditableFunc||this._rotationEditableFunc(t))},isSourceTargetEditable:function(){return!0},getRotationPoint:function(t){var e=t.getAnchor(),i=t.getScale(),n=this._zoom,r=Zo(t.getRotation(),0,-t.getHeight()*i.y*e.y-(i.y<0?-1:1)*(lt?32:16)/n),o=t.p();return r.x+=o.x,r.y+=o.y,r},getLogicalPoint:function(t){var e=this;return dl(t,e._canvas,e.tx(),e.ty(),e._zoom,e._zoom)},getScreenPoint:function(t,e){var n,r=this;return"object"==typeof t?t.x!==i?(n=t.x,e=t.y):(n=t[0],e=t[1]):n=t,fl(n,e,r._canvas,r.tx(),r.ty(),r._zoom,r._zoom)},getSelectedDataAt:function(t){var e=this;return this.getDataAt(t,(function(t){return e.isSelected(t)}))},getDataInfoAt:function(t,e,i){var n,r=this.lp(t),o=this.getDataAt(r,e,i);if(o){var a=this.getDataUI(o);n={data:o,ui:a,point:r};var s=a._38o;if(s){var c=s.icons;for(var h in c){var u=c[h],d=s.rects[h];if(d)for(var f=dc(u.names,o,this),g=f?f.length:0,p=d.rotation,v=g-1;v>=0;v--){var _=f[v],y=d[v];if(al(y,r,p))return n.part="icons",n.name=h,n.icon=_,n.rect=y,n.index=v,n.rotation=p,n}}}if(this.isNoteVisible(o)){if(a.note2Info&&al(a.note2Info.clickRect,r,l,a.note2Info.scale))return n.part="note2",n;if(a.noteInfo&&al(a.noteInfo.clickRect,r,l,a.noteInfo.scale))return n.part="note",n}if(this.isLabelVisible(o)){if(a.label2Info&&al(a.label2Info.rect,r,a.label2Info.rotation,a.label2Info.scale))return n.part="label2",n;if(a.labelInfo&&al(a.labelInfo.rect,r,a.labelInfo.rotation,a.labelInfo.scale))return n.part="label",n}if(o.isInRect&&o.isInRect(r))return n.part="body",n}return n},getDataAt:function(t,e,i){t.target&&(t=this.lp(t));var n,r=this._zoom;return this.reverseEach((function(o){return(e?e(o):this.isSelectable(o))&&this.rectIntersects(o,Tn(t.x,t.y,i,r))?(n=o,!1):void 0}),this),n},getIconInfoAt:function(t,e){var i=this;if(t.target&&(t=i.lp(t)),e||(e=i.getDataAt(t)),e){var n=i.getDataUI(e);if(n&&n._38o){var r,o=n._38o,a=new gc;for(r in o.icons)a.add(r);for(var s=a.size()-1;s>=0;s--){r=a.get(s);for(var c=o.rects[r],h=c.rotation,u=c.length-1;u>=0;u--){var d=c[u],f=d.width,g=d.height,p={x:t.x-d.x-f/2,y:t.y-d.y-g/2};h!=l&&(p=Zo(-h,p.x,p.y));d={x:-f/2,y:-g/2,width:f,height:g};if(al(d,p))return{key:r,index:u,name:o.icons[r].names[u],rect:c[u],point:t,rotation:h,relativeRect:d,relativePoint:p,data:e}}}}}return l},getDatasInRect:function(t,e,n){n===i&&(n=1);var r=this,o=new gc;return r.reverseEach((function(i){n&&!r.isSelectable(i)||(e?r.rectIntersects(i,t):r.rectContains(i,t))&&o.add(i)})),o},moveSelection:function(t,e){var i=this;i.dm().beginTransaction(),na(i.sm().toSelection(i.isMovable,i),t,e),i.dm().endTransaction()},moveDatas:function(t,e,i){var n=this;n.dm().beginTransaction(),t instanceof gc||(t=new gc(t)),na(t,e,i),n.dm().endTransaction()},getDataUIBounds:function(t){var e=this.getDataUI(t);return e?e._79o():l},drawData:function(t,e,i){var n=this.getDataUI(e);if(n){var r=n._79o();(!i||ll(i,r))&&(n._42(t),e instanceof c.Block&&e.eachChild((function(e){this.isVisible(e)&&this.drawData(t,e,i)}),this))}},getBoundsForGroup:function(t){return t.s(Ft)?this.getDataUIBounds(t):l},isPixelPerfect:function(t){return t.s("pixelPerfect")},rectIntersects:function(t,e){this.validate();var i=l;if(this._56I[t._id]){var n=this._25I[t._id];if(n){var r=n._79o();if(sl(e,r))i=!0;else if((e=cl(e,r))&&(n.rectIntersects&&(i=n.rectIntersects(e)),i==l)){if(!this.isPixelPerfect(t))return!0;var o=e.x,a=e.y,s=e.width,c=e.height,h=this._zoom,d=u.hitMaxArea,f=s*c*h*h;if(f>d){var g=Math.sqrt(d/f);h*=g}s*=h,c*=h,2>s&&(s=2),2>c&&(c=2),o*=h,a*=h;var p=xo(s,c);Vr(p,-o,-a),p.scale(h,h),this._drawForChecking=!0,this.drawData(p,t,e),this._drawForChecking=!1;try{for(var v=0,_=p.getImageData(0,0,s,c).data;v<_.length;v+=4)if(0!==_[v+3]){i=!0;break}p.restore()}catch(x){mo=l,i=!1}}}}return!!i},rectContains:function(t,e){if(this._56I[t._id]){var i=this._25I[t._id];if(i)return sl(e,i._79o())}return!1},reset:function(){this.setZoom(1),this.setTranslate(0,0)},handleKeyDown:function(t){if(!u.isInput(t.target)){var e=this,i=e._focusData,n=i&&e._25I[i._id],r=0,o=e._dataModel._datas;if(!(i&&i._enabled&&i._editable&&n&&n.onKeyDown&&!0===n.onKeyDown(t)))if(9===t.keyCode&&(i&&(r=o.indexOf(i),$s(t)?-1===--r&&(r=0):++r===o.size()&&(r=0)),e._focusData=i=o.get(r),e.sm().setSelection(i)),to(t)?e.selectAll():go(t)&&e.isResettable()&&e.reset(),e.sm().isEmpty()){if(e._editing)return;var a=e.tx(),s=e.ty(),l=!1,c=$s()?100:10;co(t)&&(a-=c,l=!0),ho(t)&&(s-=c,l=!0),uo(t)&&(a+=c,l=!0),fo(t)&&(s+=c,l=!0),l&&e.setTranslate(a,s)}else{eo(t)&&e.handleDelete(t);var h=$s()?10:1;co(t)&&(e.moveSelection(-h,0),e.fi({kind:"moveLeft"})),ho(t)&&(e.moveSelection(0,-h),e.fi({kind:"moveUp"})),uo(t)&&(e.moveSelection(h,0),e.fi({kind:"moveRight"})),fo(t)&&(e.moveSelection(0,h),e.fi({kind:"moveDown"}))}}},handleScroll:function(t,e){if(Os(t),this.isZoomable()){if(!this.getEditInteractor()){var i=this.getDataAt(t);if(i){var n=zs(this.getImage(i));if(n&&dc(n.scrollable,i,this))return}}var r=this.lp(t);e>0?this.scrollZoomIn(r):0>e&&this.scrollZoomOut(r)}},handlePinch:function(t,e,i){this.isZoomable()&&(Math.abs(e-i)<u.pinchZoomThreshold||(e>i?this.pinchZoomIn(t):this.pinchZoomOut(t)))},checkDoubleClickOnNote:function(t,e){var i=this,n=i.lp(t),r=i.getDataUI(e),o=r.note2Info;return o&&e.s("note2.toggleable")&&al(o.clickRect,n)?(e.s(re,!e.s(re)),i.fi({kind:"toggleNote2",event:t,data:e}),!0):(o=r.noteInfo,!!(o&&e.s("note.toggleable")&&al(o.clickRect,n))&&(e.s(ne,!e.s(ne)),i.fi({kind:"toggleNote",event:t,data:e}),!0))},_84o:function(){},isNoteVisible:function(){return this._zoom>.15},isLabelVisible:function(){return this._zoom>.15},isEditVisible:function(){return this._zoom>.15},autoScroll:function(t,e){var i=this,n=i.getAutoScrollZone(),r=n/i.getZoom(),o=n/4,a=i._29I,s=i.lp(t),l={x:i.tx(),y:i.ty()};return s&&n>0&&a&&(s.x-a.x<r?i.translate(o,0):a.x+a.width-s.x<r&&i.translate(-o,0),s.y-a.y<r?i.translate(0,o):a.y+a.height-s.y<r&&i.translate(0,-o)),l.x=i.tx()-l.x,l.y=i.ty()-l.y,e&&(e.x+=l.x,e.y+=l.y),l},getMoveMode:function(t,e){var i=e.s("2d.move.mode");return i||(Zi["88"]?"x":Zi["89"]?"y":"xy")},getSerializableProperties:function(){return{scrollBarColor:1,scrollBarSize:1,autoMakeVisible:1,autoHideScrollBar:1,editable:1,resettable:1,pannable:1,rectSelectable:1,autoScrollZone:1,visibleFunc:1,movableFunc:1,editableFunc:1,pointEditableFunc:1,rectEditableFunc:1,anchorEditableFunc:1,rotationEditableFunc:1,rectSelectBackground:1,rectSelectBorderColor:1,editPointSize:1,editPointBorderColor:1,editPointBackground:1,hoverDelay:1,dataModel:1,selectionModel:1,currentSubGraph:1,zoom:1,translateX:1,translateY:1}},serializeProperty:function(t,e,i){var n=this;return"currentSubGraph"===e?{__i:t.getId()}:i.serializeProperty(t,e,n)},deserializeProperty:function(t,e,i){var n=this;if("currentSubGraph"===e){var r=n.dm(),o=r.__idMap;return o[t.__i]}return i.deserializeProperty(t,e,n)},setDefaultCursor:function(t,e){this._defaultCursor=t,!1!==e&&this.setCursor(t)},setCursor:function(t){"default"===t&&(t=this._defaultCursor||t);var e=this.getView().style;e.cursor=t,e.cursor="-webkit-"+t,e.cursor="-moz-"+t},getCurrentConnectActionType:function(){return this._currentActionType},setCurrentConnectActionType:function(t){return!(t!==l&&!u.getConnectAction(null,t))&&(this._currentActionType=t,this.redraw(),!0)},getEditStyle:function(t){var e=this.getEditInteractor();return e?e.getStyle(t):i},setEditStyle:function(t,e,i){var n=this.getEditInteractor();return!!n&&(n.setStyle(t,e,i),!0)},isConnectActionVisible:function(t){var e=u.getConnectAction(this);if(!e)return!1;var i=e.visible;return An(i)&&(i=i(this,t)),i},isInteractive:function(t){if(this._drawForChecking)return!1;var e=zs(this.getImage(t));return!(!e||!dc(e.interactive,t,this))||t.s("interactive")},appendHTML:function(t,e){var i=this.getView();if(!(e||t&&t.parentNode!==i))return!1;var n=t.getView&&t.getView();if(!e&&n&&n.parentNode===i)return!1;(t.getView||t.isSelfViewEvent)&&(t=t.getView());var r=this.getEditInteractor();return r&&r._canvas?i.insertBefore(t,r._canvas):this.isScrollBarVisible()?i.insertBefore(t,this.getView().lastChild):Mr(i,t),!0},_layoutHTMLImpl:function(t,e,i){if(arguments.length>1){var n,r=this,o=r._zoom;if(e.getView&&(n=e,e=e.getView()),e.style.position="absolute",i){var a=t.getRect();Gr(n||e,r.tx()+a.x*o,r.ty()+a.y*o,a.width*o,a.height*o)}else{var s=new Ha,l=(a=t.getAnchorRect(),t.getPosition()),c=t.getScale(),h=e.style;Gr(n||e,a),s.appendTranslate(r.tx(),r.ty()),s.appendScale(o,o),s.append(new Ha(t.getRotation(),l.x,l.y,c.x,c.y)),Rr(h,"transform","matrix("+s.a.toFixed(5)+", "+s.b.toFixed(5)+", "+s.c.toFixed(5)+",\n    "+s.d.toFixed(5)+", "+s.tx.toFixed(5)+", "+s.ty.toFixed(5)+")"),Rr(h,"transformOrigin",(-a.x).toFixed(5)+"px "+(-a.y).toFixed(5)+"px"),e.updateAppendMatrix=!0}}else this._layoutHTML&&this._layoutHTML()},getTextEditInfo:function(t){return t instanceof gu?{name:"text",accessType:"s",isMultiline:!1}:void 0},getState:function(t){var e="state",i=t.s(e);if(i)return i;var n=zs(t._image);return n?dc(n[e],t,this)||null:void 0},getShape:function(t){return t.getStyle(Rt)}}),e.defineProperties(Jc.GraphView.prototype,{layoutHTML:{get:function(){return this._layoutHTMLImplBind||(this._layoutHTMLImplBind=this._layoutHTMLImpl.bind(this)),this._layoutHTMLImplBind},set:function(t){this._layoutHTML=t}}});var Cu=function(t,e){var i=this;i.gv=t,i.s=function(t){return e.getStyle(t)},i._data=e,i._87I=new gc};bl(Cu,e,{_6I:l,ms_icons:1,_84o:function(){},dispose:function(){},isShadowed:function(){return this.s("shadow")||this.gv.isSelected(this._data)&&"shadow"===this.s("select.type")},getSelectWidth:function(){var t=this,e=t.gv.isSelected(t._data);return!e||t.isShadowed()?0:t.gv.getSelectWidth(t._data)},getSelectColor:function(){return this.gv.getSelectColor(this._data)},getBodyColor:function(t){var e=this._data,i=this.gv.getBodyColor(e);return i||(t?e.getStyle(t):l)},_2Q:function(t){return this.s(t)},_1Q:function(t,e,i,n){var r=this.s,o=r("2d.gray"),a=r(e+".dash.color");if(o&&(a=u.toGrayColor(a)),t.strokeStyle=a,t.lineWidth=i,t.stroke(),r(e+".dash.3d")){var s=r(e+".dash.3d.color");zo(t,a,o?u.toGrayColor(s):s,i,this.gv._zoom,r(e+".dash.3d.accuracy"))}Xl(t,n)},invalidate:function(){this._6I=l},_79o:function(){var t=this;if(!t._6I){var e=t._data,i=t.gv;t.labelInfo=t.label2Info=t.noteInfo=t.note2Info=t._38o=l,t._87I.clear(),t.interactiveInfo=i.isInteractive(e)?{}:l,t._3O(),t._55O=i.isEditable(e)?{_42O:i.isRectEditable(e),_43O:i.isPointEditable(e),_56O:i.isRotationEditable(e)}:l,t._6I=t._81o()}return t._6I},_3O:function(){},getPosition:function(){return un},_68o:function(t,e){t&&this._87I.add(Mo(t,e))},_81o:function(){var t,e=this,i=e.s;if(e._24O(Yt,"getLabel"),e._24O(Zt,"getLabel2"),e._26O(Jt,"getNote"),e._26O(Kt,"getNote2"),e._15O(),e._55O&&e._48O(),e._87I.each((function(e){t=ol(t,e)})),t){var n=e.isShadowed(),r=i("shadow2"),o=Hs(t);r?(o.x+=i("shadow2.offset.x"),o.y+=i("shadow2.offset.y"),ul(o,i("shadow2.blur"))):n&&(o.x+=i("shadow.offset.x"),o.y+=i("shadow.offset.y"),ul(o,i("shadow.blur"))),t=ol(t,o)}return e._87I.clear(),t},_42:function(t){var e=this,i=e._data,n=e.gv,r=e.s,o=r("opacity"),a=this.isShadowed(),s=r("shadow2");if(a||s){var c=t.shadowOffsetX,h=t.shadowOffsetY,u=t.shadowBlur,d=t.shadowColor,f=n.getZoom(),g=a?"shadow":"shadow2";t.shadowOffsetX=r(g+".offset.x")*f,t.shadowOffsetY=r(g+".offset.y")*f,t.shadowBlur=r(g+".blur")*f,t.shadowColor=a?e.getSelectColor():r(g+".color")}if(o!=l){var p=t.globalAlpha;t.globalAlpha=o}e._80o(t),n.isLabelVisible(i)&&((!n._drawForChecking||r("label.selectable"))&&Wc(t,e.labelInfo),(!n._drawForChecking||r("label2.selectable"))&&Wc(t,e.label2Info)),n.isNoteVisible(i)&&(Nc(t,e.noteInfo),Nc(t,e.note2Info)),e._99O(t),o!=l&&(t.globalAlpha=p),(a||s)&&(t.shadowOffsetX=c,t.shadowOffsetY=h,t.shadowBlur=u,t.shadowColor=d)},_80o:function(){},_47O:function(){},_24O:function(t,e){var i=this,n=i._data,r=i.gv,o=i.s,a=r[e](n);if(a!=l){var s=o(t+".scale"),c=o(t+".max"),h=o(t+".position"),u=i[t+"Info"]={label:a,scale:s,color:r[e+"Color"](n),font:o(t+".font"),opacity:o(t+".opacity"),align:o(t+".align"),rotation:i.getRotation(o(t+".rotation"),!1,h),background:r[e+"Background"](n)},d=Tr(u,a);c>0&&c<d.width&&(u.labelWidth=d.width,d.width=c),1!==s&&(d.width*=s,d.height*=s);var f=i.getPosition(h,o(t+".offset.x"),o(t+".offset.y"),d,o(t+".position.fixed"));if(d.x=f.x-d.width/2,d.y=f.y-d.height/2,i._68o(u.rect=d,u.rotation),1!==s){var g=d.width/s,p=d.height/s;u.rect={x:f.x-g/2,y:f.y-p/2,width:g,height:p}}}},_26O:function(t,e){var i=this,n=i.gv,r=i._data,o=i.s,a=n[e](r);if(a!=l){var s,c,h=o(t+".scale"),u=i[t+"Info"]={note:a,scale:h,data:r,view:n,expanded:o(t+".expanded"),font:o(t+".font"),color:o(t+".color"),opacity:o(t+".opacity"),align:o(t+".align"),icon:o(t+".icon"),backgroundImage:o(t+".backgroundImage"),borderWidth:o(t+".border.width"),borderColor:o(t+".border.color"),background:n[e+"Background"](r)},d=i.getPosition(o(t+".position"),o(t+".offset.x"),o(t+".offset.y")),f=d.x,g=d.y;if(u.expanded){var p,v=o(t+".max"),_=o(t+".backgroundImage");_?(_=zs(_),p={width:hc(_,r),height:uc(_,r)}):p=Tr(u,a),p.width+=6,p.height+=2,v>0&&v<p.width&&(u.labelWidth=p.width,p.width=v),s=p.width,c=p.height+8,u.clickRect={x:f-s*h/2,y:g-c*h,width:s*h,height:c*h*p.height/c}}else{var y=o(t+".icon");y?(y=zs(y),s=hc(y,r),c=uc(y,r)):(s=12,c=18),u.clickRect={x:f-s*h/2,y:g-c*h,width:s*h,height:c*h}}u.rect={x:f-s/2,y:g-c*h/2-c/2,width:s,height:c};var m=T(u.borderWidth/2)*h;i._68o({x:f-s*h/2-m,y:g-c*h-m,width:s*h+2*m,height:c*h+2*m})}},_48O:function(){},_99O:function(t){var e=this,i=e._38o;if(i){var n=e.gv,r=e._data,o=i.icons,a=e.interactiveInfo;for(var s in a&&(a._38o={}),o){var c=o[s],h=i.rects[s];if(h){a&&(a._38o[s]=[]);var u=dc(c.opacity,r,n),d=dc(c.names,r,n),f=d?d.length:0,g=h.rotation;if(u!=l){var p=t.globalAlpha;t.globalAlpha*=u}for(var v=0;f>v;v++){var _=d[v],y=zs(_),m=h[v];if(g){var b=m.x+m.width/2,x=m.y+m.height/2;t.save(),Vr(t,b,x),Br(t,g),Vr(t,-b,-x)}a&&a._38o[s].push(t.interactiveInfo={compInfos:[],matrix:g?new Ha(g,b,x).appendTranslate(-b,-x):new Ha}),Vs(t,y,dc(c.stretch,r,n),m.x,m.y,m.width,m.height,e._data,e.gv),t.interactiveInfo=l,g&&t.restore()}u!=l&&(t.globalAlpha=p)}}}}});var Su=function(t,e){Kn(Su,this,[t,e])};bl(Su,Cu,{_checkEmptyRect:!0,_40O:function(t,e){var i=this,n=i.s,r=t.rect;(t.borderColor=i.gv.getBorderColor(i._data))&&(t.borderType=n("border.type"),t.borderWidth=n("border.width"),t.borderPadding=n("border.padding"),e=P(e,t.borderPadding+t.borderWidth/2));var o=i._data.getScale(),a=P(1,P(O(o.x),O(o.y)));if(t.selectWidth=i.getSelectWidth()){var s=i.gv._zoom;t.selectType=n("select.type"),t._97o=i.getSelectColor(),t.selectPadding=n("select.padding"),e=P(e,(t.selectPadding+t.selectWidth/2/s)/a)}e>0&&(e*=a,r=Hs(r),ul(r,e)),i._68o(r)},_39O:function(t,e){var i,n=this,r=e.rect;if(e.borderWidth>0&&(i=e.borderPadding,t.strokeStyle=e.borderColor,t.lineWidth=e.borderWidth,Vo(t,e.borderType,{x:r.x-i,y:r.y-i,width:r.width+2*i,height:r.height+2*i}),t.stroke()),e.selectWidth>0){var o=n.gv._zoom;if(i=e.selectPadding,t.strokeStyle=e._97o,t.lineWidth=e.selectWidth/o,e.rotation!=l){t.save(),t.translate(e.position.x,e.position.y),t.rotate(e.rotation);var a=n._data,s=a.getWidth(),c=a.getHeight(),h=e.scale,u=e.anchor;r={x:h.x*-s*u.x,y:h.y*-c*u.y,width:h.x*s,height:h.y*c}}Vo(t,e.selectType,{x:r.x-i,y:r.y-i,width:r.width+2*i,height:r.height+2*i}),e.rotation!=l&&t.restore(),t.stroke()}},dispose:function(){var t=this,e=t._htmlView;Su.superClass._3O.call(t),e&&(e.onHTMLRemoved&&e.onHTMLRemoved(),pl(e))},_3O:function(){var t=this,e=t.s,i=t._data,n=t.gv,r=n.getShape(i),o=t.getBodyColor(),a=t._83o=r?{shape:r,_53o:t.getBodyColor("shape.background"),_27Q:zs(e("shape.repeat.image"),o),shapeGradientPack:e("shape.gradient.pack"),_54o:e("shape.border.width"),_55o:e("shape.border.color"),_56o:e("shape.border.3d"),_57o:e("shape.border.3d.color"),_58o:e("shape.border.3d.accuracy"),shapeGradient:e("shape.gradient"),_59o:e("shape.gradient.color"),_60o:e("shape.border.pattern"),_61o:e("shape.border.cap"),_62o:e("shape.border.join"),shapeForeground:e("shape.foreground"),bodyColor:o,gray:e("2d.gray")}:{img:zs(n.getImage(i),o),bodyColor:o,gray:e("2d.gray"),stretch:e("image.stretch")};if(N&&!q);else{var s,c=a.img;c&&c.renderHTML?(t._htmlInfo&&t._htmlInfo.img!==c&&(t._htmlInfo=l),t._htmlInfo||(t._htmlInfo={img:c,cache:{}}),s=c.renderHTML(i,n,t._htmlInfo.cache)):t._htmlInfo=l,t._htmlView&&t._htmlView!==s&&(t._htmlView.onHTMLRemoved&&t._htmlView.onHTMLRemoved(),pl(t._htmlView.getView?t._htmlView.getView():t._htmlView)),(t._htmlView=s)&&n.appendHTML(s)&&(s.onHTMLAddedSync&&s.onHTMLAddedSync(),s.onHTMLAdded&&Ls(s.onHTMLAdded)),a.rect=i.getRect(),a.position=i.p(),a.scale=i.getScale(),a.anchor=i.getAnchor(),a.rotation=i.getRotation(),r===Pt&&(a._63o=e("shape.depth"));var h=0;if(r)h=Io(l,a._54o/2,a._62o),t.s("shape.dash")&&(h=P(h,(t.s("shape.dash.width")||a._54o)/2));else if(c&&c.boundExtend)if(h=dc(c.boundExtend,i,n),c.boundExtendAbsolute){var u=i.getScale();h/=n._zoom*P(1,P(O(u.x),O(u.y)))}else if(!dc(c.fitSize,i,n)){var d=dc(c.width,i,n),f=dc(c.height,i,n);h*=P(i.getWidth()/d,i.getHeight()/f)}t._40O(a,h);var g=e("clip.percentage");if(1>g&&(0>g&&(g=0),a.clipRect=cr(i.getAnchorRect(),e("clip.direction"),g)),r){var p=e("shape.fill.clip.percentage");1>p&&(0>p&&(p=0),a.shapeClipRect=cr(i.getAnchorRect(),e("shape.fill.clip.direction"),p));var v=e("shape.foreground.clip.percentage");1>v&&(0>v&&(v=0),a.shapeForegroundClipRect=cr(i.getAnchorRect(),e("shape.foreground.clip.direction"),v))}}},getPosition:function(t,e,i,n){var r=la(t,this._83o.rect,n);return r.x+=e,r.y+=i,r},_80o:function(t){var e=this,i=e.s,n=e.gv,r=e._data,o=e._83o,a=o.rect,s=o.position,c=o.rotation,h=o.anchor,d=o.scale,f=o.shape,g=o.clipRect;if(!e._checkEmptyRect||a.width>0&&a.height>0){var p=r.getSize();if(p.x=-p.width*h.x,p.y=-p.height*h.y,t.save(),Vr(t,s.x,s.y),Br(t,c),Lr(t,d.x,d.y),g&&(t.beginPath(),t.rect(g.x,g.y,g.width,g.height),t.clip()),n._drawForChecking&&o.img&&!1===dc(o.img.pixelPerfect,r,n))Ao(t,p.x,p.y,p.width,p.height,"#888888");else if(e.freeDraw)e.freeDraw(t,p,o);else if(f){var v,_,y,m,b=o._60o,x=ql(t,b),w=o._27Q,C=o._54o,S=o.shapeGradientPack,I=o.gray,M=t.lineJoin,T=t.lineCap,E=function(t){return I?u.toGrayColor(t):t};"roundRect"===f?v=i("shape.corner.radius"):"polygon"===f?v=i("shape.polygon.side"):"arc"===f&&(v=i("shape.arc.from"),_=i("shape.arc.to"),y=i("shape.arc.close"),m=i("shape.arc.oval")),t.lineJoin=o._62o,t.lineCap=o._61o;var P=E(o._53o);if(P||w||S){var D=o.shapeClipRect;D&&(t.save(),t.beginPath(),t.rect(D.x,D.y,D.width,D.height),t.clip()),Vo(t,f,p,v,_,y,m),S?Po(t,S):w?Lo(t,w,E(o.bodyColor),null,r,n):Bo(t,P,o.shapeGradient,E(o._59o),p),t.fill(),D&&t.restore(),S&&t.restore(),t!==x&&Vo(x,f,p,v,_,y,m)}else Vo(x,f,p,v,_,y,m);var O=o.shapeForeground;if(O){t.save();var R=o.shapeForegroundClipRect;R&&(t.beginPath(),t.rect(R.x,R.y,R.width,R.height),t.clip()),Vo(t,f,p,v,_,y,m),Bo(t,O,i("shape.foreground.gradient"),E(i("shape.foreground.gradient.color")),p),t.fill(),t.restore()}if(C>0){var z=i("shape.border.width.absolute");z&&(t.save(),t.setTransform(1,0,0,1,0,0)),t.lineWidth=C;var k=E(o._55o);t.strokeStyle=k,t.stroke(),z&&t.restore(),o._56o&&zo(t,k,E(o._57o),C,n._zoom,o._58o)}if(Xl(t,b),i("shape.dash")){var A=i("shape.dash.width")||C;if(A>0){b=i("shape.dash.pattern");x=ql(t,b,e._2Q("shape.dash.offset"));x!==t&&Vo(x,f,p,v,_,y,m),e._1Q(t,"shape",A,b)}}Uo(t,P,o._63o,p),t.lineJoin=M,t.lineCap=T}else{var V=e.interactiveInfo;V&&(t.interactiveInfo=V.bodyInfo={compInfos:[],matrix:new Ha(c,s.x,s.y,d.x,d.y)}),o.gray&&(t.compGray=!0);var B=o.img;B&&B.cacheRule!=l&&(B=th(t,B,o.stretch,p.width,p.height,r,n,o.bodyColor)),Vs(t,B,o.stretch,p.x,p.y,p.width,p.height,r,n,o.bodyColor),t.compGray=!1,t.interactiveInfo=l}t.restore()}e._39O(t,o)},_48O:function(){},_47O:function(){}});var Iu=function(t,e){Kn(Iu,this,[t,e])},Mu=function(t,e,i,n){var r=nl(t,e);return i=n?D(i,r):qc(i,r),r?i/=r:i=0,{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}};bl(Iu,Cu,{_3O:function(){var t,e=this,n=e._data,r=e.gv,o=e.s,a=o(se),s=n.isLooped(),c=o("edge.width"),h=o("edge.center"),d=o("edge.offset"),f=r.getBorderColor(n),g=f?o("border.width"):0,p=e.getSelectWidth(),v=n._40I,_=n._41I,y=e._78o=v&&_?{looped:s,type:a,width:c,center:h,color:e.getBodyColor("edge.color"),borderColor:f,borderWidth:g,_97o:p?e.getSelectColor():l,selectWidth:p,pattern:o("edge.pattern"),cap:o("edge.cap"),join:o("edge.join"),is3d:o("edge.3d"),_67o:o("edge.3d.color"),_66o:o("edge.3d.accuracy"),gray:o("2d.gray")}:l;if(y){var m=u.getEdgeType(a);if(m){var b=m(n,Yc(e,r,n,s,a),r,e._19Q);b.points&&b.points.size()>1?(y.edgeTypeInfo=b,t=rl(y.edgeTypeInfo.points)):b[fe]&&b.rect&&(y.edgeTypeInfo=b,t=b.rect)}else{var x=o("edge.source.anchor.x"),w=o("edge.source.anchor.y"),C=o("edge.target.anchor.x"),S=o("edge.target.anchor.y"),I=Fc(r,n,"source"),M=Fc(r,n,"target");if(a===Nt){var T=y.points=o(ae)||pc,E=T.size();y.segments=o("edge.segments");var D=x!==i||w!==i||jn(v),O=C!==i||S!==i||jn(_);if(!h)if(d)D||(I=Mu(I,E?T.get(0):M,d,E)),O||(M=Mu(M,E?T.get(E-1):I,d,E));else{var R;D||(R=or(I,E?T.get(0):M,bc(r,v)),R&&(I={x:R[0],y:R[1]})),O||(R=or(E?T.get(E-1):I,M,bc(r,_)),R&&(M={x:R[0],y:R[1]}))}t=ol(rl(y.points),rl(I,M))}else{var z=Yc(e,r,n,s,a);if(e._19Q||(z=-z),s)I=Hs(I),I.x=r.getNodeRect(v).x,y.radius=z,t={x:I.x-z,y:I.y-z,width:2*z,height:2*z};else{var k=nl(I,M),A=qc(d,k),V={x:A,y:z},B={x:k-A,y:z},F=G(M.y-I.y,M.x-I.x),j=y.mat=new Ga(F);if(y.orienAngle=F,y.angle=M.x<I.x?F+L:F,y.rect={x:V.x,y:V.y,width:B.x-V.x,height:0},y.origin=I,V=j.tf(V),V.x+=I.x,V.y+=I.y,B=j.tf(B),B.x+=I.x,B.y+=I.y,h){var H={x:k,y:0};H=j.tf(H),H.x+=I.x,H.y+=I.y,t=rl([I,V,B,H]),y.c1=I,y.c2=H}else t=rl(V,B);I=V,M=B}}y.sourcePoint=I,y.targetPoint=M,n._lastSourcePoint=I,n._lastTargetPoint=M}var U=0;o("edge.dash")&&(U=o("edge.dash.width")||c);var W="square"===y.cap?.71:.5;Io(t,P(U*W,c*W+g+p),y.join),e._68o(t)}},getRotation:function(t,e,i){t=t||0;var n=this._78o;if(n){var r,o=n.angle,a=n.points,s=n.edgeTypeInfo;if(o!=l)return e?n.orienAngle+t:o+t;if(s&&s[fe])return s.getRotation?s.getRotation(this,t,e,i):0;if(s&&s.points){var c=s.points;return r=c.size(),wc[i]?r&&0===r%2?Xc(c.get(r/2-1),c.get(r/2),e,t):t:xc[i]?Xc(c.get(0),c.get(1),e,t):Xc(c.get(r-2),c.get(r-1),e,t)}if(a)return r=a.size(),wc[i]?r&&0===r%2?Xc(a.get(r/2-1),a.get(r/2),e,t):t:xc[i]?Xc(n.sourcePoint,r?a.get(0):n.targetPoint,e,t):Xc(r?a.get(r-1):n.sourcePoint,n.targetPoint,e,t)}return t},getPosition:function(t,e,i,n,r){var o=this._78o;if(o){var a=o.type,s=o.points,l=o.edgeTypeInfo,c=o.sourcePoint,h=o.targetPoint;if(!a)return o.looped?{x:c.x-o.radius+e,y:c.y+i}:(r&&c&&h&&(c.x>h.x||c.x===h.x&&c.y>h.y)&&(t=sa[t],i=-i),u=la(t,o.rect,n),u.x+=e,u.y+=i,u=o.mat.tf(u),u.x+=o.origin.x,u.y+=o.origin.y,u);if(l&&l[fe])return l.getPosition?l.getPosition(this,t,e,i,n,r):{x:(c.x+h.x)/2,y:(c.y+h.y)/2};if(s){var u,d=s.size();if(wc[t]){if(d){var f=d%2;if(0===f)return Qc(s.get(d/2-1),s.get(d/2),t,e,i,n,r);u=s.get((d-f)/2)}else u={x:(c.x+h.x)/2,y:(c.y+h.y)/2};return u=la(t,{x:u.x,y:u.y,width:0,height:0},n),u.x+=e,u.y+=i,u}return xc[t]?Qc(c,d?s.get(0):h,t,e,i,n,r):Qc(d?s.get(d-1):c,h,t,e,i,n,r)}if(l){var g=l.points;d=g.size();if(wc[t]){f=d%2;return 0===f?Qc(g.get(d/2-1),g.get(d/2),t,e,i,n,r):(u=g.get((d-f)/2),u=la(t,{x:u.x,y:u.y,width:0,height:0},n),u.x+=e,u.y+=i,u)}return xc[t]?Qc(g.get(0),g.get(1),t,e,i,n,r):Qc(g.get(d-2),g.get(d-1),t,e,i,n,r)}}return un},_42:function(t){this._78o&&Iu.superClass._42.call(this,t)},drawPath:function(t,e){t.beginPath();var i=e.type,n=e.points,r=e.segments,o=e.edgeTypeInfo;if(!i||n){var a=e.sourcePoint,s=a.x,l=a.y,c=e.targetPoint,h=c.x,u=c.y;if(i)if(r){var d=new gc({x:s,y:l});d.addAll(n),d.add({x:h,y:u}),Oo(t,d,r)}else t.moveTo(s,l),n.each((function(e){t.lineTo(e.x,e.y)})),t.lineTo(h,u);else e.looped?t.arc(s,l,e.radius,0,F,!0):e.center?(t.moveTo(e.c1.x,e.c1.y),t.lineTo(s,l),t.lineTo(h,u),t.lineTo(e.c2.x,e.c2.y)):(t.moveTo(s,l),t.lineTo(h,u))}else o&&(o.points?Oo(t,o.points,o.segments):o[fe]&&o[fe](t,o))},_80o:function(t){var e=this,i=e.s,n=e._78o,r=n.width,o=n.selectWidth,a=n.borderWidth,s=t.lineJoin,l=t.lineCap,c=n.gray,h=n.pattern;t.lineJoin=n.join,t.lineCap=n.cap,e.drawPath(ql(t,h),n);var d=i("edge.width.absolute");d&&(t.save(),t.setTransform(1,0,0,1,0,0)),o&&(t.strokeStyle=n._97o,t.lineWidth=r+2*(a+o),t.stroke()),a&&(t.strokeStyle=c?u.toGrayColor(n.borderColor):n.borderColor,t.lineWidth=r+2*a,t.stroke());var f=c?u.toGrayColor(n.color):n.color,g=c?u.toGrayColor(n._67o):n._67o;if(t.strokeStyle=f,t.lineWidth=r,t.stroke(),n.is3d&&zo(t,f,g,r,e.gv._zoom,n._66o),Xl(t,h),i("edge.dash")){h=i("edge.dash.pattern");var p=ql(t,h,e._2Q("edge.dash.offset"));p!==t&&e.drawPath(p,n),e._1Q(t,"edge",i("edge.dash.width")||r,h)}d&&t.restore(),t.lineJoin=s,t.lineCap=l},_48O:function(){},_47O:function(){}});var Tu=function(t,e){Kn(Tu,this,[t,e])};bl(Tu,Su,{_3O:function(){var t,e,i=this,n=i.s,r=i._data,o=i.gv;if(i._88I=l,r.isExpanded()&&r.eachChild((function(i){if(Fn(i)){var n=o.getBoundsForGroup(i);n&&(e||(e=[]),e.push(n),t=ol(t,n))}})),t){var a=o.getLabel(r),s=n("group.type"),c=n("group.border.width")||0,h=n("group.border.width.absolute"),u=c/2;h&&(c/=o._zoom),t=Zc(s,e,t),zc(t,r,"group.padding",1),ul(t,c);var d=i._88I={type:s,rect:t,_64o:t};if(!s&&a!=l){var f,g=i.labelInfo={label:a,color:n("group.title.color"),font:n("group.title.font"),align:n("group.title.align")},p=Tr(g,a),v=p.width+c,_=p.height+c,y=n("group.title.align"),m=n("group.title.orientation");if(m===vt||m===_t?(t.height+=c,v>t.width&&(t.width=v)):(m===gt||m===pt)&&(t.width+=c,v>t.height&&(t.height=v)),f=y===gt?t.x:y===pt?t.x+t.width-v:t.x+t.width/2-v/2,m===_t)d.titleRect={x:t.x,y:t.y+t.height,width:t.width,height:_},d.rect={x:t.x,y:t.y,width:t.width,height:t.height+_},g.rect={x:f,y:t.y+t.height,width:v,height:_};else if(m===gt){var b=d.titleRect={x:t.x-_,y:t.y,width:_,height:t.height};d.rect={x:t.x-_,y:t.y,width:t.width+_,height:t.height},g.rect={x:b.x+_/2-t.height/2,y:b.y+t.height/2-_/2,width:t.height,height:_},g.rotation=-Math.PI/2}else if(m===pt){b=d.titleRect={x:t.x+t.width,y:t.y,width:_,height:t.height};d.rect={x:t.x,y:t.y,width:t.width+_,height:t.height},g.rect={x:b.x+_/2-t.height/2,y:b.y+t.height/2-_/2,width:t.height,height:_},g.rotation=Math.PI/2}else d.titleRect={x:t.x,y:t.y-_,width:t.width,height:_},d.rect={x:t.x,y:t.y-_,width:t.width,height:t.height+_},g.rect={x:f,y:t.y-_-u,width:v,height:_+c}}i._40O(d,n("group.border.width")/2)}else Tu.superClass._3O.call(i)},getPosition:function(t,e,i,n){var r=this._88I;if(r){var o=la(t,r.rect,n);return o.x+=e,o.y+=i,o}return Tu.superClass.getPosition.apply(this,arguments)},_24O:function(t,e){var i=this._88I;(!i||i.type||"label2"===t)&&Tu.superClass._24O.call(this,t,e)},_80o:function(t){var e=this,i=e._88I;if(i){var n=e._data,r=e.s,o=e.gv,a=i.type,s=i.rect,l=i._64o,c=i.titleRect,h=e.getBodyColor(),u=zs(r("group.image"),h),d=r("group.image.stretch"),f=e.getBodyColor("group.background"),g=zs(r("group.repeat.image"),h),p=r("group.gradient.pack"),v=r("group.gradient"),_=r("group.gradient.color"),y=r("group.border.width"),m=r("group.border.color"),b=r("group.border.pattern"),x=r("group.title.orientation"),w=r("group.depth"),C=r("group.border.radius"),S=r("group.border.join"),I=r("group.border.cap"),M=r("group.border.width.absolute");if(M&&(y/=o._zoom),a){var T=t.lineJoin,E=t.lineCap;if(t.lineJoin=S,t.lineCap=I,u){if(t.save(),Vo(t,a,s,C),t.clip(),Vs(t,u,d,s.x,s.y,s.width,s.height,n,o,h),t.restore(),y>0){var P=ql(t,b);Vo(P,a,s,C),t.lineWidth=y,t.strokeStyle=m,t.stroke(),Xl(t,b)}}else{P=ql(t,b);f||g||p?(Vo(t,a,s,C),p?Po(t,p):g?Lo(t,g,h,null,n,o):Bo(t,f,v,_,s),t.fill(),p&&t.restore(),t!==P&&Vo(P,a,s,C)):Vo(P,a,s,C),y>0&&(t.lineWidth=y,t.strokeStyle=r("group.border.color"),t.stroke()),Xl(t,b),a===Pt&&Uo(t,f,w,s)}t.lineJoin=T,t.lineCap=E}else{var D=r("group.title.background");if((!C||0>C)&&(C=0),u)Vs(t,u,d,l.x,l.y,l.width,l.height,n,o,e.getBodyColor());else if(f||g)if(g?Lo(t,g,h,null,n,o):Bo(t,f,v,_,l),0===y)Vo(t,Pt,l),t.fill(),Uo(t,f,w,l);else{switch(t.beginPath(),x){case _t:Ho(t,l.x,l.y,l.width,l.height,C,C,0,0);break;case gt:Ho(t,l.x,l.y,l.width,l.height,0,C,0,C);break;case pt:Ho(t,l.x,l.y,l.width,l.height,C,0,C,0);break;case vt:Ho(t,l.x,l.y,l.width,l.height,0,0,C,C)}t.fill()}if(c&&D)if(0===y)Ao(t,c.x,c.y,c.width,c.height,D),Uo(t,D,w,c);else{switch(t.beginPath(),t.fillStyle=D,x){case _t:Ho(t,c.x,c.y,c.width,c.height,0,0,C,C);break;case gt:Ho(t,c.x,c.y,c.width,c.height,C,0,C,0);break;case pt:Ho(t,c.x,c.y,c.width,c.height,0,C,0,C);break;case vt:Ho(t,c.x,c.y,c.width,c.height,C,C,0,0)}t.fill()}if(y>0){P=ql(t,b);if(Vo(P,"roundRect",s,C),t.save(),t.lineWidth=y,t.strokeStyle=m,t.lineJoin=S,t.lineCap=I,t.closePath(),t.stroke(),c&&r("group.splitLine")){var O=c.x,R=c.y,z=c.width,k=c.height;t.beginPath(),x===_t?(t.moveTo(O,R),t.lineTo(O+z,R)):x===gt?(t.moveTo(O+z,R),t.lineTo(O+z,R+k)):x===pt?(t.moveTo(O,R),t.lineTo(O,R+k)):(t.moveTo(O,R+k),t.lineTo(O+z,R+k))}t.stroke(),t.restore(),Xl(P,b)}}e._39O(t,i)}else Tu.superClass._80o.call(e,t)}});var Eu=function(t,e){Kn(Eu,this,[t,e])};bl(Eu,Su,{_80o:function(t){this._39O(t,this._83o)}});var Pu=function(t,e){Kn(Pu,this,[t,e])};bl(Pu,Su,{_3O:function(){var t=this,e=t._data,i=t.s,n=t.gv,r=e.getPoints(),o=n.getBorderColor(e),a=o?i("border.width"):0,s=t.getSelectWidth(),c=i("shape.border.width"),h=e.getRect(),u=e.getAnchorRect(),d=n.getBodyColor(e),f=t._99o=r.isEmpty()?l:{rect:h,rotation:e.getRotation(),fillRule:i("shape.fill.rule"),scale:e.getScale(),position:e.p(),points:r,segments:e.getSegments(),bodyColor:d,borderColor:o,borderWidth:a,_94o:i("shape.border.3d"),_95o:i("shape.border.3d.color"),_96o:i("shape.border.3d.accuracy"),_97o:s?t.getSelectColor():l,selectWidth:s,_53o:i("shape.background"),_27Q:zs(i("shape.repeat.image"),d),shapeGradientPack:i("shape.gradient.pack"),_54o:c,_55o:i("shape.border.color"),shapeGradient:i("shape.gradient"),_59o:i("shape.gradient.color"),_60o:i("shape.border.pattern"),_61o:i("shape.border.cap"),_62o:i("shape.border.join"),shapeForeground:i("shape.foreground"),gray:i("2d.gray")};if(f){u.x+=f.position.x,u.y+=f.position.y,f.gradientRect=u;var g=e.getScale(),p=P(1,P(O(g.x),O(g.y)));i("shape.dash")&&i("shape.dash.width")>c&&(c=i("shape.dash.width"));var v,_=i("shape.border.width.absolute");v=_?(c+a+s)/t.gv._zoom/p:c*("square"===f._61o?.71:.5)+a+s/t.gv._zoom/p,v&&(v*=p,h=Hs(h),Io(h,v,f._62o)),t._68o(h);var y=i("clip.percentage");1>y&&(0>y&&(y=0),f.clipRect=cr(e.getAnchorRect(),i("clip.direction"),y));var m=i("shape.fill.clip.percentage");1>m&&(0>m&&(m=0),f.shapeClipRect=cr(e.getAnchorRect(),i("shape.fill.clip.direction"),m));var b=i("shape.foreground.clip.percentage");1>b&&(0>b&&(b=0),f.shapeForegroundClipRect=cr(e.getAnchorRect(),i("shape.foreground.clip.direction"),b))}},getPosition:function(t,e,i,n){var r=this._99o;if(r){var o=la(t,r.rect,n);return o.x+=e,o.y+=i,o}return un},_42:function(t){this._99o&&Pu.superClass._42.call(this,t)},_80o:function(t){var e,i=this,n=i.s,r=i._99o,o=r.position,a=r.scale,s=r.rotation,l=r.borderWidth,c=r.selectWidth/i.gv._zoom,h=r._27Q,d=r.shapeGradientPack,f=r._54o,g=r.clipRect,p=r.shapeClipRect,v=r.points,_=r.segments,y=i._data.isClosePath(),m=r.fillRule,b=r.gray,x=function(t){return b?u.toGrayColor(t):t},w=x(r._53o),C=w||h||d;t.save(),Vr(t,o.x,o.y),Br(t,s),Lr(t,a.x,a.y),g&&(t.beginPath(),t.rect(g.x,g.y,g.width,g.height),t.clip()),C&&p&&(t.save(),t.beginPath(),t.rect(p.x,p.y,p.width,p.height),t.clip()),Vr(t,-o.x,-o.y);var S=r._60o,I=ql(t,S),M=t.lineJoin,T=t.lineCap;t.lineJoin=r._62o,t.lineCap=r._61o;var E=x(r.bodyColor);C?(Oo(t,v,_,y),d?Po(t,d):h?Lo(t,h,E,null,i._data,i.gv):(e=E||w,Bo(t,e,r.shapeGradient,x(r._59o),r.gradientRect)),t.fill(m),p&&(t.restore(),Vr(t,-o.x,-o.y)),d&&t.restore(),I!==t&&Oo(I,v,_,y)):Oo(I,v,_,y);var P=r.shapeForeground;if(P){t.save();var D=r.shapeForegroundClipRect;D&&(Vr(t,o.x,o.y),t.beginPath(),t.rect(D.x,D.y,D.width,D.height),t.clip(),Vr(t,-o.x,-o.y)),Oo(t,v,_,y),Bo(t,P,n("shape.foreground.gradient"),x(n("shape.foreground.gradient.color")),r.gradientRect),t.fill(m),t.restore()}var O=n("shape.border.width.absolute");if(O&&(t.save(),t.setTransform(1,0,0,1,0,0)),c&&(t.strokeStyle=r._97o,t.lineWidth=f+2*(l+c),t.stroke()),l&&(t.strokeStyle=x(r.borderColor),t.lineWidth=f+2*l,t.stroke()),f&&(e=x(r._55o),!w&&E&&(e=E),t.strokeStyle=e,t.lineWidth=f,t.stroke(),r._94o&&zo(t,e,x(r._95o),f,i.gv._zoom,r._96o)),Xl(t,S),n("shape.dash")){var R=n("shape.dash.width")||f;if(R>0){S=n("shape.dash.pattern");I=ql(t,S,i._2Q("shape.dash.offset"));I!==t&&Oo(I,v,_,y),i._1Q(t,"shape",R,S)}}O&&t.restore(),t.lineJoin=M,t.lineCap=T,t.restore()},_48O:function(){},_47O:function(){}});var Du=function(t,e){Kn(Du,this,[t,e])};bl(Du,Pu,{getRotation:function(t,e,i){t=t||0;var n=this._data.getPoints(),r=n.size();return r>1?wc[i]?r&&0===r%2?Xc(n.get(r/2-1),n.get(r/2),e,t):t:xc[i]?Xc(n.get(0),n.get(1),e,t):Xc(n.get(r-2),n.get(r-1),e,t):t},getPosition:function(t,e,i,n,r){var o=this._data.getPoints(),a=o.size();if(a>1){if(wc[t]){var s=a%2;if(0===s)return Qc(o.get(a/2-1),o.get(a/2),t,e,i,n,r);var l=o.get((a-s)/2),c={x:l.x,y:l.y,width:0,height:0};return l=la(t,c,n),l.x+=e,l.y+=i,l}return xc[t]?Qc(o.get(0),o.get(1),t,e,i,n,r):Qc(o.get(a-2),o.get(a-1),t,e,i,n,r)}return un}});var Ou=function(t,e){Kn(Ou,this,[t,e])};bl(Ou,Su,{_3O:function(){var t=this;Ou.superClass._3O.call(t);var e=t.s,i=t._83o;t._82o=i.img||i.shape?l:{background:t.getBodyColor("grid.background"),depth:e("grid.depth"),rect:i.rect,_88o:e("grid.cell.depth"),cellBorderColor:e("grid.cell.border.color"),_89o:e("grid.row.count"),_90o:e("grid.column.count"),block:e("grid.block"),_91o:e("grid.block.color"),_92o:e("grid.block.padding"),_93o:e("grid.block.width")}},_80o:function(t){var e=this,i=e._82o;if(i){var n,r,o=e._data,a=i.background,s=i.rect,l=i.block,c=i._91o,h=i._92o,u=i._93o,d=i._88o,f=i.cellBorderColor,g=i._89o,p=i._90o;if(a)if(Ao(t,s.x,s.y,s.width,s.height,a),Uo(t,a,i.depth,s),d)for(n=0;g>n;n++)for(r=0;p>r;r++)s=o.getCellRect(n,r),s&&Uo(t,a,d,s);else if(f){for(t.beginPath(),n=0;g>n;n++)for(r=0;p>r;r++)s=o.getCellRect(n,r),s&&t.rect(s.x,s.y,s.width,s.height);t.strokeStyle=f,t.lineWidth=1,t.stroke()}if("h"===l)for(n=0;g>n;n++)s=ol(o.getCellRect(n,0),o.getCellRect(n,p-1)),ul(s,h),Go(t,c,s.x,s.y,s.width,s.height,u);else if("v"===l)for(r=0;p>r;r++)s=ol(o.getCellRect(0,r),o.getCellRect(g-1,r)),ul(s,h),Go(t,c,s.x,s.y,s.width,s.height,u);e._39O(t,e._83o)}else Ou.superClass._80o.call(e,t)}});var Ru=function(t,e){Kn(Ru,this,[t,e])};bl(Ru,Su,{_checkEmptyRect:!1,_81o:function(){var t=this._data,e=Ru.superClass._81o.call(this),i=t.s("text");if(i!=l){var n,r,o=t.s("text.font"),a=t.s("text.align"),s=t.s("text.vAlign"),c=Xs(o,i),h=c.width,u=c.height,d=t.getAnchor(),f=t.getWidth(),g=t.getHeight();"left"===a?n=-f*d.x:"center"===a?n=-f*d.x+(f-h)/2:"right"===a&&(n=f*(1-d.x)-c.width),"top"===s?r=-g*d.y:"middle"===s?r=-g*d.y+(g-u)/2:"bottom"===s&&(r=g*(1-d.y)-c.height);var p,v=t.getMatrix();if(p=rl([v.tf(n,r),v.tf(n+h,r),v.tf(n+h,r+u),v.tf(n,r+u)]),e=ol(e,p),e&&t.s("text.shadow")){var _=Hs(e);_.x+=t.s("text.shadow.offset.x"),_.y+=t.s("text.shadow.offset.y"),ul(_,t.s("text.shadow.blur")),e=ol(e,_)}}return e}});var zu=Jc.Interactor=function(t){this.gv=this._graphView=t};Kc("Interactor",e,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners(),this.clear()},clear:function(){},fi:function(t){this.gv.fi(t)},setCursor:function(t){lt||this.gv.setCursor(t)},startDragging:function(t){var e=this;e._lastClientPoint=el(t),e._lastLogicalPoint=e.gv.lp(t),gl(e,t)},clearDragging:function(){var t=this;t._lastClientPoint=t._lastLogicalPoint=t._logicalPoint=l},autoScroll:function(t){return this.gv.autoScroll(t,this._lastClientPoint)}});var ku=l,Au=function(t){ku.handleWindowTouchMove(t)},Vu=function(e){ku.handleWindowTouchEnd(e),C(t,xi,Au),C(t,wi,Vu),ku=l},Bu=function(t){ku.handleWindowMouseMove(t)},Lu=function(e){ku.handleWindowMouseUp(e),C(t,_i,Bu),C(t,yi,Lu),ku=l},Fu=function(e,i){if(e!==ku){var n=Nr(i);ku?n?ku.handleWindowTouchEnd(i):ku.handleWindowMouseUp(i):n?(w(t,xi,Au),w(t,wi,Vu)):(w(t,_i,Bu),w(t,yi,Lu)),ku=e}},ju=function(t){var e=this;e.gv=t,e._is2d=t instanceof Jc.GraphView,e._eventListeners={},["mousedown","mousemove","mouseleave","touchstart","touchmove",Mi,"wheel"].forEach((function(t){e.addListener(t)})),e.initImageResource()};bl(ju,zu,{enableVR:function(t){var e=this;if(!!e._vrEnable!==t)if(e._vrEnable=t,t)e.gv.vr.mp(e.onVRControllerChange,e);else if(e.gv.vr.ump(e.onVRControllerChange,e),e._vrRayPolyline){var n=e.gv.dm();n.remove(e._vrRayPolyline),n.remove(e._vrRayHitPoint),e._vrRayPolyline=i,e._vrRayHitPoint=i}},onVRControllerChange:function(t){var e=this,i=t.property,n=t.newValue,r=e.gv.vr.getController(n.id),o=r.getRay();o&&("gamepad.button.trigger"===i?"down"===n._62O?e.handle_mousedown(o):e.handleWindowMouseUp(o):"gamepad.pose"===i&&(e.handle_mousemove(o),e.handleWindowMouseMove(o)))},drawVRRay:function(t,e,i){var n,r=this,o=r.gv,a=r._vrRayPolyline,s=!1;if(a)n=r._vrRayHitPoint;else{var l=o.dm();r._vrRayPolyline=a=new c.Polyline,r._vrRayHitPoint=n=new c.Node,n.s({shape3d:"billboard","shape3d.transparent":!0,"texture.scale":10,"shape3d.image":"coreInteractorRayHitImage"}),n.setAnchor3d(.5,.5,.499);var h=.2/o.vr.measureOflength;n.s3(h,h,h),a.s("intersect",!1),n.s("intersect",!1),l.add(a),l.add(n),s=!0}if(e){var u=i.world,d=i.worldNormal,f=u.x,g=u.y,p=u.z;a.s("shape.border.color","red"),a.setPoints([{x:t.origin.x,y:t.origin.z,e:t.origin.y},{x:f,y:p,e:g}]),n.s("3d.visible",!0),n.p3(f,g,p),n.lookAtDirection([d.x,d.y,d.z],"front")}else{a.s("shape.border.color","blue");var v=new c.Math.Vector3;v.copy(t.direction).setLength(1e3/r.gv.vr.measureOflength).add(t.origin),a.setPoints([{x:t.origin.x,y:t.origin.z,e:t.origin.y},{x:v.x,y:v.z,e:v.y}]),n.s("3d.visible",!1)}o.fi({kind:"vrRayIntersect",ray:t,data:e,intersect:i,polyline:a,hitNode:n,begin:s})},setPreventEventDefault:function(t,e){var n=this,r=n._eventListeners[t];r?r._prevent=e:n._eventListeners[t]=r={_removal:i,_prevent:e}},removeListener:function(t){var e=this,n=e._eventListeners[t];n&&n._removal&&(n._removal(),n._removal=i)},addListener:function(t){var e=this,n=e._eventListeners[t];if(n||(e._eventListeners[t]=n={_removal:i,_prevent:!0}),!n||!n._removal){var r=function(i){n._prevent&&u.preventDefault(i),e.disabled||("wheel"===t?Yn(e,i):e["handle_"+t](i))};w(e.gv.getView(),t,r),n._removal=function(){C(e.gv.getView(),t,r)}}},handleWindowTouchMove:function(t){this.handleWindowMouseMove(t)},handleWindowMouseMove:function(t){this.downInfo&&(this.isDragging?this.handleDownInfo("onDrag",t):(this.handleDownInfo("onBeginDrag",t),this.isDragging=!0))},handleWindowTouchEnd:function(t){this.handleWindowMouseUp(t)},handleWindowMouseUp:function(t){if(this.isDragging&&(this.handleDownInfo("onEndDrag",t),this.isDragging=!1),this.downInfo){var e=this.handle("onUp",t);if(e&&e.data===this.downInfo.data){this.handleMissingUp(t);var i=this,n=2===t.button?"onContextMenu":"onClick";if(!i._dbclickTimer)return void(i._dbclickTimer=J((function(){delete i._dbclickTimer,i.handleClick(t,n,e),this.downInfo=l}),u.clickDelay));K(i._dbclickTimer),delete i._dbclickTimer,n="onDoubleClick",i.handleClick(t,n,e)}else this.handleDownInfo("onUp",t);this.downInfo=l}},handle_mouseleave:function(t){var e=this,i=e.gv,n=e.currentInfo?e.currentInfo.data:l;if(n){n.s("onLeave")&&n.s("onLeave")(t,n,i),e.fire("data","onLeave",t,n);var r=e.currentInfo?e.currentInfo.hits:l;if(r)for(var o in r)e.handleLeave(t,o);e.currentInfo=l}},handle_mousewheel:function(t){t.scrollDelta=t.wheelDelta/40,this.handle("onScroll",t)},handle_DOMMouseScroll:function(t){t.scrollDelta=2===t.axis?-t.detail:0,this.handle("onScroll",t)},handle_touchstart:function(t){this.handle_mousedown(t)},handle_touchmove:function(t){this.handle("onMove",t)},handle_mousedown:function(t){this.isDragging&&(this.handleDownInfo("onEndDrag",t),this.isDragging=!1),this.downInfo=this.handle("onDown",t),this.downInfo&&Fu(this,t)},handle_mousemove:function(t){var e=this,i=e.gv;e._hoverTimer&&(K(e._hoverTimer),delete e._hoverTimer);var n,r,o,a=e.handle("onMove",t),s=this.currentInfo?this.currentInfo.data:l,c=this.currentInfo?this.currentInfo.hits:l;if(a&&(r=a.data,o=a.hits,e._hoverTimer=J((function(){K(e._hoverTimer),delete e._hoverTimer,e.handle("onHover",t,a)}),i.getHoverDelay()||u.hoverDelay)),r!==s){if(s&&(s.s("onLeave")&&s.s("onLeave")(t,s,i),this.fire("data","onLeave",t,s)),r&&(r.s("onEnter")&&r.s("onEnter")(t,r,i),this.fire("data","onEnter",t,r)),c)for(n in c)this.handleLeave(t,n);if(o)for(n in o){var h=o[n],d=r._interactPrefix=h.prefix,f=d&&r.a(d+"onEnter")||h.target.onEnter;f&&f.call(h.target,t,r,i,h.point,h.width,h.height),this.fire(h.type,"onEnter",h.event,h.data,h.image,h.comp,h.point,h),r._interactPrefix=null}}else{if(c)for(n in c)o&&o[n]||this.handleLeave(t,n);if(o)for(n in o)if(!c||!c[n]){h=o[n],d=r._interactPrefix=h.prefix,f=d&&r.a(d+"onEnter")||h.target.onEnter;f&&f.call(h.target,t,r,i,h.point,h.width,h.height),this.fire(h.type,"onEnter",h.event,h.data,h.image,h.comp,h.point,h),r._interactPrefix=null}}this.currentInfo=a},handle:function(t,e,i){var n,r,o=this,a=o.gv;if(o._is2d){if(i=i||a.getDataInfoAt(e),!i||!a.isInteractive(i.data))return;if(n=i.ui.interactiveInfo){var s,l=i.data;if(l.s(t)&&l.s(t)(e,l,a),this.fire("data",t,e,l),"body"===i.part&&n.bodyInfo)s="body",i.hits=this.handleImage(s,a.getImage(l),t,e,l,i.point,n.bodyInfo);else if("icons"===i.part&&n._38o){var h=n._38o[i.name];h&&h[i.index]&&(s="icons|"+i.name+"|"+i.index,i.hits=this.handleImage(s,i.icon,t,e,l,i.point,h[i.index]))}}return i}if(!i)if(e&&e instanceof c.Math.Ray){var u=a.vr.intersectWorld(e);if(l=u.data,r=u.intersect,o.drawVRRay(e,l,r),!l)return;var d=a.getData3dUI(l);if(n=d.interactiveInfo,!n)return;i={data:l,part:r.part,ui:d}}else{if(i=a.getDataInfoAt(e),!i)return;i&&(i={data:i.data,part:i.part})}if(a.isInteractive(i.data)){if(!r){l=i.data;d=a.getData3dUI(l);if(i.ui=d,n=d.interactiveInfo,!n)return i;if(r=a.intersectObject(e,l),!r)return}l.s(t)&&l.s(t)(e,l,a),this.fire("data",t,e,l);var f,g=r.part;return"body"!==g&&(f=l.s(g+".image")||l.s("shape3d."+g+".image")),f||(f=l.s("all.image")||l.s("shape3d.image")),n="object"==typeof f?n[f.uuid]:n[f],n&&n.bodyInfo?(i.part="body",i.interactiveInfo=n,i.point=this._convertUVToPoint(r.uv,n),i.image=f,i.hits=this.handleImage("body",f,t,e,l,i.point,n.bodyInfo),i):i}},_handleLeaveOrMissing:function(t,e,i){var n="leave"===t?this.currentInfo:this.downInfo;if(n){var r=n.interactiveInfo||n.ui.interactiveInfo;if(r){var o,a,s=n.data;if(this._is2d){if(a=this.gv.lp(e),"body"===n.part&&r.bodyInfo)o="body","leave"===t?this.handleLeaveImage(i,o,this.gv.getImage(s),e,s,a,r.bodyInfo):this.handleMissingUpImage(o,this.gv.getImage(s),e,s,a,r.bodyInfo);else if("icons"===n.part&&r._38o){var l=r._38o[n.name];l&&l[n.index]&&(o="icons|"+n.name+"|"+n.index,"leave"===t?this.handleLeaveImage(i,o,n.icon,e,s,a,l[n.index]):this.handleMissingUpImage(o,n.icon,e,s,a,l[n.index]))}}else{if(!r.bodyInfo)return;var c=this.gv.intersectObject(e,s);a=c&&c.uv?this._convertUVToPoint(c.uv,r):{x:1/0,y:1/0},"leave"===t?this.handleLeaveImage(i,"body",n.image,e,s,a,r.bodyInfo):this.handleMissingUpImage("body",n.image,e,s,a,r.bodyInfo)}}}},handleClick:function(t,e,i){var n=this,r=this.downInfo;if(r&&i){var o,a=i.interactiveInfo||i.ui.interactiveInfo,s=i.data,l=this.gv;if(s.s(e)&&s.s(e)(t,s,l),n.fire("data",e,t,s),a)if(this._is2d){if(r.part===i.part){var c=l.lp(t);"body"===i.part&&a.bodyInfo&&(o="body",this.handleClickImage(o,l.getImage(s),e,t,s,c,a.bodyInfo,i))}}else{if(!a.bodyInfo)return;var h=l.intersectObject(t,s);if(!h)return;c=this._convertUVToPoint(h.uv,a),this.handleClickImage("body",r.image,e,t,s,c,a.bodyInfo,i)}}},handleDownInfo:function(t,e){if(this.downInfo){var i=this.downInfo,n=this.gv,r=i.interactiveInfo||i.ui.interactiveInfo;if(r){var o,a=i.data;if(a.s(t)&&a.s(t)(e,a,n),this.fire("data",t,e,a),this._is2d){var s=n.lp(e);if("body"===i.part&&r.bodyInfo)o="body",this.handleDownInfoImage(o,n.getImage(a),t,e,a,s,r.bodyInfo);else if("icons"===i.part&&r._38o){var l=r._38o[i.name];l&&l[i.index]&&(o="icons|"+i.name+"|"+i.index,this.handleDownInfoImage(o,i.icon,t,e,a,s,l[i.index]))}}else{if(!r.bodyInfo)return;var c=n.intersectObject(e,a);if(!c)return;s=this._convertUVToPoint(c.uv,r),this.handleDownInfoImage("body",i.image,t,e,a,s,r.bodyInfo)}}}},fire:function(t,e,n,r,o,a,s,l){this.gv.fi({kind:e,type:t,event:n,data:r,image:o,comp:a,view:this.gv,point:s,width:l?l.width:i,height:l?l.height:i})},handleImage:function(t,e,n,r,o,a,s){var l={};if(e&&(e=zs(e))){var c=this.gv,h=s.rect,u=this.convertPoint(a,s);u.inRect&&(e[n]&&e[n](r,o,c,u,h.width,h.height),this.fire("image",n,r,o,e,i,u,h),l[t+"|image"]={target:e,type:"image",image:e,data:o,event:r,point:u,width:h.width,height:h.height});for(var d=s.compInfos,f=e,g=d.length-1;g>=0;g--){var p=d[g],v=p.comp;if(u=this.convertPoint(a,p,f,v,c,o),u.inRect){h=p.rect;var _=o._interactPrefix=p.prefix,y=_&&o.a(_+n)||v[n];y&&y.call(v,r,o,c,u,h.width,h.height),this.fire("comp",n,r,o,e,v,u,h),(e=h.image)&&(e[n]&&e[n](r,o,c,u,h.width,h.height),this.fire("image",n,r,o,e,i,u,h)),o._interactPrefix=null,l[t+"|"+g]={target:v,type:"comp",comp:v,image:e,data:o,event:r,point:u,width:h.width,height:h.height,prefix:_},e&&(l[t+"|"+g+"|image"]={target:e,type:"image",image:e,data:o,event:r,point:u,width:h.width,height:h.height,prefix:_})}}}return l},handleLeave:function(t,e){return this._handleLeaveOrMissing("leave",t,e)},handleMissingUp:function(t){return this._handleLeaveOrMissing("missing",t)},handleLeaveImage:function(t,e,n,r,o,a,s){if(n&&(n=zs(n))){var l=this.gv,c=s.rect,h=this.convertPoint(a,s);t===e+"|image"&&(n.onLeave&&n.onLeave(r,o,l,h,c.width,c.height),this.fire("image","onLeave",r,o,n,i,h,c));for(var u=s.compInfos,d=n,f=u.length-1;f>=0;f--){var g=u[f],p=g.comp;h=this.convertPoint(a,g,d,p,l,o),c=g.rect;var v=o._interactPrefix=g.prefix;if(t===e+"|"+f){var _=v&&o.a(v+"onLeave")||p.onLeave;_&&_.call(p,r,o,l,h,c.width,c.height),this.fire("comp","onLeave",r,o,n,p,h,c)}(n=c.image)&&t===e+"|"+f+"|image"&&(n.onLeave&&n.onLeave(r,o,l,h,c.width,c.height),this.fire("image","onLeave",r,o,n,i,h,c)),o._interactPrefix=null}}},handleMissingUpImage:function(t,e,n,r,o,a){var s="onUp",l=this.downInfo.hits;if(l&&e&&(e=zs(e))){var c=this.gv,h=a.rect,u=this.convertPoint(o,a);!u.inRect&&l[t+"|image"]&&(e[s]&&e[s](n,r,c,u,h.width,h.height),this.fire("image",s,n,r,e,i,u,h));for(var d=a.compInfos,f=e,g=d.length-1;g>=0;g--){var p=d[g],v=p.comp;if(u=this.convertPoint(o,p,f,v,c,r),!u.inRect){h=p.rect;var _=r._interactPrefix=p.prefix;if(l[t+"|"+g]){var y=_&&r.a(_+s)||v[s];y&&y.call(v,n,r,c,u,h.width,h.height),this.fire("comp",s,n,r,e,v,u,h)}(e=h.image)&&l[t+"|"+g+"|image"]&&(e[s]&&e[s](n,r,c,u,h.width,h.height),this.fire("image",s,n,r,e,i,u,h)),r._interactPrefix=null}}}},handleDownInfoImage:function(t,e,n,r,o,a,s){var l=this.downInfo.hits;if(l&&e&&(e=zs(e))){var c=this.gv,h=s.rect,u=this.convertPoint(a,s);l[t+"|image"]&&(e[n]&&e[n](r,o,c,u,h.width,h.height),this.fire("image",n,r,o,e,i,u,h));for(var d=s.compInfos,f=e,g=d.length-1;g>=0;g--){var p=d[g],v=p.comp;u=this.convertPoint(a,p,f,v,c,o),h=p.rect;var _=o._interactPrefix=p.prefix;if(l[t+"|"+g]){var y=_&&o.a(_+n)||v[n];y&&y.call(v,r,o,c,u,h.width,h.height),this.fire("comp",n,r,o,e,v,u,h)}(e=h.image)&&l[t+"|"+g+"|image"]&&(e[n]&&e[n](r,o,c,u,h.width,h.height),this.fire("image",n,r,o,e,i,u,h)),o._interactPrefix=null}}},handleClickImage:function(t,e,n,r,o,a,s,l){var c=this.downInfo.hits,h=l.hits;if(c&&e&&(e=zs(e))){var u=this.gv,d=s.rect,f=this.convertPoint(a,s);c[t+"|image"]&&(e[n]&&e[n](r,o,u,f,d.width,d.height),this.fire("image",n,r,o,e,i,f,d));for(var g=s.compInfos,p=e,v=g.length-1;v>=0;v--){var _=g[v],y=_.comp;f=this.convertPoint(a,_,p,y,u,o),d=_.rect;var m=o._interactPrefix=_.prefix;if(c[t+"|"+v]&&h[t+"|"+v]){var b=m&&o.a(m+n)||y[n];b&&b.call(y,r,o,u,f,d.width,d.height),this.fire("comp",n,r,o,e,y,f,d)}(e=d.image)&&c[t+"|"+v+"|image"]&&(e[n]&&e[n](r,o,u,f,d.width,d.height),this.fire("image",n,r,o,e,i,f,d)),o._interactPrefix=null}}},initImageResource:function(){u.setImage("coreInteractorRayHitImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",opacity:.3,rotation:-1.593,rect:[.73315,.6933,14.5337,14.61341]},{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",rotation:-1.593,rect:[3.56695,3.75073,8.8661,8.49856]}]})},_convertUVToPoint:function(t,e){if(!t)return{x:1/0,y:1/0};var i=e.bodyInfo.rect,n=t.clone(),r=t.multiply({x:i.width,y:i.height});return r.local=n,r},convertPoint:function(t,e,n,r,o,a){var s=e.rect,c=e.matrix.applyInverse(t).sub(s),h=c.x>=0&&c.y>=0&&c.x<=s.width&&c.y<=s.height;if(!h)return c;if(r&&dc(r.pixelPerfect,a,o)){var d=1;this._is2d?(d=o.getZoom(),s=Tn(t.x,t.y,i,d)):s=Tn(t.x,t.y);var f=!1,g=s.x,p=s.y,v=s.width,_=s.height,y=u.hitMaxArea,m=v*_*d*d;if(m>y){var b=Math.sqrt(y/m);d*=b}v*=d,_*=d,2>v&&(v=2),2>_&&(_=2),g*=d,p*=d;var x=xo(v,_),w=new Ha(0,-g,-p,d,d);w.append(e.matrix),o._drawForChecking=!0,r.transform=w,e.refRect&&e.refRect.fitSize&&(r.refRect=e.refRect);var C=n.comps;n.comps=[r],fc(x,n,0,0,v,_,a,self),n.comps=C,delete r.refRect,delete r.transform,o._drawForChecking=!1;try{for(var S=0,I=x.getImageData(0,0,v,_).data;S<I.length;S+=4)if(0!==I[S+3]){f=!0;break}x.restore()}catch(q){mo=l,f=!1}c.inRect=f}else c.inRect=!0;return c}});var Hu=Jc.DefaultInteractor=function(t){Kn(Hu,this,[t])};Kc("DefaultInteractor",zu,{handle_mousedown:function(t){Os(t);var e=this,i=e.gv,n=i.getDataAt(t);if(i.setFocus(t)&&!i._editing&&!i._scrolling){Ks(t)?i.handleDoubleClick(t,n):i.handleClick(t,n);var r=Ys(t);!go()&&!r&&n&&(i.isMovable(n)||i._39Q(n))||!i.isPannable()||!Qs(t)&&!r||tl(t)||(e._tx=i.tx(),e._ty=i.ty(),e.startDragging(t))}},handleWindowMouseUp:function(t){var e=this,i=e.gv;i._panning&&(delete i._panning,i.onPanEnded(),e.fi({kind:"endPan",event:t})),delete e._tx,delete e._ty,e.clearDragging()},handle_mousemove:function(t){var e=this,i=e.gv;e._hoverTimer&&(K(e._hoverTimer),delete e._hoverTimer),e._hoverTimer=J((function(){e.fi({kind:"hover",event:t}),K(e._hoverTimer),delete e._hoverTimer}),i.getHoverDelay()||u.hoverDelay)},handle_touchmove:function(t){this.handle_mousemove(t)},handleWindowMouseMove:function(t){var e=this,i=e.gv;e.fi({kind:i._panning?"betweenPan":"beginPan",event:t}),i._panning=1;var n=Uc(i,t,e._lastClientPoint);i.setTranslate(e._tx+n.x,e._ty+n.y)},handle_mousewheel:function(t){this.gv.handleScroll(t,t.wheelDelta)},handle_DOMMouseScroll:function(t){2===t.axis&&this.gv.handleScroll(t,-t.detail)},handle_keydown:function(t){this.gv.handleKeyDown(t)}});var Gu=Jc.SelectInteractor=function(t){Kn(Gu,this,[t])};Kc("SelectInteractor",zu,{_42:function(){var t=this,e=t.gv,i=e.getZoom(),n=t.mark,r=t.div;r||(r=t.div=xr(),Mr(t.getView(),r));var o={};o.x=n.x*i+e.tx(),o.y=n.y*i+e.ty(),o.width=n.width*i,o.height=n.height*i,Gr(r,o),this.intersects()?(r.style.border="",r.style.background=e.getRectSelectBackground()):(r.style.background="",r.style.border="1px solid "+e.getRectSelectBorderColor())},handle_mousedown:function(t){var e=this,i=e.gv;if(e._57I=l,e.pendingClickThrough=l,!(i._editing||i._scrolling||go()||Ys(t))){var n=i.getDataAt(t),r=i.sm();n?tl(t)?r.co(n)?r.rs(n):r.as(n):r.co(n)?n instanceof du&&n.isClickThroughEnabled()&&Qs(t)&&(e.pendingClickThrough=el(t)):r.ss(n):tl(t)||!i.isPannable()?Qs(t)&&(tl(t)||r.cs(),i.isRectSelectable()&&(e.startDragging(t),i._77O=1)):Qs(t)&&(e._57I=el(t))}},handle_mouseup:function(t){var e=this,i=e.gv,n=e._57I;if(n&&(nl(n,el(t))<=1&&i.sm().cs(),e._57I=l),e.pendingClickThrough){if(nl(e.pendingClickThrough,el(t))<=1){var r=i.getDataAt(t);if(r instanceof du&&r.isClickThroughEnabled()){var o=i.getDataAt(t,(function(t){var e=t.getParent()===r&&i.isSelectable(t,!0);return e}));o&&(t.clickThrough=!0,i.sm().ss(o))}}e.pendingClickThrough=l}},handleWindowMouseUp:function(t){this.clear(t)},handleWindowMouseMove:function(t){var e=this,i=e.gv;e._logicalPoint=i.lp(t),e.mark?(e.fi({kind:"betweenRectSelect",event:t}),i.isPannable()&&e.autoScroll(t),e.redraw()):e.fi({kind:"beginRectSelect",event:t}),e.mark=rl(e._lastLogicalPoint,e._logicalPoint),e.redraw()},intersects:function(){var t=this,e=t._lastLogicalPoint,i=t._logicalPoint;return e.x>i.x||e.y>i.y},clear:function(t){var e=this,i=e.gv,n=e.mark;if(e._57I=l,e.pendingClickThrough=l,e._lastLogicalPoint){if(n){if(0!==n.width&&0!==n.height){var r=i.getDatasInRect(n,e.intersects());if(!r.isEmpty()){var o=i.sm(),a=o.toSelection();r.each((function(t){o.co(t)?a.remove(t):a.add(t)})),o.ss(a)}}pl(e.div),delete e.div,delete e.mark,e.redraw(),e.fi({kind:"endRectSelect",event:t}),i.onRectSelectEnded()}e.clearDragging(),delete i._77O}},redraw:function(){var t=this;t._draw||(t._draw=1,J((function(){t.mark&&t._42(),delete t._draw}),16))}});var Uu=Jc.MoveInteractor=function(t){Kn(Uu,this,[t])};Kc("MoveInteractor",zu,{handle_mousedown:function(t){var e=this,i=e.gv;if(Qs(t)&&!i._editing&&!i._scrolling&&!go()){var n=i.getSelectedDataAt(t);!n||i._39Q(n)&&!i.isMovable(n)?i._focusData=l:(e._data=n,i.handleMouseDown&&i.handleMouseDown(t,n),e.startDragging(t),i.isMovable(n)&&(i._moving=1))}},handleWindowMouseUp:function(t){var e=this,i=e.gv;i.handleMouseUp&&i.handleMouseUp(t,e._data),e.clear(t)},handleWindowMouseMove:function(t){var e=this,i=e._data,n=e.gv;if((!n._93O||!n._93O(t,i))&&n._moving){e._logicalPoint||e.fi({kind:"prepareMove",event:t});var r=e._logicalPoint?"betweenMove":"beginMove",o={kind:r,event:t},a=e._logicalPoint=n.lp(t);"beginMove"!==r||e._alreadyBeginTransaction||(e._alreadyBeginTransaction=!0,n.getDataModel().beginTransaction());var s=e._calcShift(r,t),l=s.x,c=s.y,h=e.gv.getMoveMode(t,i);h&&("x"===h?c=0:"y"===h?l=0:"xy"!==h&&(l=c=0)),n.moveSelection(l,c),e._lastLogicalPoint=a,e.autoScroll(t),e.fi(o)}},_calcShift:function(){var t=this,e=t._logicalPoint,i=t._lastLogicalPoint,n=e.x-i.x,r=e.y-i.y;return{x:n,y:r}},clear:function(t){var e=this,i=e.gv;e._lastLogicalPoint&&(e._lastLogicalPoint=e._data=i._moving=l,e._logicalPoint&&(e.fi({kind:"endMove",event:t}),i.onMoveEnded()),e.clearDragging()),e._alreadyBeginTransaction&&(e._alreadyBeginTransaction=!1,i.getDataModel().endTransaction())}});var Wu=Jc.TextEditInteractor=function(t){Kn(Wu,this,[t]),this.init()};Kc("TextEditInteractor",zu,{init:function(){var t=this,e=this.input=s.createElement("input"),i=e.style;e.text="text",i.border="1px solid #d8d8d8",i.position="absolute",i.padding="2px 3px",i.outline="none",i.marginLeft="-90px",i.marginTop="-16px",i.backgroundColor="rgba(255,255,255, 0.9)",i.fontSize="14px",i.width="180px",i.height="32px",i.boxShadow="0 0 13px rgba(16,142,233, 0.5)",i.textAlign="center",i.boxSizing="border-box",w(e,"keyup",(function(e){po(e)&&t.endTextEdit()})),w(e,"focus",(function(){e.select()}));var n=this.textarea=s.createElement("textarea"),r=this.wrap=s.createElement("div");r.appendChild(n),i=n.style,i.margin=0,i.padding="4px",i.overflow="hidden",i.boxSizing="border-box",i.position="absolute",i.outline="none",i.backgroundColor="transparent",i.resize="none",i.textAlign="center",i.fontSize="14px",i.border="none",i.borderWidth=0,i.width="100%",i.top="50%",i=r.style,i.boxSizing="border-box",i.margin=0,i.padding=0,i.position="absolute",i.boxShadow="0 0 13px rgba(16,142,233, 0.5)",i.border="1px solid #d8d8d8",i.backgroundColor="rgba(255,255,255, 0.9)",i.width="180px",i.marginLeft="-90px",w(n,"keydown",(function(e){return($s()||tl())&&po(e)?void t.endTextEdit():void t.calculateTextareaHeight(String.fromCharCode(e.keyCode))})),w(n,"focus",(function(){n.select()}));var o=function(t){t.stopPropagation()};w(e,"mousedown",o),w(e,"touchstart",o),w(n,"mousedown",o),w(n,"touchstart",o),t.SIZING_STYLE=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"],t.HIDDEN_TEXTAREA_STYLE="visibility:hidden; min-height:0 !important;max-height:none !important;height:0 !important;visibility:hidden !important;overflow:hidden !important;position:absolute !important;z-index:-1000 !important;top:0 !important;right:0 !important",t.handleWindowClick=function(e){var i=t._editingDOM;if(i){var n=i.getBoundingClientRect(),r=el(e);al(n,r)||t.endTextEdit()}}},handle_mousedown:function(t){var e=this,i=e.gv;if(Ks(t)&&!i._editing){var n=i.getDataAt(t);if(n){var r=i.getTextEditInfo(n);r&&(this._editInfo=r,this._editTarget=n,i._editing=!0,r.isMultiline?this.handleMultilineEdit():this.handleTextEdit())}}},handleMultilineEdit:function(){var e=this,n=e.gv,r=e._editTarget,o=e.getTargetValue(),a=e.textarea,s=e.wrap;this.hiddenTextarea||this.createHiddenTextarea(),(null===o||o===i)&&(o=""),a.value=o,e._editingDOM=a,n.getView().appendChild(s),this.layoutHTML(s,r),this.calculateTextareaHeight(),J((function(){a.focus(),w(t,"mousedown",e.handleWindowClick),w(t,"touchstart",e.handleWindowClick)}),10)},handleTextEdit:function(){var e=this,n=e.gv,r=e._editTarget,o=e.getTargetValue(),a=e.input;(null===o||o===i)&&(o=""),a.value=o,e._editingDOM=a,n.getView().appendChild(a),this.layoutHTML(a,r),J((function(){a.focus(),w(t,"mousedown",e.handleWindowClick),w(t,"touchstart",e.handleWindowClick)}),10)},layoutHTML:function(t,e){var i=this.gv,n=i.getZoom();if(e instanceof c.Node){var r=e.getRect();t.style.left=(r.x+r.width/2)*n+i.tx()+"px",t.style.top=(r.y+r.height/2)*n+i.ty()+"px"}else if(e instanceof c.Edge){var o=i.getDataUI(e);r=o._6I;t.style.left=(r.x+r.width/2)*n+i.tx()+"px",t.style.top=(r.y+r.height/2)*n+i.ty()+"px"}},endTextEdit:function(){var e=this,i=e._editInfo.isMultiline?e.wrap:e.input,n=e._editInfo.isMultiline?e.textarea:e.input;e.setTargetValue(n.value),e.gv.getView().removeChild(i),e.gv._editing=!1,delete e._editingDOM,C(t,"mousedown",e.handlelick),C(t,"touchstart",e.handleWindowClick)},setTargetValue:function(t){var e=this,i=e._editTarget,n=e._editInfo,r=n.accessType,o=n.name;if(o&&r||(r="p",o="name"),"p"===r){var a=c.Default.setter(o);i[a](t)}else"a"===r?i.a(o,t):i.s(o,t)},getTargetValue:function(){var t=this,e=t._editTarget,i=t._editInfo,n=i.accessType,r=i.name;if(r&&n||(n="p",r="name"),"p"===n){var o=c.Default.getter(r);return e[o]()}return"a"===n?e.a(r):e.s(r)},createHiddenTextarea:function(){this.hiddenTextarea=s.createElement("textarea"),this.hiddenTextarea.setAttribute("style","margin:0; padding:0; position:absolute; overflowY:scroll; resize:none; box-sizing:border-box;"),this.hiddenTextarea.setAttribute("rows","1"),this.gv.getView().appendChild(this.hiddenTextarea)},calculateHTMLStyle:function(e,i){if(i&&this.computedStyleCache)return this.computedStyleCache;var n=this,r=t.getComputedStyle(e),o=r.getPropertyValue("box-sizing")||r.getPropertyValue("-moz-box-sizing")||r.getPropertyValue("-webkit-box-sizing"),a=parseFloat(r.getPropertyValue("padding-bottom"))+parseFloat(r.getPropertyValue("padding-top")),s=parseFloat(r.getPropertyValue("border-bottom-width"))+parseFloat(r.getPropertyValue("border-top-width")),l=n.SIZING_STYLE.map((function(t){return t+":"+r.getPropertyValue(t)})).join(";"),c={sizingStyle:l,paddingSize:a,borderSize:s,boxSizing:o};return i&&(this.computedStyleCache=c),c},calculateTextareaHeight:function(t){t=t||"";var e=this,i=e.textarea,n=e.hiddenTextarea,r=e.wrap,o=32,a=e.calculateHTMLStyle(i,!1),s=a.paddingSize,l=a.borderSize,c=a.boxSizing,h=a.sizingStyle;n.setAttribute("style",h+";"+e.HIDDEN_TEXTAREA_STYLE),n.value=i.value+t;var u=n.scrollHeight;"border-box"===c?u+=l:"content-box"===c&&(u-=s),i.style.height=u+"px",i.style.marginTop=0-.5*u+"px",r.style.height=Math.max(u,o)+"px",r.style.marginTop=-.5*u+"px"}});var Nu=Jc.ScrollBarInteractor=function(t){Kn(Nu,this,[t])};Kc("ScrollBarInteractor",zu,{_41o:function(){return this.gv.getViewRect().height<this.gv.getScrollRect().height},_40o:function(){return this.gv.getViewRect().width<this.gv.getScrollRect().width},isV:function(t){var e=this.gv.getViewRect();return this._41o()&&(e.x+e.width-this.gv.lp(t).x)*this.gv.getZoom()<Ss},isH:function(t){var e=this.gv.getViewRect();return this._40o()&&(e.y+e.height-this.gv.lp(t).y)*this.gv.getZoom()<Ss},handle_mousemove:function(t){this.handle_touchmove(t)},handle_touchmove:function(t){if(!Xr&&Qs(t)&&this.gv.isScrollBarVisible()){var e=this,i=e.isV(t),n=e.isH(t);(i||n)&&e.gv.showScrollBar(),e.gv._scrolling=i||n}},handleWindowMouseUp:function(t){this.handleWindowTouchEnd(t)},handleWindowTouchEnd:function(t){this._state=this._cp=this._tx=this._ty=this.gv._scrolling=l,this.fi({kind:"endScroll",event:t})},handle_mousedown:function(t){this.handle_touchstart(t)},handle_touchstart:function(t){var e=this;if(e.gv.setFocus(t),Os(t),e.handle_touchmove(t),!(Js(t)>1)&&e.gv._scrolling&&e.gv.isScrollBarVisible()){e._cp=el(t),e._tx=e.gv.tx(),e._ty=e.gv.ty();var i=e.isV(t);e._state=i?"vScroll":"hScroll",gl(e,t),e.fi({kind:"beginScroll",event:t})}},handleWindowMouseMove:function(t){this.handleWindowTouchMove(t)},handleWindowTouchMove:function(t){var e=el(t),i=this.gv.getViewRect(),n=this.gv.getScrollRect();"vScroll"===this._state?this.gv.ty(this._ty+(this._cp.y-e.y)*n.height/i.height):"hScroll"===this._state&&this.gv.tx(this._tx+(this._cp.x-e.x)*n.width/i.width),this.fi({kind:"betweenScroll",event:t})}});var qu=Jc.TouchInteractor=function(t,e){e=e||{},e.selectable===i&&(e.selectable=!0),e.movable===i&&(e.movable=!0),e.pannable===i&&(e.pannable=!0),e.pinchable===i&&(e.pinchable=!0),e.editable===i&&(e.editable=!0),this.params=e,Kn(qu,this,[t])};Kc("TouchInteractor",zu,{ms_edit:1,setUp:function(){var t=this;qu.superClass.setUp.call(t),lt&&t.params.editable&&t.gv.setEditInteractor(t)},tearDown:function(){var t=this;qu.superClass.tearDown.call(t),lt&&t.params.editable&&t.gv.setEditInteractor(l)},clear:function(t){var e=this,i=e.gv;i._moving&&(e.fi({kind:"endMove",event:t}),delete i._moving,i.onMoveEnded(),i.dm().endTransaction()),i._panning&&(e.fi({kind:"endPan",event:t}),delete i._panning,i.onPanEnded()),i._pinching&&(e.fi({kind:"endPinch",event:t}),delete i._pinching,i.onPinchEnded()),i._editing&&(e._46O(t),e._77I=e._node=e._edge=e._shape=e._rect=e._89I=e._index=i._editing=l),e.pendingClickThrough=e._moving=e._panning=e._pinching=e._editing=e._57I=e._data=e._beginHistory=l,e.clearDragging()},handle_touchstart:function(t){var e=this;if(!e.gv._editing){Os(t),e._57I=l,e.pendingClickThrough=l;var i=e.params,n=e.gv,r=n.sm(),o=n.getDataAt(t),a=Js(t);if(1===a){if(Ks(t))return void n.handleDoubleClick(t,o);n.handleClick(t,o),o&&(n.handleMouseDown&&n.handleMouseDown(t,o),e._data=o),i.selectable||(o=l),o&&(r.co(o)?o instanceof du&&o.isClickThroughEnabled()&&(e.pendingClickThrough=el(t)):r.ss(o),i.editable&&n.isEditable(o)&&e._79I(t,o,!0)?(e._editing=1,e.startDragging(t)):i.movable&&n.isMovable(o)&&(e._moving=1,e.startDragging(t))),o&&n.isMovable(o)||(e._57I=el(t),i.pannable&&n.isPannable()&&(e._panning=1,e.startDragging(t),e._translate={x:n.tx(),y:n.ty()}))}else if(i.pinchable&&2===a){if(o&&n._39Q(o))return;e._pinching=1,e.startDragging(t);var s=n.getView(),c=n.getZoom(),h=s.getBoundingClientRect(),u=t.touches[0],d=t.touches[1],f={x:(u.clientX+d.clientX)/2-h.left,y:(u.clientY+d.clientY)/2-h.top};f.x-=n.tx(),f.y-=n.ty(),f.x/=c,f.y/=c,e._p=f,e._d=Jo(t)}}},handle_touchend:function(t){var e=this,i=e.gv,n=e._57I,r=e._data;if(n&&(nl(n,el(t))<=1&&!i.getDataAt(t)&&i.sm().cs(),e._57I=l),r&&i.handleMouseUp&&i.handleMouseUp(t,r),e.pendingClickThrough){if(nl(e.pendingClickThrough,el(t))<=1){r=i.getDataAt(t);if(r instanceof du&&r.isClickThroughEnabled()){var o=i.getDataAt(t,(function(t){var e=t.getParent()===r&&i.isSelectable(t,!0);return e}));o&&(t.clickThrough=!0,i.sm().ss(o))}}e.pendingClickThrough=l}},handleWindowTouchEnd:function(t){this.clear(t)},handleWindowTouchMove:function(t){var e=this,i=e.gv,n=Js(t);if(1===n){var r=el(t),o=Uc(i,r,e._lastClientPoint),a=nl({x:0,y:0},o);if(e._editing&&(e._beginHistory||(e._beginHistory=1,i.dm().beginTransaction()),i._editing=1,e._78I(t)),e._moving){if(!i._moving&&a<u.touchMoveThreshold)return;e._beginHistory||(e._beginHistory=1,i.dm().beginTransaction()),e.handleMove(t)}else if(e._panning){if(!i._panning&&a<u.touchMoveThreshold)return;i.setTranslate(e._translate.x+o.x,e._translate.y+o.y),e.fi({kind:i._panning?"betweenPan":"beginPan",event:t}),i._panning=1}}else if(2===n&&e._pinching){var s=Jo(t);i.handlePinch(e._p,s,e._d),e._d=s,e.fi({kind:i._pinching?"betweenPinch":"beginPinch",event:t}),i._pinching=1}},handleMove:function(t){var e=this,i=e.gv,n=i.lp(t);i._93O&&i._93O(t,e._data)||(i.moveSelection(n.x-e._lastLogicalPoint.x,n.y-e._lastLogicalPoint.y),e._lastLogicalPoint=n,e.autoScroll(t),e.fi({kind:i._moving?"betweenMove":"beginMove",event:t}),i._moving=1)}});c=t.ht;var Xu=c.graph._editor={Math:c.Math,Guide:{}};Xu.getStyle=function(t){var e,n=Xu.StyleMap;return n&&(e=n[t],e!==i)?e:Xu.DefaultStyleMap[t]},Xu.setStyle=function(t,e){var i=Xu.StyleMap;i||(i=Xu.StyleMap={}),i[t]=e},Xu.inEdit=function(t){return!0===t._inXEdit},Xu.startEdit=function(t){t._inXEdit=!0,Xu.Inject.doInject(t)},Xu._46O=function(t){t._inXEdit=!1,Xu.Inject.undoInject(t)},Xu.toScreenPosition=function(t,e){var i=t.tx(),n=t.ty(),r=t._zoom;return new Xu.Math.Vector2(e.x*r+i,e.y*r+n)},Xu.checkHit=function(t,e,i){return t.distanceTo(e)<i},Xu.toWorldPosition=function(t,e){var i=t.tx(),n=t.ty(),r=t._zoom;return{x:(e.x-i)/r,y:(e.y-n)/r}},Xu.setAntialias=function(t,e){for(var i,n=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","msImageSmoothingEnabled"],r=0,o=n.length;o>r&&(i=n[r],!(i in t));r++);t[i],t[i]=e},Xu.getTargetCornersOnScreen=function(t,e){if(!e)return null;var i,n=[];if(Gn(e,t)){var r=bc(t,e);i=[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}]}else{if(!e.getCorners)return null;i=e.getCorners()}return i.forEach((function(e){var i=Xu.toScreenPosition(t,e);n.push(i.x,i.y)})),n},Xu.log=function(){};var Qu=Xu.Inject={_modules:[]};Qu.registAsModule=function(t,e){var i={},n={};for(var r in t){var o=e.prototype[r];i[r]=o}t.getBackup=function(t){return i[t]},t.getBackups=function(){return i},n.doInject=function(){for(var i in t)"getBackup"!==i&&(e.prototype[i]=t[i])},n.undoInject=function(){for(var n in t)"getBackup"!==n&&(e.prototype[n]=i[n])},Qu._modules.push(n)},Qu.doInject=function(t){for(var e,i=Qu._modules,n=0,r=i.length;r>n;n++)e=i[n],e.doInject(t)},Qu.undoInject=function(t){for(var e,i=Qu._modules,n=0,r=i.length;r>n;n++)e=i[n],e.undoInject(t)};zu=c.graph.EditInteractor=function(t){var e=this,i=s.createElement("canvas");i.className="editCanvas",i.style.position="absolute",e._styleMap={},e._canvas=i,e._context=i.getContext("2d"),zu.superClass.constructor.call(e,t),this._editDetail=!1,Xu.setAntialias(e._context,!1),e._subModules=[new Xu.Anchor(e),new Xu.RotateX(e),new Xu.MoveDummy(e),new Xu.Rect(e),new Xu.Curve(e),new Xu.MoveHelper(e)],e._gridGuide=new Xu.Guide.Grid(e),e._rectGuide=new Xu.Guide.Rect(e),e._hoverGuide=new Xu.Guide.Hover(e)};var Yu=zu;c.Default.def(zu,c.graph.Interactor,{ms_edit:1,ms_fire:1}),e.defineProperties(zu.prototype,{editDetail:{get:function(){var t=!!this._editDetail;return t},set:function(t){var e=this,i=e._editDetail;i!==t&&(e._editDetail=t,e.gv._editing=t,e.fp("editDetail",i,t),e.fp("pointsEditingMode",i,t),e.fi({kind:t?"beginEditPoints":"endEditPoints"}))}},gvEditing:{get:function(){return this.gv._editing},set:function(t){(!this._editDetail||t)&&(this.gv._editing=t,t||(this.editDetail=!1))}},editing:{get:function(){return this._editing},set:function(t){this._editing=t,this.gvEditing=t}},pointsEditingMode:{get:function(){return this.editDetail},set:function(t){var e=this;e.editDetail!==t&&(t?e._tryEnterEditDetailMode():e._tryQuitEditDetailMode())}},gridEnabled:{get:function(){var t=this._gridEnabled;if(!t)return!1;this.gv;return!0},set:function(t){t!==this._gridEnabled&&(this._gridEnabled=t,this._42())}},alignmentGuideEnabled:{get:function(){return this._agEnabled},set:function(t){t!==this._agEnabled&&(this._agEnabled=t,this._42())}},gridGuide:{get:function(){return this._gridGuide}},rectGuide:{get:function(){return this._rectGuide}},hoverGuide:{get:function(){return this._hoverGuide}}}),zu.prototype.getSubModule=function(t){var e,i,n,r=this._subModules;for(i=0,n=r.length;n>i;i++)if(e=r[i],e.catalog===t)return e},zu.prototype.invokeSubModule=function(t,e){var n=this,r=n._subModules;if(r)for(var o,a,s,l=Array.prototype.slice.call(arguments,2),c=0,h=r.length;h>c;c++)if(o=r[c],a=o[t],a&&(s=a.apply(o,l),s!=i&&e))return o},zu.prototype.invokeSubModuleInverse=function(t,e){var n=this,r=n._subModules;if(r)for(var o,a,s,l=Array.prototype.slice.call(arguments,2),c=r.length-1;c>=0;c--)if(o=r[c],a=o[t],a&&(s=a.apply(o,l),s!=i&&e))return o},zu.prototype.setUp=function(){Xu.log("setUp");var t=this,e=t.gv,i=e.getView(),n=t._canvas;zu.superClass.setUp.call(t),e.setEditInteractor(t),e._79O?i.insertBefore(n,e._79O):i.appendChild(n),Xu.startEdit(e),t.invokeSubModule("setUp"),e.dm().mm(t._onDataModelChanged,t),e.dm().md(t._onDataPropertyChanged,t)},zu.prototype.tearDown=function(){Xu.log("tearDown");var t=this,e=t.gv,i=e.getView();t._resetCustomCursorStyle(),zu.superClass.tearDown.call(t),e.dm().umm(t._onDataModelChanged,t),e.dm().umd(t._onDataPropertyChanged,t),e.setEditInteractor(null),i.removeChild(t._canvas),t._drawTimer&&(K(t._drawTimer),t._drawTimer=null),Xu._46O(e),t.invokeSubModule("tearDown")},zu.prototype._onDataModelChanged=function(t){var e=this;("clear"===t.kind||"remove"===t.kind&&e.editDetail&&t.data===e.getSubModule("Curve").target)&&(e.editDetail=!1,e._42())},zu.prototype._onDataPropertyChanged=function(t){var e=this;if(e.editDetail){var i=e.getSubModule("Curve"),n=t.data;n===i.target&&(n._writing||i._handleDataChanged(t))}},zu.prototype.clear=function(){Xu.log("clear")},zu.prototype.redraw=function(){this._42()},zu.prototype._42=function(){var t=this;t._drawTimer||(t._drawTimer=J((function(){t._drawTimer=null,t.drawImpl()}),0))},zu.prototype.drawImpl=function(){var e;for(e in{_42:!0})break;return function(){var i=this,n=i._canvas,r=i.gv,o=r.getWidth(),a=r.getHeight(),s=i._context,l=c.Default.getInternal(),h=t.devicePixelRatio;(n.width!==o||n.height!==a)&&l.setCanvas(n,o,a,h),s.clearRect(0,0,n.width,n.height);var u=i._getValidSelection();s.save(),s.scale(h,h),i._gridGuide._42(),i.invokeSubModuleInverse(e,!1,s,r,u),i._rectGuide._42(),i._hoverGuide._42(),s.restore()}}(),zu.prototype._getValidSelection=function(){var t=this,e=t.gv,i=e.sm().getSelection(),n=[];return i.each((function(t){e.isVisible(t)&&e.isEditable(t)&&n.push(t)})),n},zu.prototype.handle_touchmove=function(t){return this.handle_mousemove(t)},zu.prototype.handle_mousemove=function(t){if(!c.Default.isDragging()){var e=this;if((e.editDetail||!go()&&!Ys(t))&&!e.gv._externalEditing)if(e.gvEditing=!1,e._checkEdit(t))e.gvEditing=!0;else{if(!e.getStyle("hoverGuideVisible"))return;e.hoverData=e.gv.getDataAt(t),e._42()}}},zu.prototype.handle_touchstart=function(t){return this.handle_mousedown(t)},zu.prototype.handle_mousedown=function(t){Os(t);var e=this;if((e.editDetail||!go()&&!Ys(t))&&!e.gv._externalEditing){if(Ks(t)&&!t.clickThrough){if(e.editDetail){if(e._tryQuitEditDetailMode(t))return}else if(e._tryEnterEditDetailMode())return;e.gv.dm().beginTransaction();var i=e.invokeSubModule("handleDoubleClick",!0,t);if(e.gv.dm().endTransaction(),i)return}var n=e._checkEdit(t);n&&(e._downPosition=e._getLogicalPoint(t),e.gv.dm().beginTransaction(),n.startEdit(e,t),e.editing=!0)}},zu.prototype._checkEdit=function(t){var e=this,i=e.gv,n=e._getLogicalPoint(t),r=e.invokeSubModule("check",!0,i,t,n)||null;return e._editMod=r,r},zu.prototype.handleWindowTouchMove=function(t){return this.handleWindowMouseMove(t)},zu.prototype.handleWindowMouseMove=function(t){var e=this,i=e._downPosition;if(i){var n=e._getLogicalPoint(t);if(n.distanceTo(i)<e.getStyle("moveSensitivity"))return;delete e._downPosition}var r=e._editMod;r&&r.handleEdit(e.gv,t)},zu.prototype._getLogicalPoint=function(t){var e=this,i=c.Default.getLogicalPoint(t,e._canvas);return new Xu.Math.Vector2(i)},zu.prototype.handleWindowTouchEnd=function(t){return this.handleWindowMouseUp(t)},zu.prototype.handleWindowMouseUp=function(){var t;for(t in{_46O:!0})break;return function(e){var i=this;i.editing=!1,i.setCursor("default"),i.invokeSubModule(t,!1,e),i._42(),i.gv.dm().endTransaction()}}(),zu.prototype.handle_mousewheel=function(t){var e=this;Os(t),e.invokeSubModule("preHandleScroll",!0)||e.gv.handleScroll(t,t.wheelDelta)},zu.prototype.handleDelete=function(){var t=this;if(!t.editDetail){t.gv.dm().beginTransaction();var e=t.invokeSubModule("handleNormalStateDelete",!0);return t.gv.dm().endTransaction(),void(e||t.gv.removeSelection())}t.gv.dm().beginTransaction(),t.invokeSubModule("handleDelete",!0),t.gv.dm().endTransaction(),t._42()},zu.prototype.handle_keydown=function(t){var e=this;if((t.metaKey||t.ctrlKey)&&e._42(),go(t)&&!e.editing)return e.gvEditing=!1,e.setCursor("default"),void e._42();var i=po(t);return e.editDetail?((i||vo(t))&&(e.editDetail=!1,e._42()),e.gv.dm().beginTransaction(),e.invokeSubModule("handle_keydown",!0,t),void e.gv.dm().endTransaction()):(e.gv.dm().beginTransaction(),e.invokeSubModule("handleNormalStateKeyDown",!0,t),e.gv.dm().endTransaction(),void(i&&e._tryEnterEditDetailMode()))},zu.prototype.handle_keyup=function(t){this.gv.dm().beginTransaction(),this.invokeSubModule("handle_keyup",!0,t),this.gv.dm().endTransaction()},zu.prototype._tryEnterEditDetailMode=function(){var t=this;return!t.editDetail&&t.invokeSubModule("canEnterEditDetailMode",!0)&&1===t._getValidSelection().length?(t.editDetail=!0,t._42(),!0):void 0},zu.prototype._tryQuitEditDetailMode=function(t){var e=this;return!!e.editDetail&&(!(t&&!e.invokeSubModule("canQuitEditDetailMode",!0,t))&&(e.editDetail=!1,e._42(),!0))},zu.prototype.setStyle=function(t,e,i){var n=this;i?Xu.setStyle(t,e):n._styleMap[t]=e,"baseColor"===t&&(od=e),n.fp("styleChanged",null,{key:t,value:e,base:i}),n._42()},zu.prototype.getStyle=function(t){var e=this,n=e._styleMap[t];return n!==i?n:Xu.getStyle(t)},zu.prototype.setCursor=function(t){this._resetCustomCursorStyle(),c.graph.EditInteractor.superClass.setCursor.call(this,t)},zu.prototype._drawHostGuide=function(t){var e=this,i=e._context,n=e.gv;Xu.Icons.DrawIcon(e,i,Xu.Icons.NodeHoverGuide,t.corners);var r=t.host;if(r){var o=n.getAttachPoints(r);if(o&&o.length)for(var a=0,s=o.length;s>a;a++){var l=o[a],c=jc(n,r,0,l.offsetX||0,l.offsetY||0,l.x,l.y);c=Xu.toScreenPosition(n,c),c.isAttach=t.attach===a,Xu.Icons.DrawIcon(e,i,Xu.Icons.AttachPoint,c)}}},zu.prototype._resetCustomCursorStyle=function(){var t=this;if(t._customStyle){var e=this.gv.getView();e.classList&&e.classList.remove&&e.classList.remove(t._customStyle),t._customStyle=null}},zu.prototype._setRotateCursor=function(t){var e=this,i=e._cursorFactory;i||(i=e._cursorFactory=new Xu.CursorFactory(e));var n=i.getRotateCursor(t),r=e.gv.getView();e._resetCustomCursorStyle(),e._customStyle=n,r.classList&&r.classList.add&&r.classList.add(n)};var Zu=Xu.Group=function(t){var e=this;e._entities=t,e._64O=0,e._position={x:0,y:0},e._scale={x:1,y:1},e._anchor={x:.5,y:.5},e._anchor2={x:.5,y:.5}};Zu.prototype={},Zu.prototype.constructor=Zu;var Ju=null;Zu.findOrCreateGroup=function(t){if(Ju&&Ju.checkIsMe(t))return Ju;var e=new Xu.Group(t);return e.getKeyOb()?(Ju=e,e):void 0},Zu.prototype.checkIsMe=function(t){var e=this._entities;if(e.length!==t.length)return!1;var i,n={},r=t.length;for(i=0;r>i;i++)n[t[i]._id]=!0;for(i=0;r>i;i++)if(!n[e[i]._id])return!1;return!0},Zu.prototype.getRotation=function(){return this._64O},Zu.prototype.getPosition=function(){return this._position},Zu.prototype.getAnchor=function(){return this._anchor},Zu.prototype.getWidth=function(){return this._width},Zu.prototype.getScale=function(){return this._scale},Zu.prototype.getSize=function(){return{width:this._width,height:this._height}},Zu.prototype.getHeight=function(){return this._height},Zu.prototype.getKeyOb=function(){for(var t=this._entities,e=t.length-1;e>=0;e--){var i=t[e];if(this.isNode(i))return i}},Zu.prototype.getAnchor2=function(){var t=this,e=t.rotateCenter;if(e)return e;var i=t.getKeyOb();if(!i)return t._anchor;var n=t._anchor2,r=i.getMatrix();return r.tf({x:i.getWidth()*(n.x-i.getAnchor().x),y:i.getHeight()*(n.y-i.getAnchor().y)})},Zu.prototype.setAnchor2=function(t,e){var i=this,n=i.getKeyOb();if(n){var r,o=n.getMatrix();r="number"==typeof t?{x:t,y:e}:t;var a=o.tfi(r);i._anchor2={x:n.getAnchor().x+a.x/n.getWidth(),y:n.getAnchor().y+a.y/n.getHeight()}}},Zu.prototype.setRotation=function(){},Zu.prototype.beginRotate=function(t){this.rotateCenter=t.pos,this.rotateMode=t.groupRotateMode},Zu.prototype.endRotate=function(){delete this.rotateCenter,delete this.rotateMode},Zu.prototype.addRotation=function(t,e,i){return"batch"===e?this._addRotationInBatchMode(t,i):"block"===e?this._addRotationInBlockMode(t,i):void 0},Zu.prototype._addRotationInBlockMode=function(t,e){var i=this,n=i.rotateCenter||i.getPosition();i._entities.forEach((function(r){if(i.isNode(r)&&(!e||e(r))){var o=r.getMatrix();o.translate(-n.x,-n.y),o.rotate(t),o.translate(n.x,n.y);var a=Math.sign(r.getScale().x);r.setRotation(G(o.b*a,o.a*a)),r.setPosition(o.tx,o.ty)}}))},Zu.prototype._addRotationInBatchMode=function(t,e){var i=this,n=i._anchor2;i._entities.forEach((function(r){if(i.isNode(r)&&(!e||e(r))){var o=r.getAnchor(),a=r.getMatrix(),s=a.tf({x:r.getWidth()*(n.x-o.x),y:r.getHeight()*(n.y-o.y)}),l=new Xu.Math.Matrix2d;l.set(a.a,a.b,a.c,a.d,a.tx,a.ty),l.translate(-s.x,-s.y),l.rotate(t),l.translate(s.x,s.y);var c=Math.sign(r.getScale().x);r.setRotation(G(l.b*c,l.a*c)),r.setPosition(l.tx,l.ty)}}))},Zu.prototype.setPosition=function(t){var e,i,n,r,o=this,a=o._position,s=t.x-a.x,l=t.y-a.y,c=o._entities;for(i=0,n=c.length;n>i;i++)e=c[i],Fn(e)&&(r=e.getPosition(),e.setPosition(r.x+s,r.y+l));o._position=t},Zu.prototype.setScale=function(t,e){var i=this,n=t/i._scale.x,r=e/i._scale.y;i._adjustChildScaleOrSize(n,r,"size"),i._scale={x:t,y:e}},Zu.prototype.getRect=function(){var t=this,e=t._position,i=t._width,n=t._height;return{x:e.x-i/2,y:e.y-n/2,width:i,height:n}},Zu.prototype.setSize=function(t,e){var i=this,n=(t=Math.max(1,t),e=Math.max(1,e),t/i._width),r=e/i._height;i._adjustChildScaleOrSize(n,r,"size"),i._width=t,i._height=e},Zu.prototype._adjustChildScaleOrSize=function(t,e,i){var n,r,o,a,s,l,c,h,u,d,f,g,p,v,_=this,y=_._position,m=_._entities,b=new Xu.Math.Matrix2d;for(r=0,o=m.length;o>r;r++)if(n=m[r],_.isNode(n)){if(a=n.getPosition(),s=n.getRotation(),l=n.getWidth(),c=n.getHeight(),h=n.getScale(),f=h.x*l,g=h.y*c,b.identity().scale(f,g).rotate(s).translate(a.x,a.y).translate(-y.x,-y.y).rotate(-_._64O),s=G(b.b*Math.sign(f),b.a*Math.sign(f)),b.scale(t,e),u=Math.cos(s),d=Math.sin(s),Math.abs(u)<.001?(p=b.b/d,v=-b.c/d):(p=b.a/u,v=b.d/u),"scale"===i)n.setScale(p/l,v/c);else if("size"===i){var x=p/h.x,w=v/h.y;n.setScale(nr(p)*Math.abs(h.x),nr(v)*Math.abs(h.y)),n.setSize(Math.max(.1,Math.abs(x)),Math.max(.1,Math.abs(w)))}b.rotate(_._64O).translate(y.x,y.y),n.setPosition(b.tx,b.ty)}},Zu.prototype.getMatrix=function(){var t=this,e=t._position,i=c.Default.getInternal(),n=t._scale;return new i.Mat(t._64O,e.x,e.y,n.x,n.y)},Zu.prototype.toGlobal=function(t){return this.getMatrix().tf(t)},Zu.prototype.getCorners=function(){var t=this,e=t._width,i=t._height,n=t._anchor,r=-e*n.x,o=-i*n.y,a=t.getMatrix();return[a.tf(r,o),a.tf(r,o+i),a.tf(r+e,o+i),a.tf(r+e,o)]},Zu.prototype.calcInfo=function(){var t,e,i,n,r,o,a=this,s=[],l=a._entities,c=a._64O;for(n=0,r=l.length;r>n;n++)o=l[n],a.isNode(o)&&o.getCorners&&s.push.apply(s,o.getCorners());if(s.length){var h=Math.cos(-c),u=Math.sin(-c),d=1/0,f=-1/0,g=1/0,p=-1/0;for(n=0,r=s.length;r>n;n++)i=s[n],t=i.x,e=i.y,i.x=h*t-u*e,i.y=u*t+h*e,d=Math.min(d,i.x),f=Math.max(f,i.x),g=Math.min(g,i.y),p=Math.max(p,i.y);a._width=(f-d)/a._scale.x,a._height=(p-g)/a._scale.y,h=Math.cos(c),u=Math.sin(c);var v=a._anchor;t=d+(f-d)*v.x,e=g+(p-g)*v.y,a._position={x:h*t-u*e,y:u*t+h*e}}},Zu.prototype.isNode=function(t){return!!Fn(t)&&(!Gn(t)||!t.size())},Zu.prototype._42=function(t,e,i){var n,r,o,a,s,l,c,h,u=this,d=u._entities,f=u.rotateMode;for("batch"===f&&(h=u.getKeyOb()),n=0,r=d.length;r>n;n++)o=d[n],u.isNode(o)&&(l=o.getRect(),a=Xu.toScreenPosition(i,{x:l.x,y:l.y}),s=Xu.toScreenPosition(i,{x:l.x+l.width,y:l.y+l.height}),c={min:a,max:s},o===h&&(c.isKeyOb=!0),Xu.Icons.DrawIcon(t,e,Xu.Icons.GroupSubEntityRect,c))};var Ku=Xu.CurveActiving=function(t,e){for(var i in this._curve=t,this._interactor=t._interactor,this.silent=!0,e)this[i]=e[i];delete this.silent};Ku.prototype={},Ku.prototype.constructor=Ku,e.defineProperties(Ku.prototype,{point:{get:function(){return this._point},set:function(t){var e=this;e._point=t,e.editingCtrl||e.silent||e._firePointChange()}},pairs:{get:function(){return this._pairs},set:function(t){var e=this;e._pairs=t,e.editingCtrl&&!e.silent&&e._firePointChange()}}}),Ku.prototype._firePointChange=function(){var t=this,e=t.getCurrentEditingPoint(),n=t._interactor;if(e){var r=this._curve.target;if(r){var o=Xu.getDataMatrix(r).invert(),a=e.e;e=o.apply(Xu.toWorldPosition(n.gv,e)),e.e=a;var s=t._lastFirePoint;s&&Math.abs(e.x-s.x)<1e-5&&Math.abs(e.y-s.y)<1e-5&&(e.e==i&&s.e==i||Math.abs(e.e-s.e)<1e-5)||(t._lastFirePoint=e,n.fi({kind:"selectPoint",x:e.x,y:e.y,e:e.e}))}}else n.fi({kind:"selectPoint"})},Ku.prototype.dispose=function(){this._interactor.fi({kind:"selectPoint"})},Ku.prototype.getCurrentEditingPoint=function(){var t=this,e=t.editingCtrl;if(e){var i=t.pairs;if(i){var n=i[e.pairId];if(n){var r=n[e.type];if(r)return r}}}return t._point};var $u=Xu.CursorFactory=function(t){var e=this;e._interactor=t,e._rotateCursorStyles={}};$u.prototype={},$u.prototype.constructor=$u,$u.prototype.getRotateCursor=function(t){var e=this;0>t&&(t+=2*Math.PI);var i=e._interactor,n=i.getStyle("rotateCursorSize"),r=i.getStyle("rotateCursorRound"),o=Math.round(t/Math.PI*180/r);o*r>=360&&(o=0);var a=e._rotateCursorStyles,s="htCustomRotateStyle_"+n+"_"+r+"_"+o;return a[s]||(e._produceRotateCursor(s,n,r,o),a[s]=!0),s},$u.prototype._produceRotateCursor=function(t,e,i,n){var r=this;r._interactor;var o=r._canvas;o||(o=r._canvas=s.createElement("canvas")),o.width=o.height=e*devicePixelRatio,o.style.width=o.style.height=e+" px";var a=o.getContext("2d");Xu.setAntialias(a,!1),a.scale(devicePixelRatio,devicePixelRatio);var l,c,h,u,d,f=Math.round(e/2),g=f+" "+f+",auto !important;",p=4;l=Math.PI/180*n*i,a.clearRect(0,0,e,e),a.save(),a.scale(e/32,e/32),a.translate(16,15),a.rotate(l+Math.PI/2),a.beginPath(),a.moveTo(-8,0),a.lineTo(-8,p),a.lineTo(-8+p,p),a.moveTo(8,0),a.lineTo(8,p),a.lineTo(8-p,p),a.moveTo(-8,p),a.quadraticCurveTo(0,-6,8,p),a.restore(),a.lineCap="round",a.lineJoin="miter",a.strokeStyle="white",a.lineWidth=4,a.stroke(),a.strokeStyle="black",a.lineWidth=2,a.stroke(),c=JSON.stringify(o.toDataURL()),u="cursor:url("+c+")"+g,1!==devicePixelRatio&&(h='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+e+'px" height="'+e+'px"><image xlink:href='+c+' width="'+e+'" height="'+e+'"/></svg>',u+="cursor:url(data:image/svg+xml;base64,"+btoa(h)+")"+g,u+="cursor:-webkit-image-set(url("+c+")"+devicePixelRatio+"x,url("+c+")1x)"+g),d=s.createElement("style"),d.textContent="body."+t+" *, ."+t+"{"+u+"}",s.head.appendChild(d)};fu=Xu.Guide.Grid=function(t){var e=this;e._interactor=t,e._alignmentGuideId=0,e._xAlignmentGuide=[],e._yAlignmentGuide=[]};fu.prototype={},fu.prototype.constructor=fu,e.defineProperties(fu.prototype,{gridBlockSize:{get:function(){var t=this;return t._gridBlockSize||t._interactor.getStyle("gridBlockSize")},set:function(t){this._gridBlockSize=t,this._interactor._42()}},gridThickLinesEvery:{get:function(){var t=this;return t._gridThickLinesEvery||t._interactor.getStyle("gridThickLinesEvery")},set:function(t){this._gridThickLinesEvery=t,this._interactor._42()}},gridEnabled:{get:function(){var t=this,e=t._interactor;return e.gridEnabled&&t.isValidGrid()}}}),fu.prototype._42=function(){var t=this,e=t._interactor;t.gridEnabled&&t.drawGrid(),e.alignmentGuideEnabled&&t.drawAlignmentGuide()},fu.prototype.makeMatrix=function(){var t=this,e=t._interactor.getStyle("gridAngle"),i=t._interactor.getStyle("gridRotation"),n=new Xu.Math.Matrix2d,r=Math.sin(e),o=Math.cos(e);return n.set(1,0,o,r,0,0),n.rotate(i),n},fu.prototype.isValidGrid=function(){var t=this,e=Math.PI,i=t._interactor,n=i.gv;if(n._zoom<i.getStyle("gridZoomThreshold"))return!1;var r=i.getStyle("gridAngle"),o=Math.abs(r%e/e*180),a=1-1e-8;return!(a>o||o>180-a)},fu.prototype.drawAlignmentGuide=function(){var t=this,e=t._interactor,i=e.gv,n=e._canvas,r=e._context,o=n.width,a=n.height,s=i.tx(),l=i.ty(),c=i._zoom;r.beginPath(),r.strokeStyle=e.getStyle("gridAlignmentGuideColor"),r.lineWidth=1,t._xAlignmentGuide.forEach((function(t){var e=t.p*c+s;r.moveTo(e,0),r.lineTo(e,a)})),t._yAlignmentGuide.forEach((function(t){var e=t.p*c+l;r.moveTo(0,e),r.lineTo(o,e)})),r.stroke()},fu.prototype.drawGrid=function(){function t(t,e,i,n){var r=Xu.toScreenPosition(s,d.apply({x:t,y:e})),o=Xu.toScreenPosition(s,d.apply({x:i,y:n}));c.moveTo(r.x,r.y),c.lineTo(o.x,o.y)}var e=this,i=e._interactor,n=e.gridBlockSize,r=e.gridThickLinesEvery,o=i.getStyle("gridThickColor"),a=i.getStyle("gridLightColor"),s=i.gv,l=i._canvas,c=i._context,h=l.width,u=l.height,d=e.makeMatrix(),f=d.applyInverse(Xu.toWorldPosition(s,{x:0,y:0})),g=d.applyInverse(Xu.toWorldPosition(s,{x:h,y:0})),p=d.applyInverse(Xu.toWorldPosition(s,{x:0,y:u})),v=d.applyInverse(Xu.toWorldPosition(s,{x:h,y:u})),_=Math.min(f.x,g.x,p.x,v.x),y=Math.max(f.x,g.x,p.x,v.x),m=Math.min(f.y,g.y,p.y,v.y),b=Math.max(f.y,g.y,p.y,v.y);h=y-_,u=b-m;var x,w,C,S=Math.ceil(_/n),I=Math.floor(y/n),M=Math.ceil(m/n),T=Math.floor(b/n);for(s.tx(),s.ty(),s._zoom,c.save(),c.lineWidth=1,c.beginPath(),c.strokeStyle=o,C=Math.ceil(S/r)*r;I>=C;C+=r)x=C*n,t(x,m,x,b);for(C=Math.ceil(M/r)*r;T>=C;C+=r)w=C*n,t(_,w,y,w);for(c.stroke(),c.beginPath(),c.strokeStyle=a,C=S;I>=C;C++)0!==C%r&&(x=C*n,t(x,m,x,b));for(C=M;T>=C;C++)0!==C%r&&(w=C*n,t(_,w,y,w));c.stroke(),c.restore()},fu.prototype.getAlignmentGuides=function(){var t=this;return{x:t._xAlignmentGuide,y:t._yAlignmentGuide}},fu.prototype.addAlignmentGuide=function(t,e,i){var n=this,r="x"===t?n._xAlignmentGuide:n._yAlignmentGuide,o=(i=i||++n._alignmentGuideId,{p:e,id:i});if(r.length){var a=n._findClosestAlignmentGuide(o.p,r);a.dis<0?r.splice(a.index+1,0,o):r.splice(a.index,0,o)}else r.push(o);return n._interactor._42(),i},fu.prototype.findClosest=function(t,e,i){var n=this,r=n._interactor,o=r.gv;i&&(t=Xu.toWorldPosition(o,t));var a,s,l,c=1/0,h=1/0,u=t.x,d=t.y;if(n.gridEnabled){var f=n.gridBlockSize,g=n.makeMatrix(),p=g.applyInverse(t);p=g.apply({x:Math.round(p.x/f)*f,y:Math.round(p.y/f)*f}),c=p.x-u,h=p.y-d,l=!0}if(r.alignmentGuideEnabled&&(a=n._findClosestAlignmentGuide(u,n._xAlignmentGuide).dis,s=n._findClosestAlignmentGuide(d,n._yAlignmentGuide).dis,Math.abs(a)<Math.abs(c)&&(c=a,l=!0),Math.abs(s)<Math.abs(h)&&(h=s,l=!0)),l){l=!1;var v=o._zoom,_=r.getStyle("smartGuideThreshold")/v,y={};if(Math.abs(c)<_&&"y"!==e&&(y.x=i?c*v:c,l=!0),Math.abs(h)<_&&"x"!==e&&(y.y=i?h*v:h,l=!0),l)return y}},fu.prototype._findClosestAlignmentGuide=function(t,e){if(!e.length)return{dis:1/0};for(var i,n=0,r=e.length-1;r-n>1;)i=Math.floor((n+r)/2),e[i].p<t?n=i:r=i;var o=e[n].p-t,a=e[r].p-t;return Math.abs(o)<=Math.abs(a)?{line:e[n],dis:o,index:n}:{line:e[r],dis:a,index:r}},fu.prototype.removeAllAlignmentGuide=function(t){var e=this;"y"!==t&&(e._xAlignmentGuide=[]),"x"!==t&&(e._yAlignmentGuide=[]),e._interactor._42()},fu.prototype.removeAlignmentGuide=function(t){for(var e,i,n,r=this,o=r._xAlignmentGuide,a=0;2>a;a++)for(o=0===a?r._xAlignmentGuide:r._yAlignmentGuide,e=0,i=o.length;i>e;e++)if(n=o[e],n.id===t)return o.splice(e,1),r._interactor._42(),{axis:0===a?"x":"y",position:n.p};return!1},fu.prototype.adjustAlignmentGuide=function(t,e){var i=this,n=i.removeAlignmentGuide(t);return!!n&&(i.addAlignmentGuide(n.axis,e,t),!0)};var td=Xu.Guide.Rect=function(t){var e=this;e._interactor=t};td.prototype={},td.prototype.constructor=td,td.prototype.gatherRects=function(){var t,e,i,n,r=this,o=r._interactor.gv,a=[],s=[],l={x:a,y:s},c={},h=o.getDataModel(),u=h.a("width"),d=h.a("height");u&&d&&(t=0,e=0,i=u,n=d,a.push({node:h,type:0,p:t},{node:h,type:1,p:t+i/2},{node:h,type:2,p:t+i}),s.push({node:h,type:0,p:e},{node:h,type:1,p:e+n/2},{node:h,type:2,p:e+n}),c[h._id||0]={x:t,y:e,width:i,height:n}),h.each((function(r){if(Fn(r)&&!o.isSelected(r)&&o.isVisible(r)&&o.isValidGuideLineSource(r)){var l=!1;if(o.sm().getSelection().each((function(t){l||(r.isHostOn(t)||r.isDescendantOf(t))&&(l=!0)})),!l){var h=r.getRect();t=h.x,e=h.y,i=h.width,n=h.height,a.push({node:r,type:0,p:t},{node:r,type:1,p:t+i/2},{node:r,type:2,p:t+i}),s.push({node:r,type:0,p:e},{node:r,type:1,p:e+n/2},{node:r,type:2,p:e+n}),c[r._id]=h}}})),a.sort((function(t,e){return t.p-e.p})),s.sort((function(t,e){return t.p-e.p})),r._grid=l,r._87I=c},td.prototype.gatherLines=function(t,e,i){var n,r,o,a,s,l,c,h,u,d,f,g,p,v,_=this,y=[_.findClosest({x:t.x,y:t.y},e),_.findClosest({x:t.x+t.w/2,y:t.y+t.h/2},e),_.findClosest({x:t.x+t.w,y:t.y+t.h},e)],m={},b=_._87I;for(i=i||255,_._guideLine=[],n=0;2>n;n++)for(m={},0===n?(a="y",h=t.x,u=h+t.w):(a="x",h=t.y,u=h+t.h),r=0;3>r;r++)s=y[r],s&&isFinite(s[a])&&(p=1<<3*n+r,i&p&&(l=s[a+"Line"],c=l.node,v=c._id||0,m[v]||(m[v]=!0,g=b[v],"y"===a?(d=g.x,f=g.x+g.width):(d=g.y,f=g.y+g.height),o=l.p,_._guideLine.push({type:a,a:h,b:u,c:d,d:f,p:o,center:1===l.type}))))},td.prototype._binarySearchClosest=function(t,e){if(!e.length)return{dis:1/0};for(var i,n=0,r=e.length-1;r-n>1;)i=Math.floor((n+r)/2),e[i].p<t?n=i:r=i;var o=e[n].p-t,a=e[r].p-t;return Math.abs(o)<=Math.abs(a)?{line:e[n],dis:o}:{line:e[r],dis:a}},td.prototype.findClosest=function(t,e,i){var n=this,r=n._interactor,o=r.gv,a=n._grid;i&&(t=Xu.toWorldPosition(o,t));var s,l=n._binarySearchClosest(t.x,a.x),c=n._binarySearchClosest(t.y,a.y),h=l.dis,u=c.dis,d=o._zoom,f=r.getStyle("smartGuideThreshold")/d,g={};return Math.abs(h)<f&&"y"!==e&&(g.x=i?h*d:h,g.xLine=l.line,s=!0),Math.abs(u)<f&&"x"!==e&&(g.y=i?u*d:u,g.yLine=c.line,s=!0),s?g:void 0},td.prototype._42=function(){var t=this,e=t._guideLine;if(e&&!c.Default.isCtrlDown()){var i=t._interactor;if(i.getStyle("guideLineVisible")){var n,r,o,a,s,l,h,u,d,f,g,p,v,_,y,m,b,x=i.gv,w=i._context,C=x.tx(),S=x.ty(),I=x._zoom,M=i.getStyle("guideLineTextSpacing");for(n=0,r=e.length;r>n;n++)o=e[n],u=o.type,d=o.p,f=o.a,g=o.b,p=o.c,v=o.d,_=Math.min(f,p),y=Math.max(g,v),"x"===u?(a=d*I+C,s=_*I+S,l=a,h=y*I+S):(a=_*I+C,s=d*I+S,l=y*I+C,h=s),Xu.Icons.DrawIcon(i,w,Xu.Icons.MoveLineGuide,{rect:[a,s,l,h],center:o.center}),v>=f&&g>=p||(_=f>v?v:g,y=f>v?f:p,b=y-_,"x"===u?(o.center2center||(a-=M,l=a),s=_*I+S,h=y*I+S,m=Xu.Icons.MoveLineGuideDistanceV):"y"===u&&(o.center2center||(s-=M,h=s),a=_*I+C,l=y*I+C,m=Xu.Icons.MoveLineGuideDistanceH),Xu.Icons.DrawIcon(i,w,m,{x0:a,y0:s,x1:l,y1:h,dis:b}))}}},td.prototype.clear=function(){this._guideLine=null};var ed=Xu.Guide.Hover=function(t){var e=this;e._interactor=t};ed.prototype={},ed.prototype.constructor=ed,e.defineProperties(ed.prototype,{}),ed.prototype._42=function(){var t=this._interactor;if(t.getStyle("hoverGuideVisible")&&!t.gvEditing){var e=t.hoverData,i=t.gv;if(!Fn(e)||i.isSelected(e))return void(t.hoverData=null);var n=bc(i,e),r=Xu.toScreenPosition(i,{x:n.x,y:n.y}),o=Xu.toScreenPosition(i,{x:n.x+n.width,y:n.y+n.height});Xu.Icons.DrawIcon(t,t._context,Xu.Icons.HoverDataRect,{min:r,max:o,color:t.getStyle("hoverGuideColor")||t.getStyle("baseColor")})}},Xu.DefaultStyleMap={baseColor:"rgb(51,153,255)",pointSize:[24,9],checkSize:7,rotateCheckSize:10,moveSensitivity:10,moveDummyThreshold:32,moveDummyPosition:[0,0,-16,-16],moveDummyLineExtraShift:[-32,0],moveDummySensitivity:16,keepAspectRatio:!1,rotateRound:Math.PI/2,shiftRotateRound:Math.PI/12,rotateSensitivity:Math.PI/60,rotateAsClock:!1,shiftLineRotateRound:Math.PI/4,anchorMovable:!0,anchorVisible:!0,anchorHideThreshold:25,anchorOutsideVisibleThreshold:.25,anchorRound:.25,anchorSensitivity:.02,smartGuideThreshold:8,curveIntersectSize:5,curvePointIntersectSize:8,edgeHostDetectPerFrame:!0,edgeHostEdgeMaxDistance:12,edgeHostEdgeHighlighColor:"#5d5d5d",edgeHostPointHighlighColor:"red",edgeHostHighlighPeriod:1500,edgeElevationEditable:!1,attachThreshold:25,guideLineVisible:!0,guideLineTextSpacing:0,hoverGuideVisible:!1,hoverGuideColor:null,gridBlockSize:40,gridThickLinesEvery:10,gridThickColor:"#5d5d5d",gridLightColor:"#d0d0d0",gridZoomThreshold:.25,gridAlignmentGuideColor:"#ff0000",gridAngle:Math.PI/2,gridRotation:0,groupRotateModeDefault:"block",groupRotateModeKey:["ctrlKey","metaKey"],rotateCursorSize:32,rotateCursorRound:45,tipTextColor:"#ffffff",tipBackground:"#333333",curveHighlightColor:"#30599e",rectPointBackground:"white",rectPointBorderColor:"#666666",rectPointShadowColor:"rgba(0,0,0,0.35)",shapeCtrlPointBackground:"white",shapeCtrlPointBorderColor:null,shapeCtrlPointHighlightBorder:null,shapeHighlighPointBackground:"#30599e",curveElevationVisible:!0,curveElevationIntersectSize:8,curveElevationGuideShift:[20,0],curveTipVisible:!0,connectGuideVisible:!0,connectGuideShift:[1,.25,8,0],connectGuideIntersectSize:8,connectGuideGarbageIntersectsize:25,connectGuideGarbageShift:[1,1,-48,-48]};var id=Xu.Icons={},nd=1e4,rd=null,od=Xu.DefaultStyleMap.baseColor,ad="rgb(183,232,135)",sd="rgb(255,204,153)",ld=6;c.Default.setImage("Icons.RectPoint",{width:ld,height:ld,comps:[{type:"rect",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return od}},rect:[0,0,ld,ld]}]}),id.GroupSubEntityRect={comps:[{type:"shape",points:{func:function(){var t=id.GroupSubEntityRect.data;if(!t)return[];var e=t.min,i=t.max;return[e.x,e.y,e.x,i.y,i.x,i.y,i.x,e.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return id.GroupSubEntityRect.data.isKeyOb,od}}}]};var cd=4;id.HoverDataRect={comps:[{type:"shape",points:{func:function(){var t=id.HoverDataRect.data;if(!t)return[];var e=t.min,i=t.max,n=cd;return e.x-=n,e.y-=n,i.x+=n,i.y+=n,[e.x,e.y,e.x,i.y,i.x,i.y,i.x,e.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return id.HoverDataRect.data.color}},borderCap:"round",borderPattern:[1,4]}]},id.Line={comps:[{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[id.Line.data.P1.x,id.Line.data.P1.y],ld,ld]}}},{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[id.Line.data.P2.x,id.Line.data.P2.y],ld,ld]}}}]},id.NodeHoverGuide={comps:[{type:"shape",points:{func:function(){return id.NodeHoverGuide.data}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:"#3399FF"}]},id.Rect={comps:[{type:"shape",points:{func:function(){var t=id.Rect.data;if(!t)return[];var e=t.LT,i=t.LB,n=t.RB,r=t.RT;return[e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return od}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return id.Rect.data.rotation}},rect:{func:function(){return[[id.Rect.data.LT.x,id.Rect.data.LT.y],ld,ld]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return id.Rect.data.rotation}},rect:{func:function(){return[[id.Rect.data.LB.x,id.Rect.data.LB.y],ld,ld]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return id.Rect.data.rotation}},rect:{func:function(){return[[id.Rect.data.RB.x,id.Rect.data.RB.y],ld,ld]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return id.Rect.data.rotation}},rect:{func:function(){return[[id.Rect.data.RT.x,id.Rect.data.RT.y],ld,ld]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return id.Rect.data.rotation}},visible:{func:function(){return!!id.Rect.data.L}},rect:{func:function(){return[[id.Rect.data.L.x,id.Rect.data.L.y],ld,ld]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return id.Rect.data.rotation}},visible:{func:function(){return!!id.Rect.data.R}},rect:{func:function(){return[[id.Rect.data.R.x,id.Rect.data.R.y],ld,ld]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return id.Rect.data.rotation}},visible:{func:function(){return!!id.Rect.data.T}},rect:{func:function(){return[[id.Rect.data.T.x,id.Rect.data.T.y],ld,ld]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return id.Rect.data.rotation}},visible:{func:function(){return!!id.Rect.data.B}},rect:{func:function(){return[[id.Rect.data.B.x,id.Rect.data.B.y],ld,ld]}}}]};var hd=16;c.Default.setImage("Icons.Anchor",{width:12,height:12,comps:[{type:"shape",borderWidth:1,borderColor:{func:function(){return od}},borderCap:"round",shadowColor:"#1ABC9C",points:[.50928,6,11.49072,6,6,6,6,.50928,6,11.49072]},{type:"circle",borderWidth:1,borderColor:{func:function(){return od}},shadowColor:"#1ABC9C",rect:[2.84391,2.84391,6.53697,6.53697]}]}),id.Anchor={comps:[{type:"image",name:"Icons.Anchor",rect:{func:function(){return[[id.Anchor.data.POS.x,id.Anchor.data.POS.y],hd,hd]}}}]},id.TipShiftX=12,id.TipShiftY=12;var ud=[8,28];id.TipHelper={comps:[{type:"roundRect",rect:{func:function(){return[id.TipHelper.data.helperPos.x,id.TipHelper.data.helperPos.y,ud[0]*id.TipHelper.data.size,ud[1]]}},background:{func:function(){return rd.getStyle("tipBackground")}},opacity:.6},{type:"text",text:{func:function(){return id.TipHelper.data.text}},rect:{func:function(){return[id.TipHelper.data.helperPos.x,id.TipHelper.data.helperPos.y,ud[0]*id.TipHelper.data.size,ud[1]]}},color:{func:function(){return rd.getStyle("tipTextColor")}},font:"bold 12px Arial",align:"center"}]};var dd=7;id.ShapePoint={comps:[{type:"circle",visible:{func:function(){return!!id.ShapePoint.data.dynamicVisible}},rect:{func:function(){var t=id.ShapePoint.data.point,e=id.ShapePoint.data.size||dd;return[t,e+10,e+10]}},background:{func:function(){var t=Date.now(),e=id.ShapePoint.data.dynamicPeriod||1500,i=Math.sin(t%e/e*Math.PI);return"rgba(27,124,22,"+.5*i+")"}},borderWidth:0},{type:"circle",rect:{func:function(){var t=id.ShapePoint.data.point,e=id.ShapePoint.data.size||dd;return[t,e,e]}},background:{func:function(){var t=id.ShapePoint.data.isEnd;return t?"rgba(27,124,222,0.7)":"#ffffff"}},borderWidth:1,borderColor:{func:function(){return id.ShapePoint.data.color||od}}},{type:"rect",visible:{func:function(){return!!id.ShapePoint.data.dynamicVisible}},background:"red",borderWidth:0,rotation:Math.PI/4,borderColor:{func:function(){return od}},rect:{func:function(){var t=5;return[id.ShapePoint.data.point,t,t]}}}]},id.ShapeBgCurve={comps:[{type:"shape",visible:{func:function(){return!!id.ShapeBgCurve.data.dynamicVisible}},points:{func:function(){return id.ShapeBgCurve.data.P}},segments:{func:function(){return id.ShapeBgCurve.data.S}},background:null,borderWidth:6,borderColor:{func:function(){var t=Date.now(),e=id.ShapeBgCurve.data.dynamicPeriod||1500,i=Math.sin(t%e/e*Math.PI);return"rgba(27,124,22,"+.3*i+")"}}},{type:"shape",points:{func:function(){return id.ShapeBgCurve.data.P}},segments:{func:function(){return id.ShapeBgCurve.data.S}},background:null,borderWidth:1,borderColor:{func:function(){return id.ShapeBgCurve.data.color||od}}}]};var fd=8;id.ShapeHighlighPoint={comps:[{type:"circle",rect:{func:function(){var t=id.ShapeHighlighPoint.data;return[[t.x,t.y],fd,fd]}},background:{func:function(){return rd.getStyle("shapeHighlighPointBackground")}},borderWidth:0}]};var gd=10;id.ShapeHighlighRealPoint={comps:[{type:"circle",rect:{func:function(){var t=id.ShapeHighlighRealPoint.data;return[[t.x,t.y],gd,gd]}},background:"#ffffff",borderWidth:2,borderColor:{func:function(){return od}}}]};var pd=8;id.ShapeHighlighCtrlPoint={comps:[{type:"shape",points:{func:function(){var t=id.ShapeHighlighCtrlPoint.data,e=t.x,i=t.y,n=pd/2;return[e-n,i-n,e-n,i+n,e+n,i+n,e+n,i-n]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return rd.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return rd.getStyle("shapeCtrlPointBorderColor")||od}}}]};var vd=3;id.ShapeHighlightCurve={comps:[{type:"shape",points:{func:function(){return id.ShapeHighlightCurve.data}},segments:[1,4],background:null,borderWidth:vd,borderColor:{func:function(){return rd.getStyle("curveHighlightColor")}}}]},id.ShapeGuideLine={comps:[{type:"shape",points:{func:function(){return id.ShapeGuideLine.data}},background:null,borderWidth:1,borderColor:"rgb(255,204,153)"}]},id.MoveLineGuide={comps:[{type:"shape",points:{func:function(){return id.MoveLineGuide.data.rect}},background:null,borderWidth:1,borderColor:{func:function(){return id.MoveLineGuide.data.center?ad:sd}}}]};var _d=5;id.MoveLineGuideDistanceH={comps:[{type:"shape",points:{func:function(){var t=id.MoveLineGuideDistanceH.data,e=t.x0,i=t.y0;return[e,i-_d,e,i+_d]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:sd},{type:"shape",points:{func:function(){var t=id.MoveLineGuideDistanceH.data,e=t.x1,i=t.y1;return[e,i-_d,e,i+_d]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:sd},{type:"text",text:{func:function(){return Math.round(id.MoveLineGuideDistanceH.data.dis)}},rect:{func:function(){var t=id.MoveLineGuideDistanceH.data;return[[(t.x0+t.x1)/2,t.y0-10],20,20]}},color:sd,font:"12px Arial",align:"center"}]},id.MoveLineGuideDistanceV={comps:[{type:"shape",points:{func:function(){var t=id.MoveLineGuideDistanceV.data,e=t.x0,i=t.y0;return[e-_d,i,e+_d,i]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:sd},{type:"shape",points:{func:function(){var t=id.MoveLineGuideDistanceV.data,e=t.x1,i=t.y1;return[e-_d,i,e+_d,i]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:sd},{type:"text",text:{func:function(){return Math.round(id.MoveLineGuideDistanceV.data.dis)}},rect:{func:function(){var t=id.MoveLineGuideDistanceV.data;return[[t.x0-10,(t.y0+t.y1)/2],20,20]}},color:sd,font:"12px Arial",align:"center"}]},c.Default.setImage("Icons.EdgeElevationGuideImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,255,255)",borderWidth:1,borderColor:"rgb(138,138,138)",rect:[.5,.5,15,15]},{type:"shape",borderWidth:2,borderColor:"rgb(44,44,44)",borderCap:"round",points:[4,8,8,4,12,8,8,4,8,13],segments:[1,2,2,1,2]}]}),id.EdgeElevationGuide={comps:[{type:"image",name:"Icons.EdgeElevationGuideImage",rect:{func:function(){var t=id.EdgeElevationGuide.data,e=t.x,i=t.y,n=rd.getStyle("curveElevationIntersectSize"),r=rd.getStyle("curveElevationGuideShift");return e+=r[0],i+=r[1],[e-n,i-n,2*n,2*n]}}}]},c.Default.setImage("Icons.ConnectGuideBgImage",{width:12,height:12,comps:[{type:"shape",background:"#3399ff",fillRule:"evenodd",shadowColor:"#1ABC9C",rotation:3.14159,points:[6.00001,11.99999,6.00001,11.99999,2.6863,11.99999,1e-5,9.30695,1e-5,5.99999,1e-5,5.99999,1e-5,2.68628,2.69305,-1e-5,6.00001,-1e-5,12.00001,-1e-5,11.99998,12.00001,6.00001,11.99999],segments:[1,2,4,2,4,2,2,2]}]}),c.Default.setImage("Icons.ConnectGuideHeaderImage",{width:12,height:12,comps:[{type:"oval",background:"#3399FF",borderColor:"#3399FF",shadowColor:"#1ABC9C",rect:[0,0,12,12]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[4.76,2.56,8.2,5.98,4.76,9.44]}]}),id.ConnectGuide={comps:[{type:"image",name:"Icons.ConnectGuideBgImage",rotation:{func:function(){return id.ConnectGuide.data.rotation}},rect:{func:function(){var t=id.ConnectGuide.data.connect;t.x,t.y;var e=rd.getStyle("connectGuideIntersectSize");return[[t.x,t.y],2*e,2*e]}}},{type:"image",name:"Icons.ConnectGuideHeaderImage",rect:{func:function(){var t=id.ConnectGuide.data.cursorPos||id.ConnectGuide.data.connect,e=rd.getStyle("connectGuideIntersectSize");return[[t.x,t.y],2*e-2,2*e-2]}}},{type:"shape",background:null,borderColor:"#3399ff",borderWidth:2,segments:[1,4],points:{func:function(){var t=id.ConnectGuide.data.connect,e=id.ConnectGuide.data.cursorPos||t;return[t.x,t.y,t.x+.5*(e.x-t.x),t.y,e.x+.5*(t.x-e.x),e.y,e.x,e.y]}}}]},c.Default.setImage("Icons.ConnectGuideGarbageImage",{width:48,height:48,comps:[{type:"oval",background:"rgba(0,0,0,0.1)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,48,48]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[19.84721,19.69091,19.84721,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[24.10371,19.69091,24.10371,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[28.15279,19.69091,28.15279,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[11.23055,15.22377,36.76945,15.189,19.12302,15.17121,20.94722,11.5228,26.41985,11.5228,28.24406,15.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[15.48702,15.22377,17.02595,21.25344]}]}),c.Default.setImage("Icons.ConnectGuideDeletingImage",{width:56,height:56,comps:[{type:"oval",background:"rgba(232,0,0,0.75)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,56,56]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[22.67939,27.69091,22.67939,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[26.93588,27.69091,26.93588,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[30.98497,27.69091,30.98497,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",anchorX:0,anchorY:1,rotation:5.65062,points:[14.06272,23.22377,39.60163,23.189,21.9552,23.17121,23.7794,19.5228,29.25203,19.5228,31.07623,23.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[18.3192,23.22377,17.02595,21.25344]}]}),id.ConnectGuideGarbage={comps:[{type:"image",name:{func:function(){var t=id.ConnectGuideGarbage.data.hover;return t?"Icons.ConnectGuideDeletingImage":"Icons.ConnectGuideGarbageImage"}},rect:{func:function(){var t=id.ConnectGuideGarbage.data,e=rd.getStyle("connectGuideGarbageIntersectsize");return t.hover&&(e+=5),[[t.x,t.y],2*e,2*e]}}}]};var yd=6;id.ShapeActivingCtrl={comps:[{type:"shape",visible:{func:function(){return!!id.ShapeActivingCtrl.data.c1}},points:{func:function(){var t=id.ShapeActivingCtrl.data;return[t.point.x,t.point.y,t.c1.x,t.c1.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return od}}},{type:"shape",visible:{func:function(){return!!id.ShapeActivingCtrl.data.c2}},points:{func:function(){var t=id.ShapeActivingCtrl.data;return[t.point.x,t.point.y,t.c2.x,t.c2.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return od}}},{type:"shape",visible:{func:function(){return!!id.ShapeActivingCtrl.data.c1}},points:{func:function(){var t=id.ShapeActivingCtrl.data.c1,e=t.x,i=t.y,n=yd/2;return"c1"===id.ShapeActivingCtrl.data.hl&&(n+=.5),[e-n,i-n,e-n,i+n,e+n,i+n,e+n,i-n]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return rd.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c1"===id.ShapeActivingCtrl.data.hl?rd.getStyle("shapeCtrlPointHighlightBorder")||od:rd.getStyle("shapeCtrlPointBorderColor")||od}}},{type:"shape",visible:{func:function(){return!!id.ShapeActivingCtrl.data.c2}},points:{func:function(){var t=id.ShapeActivingCtrl.data.c2,e=t.x,i=t.y,n=yd/2;return"c2"===id.ShapeActivingCtrl.data.hl&&(n+=.5),[e-n,i-n,e-n,i+n,e+n,i+n,e+n,i-n]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return rd.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c2"===id.ShapeActivingCtrl.data.hl?rd.getStyle("shapeCtrlPointHighlightBorder")||od:rd.getStyle("shapeCtrlPointBorderColor")||od}}}]},id.RoundPoint={comps:[{type:"circle",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return od}},rect:{func:function(){return[[id.RoundPoint.data.x,id.RoundPoint.data.y],ld,ld]}}}]},id.AttachPoint={comps:[{type:"rect",background:{func:function(){return id.AttachPoint.data.isAttach?"rgb(51,153,255)":"rgb(247,247,247)"}},borderWidth:1,rotation:Math.PI/4,borderColor:{func:function(){return od}},rect:{func:function(){var t=id.AttachPoint.data.isAttach?ld+4:ld;return[[id.AttachPoint.data.x,id.AttachPoint.data.y],t,t]}}}]},id.SimpleRect={comps:[{type:"rect",background:null,borderWidth:{func:function(){return id.SimpleRect.data.borderWidth||1}},borderColor:{func:function(){return id.SimpleRect.data.color||od}},rect:{func:function(){var t=id.SimpleRect.data;return[t.x,t.y,t.width,t.height]}}}]},c.Default.setImage("Icons.MoveDummyImage",{width:32,height:32,boundExtend:12,attachStyle:"close",comps:[{type:"oval",background:"rgb(255,255,255)",borderColor:"#979797",shadow:!0,shadowColor:"rgba(0,0,0,0.25)",shadowOffsetX:0,rect:[0,0,32,32]},{type:"shape",background:"rgb(51,153,255)",pixelPerfect:!0,points:[8.65079,11.90713,9.05502,11.46921,9.70629,11.46921,10.11052,11.90713,10.51476,12.28891,10.51476,12.92895,10.11052,13.34441,8.49359,14.97258,12.2889,14.97258,12.85034,14.97258,13.29949,15.42172,13.29949,15.99439,13.29949,16.57828,12.85034,17.0162,12.2889,17.0162,8.49359,17.0162,10.11052,18.6556,10.51476,19.0486,10.51476,19.7111,10.11052,20.09288,9.70629,20.50834,9.05502,20.50834,8.65079,20.09288,5.32709,16.76917,5.28217,16.71303,4.87794,16.32002,4.87794,15.67998,5.28217,15.26452,8.65079,11.90713,8.65079,11.90713,8.65079,11.90713,13.3444,10.09931,13.3444,10.09931,12.94017,10.50354,12.2889,10.50354,11.88467,10.09931,11.48043,9.69507,11.48043,9.0438,11.88467,8.63957,15.27574,5.25973,15.66874,4.86672,16.32001,4.86672,16.73547,5.25973,16.76917,5.31586,20.10409,8.63957,20.50832,9.0438,20.50832,9.68385,20.10409,10.09931,19.69986,10.49231,19.07105,10.50354,18.64436,10.09931,17.02742,8.45991,17.02742,12.26646,17.02742,12.83912,16.55581,13.31072,15.99438,13.31072,15.43295,13.31072,14.98379,12.83912,14.98379,12.26646,14.96134,8.45991,13.3444,10.09931,13.3444,10.09931,13.3444,10.09931,21.90069,13.33318,21.90069,13.33318,21.49646,12.91771,21.49646,12.27768,21.90069,11.89591,22.31615,11.45798,22.94497,11.45798,23.36043,11.89591,26.72904,15.2533,27.12205,15.66876,27.12205,16.3088,26.72904,16.7018,26.6729,16.75794,23.36043,20.08165,22.94497,20.49711,22.31615,20.49711,21.90069,20.08165,21.49646,19.69987,21.49646,19.03737,21.90069,18.64437,23.51763,17.00498,19.72231,17.00498,19.14965,17.00498,18.71173,16.56705,18.71173,15.98316,18.71173,15.41049,19.14965,14.96135,19.72231,14.96135,23.51763,14.96135,21.90069,13.33318,21.90069,13.33318,21.90069,13.33318,11.88467,23.32675,11.88467,23.32675,11.48043,22.94498,11.48043,22.27125,11.88467,21.88948,12.2889,21.48523,12.94017,21.48523,13.3444,21.88948,14.96134,23.52887,14.98379,19.7111,14.98379,19.14966,15.43295,18.67805,15.99438,18.67805,16.55581,18.67805,17.02742,19.14966,17.02742,19.7111,17.02742,23.52887,18.64436,21.88948,19.07105,21.48523,19.69986,21.48523,20.10409,21.88948,20.50832,22.27125,20.50832,22.94498,20.10409,23.32675,16.76917,26.65045,16.73547,26.72905,16.32001,27.13329,15.66874,27.13329,15.27574,26.72905,11.88467,23.32675,11.88467,23.32675,11.88467,23.32675],segments:[1,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2]}]}),id.MoveDummy={comps:[{type:"image",name:"Icons.MoveDummyImage",rect:{func:function(){var t=id.MoveDummy.data;return[[t.pos.x,t.pos.y],2*t.size,2*t.size]}}}]},Xu.Icons.DrawIcon=function(t,e,i,n){i.width=i.height=nd,i.data=n,rd=t,c.Default.drawImage(e,i,0,0,nd,nd)},Xu.Icons.MapPoints=function(t,e){for(var i=0,n=t.length;n>i;i++)t[i]/=e},Xu.roundTo=function(t,e,i){var n=Math.abs(t%e);return i>n||i>e-n?e*Math.round(t/e):t},Xu.toFixed=function(t){return Math.round(100*t)/100},Xu.getDataMatrix=function(t){if(t instanceof c.Shape){var e=new c.Math.Matrix2d,i=t.getPosition();return e.translate(-i.x,-i.y).scale(t.getScale().x,t.getScale().y).rotate(t.getRotation()).translate(i.x,i.y),e}return t.getMatrix?t.getMatrix():new c.Math.Matrix2d};var md=Xu.Math.Curve=function(){this._curves=[]};md.prototype={},md.prototype.constructor=md,md.prototype.createFromHtShape=function(t,e,n){e instanceof c.List&&(e=e.toArray());var r,o,a,s,l,h,u,d=this,f=null,g=null,p=0,v=Xu.Math.Vector2,_=Xu.Math.CubicBezier,y=function(e){return new v(t[e],t[e+1],n?n[e/2]:i)};for(o=0,a=e.length;a>o;o++){switch(s=e[o],l=null,s){case 1:g=y(p),f=g,p+=2;break;case 2:r=y(p),p+=2,l=new _(g,g.clone(),r.clone(),r),g=r;break;case 3:h=y(p),r=y(p+2),p+=4,l=new _(g,h.clone().sub(g).multiplyScalar(2/3).add(g),h.clone().sub(r).multiplyScalar(2/3).add(r),r),g=r;break;case 4:h=y(p),u=y(p+2),r=y(p+4),p+=6,l=new _(g,h,u,r),g=r;break;case 5:if(!f)break;l=new _(g,g.clone(),f.clone(),f),g=null,f=null}l&&(l._index=d._curves.length,d._curves.push(l))}},md.prototype.checkPoint=function(t,e){var i,n,r,o,a,s=this,l=s._curves;for(i=0,n=l.length;n>i;i++)if(o=l[i],a=o.intersectRect(t,e,e),a.length)return r=0,a.forEach((function(t){r+=t.t})),r/=a.length,t=o.getPointAt(r),t.t=r,{bezier:o,intersection:t}},md.prototype.insertKnot=function(t,e){var i=t.insertKnot(e),n=this,r=n._curves;r.splice(t._index,1,i[0],i[1])},md.prototype._isCloseEnough=function(t,e){return Math.abs(t.x-e.x)<1e-6&&Math.abs(t.y-e.y)<1e-6},md.prototype._isSamePoint=function(t,e){return t===e},md.prototype.moveRealPoint=function(t,e){var i=this,n=i._curves,r=e.clone().sub(t);n.forEach((function(n){var o=n._p1;n._p2,n._p3;var a=n._p4;i._isSamePoint(o,t)&&(n._p2.add(r),n._p1=e),i._isSamePoint(a,t)&&(n._p3.add(r),n._p4=e)}))},md.prototype.moveCtrlDueToRealPointMovement=function(t,e){var i=this,n=i._curves,r=function(t){t.add(e),t.e&&e.e&&(t.e+=e.e)};n.forEach((function(e){var n=e._p1;e._p2,e._p3;var o=e._p4;i._isSamePoint(n,t)&&r(e._p2),i._isSamePoint(o,t)&&r(e._p3)}))},md.prototype.moveCtrlPoint=function(t,e,n){var r=t[n];if(r){r.e!==i&&(e.e=r.e);var o=this,a=o._curves;e.clone().sub(r),a.forEach((function(t){var i;"c2"===n?i="_p2":"c1"===n&&(i="_p3"),o._isSamePoint(t[i],r)&&(t[i]=e)})),t[n]=e}},md.prototype.deleteRealPoint=function(t,e){var i,n,r,o,a,s,l=this,c=l._curves,h={},u=[],d=Xu.Math.CubicBezier;for(n=0,r=c.length;r>n;n++)i=c[n],o=i._p1,a=i._p2,i._p3,s=i._p4,(h[n]||!l._isSamePoint(o,t))&&(l._isSamePoint(s,t)?r>n+1&&l._isSamePoint(c[n+1]._p1,t)&&(e||u.push(new d(o,a,c[n+1]._p3,c[n+1]._p4))):u.push(i));l._curves=u},md.prototype.findPairs=function(t,e){var i,n,r,o,a,s,l,c,h=this,u=h._curves,d={},f=[];for(n=0,r=u.length;r>n;n++)i=u[n],o=i._p1,a=i._p2,s=i._p3,l=i._p4,!d[n]&&h._isSamePoint(o,t)&&(e?f.push({point:o,r2:l}):f.push({point:o,c2:a})),h._isSamePoint(l,t)&&(c=e?{point:l,r1:o}:{point:l,c1:s},r>n+1&&h._isSamePoint(u[n+1]._p1,t)&&(e?c.r2=u[n+1]._p4:c.c2=u[n+1]._p2,d[n+1]=!0),f.push(c));return f},md.prototype.toHtShape=function(){var t=this,e=t._curves,i=[],n=[],r={x:1/0,y:1/0};return e.forEach((function(e){var o=e._p1,a=e._p2,s=e._p3,l=e._p4;return t._isCloseEnough(o,r)||(i.push(1),n.push(o.clone())),r=l,t._isCloseEnough(o,a)&&t._isCloseEnough(s,l)?(i.push(2),void n.push(l.clone())):(i.push(4),void n.push(a.clone(),s.clone(),l.clone()))})),{segments:i,points:n}};var bd=Xu.Math.CubicBezier=function(t,e,i,n){var r=this;r._id=Xu.Math.CubicBezier._globalId++,r._p1=t,r._p2=e,r._p3=i,r._p4=n};bd._globalId=1,bd.prototype={},bd.prototype.constructor=bd,bd.prototype.toString=function(){return this._id},bd.prototype.intersectRect=function(t,e,i){var n=e/2,r=i/2,o=t.x,a=t.y,s=Xu.Math.Vector2,l=new s(-n+o,-r+a),c=new s(n+o,r+a),h=new s(c.x,l.y),u=new s(l.x,c.y),d=this,f=d.intersectLine(l,h),g=d.intersectLine(h,c),p=d.intersectLine(c,u),v=d.intersectLine(u,l),_=f.concat(g).concat(p).concat(v);return _},bd.prototype.intersectLine=function(t,e){var i,n,r,o,a,s,l,c,h,u,d,f,g,p=this,v=t.clone().min(e),_=t.clone().max(e);o=p._p1,a=p._p2,s=p._p3,l=p._p4,i=o.clone().multiplyScalar(-1),n=a.clone().multiplyScalar(3),r=s.clone().multiplyScalar(-3),d=i.add(n).add(r).add(l),i=o.clone().multiplyScalar(3),n=a.clone().multiplyScalar(-6),r=s.clone().multiplyScalar(3),u=i.add(n).add(r),i=o.clone().multiplyScalar(-3),n=a.clone().multiplyScalar(3),h=i.add(n),c=o.clone(),g=new Xu.Math.Vector2(t.y-e.y,e.x-t.x),f=t.x*e.y-e.x*t.y;for(var y=p.getRoots(g.dot(d),g.dot(u),g.dot(h),g.dot(c)+f),m=new Array,b=0,x=y.length;x>b;b++){var w=y[b];if(!(0>w||w>1)){var C=o.clone().lerp(a,w),S=a.clone().lerp(s,w),I=s.clone().lerp(l,w),M=C.lerp(S,w),T=S.lerp(I,w),E=M.lerp(T,w);E.t=w,t.x==e.x?v.y<=E.y&&E.y<=_.y&&m.push(E):t.y==e.y?v.x<=E.x&&E.x<=_.x&&m.push(E):E.x>=v.x&&E.y>=v.y&&E.x<=_.x&&E.y<=_.y&&m.push(E)}}return m},bd.prototype.solveTForPoint=function(t){var e,n,r,o,a=this;e=a._p1.x-t.x,n=a._p2.x-t.x,r=a._p3.x-t.x,o=a._p4.x-t.x;for(var s=a.getRoots(o-3*r+3*n-e,3*r-6*n+3*e,3*n-3*e,e),l=i,c=1/0,h=0,u=s.length;u>h;h++){var d=s[h];if(!(0>d||d>1)){var f=a._p1.clone().lerp(a._p2,d),g=a._p2.clone().lerp(a._p3,d),p=a._p3.clone().lerp(a._p4,d),v=f.lerp(g,d),_=g.lerp(p,d),y=v.lerp(_,d);y.t=d;var m=Math.abs(y.y-t.y);c>m&&(c=m,l=y)}}return l},bd.prototype.getPointAt=function(t){var e=this,i=e._p1,n=e._p2,r=e._p3,o=e._p4,a=i.clone().lerp(n,t),s=n.clone().lerp(r,t),l=r.clone().lerp(o,t),c=a.lerp(s,t),h=s.lerp(l,t);return c.lerp(h,t)},bd.prototype.getRoots=function(t,e,i,n){var r=new Array;if(Math.abs(t)<1e-6){var o=e,a=i/o,s=n/o,l=a*a-4*s;if(l>0){var c=Math.sqrt(l);r.push(.5*(-a+c)),r.push(.5*(-a-c))}else 0==l&&r.push(.5*-a)}e/=t,i/=t,n/=t,o=(3*i-e*e)/3,a=(2*e*e*e-9*i*e+27*n)/27;var h=e/3,u=a*a/4+o*o*o/27,d=a/2;if(Math.abs(u)<=1e-6&&(u=0),u>0){var f;c=Math.sqrt(u);m=-d+c,f=m>=0?Math.pow(m,1/3):-Math.pow(-m,1/3),m=-d-c,m>=0?f+=Math.pow(m,1/3):f-=Math.pow(-m,1/3),r.push(f-h)}else if(0>u){var g=Math.sqrt(-o/3),p=Math.atan2(Math.sqrt(-u),-d)/3,v=Math.cos(p),_=Math.sin(p),y=Math.sqrt(3);r.push(2*g*v-h),r.push(-g*(v+y*_)-h),r.push(-g*(v-y*_)-h)}else{var m;m=d>=0?-Math.pow(d,1/3):Math.pow(-d,1/3),r.push(2*m-h),r.push(-m-h)}return r},bd.prototype._70I=function(){var t=this;return t._p1.distanceToSquared(t._p2)<1e-10&&t._p3.distanceToSquared(t._p4)<1e-10},bd.prototype.insertKnot=function(t){var e=this,i=e._p1,n=e._p2,r=e._p3,o=e._p4,a=i.clone().lerp(n,t),s=n.clone().lerp(r,t),l=r.clone().lerp(o,t),c=a.clone().lerp(s,t),h=s.clone().lerp(l,t),u=c.clone().lerp(h,t);return e._70I()?(i.clone().lerp(o,t),[new Xu.Math.CubicBezier(i,i.clone(),u.clone(),u),new Xu.Math.CubicBezier(u,u.clone(),o.clone(),o)]):[new Xu.Math.CubicBezier(i,a,c,u),new Xu.Math.CubicBezier(u,h,l,o)]};Iu=c.Default.getInternal().ui().EdgeUI;var xd={_47O:function(t){var e=this,i=xd.getBackups()._47O;Xu.inEdit(e.gv)||i.call(e,t)}};Xu.Inject.registAsModule(xd,Iu);Su=c.Default.getInternal().ui().NodeUI;var wd={_47O:function(t){var e=this,i=wd.getBackups()._47O;Xu.inEdit(e.gv)||i.call(e,t)},getSelectWidth:function(){var t=this,e=t.gv,i=t._data;if(e.isEditable(i)&&Xu.inEdit(e))return 0;var n=wd.getBackup("getSelectWidth");return n.call(t)}};Xu.Inject.registAsModule(wd,Su);var Cd=c.graph.GraphView,Sd={_editPointSize:function(){var t=c.Default.isTouchable,e=Xu.getStyle("pointSize");return e[t?0:1]}(),isPointEditable:function(t){var e=this;if(Xu.inEdit(e))return!e._pointEditableFunc||e._pointEditableFunc(t);var i=Sd.getBackup("isPointEditable");i.call(e,t)},isEditable:function(t){var e,i=this,n=Sd.getBackup("isEditable");if(e=t instanceof Xu.Group||n.call(i,t),!Xu.inEdit(i))return e;if(!(t instanceof c.Edge))return e;if(!t.s("2d.editable"))return!1;var r=i.getEditableFunc();return!r||r(t)},_42:function(t,e){var i=this,n=Sd.getBackups()._42;if(n.call(i,t,e),Xu.inEdit(i)){var r=i.getEditInteractor();r.drawImpl()}}};Xu.Inject.registAsModule(Sd,Cd);Pu=c.Default.getInternal().ui().ShapeUI;var Id={_47O:function(t){var e=this,i=Id.getBackups()._47O;Xu.inEdit(e.gv)||i.call(e,t)}};Xu.Inject.registAsModule(Id,Pu);Hu=c.graph.DefaultInteractor;var Md={handle_mousewheel:function(t){var e=this,i=Md.getBackup("handle_mousewheel");Xu.inEdit(e.gv)||i.call(e,t)}};Xu.Inject.registAsModule(Md,Hu);Uu=c.graph.MoveInteractor;var Td={_calcShift:function(t,e){var i=this,n=Td.getBackup("_calcShift"),r=i.gv;if(!Xu.inEdit(r))return n.call(i,t,e);var o=r.getEditInteractor(),a=o.getSubModule("Move").calcShift(t,e,i);return a||n.call(i,t,e)},clear:function(t){var e=this,i=Td.getBackup("clear");i.call(e,t);var n=e.gv;if(Xu.inEdit(n)){var r=n.getEditInteractor();r.getSubModule("Move").clear(t)}}};Xu.Inject.registAsModule(Td,Uu);td=Xu.Rect=function(t){this.catalog="Rect",this._interactor=t};td.prototype={},td.prototype.constructor=td,td.prototype.gatherInfo=function(t,e){var i=this;if(1===e.length){var n=e[0];return n instanceof c.Shape&&n._70I()?i.gatherLine(t,n):!Gn(n,t)&&i.gatherSingleTarget(t,n)}return e.length>1&&i.gatherMultiTargets(t,e)},td.prototype.gatherSingleTarget=function(t,e){if(e.getCorners){var i,n=this,r=n.info;n.target=e,i=n.screenInfo={};var o=e.getCorners();for(var a in r.LT=new Xu.Math.Vector2(o[0]),r.LB=new Xu.Math.Vector2(o[1]),r.RB=new Xu.Math.Vector2(o[2]),r.RT=new Xu.Math.Vector2(o[3]),r.T=r.LT.clone().add(r.RT).divideScalar(2),r.B=r.LB.clone().add(r.RB).divideScalar(2),r.L=r.LT.clone().add(r.LB).divideScalar(2),r.R=r.RT.clone().add(r.RB).divideScalar(2),r)i[a]=Xu.toScreenPosition(t,r[a]);var s=n._interactor,l=s.getStyle("checkSize"),c=function(t,e,i){var n=e.clone().sub(t).setLength(-l),r=i.clone().sub(t).setLength(-l),o=n.add(r).add(t);return o};return i.rotLT=c(i.LT,i.RT,i.LB),i.rotLB=c(i.LB,i.LT,i.RB),i.rotRB=c(i.RB,i.LB,i.RT),i.rotRT=c(i.RT,i.LT,i.RB),i.rotT=i.rotLT.clone().add(i.rotRT).divideScalar(2),i.rotB=i.rotLB.clone().add(i.rotRB).divideScalar(2),i.rotL=i.rotLT.clone().add(i.rotLB).divideScalar(2),i.rotR=i.rotRT.clone().add(i.rotRB).divideScalar(2),i.rotation=e.getRotation(),n.gatherConnectInfo(),!0}},td.prototype.gatherConnectInfo=function(){var t=this,e=t.target,i=t._interactor,n=t.screenInfo,r=i.gv;if(r.isConnectActionVisible(e)&&i.getStyle("connectGuideVisible")){var o;e.s&&(o=e.s("connectGuideShift")),o||(o=i.getStyle("connectGuideShift"));var a=e.getAnchor(),s=e.getSize(),l=e.toGlobal({x:s.width*(o[0]-a.x),y:s.height*(o[1]-a.y)});l=Xu.toScreenPosition(r,l),n.P1?l.add(n.P2.clone().sub(n.P1).setLength(o[2])):(l.add(n.RT.clone().sub(n.LT).setLength(o[2])),l.add(n.LB.clone().sub(n.LT).setLength(o[3]))),n.connect=l}},td.prototype.gatherMultiTargets=function(t,e){var i=Xu.Group.findOrCreateGroup(e);if(!i)return!1;var n=this;return n.editing&&"rotate"!==n.editing.mode||i.calcInfo(),n.gatherSingleTarget(t,i)},td.prototype.gatherLine=function(t,e){this.target=e;var i=this.screenInfo={},n=e.getPoints(),r=Xu.getDataMatrix(e);return i.P1=Xu.toScreenPosition(t,r.apply(n.get(0))),i.P2=Xu.toScreenPosition(t,r.apply(n.get(1))),this.gatherConnectInfo(),!0},td.ResizeKeys=["LT","RB","LB","RT","L","R","B","T"],td.ResizeDirection=[{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}],td.RotateKeys=["rotLT","rotRB","rotLB","rotRT","rotL","rotR","rotB","rotT"],td.prototype.check=function(t,e,i){if(c.Default.isLeftButton(e)){var n=this;if(n.editing=null,n.tipInfo=null,n.screenInfo){var r=n.target,o=t.isEditable(r),a=n.screenInfo;if(o&&a.connect){var s=n._checkConnect(i);if(s)return s}if(a.P1)return n._checkLine(i);var l,h,u,d=null,f=n._interactor,g=f.getStyle("checkSize");if(o&&t.isRectEditable(r))for(h=0;h<Xu.Rect.ResizeKeys.length;h++)if(u=Xu.Rect.ResizeKeys[h],Xu.checkHit(i,a[u],g)){d=u,l="resize";break}if(!d&&o&&t.isRotationEditable(r)&&!f.getStyle("rotateAsClock")){var p=f.getStyle("rotateCheckSize");for(h=0;h<Xu.Rect.RotateKeys.length;h++)if(u=Xu.Rect.RotateKeys[h],Xu.checkHit(i,a[u],p)){d=u,l="rotate";break}}if(!d)return void f.setCursor("default");if("rotate"===l){var v,_=t.lp(e);if(r instanceof Xu.Group){var y=f.getStyle("groupRotateModeKey");"string"==typeof y&&(y=[y]);for(var m=!1,b=0,x=y.length;x>b;b++)if(e[y[b]]){m=!0;break}var w=f.getStyle("groupRotateModeDefault");v=m?"batch"===w?"block":"batch":w}var C="batch"===v?r.getAnchor2():r.getPosition(),S=Math.atan2(_.y-C.y,_.x-C.x);f._setRotateCursor(S),n.editing={mode:l,key:d,pos:C,flipY:r.getScale().y<0,rotation:r.getRotation(),hitRot:S},v&&(n.editing.groupRotateMode=v)}else{var I=Xu.Rect.ResizeKeys.indexOf(d),M=Xu.Rect.ResizeDirection[I],T=Math.cos(r.getRotation()),E=Math.sin(r.getRotation()),P=M.x*Math.sign(r.getScale().x),D=M.y*Math.sign(r.getScale().y),O=Math.atan2(-E*P-T*D,T*P-E*D),R=(Math.round(O/(Math.PI/4))+8)%8,z=["ew-resize","nesw-resize","ns-resize","nwse-resize","ew-resize","nesw-resize","ns-resize","nwse-resize"][R];this._interactor.setCursor(z);var k=r.getWidth(),A=r.getHeight(),V=r.getAnchor();n.editing={mode:l,key:d,rect:{x:-k*V.x,y:-A*V.y,width:k,height:A},anchor:V,matrix:r.getMatrix()}}return d}}},td.prototype._checkLine=function(t){var e=this;e.screenInfo;var i,n=e._interactor.getStyle("checkSize");if(Xu.checkHit(t,e.screenInfo.P1,n))i="P1";else{if(!Xu.checkHit(t,e.screenInfo.P2,n))return void this._interactor.setCursor("default");i="P2"}return e.editing={mode:"line",key:i},i},td.prototype._checkConnect=function(t){var e=this,i=e.screenInfo,n=e._interactor,r=n.getStyle("connectGuideIntersectSize"),o=i.connect,a=t.x,s=o.x;if(s>a&&r>s-a&&Math.abs(o.y-t.y)<r||a>=s&&Xu.checkHit(t,o,r)){var l="connect",c=u.getConnectAction(n.gv);if(e.editing={mode:l},c&&c.delete)if(e.target instanceof Xu.Group){var h=!0;n.gv.sm().getSelection().each((function(t){c.delete.visible.call(null,n.gv,t)||(h=!1)})),e.editing.hasDeleteAction=h}else c.delete.visible.call(null,n.gv,e.target)&&(e.editing.hasDeleteAction=!0);return n.setCursor("default"),l}},td.prototype._fireEditEvent=function(t,e){var i=this._interactor,n=this.editing;if(n){var r=n.mode;r="rotate"===r?"Rotation":"connect"===r?"Connection":"resize"===r?"Rect":r[0].toUpperCase()+r.slice(1),i.fi({kind:t+"Edit"+r,event:e})}},td.prototype.startEdit=function(t,e){t.startDragging(e);var i=this;i._interactor.fi({kind:"prepareEdit",event:e});var n=i.editing,r=i.target;if(n){if(i._fireEditEvent("begin",e),"rotate"===n.mode)return void(n.groupRotateMode&&r.beginRotate(n));if("connect"!==n.mode)("line"===n.mode||r&&0===r.getRotation())&&(i._inSmartGuide=!0,i._interactor.rectGuide.gatherRects());else if(n.hasDeleteAction){var o=t.gv,a=i._interactor.getStyle("connectGuideGarbageShift");n.garbageInfo={x:o.getWidth()*a[0]+a[2],y:o.getHeight()*a[1]+a[3],size:i._interactor.getStyle("connectGuideGarbageIntersectsize")},t._42()}}},td.prototype._46O=function(t){var e,n,r=this,o=r.editing,a=r.target;if(o){if("connect"===o.mode&&!o.canceled&&!o.deleted)try{o.garbageInfo&&o.garbageInfo.hover?u.doDeleteConnectionAction(r._interactor.gv,a):u.doConnectAction(r._interactor.gv,a,o.target)}catch(V){console.error(V)}n=o.freezeFlag,e=r.editing.groupRotateMode,r._fireEditEvent("end",t),r.editing=null}r.tipInfo=null,r._inSmartGuide&&(r._interactor.rectGuide.clear(),r._inSmartGuide=!1),e&&a&&a.endRotate(),a instanceof c.Block&&(n===i?delete a._freezeSyncFromChildren:a._freezeSyncFromChildren=n,a.updateFromChildren())},td.prototype.handleNormalStateDelete=function(){var t=this,e=t.editing;if(e&&"connect"===e.mode&&!e.canceled&&!e.deleted){if(e.garbageInfo){try{u.doDeleteConnectionAction(t._interactor.gv,t.target)}catch(k){console.error(k)}e.garbageInfo=null}return e.cursorPos=null,e.targetCorners=null,e.deleted=!0,t._interactor._42(),!0}},td.prototype.handleNormalStateKeyDown=function(t){var e=this,i=e.editing;return!i||"connect"!==i.mode||i.canceled||i.deleted?void 0:c.Default.isEsc(t)?(i.cursorPos=null,i.targetCorners=null,i.canceled=!0,e._interactor._42(),!0):void 0},td.prototype.handleEdit=function(t,e){var i=this,n=i.editing;if(n){var r,o,a,s,l,h=i.target,u=n.key,d=n.mode,f=t.lp(e),g=i._interactor;if("connect"===d){if(n.canceled)return;if(n.deleted)return;n.cursorPos=g._getLogicalPoint(e);var p=n.garbageInfo;return p&&Xu.checkHit(n.cursorPos,p,p.size)?(p.hover=!0,n.target=null,n.targetCorners=null):(p&&(p.hover=!1),n.target=t.getDataAt(f,(function(e){return!!t.isSelectable(e)&&!!Fn(e)}))||null,n.targetCorners=Xu.getTargetCornersOnScreen(t,n.target)),void g._42()}if("rotate"===d){var v,_,y,m,b=n.pos,x=Math.atan2(f.y-b.y,f.x-b.x);if(n.groupRotateMode?_=x-n.hitRot:(v=x-n.hitRot,_=n.rotation+v),_%=2*Math.PI,0>_&&(_+=2*Math.PI),!c.Default.isCtrlDown(e))$s(e)?(y=g.getStyle("shiftRotateRound"),m=y/2):(y=g.getStyle("rotateRound"),m=g.getStyle("rotateSensitivity")),_=Xu.roundTo(_,y,m);n.groupRotateMode?(v=_-(n.lastRotation||0),0!==v&&(h.addRotation(v,n.groupRotateMode,(function(e){return t.isRotationEditable(e)})),n.lastRotation=_)):h.setRotation(_),g._setRotateCursor(x),_>Math.PI&&(_-=2*Math.PI);var w=_/Math.PI*180;w=w.toFixed(2),r=w+"°"}else if("resize"===d){var C=n.rect;a=C.x,s=C.y;var S,I=C.width,M=C.height,T=n.anchor,E=n.matrix,P=h.s&&h.s("keepAspectRatio")||g.getStyle("keepAspectRatio");$s(e)&&(P=!P);var D,O,z=i._unionPointMode1,A=i._unionPointMode2;if(i._inSmartGuide&&!c.Default.isCtrlDown(e)&&!P)"L"===u||"R"===u?D="x":("T"===u||"B"===u)&&(D="y"),i._adsorbedToClosest(f,D),l=!0;S=E.tfi(f),"LT"===u?(C=z(S,{x:a+I,y:s+M},I,M,P),O=9):"T"===u?(C=A({x:a,y:S.y},{x:a+I,y:s+M},I,M,P,"v"),O=1):"RT"===u?(C=z(S,{x:a,y:s+M},I,M,P),O=33):"L"===u?(C=A({x:S.x,y:s},{x:a+I,y:s+M},I,M,P,"h"),O=8):"R"===u?(C=A({x:a,y:s},{x:S.x,y:s+M},I,M,P,"h"),O=32):"LB"===u?(C=z(S,{x:a+I,y:s},I,M,P),O=12):"B"===u?(C=A({x:a,y:s},{x:a+I,y:S.y},I,M,P,"v"),O=4):"RB"===u&&(C=z(S,{x:a,y:s},I,M,P),O=36);var V=E.tf(C.x+C.width*T.x,C.y+C.height*T.y);h instanceof c.Block&&(n.hasOwnProperty("freezeFlag")||(n.freezeFlag=h._freezeSyncFromChildren,h._freezeSyncFromChildren=!0)),h.setPosition(V),h.setSize(C.width,C.height),l&&(o=h.getRect(),g.rectGuide.gatherLines({node:h,x:o.x,y:o.y,w:o.width,h:o.height},D,O)),r=Math.round(C.width)+" * "+Math.round(C.height)}else if("line"===d){if($s(e)){var B=h.getPoints(),L="P1"===u?B.get(1):B.get(0),F={x:f.x-L.x,y:f.y-L.y},j=g.getStyle("shiftLineRotateRound"),H=i._shiftDirList;if(!H||i._shiftRotateRound!==j){i._shiftRotateRound=j,i._shiftDirList=H=[];for(var G=0;G<Math.PI;G+=j)H.push({x:k(G),y:R(G)})}for(var U,W=0,N=0,q=H.length;q>N;N++){var X=H[N],Q=X.x*F.x+X.y*F.y;Math.abs(Q)>Math.abs(W)&&(W=Q,U=X)}f={x:L.x+U.x*W,y:L.y+U.y*W},g.rectGuide.clear()}else i._inSmartGuide&&!c.Default.isCtrlDown(e)&&(i._adsorbedToClosest(f),l=!0);var Y=Xu.getDataMatrix(h).applyInverse(f);h.setPoint("P1"===u?0:1,Y,!0);var Z=h.getPoints(),J=Z.get(0),K=Z.get(1);a=J.x-K.x,s=J.y-K.y,r=" "+Math.round(Math.sqrt(a*a+s*s))+" ",l&&(o=h.getRect(),g.rectGuide.gatherLines({node:h,x:o.x,y:o.y,w:o.width,h:o.height}))}if(r){var $=c.Default.getLogicalPoint(e,g._canvas);$.x+=Xu.Icons.TipShiftX,$.y+=Xu.Icons.TipShiftY,i.tipInfo={helperPos:$,text:r,size:r.length}}i._fireEditEvent("between",e)}},td.prototype._unionPointMode1=function(t,e,i,n,r){if(r&&i&&n){var o=t.x-e.x,a=t.y-e.y;Math.abs(o*n)<Math.abs(a*i)?(a=Math.sign(a)*Math.abs(o*n/i),t.y=e.y+a):(o=Math.sign(o)*Math.abs(a*i/n),t.x=e.x+o)}return c.Default.unionPoint(t,e)},td.prototype._unionPointMode2=function(t,e,i,n,r,o){var a,s=c.Default.unionPoint(t,e);r&&i&&n&&("v"===o?(a=s.x+s.width/2,s.width=i*s.height/n,s.x=a-s.width/2):(a=s.y+s.height/2,s.height=n*s.width/i,s.y=a-s.height/2));return s},td.prototype._adsorbedToClosest=function(t,e){var i=this,n=i._interactor,r=n.rectGuide.findClosest(t,e),o=n.gridGuide.findClosest(t,e),a=1/0,s=1/0;r&&(isFinite(r.x)&&(a=r.x),isFinite(r.y)&&(s=r.y)),o&&(isFinite(o.x)&&Math.abs(o.x)<Math.abs(a)&&(a=o.x),isFinite(o.y)&&Math.abs(o.y)<Math.abs(s)&&(s=o.y)),isFinite(a)&&(t.x+=a),isFinite(s)&&(t.y+=s)},td.prototype._42=function(t,e,i){var n=this;n.info={},n.screenInfo=null;var r=n._interactor;if(!r.editDetail&&n.gatherInfo(e,i)){var o=n.editing,a=o?o.groupRotateMode:null,s=n.screenInfo;if("block"!==a){if(s.P1?Xu.Icons.DrawIcon(r,t,Xu.Icons.Line,s):Xu.Icons.DrawIcon(r,t,Xu.Icons.Rect,s),s.connect&&(Xu.Icons.DrawIcon(r,t,Xu.Icons.ConnectGuide,{rotation:s.rotation,connect:s.connect,cursorPos:o?o.cursorPos:null}),o)){if(o.targetCorners){for(var l={x:1/0,y:1/0},c={x:-1/0,y:-1/0},h=0,u=o.targetCorners.length;u>h;h+=2)l.x=Math.min(l.x,o.targetCorners[h]),c.x=Math.max(c.x,o.targetCorners[h]),l.y=Math.min(l.y,o.targetCorners[h+1]),c.y=Math.max(c.y,o.targetCorners[h+1]);Xu.Icons.DrawIcon(r,t,Xu.Icons.HoverDataRect,{min:l,max:c,color:r.getStyle("hoverGuideColor")||r.getStyle("baseColor")})}o.garbageInfo&&Xu.Icons.DrawIcon(r,t,Xu.Icons.ConnectGuideGarbage,o.garbageInfo)}n.tipInfo&&Xu.Icons.DrawIcon(r,t,Xu.Icons.TipHelper,n.tipInfo)}n.target instanceof Xu.Group&&n.target._42(r,t,e)}};var Ed=Xu.Anchor=function(t){this.catalog="Anchor",this._interactor=t};Ed.prototype={},Ed.prototype.constructor=Ed,Ed.prototype.gatherInfo=function(t,e){var i=this;if(1===e.length){var n=e[0];if(!n.getAnchor)return;if(n instanceof c.Shape&&n._70I())return;if(Gn(n,t))return;return i.gatherSingleTarget(t,e[0])}return e.length>1&&i.gatherMultiTargets(t,e)},Ed.prototype.gatherSingleTarget=function(t,e){var i=this;return i.info.POS=e.getPosition(),i.screenInfo.POS=Xu.toScreenPosition(t,i.info.POS),i.target=e,!0},Ed.prototype.gatherMultiTargets=function(t,e){var i=this,n=Xu.Group.findOrCreateGroup(e);return!!n&&(i.screenInfo.POS=Xu.toScreenPosition(t,n.getAnchor2()),i.target=n,!0)},Ed.prototype.isVisible=function(){var t=this,e=t._interactor;if(!1===e.getStyle("anchorVisible"))return!1;var i=t.target;if(i){if(this.editing)return!0;var n=i.getAnchor(),r=e.getStyle("anchorOutsideVisibleThreshold");if(n.x<-r||n.x>1+r||n.y<-r||n.y>1+r)return!0;var o=i.getSize(),a=i.getScale(),s=Math.min(Math.abs(o.width*a.x),Math.abs(o.height*a.y));if(s*e.gv._zoom<e.getStyle("anchorHideThreshold"))return!1}return!0},Ed.prototype.check=function(t,e,i){if(c.Default.isLeftButton(e)){var n=this,r=n._interactor;if(n.isVisible()&&!1!==r.getStyle("anchorMovable")){n.editing=null,n.tipInfo=null;var o,a=n.target;if(a&&t.isAnchorEditable(a)&&t.isEditable(a))if(n.screenInfo&&(o=n.screenInfo.POS)&&Xu.checkHit(i,new Xu.Math.Vector2(o),r.getStyle("checkSize"))){if(a instanceof Xu.Group)return n.editing={},!0;var s=a.getWidth(),l=a.getHeight(),h=a.getAnchor();return n.editing={rect:{x:-s*h.x,y:-l*h.y,width:s,height:l},anchor:h,matrix:a.getMatrix()},!0}}}},Ed.prototype.startEdit=function(t,e){t.startDragging(e),t.fi({kind:"beginEditAnchor",event:e})},Ed.prototype._46O=function(t){var e=this;e.editing&&(e.editing=null,e._interactor.fi({kind:"endEditAnchor",event:t})),e.tipInfo=null},Ed.prototype.handleEdit=function(t,e){var i=this,n=i.target;if(n){var r=i.editing;if(r){var o=t.lp(e),a=i._interactor;if(n instanceof Xu.Group)return n.setAnchor2(o),void a._42();var s=r.matrix,l=s.tfi(o),h=r.rect,u=(l.x-h.x)/h.width,d=(l.y-h.y)/h.height;if(!c.Default.isCtrlDown(e)){var f=a.getStyle("anchorRound"),g=a.getStyle("anchorSensitivity");u=Xu.roundTo(u,f,g),d=Xu.roundTo(d,f,g)}n.setAnchor(u,d,!0);var p=c.Default.getLogicalPoint(e,a._canvas);p.x+=Xu.Icons.TipShiftX,p.y+=Xu.Icons.TipShiftY;var v=u.toFixed(2)+", "+d.toFixed(2);i.tipInfo={helperPos:p,text:v,size:v.length},a.fi({kind:"betweenEditAnchor",event:e})}}},Ed.prototype._42=function(t,e,i){var n=this;n.info={},n.screenInfo={};var r=n._interactor;r.editDetail||n.gatherInfo(e,i)&&n.isVisible()&&(Xu.Icons.DrawIcon(r,t,Xu.Icons.Anchor,n.screenInfo),n.tipInfo&&Xu.Icons.DrawIcon(r,t,Xu.Icons.TipHelper,n.tipInfo))};var Pd=Xu.MoveDummy=function(t){this.catalog="MoveDummy",this._interactor=t};Pd.prototype={},Pd.prototype.constructor=Pd,Pd.prototype.gatherInfo=function(){var t=this,e=this._interactor.getSubModule("Rect");if(e){var i=e.screenInfo;if(i){var n=t._interactor,r=t.getMovableTarget(e.target);if(r){var o=n.getStyle("moveDummyThreshold");if(!1!==o){var a=i.LT||i.P1,s=i.RT||i.P2,l=i.LB||a;if(a){var c=i.P1,h=Math.min(a.distanceTo(l),a.distanceTo(s));if(!(!0!==o&&h>o)){var u=n.getStyle("moveDummyPosition"),d=s.clone().sub(a),f=l.clone().sub(a),g=u[2],p=u[3];if(c){var v=n.getStyle("moveDummyLineExtraShift");v&&(g+=v[0],p+=v[1])}var _=a.clone().add(d.clone().multiplyScalar(u[0])).add(d.setLength(g)).add(f.clone().multiplyScalar(u[1])).add(f.setLength(p));return t.screenInfo.pos=_,t.screenInfo.size=n.getStyle("moveDummySensitivity"),!0}}}}}}},Pd.prototype.getMovableTarget=function(t){var e=this._interactor.gv;if(Fn(t)){if(e.isMovable(t))return t}else if(t instanceof Xu.Group)for(var i=t._entities,n=i.length-1;n>=0;n--){var r=i[n];if(Fn(r)&&e.isMovable(r))return r}return null},Pd.prototype.getMoveInteractor=function(){for(var t,e=this._interactor.gv,i=e.getInteractors(),n=0,r=i.length;r>n;n++)if(t=i.get(n),t instanceof Uu)return t},Pd.prototype.startEdit=function(t,e){t.startDragging(e);var i=this.getMoveInteractor();if(i){var n=this.selectedTarget,r=t.gv;r._moving=1,i._data=n,r.handleMouseDown&&r.handleMouseDown(e,n)}},Pd.prototype._46O=function(t){var e=this,i=e.getMoveInteractor();i&&(i.handleWindowMouseUp(t),e.selectedTarget=null)},Pd.prototype.handleEdit=function(t,e){var i=this.getMoveInteractor();i&&i.handleWindowMouseMove(e)},Pd.prototype.check=function(t,e,i){if(this.selectedTarget=null,c.Default.isLeftButton(e)&&!t._scrolling&&!go()){var n=this;if(n.screenInfo){var r=n.screenInfo.pos;if(r&&!(i.distanceTo(r)>n.screenInfo.size)){var o=n._interactor;return n.selectedTarget=n.getMovableTarget(o.getSubModule("Rect").target),o.setCursor("default"),!0}}}},Pd.prototype._42=function(t,e,i){var n=this;n.screenInfo={};var r=n._interactor;r.editDetail||n.gatherInfo(e,i)&&(!r.editing||n.selectedTarget)&&Xu.Icons.DrawIcon(r,t,Xu.Icons.MoveDummy,n.screenInfo)};var Dd=Xu.RotateX=function(t){this.catalog="RotateX",this._interactor=t};Dd.prototype={},Dd.prototype.constructor=Dd,Dd.prototype.gatherInfo=function(t,e){var i=this;if(1===e.length){var n=e[0];return!(n instanceof c.Shape&&n._70I()||Gn(n,t))&&i.gatherSingleTarget(t,n)}return e.length>1&&i.gatherMultiTargets(t,e)},Dd.prototype.gatherSingleTarget=function(){var t=new c.Math.Vector2,e=new c.Math.Vector2,i=new c.Math.Vector2,n=new c.Math.Vector2,r=function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n};return function(o,a){if(a.getCorners){var s=this,l=a.getCorners(),c=15,h=a.getPosition();t.copy(l[0]),i.copy(l[1]),n.copy(l[3]),e.copy(t).add(n).divideScalar(2).add(t.sub(i).setLength(c/o.getZoom()));var u=Math.max(r(h,l[0]),r(h,l[1]),r(h,l[2]),r(h,l[3]));return s.info.POS=e.clone(),s.screenInfo.POS=Xu.toScreenPosition(o,s.info.POS),s.screenInfo.LEN=Math.sqrt(u)*o.getZoom()+c,s.screenInfo.CENTER=Xu.toScreenPosition(o,h),s.target=a,!0}}}(),Dd.prototype.gatherMultiTargets=function(t,e){var i=this,n=Xu.Group.findOrCreateGroup(e);if(!n)return!1;i=this;return i.gatherSingleTarget(t,n)},Dd.prototype.isVisible=function(){var t=this._interactor;if(!t.getStyle("rotateAsClock"))return!1;var e=this.target;if(!e)return!0;var i=t.gv;return!(!i.isEditable(e)||!i.isRotationEditable(e))},Dd.prototype.check=function(t,e,i){var n=this,r=n._checkImpl(t,e,i);return(r||n._clockPainted)&&n._interactor._42(),r},Dd.prototype._checkImpl=function(t,e,i){if(c.Default.isLeftButton(e)){var n,r=this;if(r.editing=null,r.tipInfo=null,r.screenInfo&&(n=r.screenInfo.POS)&&r.isVisible()){var o=r._interactor;if(Xu.checkHit(i,n,o.getStyle("checkSize"))){var a=r.target,s=t.lp(e),l=a.getPosition(),h=Math.atan2(s.y-l.y,s.x-l.x);return o._setRotateCursor(h),r.editing={pos:l,rotation:a.getRotation(),hitRot:h,groupRotateMode:"block",screenInfo:{CENTER:r.screenInfo.CENTER,LEN:r.screenInfo.LEN}},!0}}}},Dd.prototype.startEdit=function(t,e){t.startDragging(e),t.fi({kind:"beginEditRotation",event:e}),this.target instanceof Xu.Group&&this.target.beginRotate(this.editing)},Dd.prototype._46O=function(t){var e=this;e.editing&&(e.editing=null,e._interactor.fi({kind:"endEditRotation",event:t})),e.target instanceof Xu.Group&&e.target.endRotate(),e.tipInfo=null},Dd.prototype.handleEdit=function(t,e){var i=this,n=i.editing;if(n){var r,o,a,s,l=i.target,h=t.lp(e),u=i._interactor,d=n.pos,f=Math.atan2(h.y-d.y,h.x-d.x),g=l instanceof Xu.Group;if(g?o=f-n.hitRot:(r=f-n.hitRot,o=n.rotation+r),o%=2*Math.PI,0>o&&(o+=2*Math.PI),!c.Default.isCtrlDown(e))$s(e)?(a=u.getStyle("shiftRotateRound"),s=a/2):(a=u.getStyle("rotateRound"),s=u.getStyle("rotateSensitivity")),o=Xu.roundTo(o,a,s);g?(r=o-(n.lastRotation||0),0!==r&&(l.addRotation(r,n.groupRotateMode,(function(e){return t.isRotationEditable(e)})),n.lastRotation=o)):l.setRotation(o),u._setRotateCursor(f),o>Math.PI&&(o-=2*Math.PI);var p=o/Math.PI*180,v=p.toFixed(2)+"°",_=c.Default.getLogicalPoint(e,u._canvas);_.x+=Xu.Icons.TipShiftX,_.y+=Xu.Icons.TipShiftY,i.tipInfo={helperPos:_,text:v,size:v.length},u.fi({kind:"betweenEditRotation",event:e})}},Dd.prototype._42=function(t,e,i){var n=this;n._clockPainted=!1,n.info={},n.screenInfo={};var r=n._interactor;r.editDetail||n.gatherInfo(e,i)&&n.isVisible()&&(Xu.Icons.DrawIcon(r,t,Xu.Icons.RoundPoint,n.screenInfo.POS),n.tipInfo&&Xu.Icons.DrawIcon(r,t,Xu.Icons.TipHelper,n.tipInfo),n.editing&&n.drawClock(t))},Dd.prototype.drawClock=function(t){t.save();var e=this;e._clockPainted=!0;var i=e.editing||{},n=i.screenInfo||e.screenInfo,r=n.LEN,o=r+8,a=r+18;t.save(),t.translate(n.CENTER.x,n.CENTER.y),t.beginPath(),t.strokeStyle="rgb(150, 150, 150)";for(var s,l,c,h,u,d=0;360>d;d++)s=d*Math.PI/180,0===d%5&&(l=R(s)*r,c=k(s)*r,h=R(s)*o,u=k(s)*o,t.moveTo(l,c),t.lineTo(h,u)),0===d%45&&(l=R(s)*r,c=k(s)*r,h=R(s)*a,u=k(s)*a,t.moveTo(l,c),t.lineTo(h,u));t.stroke(),t.rotate(-j);var f=i.lastRotation||e.target.getRotation();t.beginPath(),t.fillStyle="rgba(255, 0, 0, 0.1)",t.strokeStyle="rgb(157, 157, 157)",t.moveTo(0,0),t.arc(0,0,a,0,f,!1),t.fill(),t.beginPath(),t.moveTo(0+a,0),t.arc(0,0,a,0,f,!1),t.stroke(),t.restore()};md=Xu.Curve=function(t){this.catalog="Curve",this._interactor=t};md.prototype={},md.prototype.constructor=md,e.defineProperties(md.prototype,{activing:{get:function(){return this._activing},set:function(t){var e=this;if(t)e._activing=new Xu.CurveActiving(this,t),e._activing._firePointChange();else{var i=e._activing;i&&i.dispose(),e._activing=null}}}}),md.PointType={Mirrored:0,Straight:1,Disconnected:2,Asymmetric:3},md.prototype.setUp=function(){var t=this,e=t._interactor;e&&e.gv.mp(t._onGraphviewPropertyChanged,t)},md.prototype._onGraphviewPropertyChanged=function(t){("zoom"===t.property||"translateX"===t.property||"translateY"===t.property)&&this._handleDataChanged()},md.prototype.tearDown=function(){var t=this,e=t._interactor;e&&e.gv.ump(t._onGraphviewPropertyChanged,t)},md.prototype.canEnterEditDetailMode=function(){var t=this,e=t._interactor,i=e._getValidSelection();if(1===i.length){var n=i[0],r=n instanceof c.Edge;if(n instanceof c.Shape||r){if(r){var o=n.s("edge.type");if(o&&"points"!==o)return}var a=e.gv;if(a.isPointEditable(n)&&a.isEditable(n))return t.target=n,!0}}},md.prototype.canQuitEditDetailMode=function(t){var e=this,i=e._interactor._getLogicalPoint(t);return e._checkEditRealPoint(i)?void 0:e._interactor.gv.getDataAt(t)!==e.target||void 0},md.prototype.preHandleScroll=function(){var t=this.editing;return!(!t||!t.inEdit)||void 0},md.prototype.getCurrentSelectintStatus=function(){var t=this;if(t.activing&&!t.activing.selections){if(t.activing.status!=i)return t.activing.status;var e=function(e){var i=t.activing.status;t.activing.status=e,t._interactor.fp("shapePointStatus",i,e)},n=Xu.Curve.PointType,r=t.activing.point,o=t.activing.pairs;if(!o||1!==o.length)return e(n.Mirrored);var a=o[0],s=a.c1&&a.c1.isNearEnough(r),l=a.c2&&a.c2.isNearEnough(r);if(!a.c1||!a.c2)return e(s||l?n.Straight:n.Disconnected);if(s&&l)return e(n.Straight);if(s||l)return e(n.Asymmetric);var c=a.c1.clone().sub(r),h=a.c2.clone().sub(r);return Math.abs(c.x*h.y-c.y*h.x)>1e-5||c.x*h.x>0?e(n.Disconnected):Math.abs(c.length()-h.length())>1e-5?e(n.Asymmetric):e(n.Mirrored)}},md.prototype.handle_keydown=function(t){var e=this;if(e._interactor.editDetail){var i=Xu.Curve.PointType;"1"===t.key?e._setCurrentSelectionStatus(i.Straight):"2"===t.key?e._setCurrentSelectionStatus(i.Mirrored):"3"===t.key?e._setCurrentSelectionStatus(i.Disconnected):"4"===t.key&&e._setCurrentSelectionStatus(i.Asymmetric)}},md.prototype.setCurrentSelectionStatus=function(t){var e=this,i=e._interactor;if(i){var n=i.gv;n.dm().beginTransaction(),this._setCurrentSelectionStatus(t),n.dm().endTransaction()}},md.prototype._setCurrentSelectionStatus=function(t){var e=this,i=e.activing;if(i){var n=e.getCurrentSelectintStatus();if(null!==n&&n!==t){i.status=t;var r=e.activing.point,o=e.activing.pairs;if(o&&1===o.length){var a=o[0],s=e.screenInfo.curve,l=Xu.Curve.PointType,c=e._interactor,h=function(){e._writeToHt(),c.fp("shapePointStatus",n,t),e.check(c.gv,null,new Xu.Math.Vector2(c._lastLogicalPoint))};if(t===l.Straight)return s.moveCtrlPoint(a,r,"c1"),s.moveCtrlPoint(a,r,"c2"),void h();if(n===l.Straight){var u=s.findPairs(r,!0),d=u[0],f=d.r1||r,g=d.r2||r,p=g.clone().sub(f).multiplyScalar(.25);return s.moveCtrlPoint(a,r.clone().sub(p),"c1"),s.moveCtrlPoint(a,r.clone().add(p),"c2"),void h()}var v=a.c1,_=a.c2;if(v&&_){if(t===l.Mirrored)return s.moveCtrlPoint(a,r.clone().multiplyScalar(2).sub(_),"c1"),void h();if(t===l.Asymmetric&&n===l.Disconnected){var y=v.clone().sub(r).length();p=r.clone().sub(_).setLength(y).add(r);return s.moveCtrlPoint(a,p,"c1"),void h()}}i._firePointChange(),c.fp("shapePointStatus",n,t),e.check(c.gv,null,new Xu.Math.Vector2(c._lastLogicalPoint))}}}},md.prototype._handleDataChanged=function(){var t="s:edge.points,s:edge.segments,points,segments,shape,position,rotation,scale".split(",");return function(e){var i=this;if(i.screenInfo&&i.target){if(e&&t.indexOf(e.property)<0)return;var n=i._interactor;i.gatherSingleTarget(n.gv,i.target,!0),i.check(n.gv,null,new Xu.Math.Vector2(n._lastLogicalPoint)),n._42()}}}(),md.prototype.gatherSingleTarget=function(t,e,n){var r,o,a=this;a.screenInfo&&a.screenInfo.curve&&(o=a.screenInfo.curve._curves);var s=a.editing;r=s?a.screenInfo:a.screenInfo={};var l,h,u=e instanceof c.Edge;u?(l=e.s("edge.segments"),h=e.s("edge.points")||new c.List):(l=e._58O,h=e._59O),r.S=l;var d,f=r.P=[],g=Xu.getDataMatrix(e);if(e instanceof c.Polyline||e instanceof c.Edge&&a._interactor.getStyle("edgeElevationEditable"))d=e.getElevation&&e.getElevation()||0,r.E=[];else{var p=!1;h.each((function(t){t.e!==i&&(p=!0)})),p&&(r.E=[])}if(h.each((function(e){r.E&&r.E.push(e.e!=i?e.e:d),e=g.apply(e);var n=Xu.toScreenPosition(t,e);f.push(n.x,n.y)})),u){var v=f.length,_=Xu.toScreenPosition(t,e._lastSourcePoint||(v?{x:f[0],y:f[1]}:{x:0,y:0})),y=Xu.toScreenPosition(t,e._lastTargetPoint||(v?{x:f[v-2],y:f[v-1]}:{x:0,y:0}));f.splice(0,0,_.x,_.y),f.push(y.x,y.y),r.E&&(r.E.splice(0,0,"head"),r.E.push("tail"))}if(!r.S||!r.S.size()){r.S=new c.List,r.S.add(1);for(var m=0;m<f.length/2-1;m++)r.S.add(2)}if((!s||n)&&a.convertToCubicBezier(o),a.activing&&(n||!a.editing||"realPoint"===a.editing.type)){var b=r.curve.findPairs(a.activing.point);a.activing.pairs=b}},md.prototype._convertToNewPoint=function(t,e,i,n){var r,o,a;for(r=0,o=e.length;o>r;r++){if(a=e[r],a._p1.isNearEnough(t)&&(!n||n.indexOf(a._p1)<0))return a._p1;if(a._p4.isNearEnough(t)&&(!n||n.indexOf(a._p4)<0))return a._p4}if(i)for(r=0,o=Math.min(i.length,o);o>r;r++){if(a=i[r],a._p1===t&&(!n||n.indexOf(e[r]._p1)<0))return e[r]._p1;if(a._p4===t&&(!n||n.indexOf(e[r]._p4)<0))return e[r]._p4}},md.prototype.convertToCubicBezier=function(t){var e,i,n=this,r=new Xu.Math.Curve,o=n.screenInfo;if(r.createFromHtShape(o.P,o.S,o.E),o.curve=r,n.activing){var a=r._curves;e=n.activing.point,i=n._convertToNewPoint(e,a,t);var s=[];if(i&&(n.activing.point=i,s.push(i)),n.activing.selections){var l=-1,c=n.activing.selections;c.forEach((function(e){l++,i=n._convertToNewPoint(e,a,t,s),i&&(c[l]=i,s.push(i))}))}}},md.prototype.check=function(t,e,i){if(!e||Qs(e)||Ys(e)){var n=this;if(n._interactor.setCursor("default"),n.editing=null,n.highlight=null,n.tipInfo=null,n.edgeEditResult=null,n.screenInfo){if(go()||e&&Ys(e))return n._interactor._42(),!0;if(n._checkEditCtrlPoint(i))return n._interactor._42(),!0;if(n._checkEditRealPoint(i))return n._interactor._42(),!0;if(n._checkEditElevation(i))return n._interactor._42(),!0;var r=n.screenInfo.curve,o=r.checkPoint(i,n._interactor.getStyle("curveIntersectSize"));if(o){var a=n.highlight={};a.type="insertKnot",a.bezier=o.bezier,a.point=o.intersection}return n._interactor._42(),!0}}},md.prototype._checkEditRealPoint=function(t){var e,i,n,r,o,a,s=this,l=s.screenInfo.curve._curves,c=s._interactor.getStyle("curvePointIntersectSize"),h=1/0;for(c*=c,n=0,r=l.length;r>n;n++)e=l[n],o=e._p1,a=t.distanceToSquared(o),h>a&&(h=a,i=o),o=e._p4,a=t.distanceToSquared(o),h>a&&(h=a,i=o);if(h>c)return!1;var u=s.highlight={};return u.type="changeRealPoint",u.point=i,s.editing={type:"realPoint",point:i,shiftGuide:{point:i.clone(),dir:"x",limit:0}},s._interactor.setCursor("crosshair"),!0},md.prototype._checkEditElevation=function(t){var e=this;if(!e._interactor.getStyle("curveElevationVisible"))return!1;var i=e.target;if(i instanceof c.Edge&&!e._interactor.getStyle("edgeElevationEditable"))return!1;var n=e.activing;if(!n)return!1;var r=n.getCurrentEditingPoint();if(!r)return!1;var o=e._interactor,a=o.getStyle("curveElevationGuideShift"),s=o.getStyle("curveElevationIntersectSize"),l=t.distanceToSquared({x:r.x+a[0],y:r.y+a[1]});if(!(l>s*s)){var h=e.highlight={};h.type="elevation";var u=new Xu.Math.Vector2(t.x,t.y,r.e);return e.editing={type:"elevation",startPoint:u},e._interactor.setCursor("crosshair"),!0}},md.prototype._checkEditCtrlPoint=function(t){var e=this;if(e.activing&&!e.activing.selections){var i=e.getCurrentSelectintStatus();if(i!==Xu.Curve.PointType.Straight){var n=e.activing.pairs;if(n){var r=e._interactor.getStyle("curvePointIntersectSize");r*=r;var o,a,s,l,c,h,u,d,f,g=1/0;for(u=0,f=n.length;f>u;u++)for(l=n[u],d=0;2>d;d++)c=0===d?"c1":"c2",l[c]&&(h=t.distanceToSquared(l[c]),g>h&&(g=h,o=l,a=u,s=c));if(g>r)return!1;e.activing.hlpair=o,e.activing.hltype=s;var p=e.highlight={};return p.type="changeCtrlPoint",p.point=o[s],e.editing={type:"ctrlPoint",pair:o,pairId:a,ctrlType:s,direction:o[s].clone().sub(e.activing.point).normalize()},e._interactor.setCursor("crosshair"),!0}}}},md.prototype.startEdit=function(t,e){t.startDragging(e);var i=this;i.highlight&&"insertKnot"===i.highlight.type&&(i.insertKnot(),i.gatherSingleTarget(i._interactor.gv,i.target),i.activing=null,i._checkEditRealPoint(i._interactor._getLogicalPoint(e)));var n=i._activing;if(n){var r=i.editing?i.editing.type:null;"ctrlPoint"===r?n.editingCtrl={pairId:i.editing.pairId,type:n.hltype}:"realPoint"===r&&(n.editingCtrl=!1)}var o=i.highlight,a=c.Default.isCtrlDown(e);if(!o||go()||Ys(e)){var s=i._interactor.gv;if(!s.setFocus(e)||s._scrolling)return;a?i._multiSelect={startPoint:s.lp(e)}:s.isPannable()&&(Qs(e)||Ys(e))&&(i._pan={tx:s.tx(),ty:s.ty()},t.fi({kind:"beginPan",event:e}))}else if("changeRealPoint"===o.type){var l,h=i.activing?i.activing.point:null,u=i.activing?i.activing.selections:null;if(a&&i.activing)h===o.point?(u?(i.activing={point:u[0]},u.length>1&&(u.splice(0,1),i.activing.selections=u)):i.activing=null,i.editing=null):u&&(l=u.indexOf(o.point))>=0?(u.length>1?u.splice(l,1):delete i.activing.selections,i.editing=null):u?(u.push(h),i.activing={point:o.point,selections:u}):i.activing={point:o.point,selections:[h]};else if(u)h===o.point||((l=u.indexOf(o.point))>=0?(u.splice(l,1,h),i.activing={point:o.point,selections:u}):i.activing={point:o.point});else{var d;h===o.point&&(d=i.activing.status),i.activing={point:o.point},d&&(i.activing.status=d)}t.fi({kind:"beginEditPoint",event:e})}},md.prototype.insertKnot=function(){var t=this,e=t.highlight,i=t.screenInfo.curve;i.insertKnot(e.bezier,e.point.t),t._writeToHt()},md.prototype._writeToHt=function(){var t,e,i=this,n=i.screenInfo.curve,r=n.toHtShape(),o=r.points,a=[],s=r.segments,l=i._interactor.gv;l.dm().beginTransaction();var h,u,d=i.target,f=d instanceof c.Edge,g=Xu.getDataMatrix(d).invert();u=d instanceof c.Polyline||d instanceof c.Edge&&i._interactor.getStyle("edgeElevationEditable"),u&&(h=d.getElevation&&d.getElevation()||0);for(var p=0,v=o.length;v>p;p++)t=o[p],e=Xu.toWorldPosition(l,t),e=g.apply(e),isFinite(t.e)&&t.e!==h&&(e.e=t.e),a.push(e);if(d._writing=!0,f){d.s("edge.type","points"),d.setStyle("edge.segments",s),d.setStyle("edge.points",a.slice(1,a.length-1)),d.setStyle("edge.source.offset.x",0),d.setStyle("edge.source.offset.y",0),d.setStyle("edge.target.offset.x",0),d.setStyle("edge.target.offset.y",0);var _=i._nextChangeEdgeHost;delete i._nextChangeEdgeHost,_&&("source"===_.type?d.setSource(_.host):d.setTarget(_.host)),i._writeEdgeHostAnchor("source",a[0]),i._writeEdgeHostAnchor("target",a[a.length-1])}else a.length?(d.setSegments(s),d.setPoints(a,!0)):d.removeFromDataModel();l.dm().endTransaction(),delete d._writing},md.prototype._writeEdgeHostAnchor=function(t,e){var n=this,r=n.target,o=n._calcHostAnchor(r,t,e);o.index!==i?(r.setStyle("edge."+t+".index",o.index),r.setStyle("edge."+t+".percent",i),r.setStyle("edge."+t+".anchor.x",i),r.setStyle("edge."+t+".anchor.y",i)):o.percent!==i?(r.setStyle("edge."+t+".percent",o.percent),r.setStyle("edge."+t+".index",i),r.setStyle("edge."+t+".anchor.x",i),r.setStyle("edge."+t+".anchor.y",i)):(r.s("edge."+t+".anchor.x",o.x),r.s("edge."+t+".anchor.y",o.y),o.offsetX||o.offsetY?(r.s("edge."+t+".offset.x",o.offsetX),r.s("edge."+t+".offset.y",o.offsetY)):(r.s("edge."+t+".offset.x",0),r.s("edge."+t+".offset.y",0)))},md.prototype._calcHostAnchor=function(t,e,i,n){n||(n="source"===e?t.getSource():t.getTarget());var r=this._interactor.gv,o=r.calculateAttachPoint(n,i);if(o)return o.info;if(jn(n)){var a=r.calculateEdgePosition(n,i);return a}var s=n.getRotation(),l=n.getAnchor();Gn(n,r)&&(s=0);var c=n.getScale();if(s||c.x<0||c.y<0){var h=n.getMatrix(),u=h.tfi(i),d=n.getSize();return{x:u.x/d.width+l.x,y:u.y/d.height+l.y}}var f=bc(r,n),g={x:(i.x-f.x)/f.width,y:(i.y-f.y)/f.height};return g},md.prototype._handlePanning=function(t){var e=this,i=e._pan;if(i){i.started=!0;var n=e._interactor,r=n.gv,o=n._lastClientPoint,a=el(t),s=Uc(r,a,o);r.setTranslate(i.tx+s.x,i.ty+s.y),e.gatherSingleTarget(n.gv,e.target),n._42(),n.fi({kind:"betweenPan",event:t})}},md.prototype.handleEdit=function(t,e){var n=this,r=n.editing;if(n._pan)n._handlePanning(e);else{if(n._multiSelect)return n._multiSelect.endPoint=t.lp(e),void n._interactor.redraw();if(r){r.inEdit=!0;var o,a,s=n._interactor._getLogicalPoint(e),l=c.Default.isCtrlDown(e),h=c.Default.isShiftDown(e),u=r.type,d=n.activing;if(n._guideInfo=null,"ctrlPoint"===u&&h){var f=n.editing.direction.clone();k=d.point;var g=f.dot(s.clone().sub(k));s=f.setLength(g).add(k)}else if("ctrlPoint"===u||"realPoint"===u){if("realPoint"===u&&h){var p=n.editing.shiftGuide;o=p.point;var v=Math.abs(s.x-o.x),_=Math.abs(s.y-o.y);v>_&&v>p.limit&&"y"===p.dir&&(p.dir="x"),_>v&&_>p.limit&&"x"===p.dir&&(p.dir="y"),f=p.dir,"x"===f?(s.y=o.y,p.limit=Math.max(p.limit,v)):"y"===f&&(s.x=o.x,p.limit=Math.max(p.limit,_))}var y=n._isEditEdgeSourceTarget();if(y){var m=n._editEdgeSourceTarget(y,s,l);m&&(n.edgeEditResult=m,a=m.tipText)}else if(!l){var b=n._guidingToEdit(s,f),x="realPoint"===u?n._interactor.gridGuide.findClosest(s,f,!0):null,w=1/0,C=1/0;x&&(x.x&&(w=x.x),x.y&&(C=x.y));var S=!1;b&&(b.xList&&(Math.abs(b.x)<=Math.abs(w)?(S=!0,w=b.x):delete b.xList),b.yList&&(Math.abs(b.y)<=Math.abs(C)?(S=!0,C=b.y):delete b.yList),S&&(n._guideInfo=b)),isFinite(w)&&(s.x+=w),isFinite(C)&&(s.y+=C),S&&(b.v=s)}}var I=n.screenInfo.curve;if("realPoint"===r.type){k=r.point,k.e!==i&&(s.e=k.e),I.moveRealPoint(k,s),r.point=s,n.highlight.point=s;var M=d.status,T=d.selections;if(n.activing={point:s,status:M},T){var E=s.clone().sub(k),P=0;T.forEach((function(t){var e=t.clone().add(E);I.moveRealPoint(t,e),T[P++]=e})),n.activing.selections=T}}else if("ctrlPoint"===r.type){var D=d.pairs,O=D[r.pairId];I.moveCtrlPoint(O,s,r.ctrlType);var R=d.status,z=Xu.Curve.PointType;if((R===z.Mirrored||R===z.Asymmetric)&&O.c1&&O.c2){var k=new Xu.Math.Vector2(d.point),A="c1"===r.ctrlType?"c2":"c1";if(R===Xu.Curve.PointType.Mirrored)I.moveCtrlPoint(O,k.clone().multiplyScalar(2).sub(s),A);else if(R===z.Asymmetric){g=O[A].clone().sub(k).length();var V=k.clone().sub(O[r.ctrlType]).setLength(g).add(k);isNaN(V.x)||I.moveCtrlPoint(O,V,A)}}d._firePointChange()}else if("elevation"===r.type){o=r.startPoint;var B=o.e+(o.y-s.y)/t._zoom;n._setCurrentPointImpl("e",B),d._firePointChange(),a="E: "+Xu.toFixed(B)}var L=c.Default.getLogicalPoint(e,n._interactor._canvas);if(L.x+=Xu.Icons.TipShiftX,L.y+=Xu.Icons.TipShiftY,!a){var F=Xu.toWorldPosition(t,s);a=Xu.toFixed(F.x)+", "+Xu.toFixed(F.y)}n.tipInfo={helperPos:L,text:a,size:a.length},n._writeToHt(),n._interactor.fi({kind:"betweenEditPoint",event:e})}}},md.prototype._setCurrentPointImpl=function(t,e){var n=this,r=n._activing;if(!r)return!1;var o=n.target;if(!o)return!1;var a=r.getCurrentEditingPoint();if(!a)return!1;var s=r.editingCtrl;if(!s)var l=a.clone();if("e"===t)a.e=e;else{var c;if("x"===t||"y"===t){var h=r._lastFirePoint;c="x"===t?{x:e,y:h?h.y:0}:{x:h?h.x:0,y:e}}else"object"==typeof t?(c=t,t.e!==i&&(a.e=t.e)):(c={x:arguments[0],y:arguments[1]},arguments[2]!==i&&(a.e=arguments[2]));var u=Xu.getDataMatrix(o);c=Xu.toScreenPosition(n._interactor.gv,u.apply(c)),a.x=c.x,a.y=c.y}if(!s){var d=l.multiplyScalar(-1).add(a);a.e&&l.e&&(d.e=a.e-l.e);var f=n.screenInfo.curve;f.moveCtrlDueToRealPointMovement(a,d);var g=r.selections;if(g){var p=0;g.forEach((function(t){var e=t.clone().add(d);isFinite(d.e)&&(e.e=(isFinite(t.e)?t.e:o.getElevation()||0)+d.e),f.moveRealPoint(t,e),g[p++]=e})),r.selections=g}}return!0},md.prototype.setCurrentPoint=function(t,e){return!!this._setCurrentPointImpl(t,e)&&(this._writeToHt(),!0)},md.prototype._isEditEdgeSourceTarget=function(){var t=this,e=t.target;if(!(e instanceof c.Edge))return!1;var i=t.editing.point,n=t.screenInfo.curve._curves;return i===n[0]._p1?"source":i===n[n.length-1]._p4&&"target"},md.prototype._editEdgeSourceTarget=function(t,e,n){var r,o=this,a=o.target;if(r="source"===t?a.getSource():a.getTarget()){var s,l,c,h,u=o._interactor.gv,d=Xu.toWorldPosition(u,e),f=o._calcHostAnchor(a,t,d,r);if(f.index!==i||f.percent!==i?f.distance*u.getZoom()>o._interactor.getStyle("edgeHostEdgeMaxDistance"):!!o._interactor.getStyle("edgeHostDetectPerFrame")||(f.x<0||f.x>1||f.y<0||f.y>1)){var g=u.getDataAt(d,(function(e){return!!u.isSelectable(e)&&(!!u.isSourceTargetEditable(a,e,t)&&!!a.canSetSourceTarget(e,t))}));if(g){var p=o._calcHostAnchor(a,t,d,g);r=g,o._nextChangeEdgeHost={type:t,host:g},f=p}}if(n||f.x===i)(f.percent!==i||f.index!==i)&&(l=f.point);else{var v=o._interactor.getStyle("anchorRound"),_=o._interactor.getStyle("anchorSensitivity");s=u.calculateAttachPoint(r,d),s?f=s.info:(f.x=Xu.roundTo(f.x,v,_),f.y=Xu.roundTo(f.y,v,_)),l=jc(u,r,0,f.offsetX||0,f.offsetY||0,f.x,f.y)}return l&&(c=Xu.toScreenPosition(u,l),e.x=c.x,e.y=c.y),o._edgeHostGuideInfo={corners:Xu.getTargetCornersOnScreen(u,r),attach:s?s.index:-1,host:r},f.percent!==i?h="percent: "+f.percent.toFixed(2):f.index!==i?h="index: "+f.index:(h=f.x.toFixed(2)+", "+f.y.toFixed(2),(f.offsetX||f.offsetY)&&(h+=" offset: "+f.offsetX.toFixed(2)+", "+f.offsetY.toFixed(2))),{host:r,anchor:f,tipText:h}}},md.prototype._guidingToEdit=function(t,e){var i,n,r=this;if(i=r.screenInfo.curve){n=i._curves;var o,a,s,l,c,h,u,d,f=1/0,g=1/0,p=[];for(r.editing&&"realPoint"===r.editing.type&&(d=r.editing.point),c=0,h=2*n.length;h>c;c++)u=n[Math.floor(c/2)][c%2?"_p4":"_p1"],p.indexOf(u)>=0||(p.push(u),d&&d===u||(s=u.x-t.x,l=u.y-t.y,Math.abs(s)<Math.abs(f)?(f=s,o=[u]):s===f&&o.push(u),Math.abs(l)<Math.abs(g)?(g=l,a=[u]):l===g&&a.push(u)));var v=r._interactor.getStyle("smartGuideThreshold");if((Math.abs(f)>v||"y"===e)&&(o=null),(Math.abs(g)>v||"x"===e)&&(a=null),o||a){var _=!1,y={};if(o&&(_=!0,y.xList=o,y.x=f),a&&(_=!0,y.yList=a,y.y=g),_)return y}}},md.prototype._46O=function(t){var e=this;e.editing&&(e.editing=null,e._interactor.fi({kind:"endEditPoint",event:t})),e._guideInfo=null,e._edgeHostGuideInfo=null,e._pan&&(e._pan=null,e._interactor.fi({kind:"endPan",event:t})),e._multiSelect&&(e._handleMultiSelect(e._multiSelect),e._multiSelect=null),e.tipInfo=null,e.edgeEditResult=null},md.prototype._handleMultiSelect=function(t){if(t.startPoint&&t.endPoint){var e,n,r,o,a,s=this,l=s._interactor,h=l.gv,u=Xu.toScreenPosition(h,t.startPoint),d=Xu.toScreenPosition(h,t.endPoint),f=c.Default.unionPoint(u,d),g=s.screenInfo.curve._curves,p=[],v=function(t){t.x>=f.x&&t.y>=f.y&&t.x<=f.x+f.width&&t.y<=f.y+f.height&&p.indexOf(t)<0&&p.push(t)};for(e=0,n=g.length;n>e;e++)a=g[e],v(a._p1),v(a._p4);if(p.length){var _=s.activing||{},y=_.selections||[];for(_.point&&y.push(_.point),e=0,n=y.length;n>e;e++)r=y[e],o=p.indexOf(r),o>=0?p[o]=i:p.push(r);var m=p;for(p=[],e=0,n=m.length;n>e;e++)m[e]&&p.push(m[e]);n=p.length,0===n?s.activing=null:1===n?s.activing={point:p[0]}:(r=p[n-1],s.activing={point:r,selections:p.splice(0,n-1)}),l.redraw()}}},md.prototype._canDeletePoint=function(t,e){var i=this.target;if(!(i instanceof c.Edge))return!0;var n=t._curves[0],r=t._curves[t._curves.length-1];return n._p1!==e&&r._p4!==e},md.prototype.handleDelete=function(){var t=this;if(t.activing&&t.screenInfo){var e=c.Default.isShiftDown(),i=t.screenInfo.curve;t._canDeletePoint(i,t.activing.point)&&i.deleteRealPoint(t.activing.point,e),t.activing.selections&&t.activing.selections.forEach((function(n){t._canDeletePoint(i,n)&&i.deleteRealPoint(n,e)})),t.activing=null,delete t.editing,delete t.tipInfo,delete t.edgeEditResult,delete t._pan,delete t._multiSelect,t._writeToHt(),t._interactor.fp("deleteShapePoint",!1,!0)}},md.prototype.handleDoubleClick=function(t){var e=this,i=e._interactor._getLogicalPoint(t);if(e.screenInfo&&e._checkEditRealPoint(i)){var n=e.getCurrentSelectintStatus(),r=Xu.Curve.PointType;return n=n===r.Mirrored?r.Straight:r.Mirrored,e._setCurrentSelectionStatus(n),e._interactor._42(),!0}},md.prototype._drawHighlight=function(t){var e=this,i=e.highlight;if(i){var n=i.bezier,r=e._interactor;n&&Xu.Icons.DrawIcon(r,t,Xu.Icons.ShapeHighlightCurve,[n._p1.x,n._p1.y,n._p2.x,n._p2.y,n._p3.x,n._p3.y,n._p4.x,n._p4.y]);var o=i.point;o&&"insertKnot"===i.type&&Xu.Icons.DrawIcon(r,t,Xu.Icons.ShapeHighlighPoint,o)}},md.prototype._drawGuide=function(t){var e=this,i=e._guideInfo;if(i){var n,r,o,a,s=i.v;for(n=0;2>n;n++)if(a=0===n?i.xList:i.yList)for(r=0,o=a.length;o>r;r++)Xu.Icons.DrawIcon(e._interactor,t,Xu.Icons.ShapeGuideLine,[s.x,s.y,a[r].x,a[r].y])}},md.prototype._drawCurrentPoint=function(t){var e=this;if(e.activing){var i=e.activing,n=e.getCurrentSelectintStatus(),r=e._interactor;if(n!==Xu.Curve.PointType.Straight){var o=i.pairs;i.hlpair,i.hltype;var a,s,l,c=i.selections,h=i.editingCtrl;if(o&&!c)for(s=0,l=o.length;l>s;s++)a=o[s],h&&s===h.pairId&&a[h.type]?Xu.Icons.DrawIcon(r,t,Xu.Icons.ShapeActivingCtrl,{point:a.point,c1:a.c1,c2:a.c2,hl:h.type}):Xu.Icons.DrawIcon(r,t,Xu.Icons.ShapeActivingCtrl,a)}Xu.Icons.DrawIcon(r,t,Xu.Icons.ShapeHighlighRealPoint,e.activing.point),c&&c.forEach((function(e){Xu.Icons.DrawIcon(r,t,Xu.Icons.ShapeHighlighRealPoint,e)}))}},md.prototype.clear=function(){var t=this;t.editing=null,t._guideInfo=null,t.activing=null,t.highlight=null},md.prototype._42=function(e){var i=this;i.info={},i.editing||(i.screenInfo=null);var n=i._interactor;if(n.editDetail){var r=n.gv;if(!i.target||!r.isSelected(i.target)||!r.isVisible(i.target))return n.editDetail=!1,void i.clear();if(i.gatherSingleTarget(r,i.target),Xu.Icons.DrawIcon(n,e,Xu.Icons.ShapeBgCurve,i.screenInfo),i._interactor.getStyle("curveElevationVisible")&&(i.target instanceof c.Polyline||i.target instanceof c.Edge&&i._interactor.getStyle("edgeElevationEditable"))&&i.activing){var o=i.activing.getCurrentEditingPoint();o&&"string"!=typeof o.e&&Xu.Icons.DrawIcon(n,e,Xu.Icons.EdgeElevationGuide,o)}if(i._drawHighlight(e),i._drawCurrentPoint(e),i._getRealPoint().forEach((function(t){Xu.Icons.DrawIcon(n,e,Xu.Icons.ShapePoint,t)})),i._drawGuide(e),i.tipInfo&&i._interactor.getStyle("curveTipVisible")&&Xu.Icons.DrawIcon(n,e,Xu.Icons.TipHelper,i.tipInfo),i._edgeHostGuideInfo&&n._drawHostGuide(i._edgeHostGuideInfo),i.edgeEditResult&&i._drawEdgeHostHighlight(e,i.edgeEditResult.host,i.edgeEditResult.anchor),i._multiSelect&&i._multiSelect.endPoint){var a=c.Default.unionPoint(Xu.toScreenPosition(r,i._multiSelect.startPoint),Xu.toScreenPosition(r,i._multiSelect.endPoint));a.color=r.getRectSelectBorderColor(),e.save(),e.setTransform(1,0,0,1,0,0);var s=t.devicePixelRatio,l=a.borderWidth=Math.round(s);l/=2,a.x=Math.round(a.x*s)+l,a.y=Math.round(a.y*s)+l,a.width=Math.round(a.width*s),a.height=Math.round(a.height*s),Xu.Icons.DrawIcon(n,e,Xu.Icons.SimpleRect,a),e.restore()}}else i.clear()},md.prototype._drawEdgeHostHighlight=function(t,e,i){this.drawEdgeHostHighlight(t,e,i),this._interactor.redraw()},md.prototype.drawEdgeHostHighlight=function(t,e,n){if(jn(e)){var r,o,a,s,l=this,c=l._interactor,h=c.gv,u=h.getDataUI(e),d=rh(u),f=[];for(a=0,s=d.points.length;s>a;a++)o=Xu.toScreenPosition(h,d.points.get(a)),f.push(o.x,o.y);d.segments&&(r=d.segments.toArray());var g=c.getStyle("edgeHostHighlighPeriod"),p=c.getStyle("edgeHostEdgeHighlighColor");Xu.Icons.DrawIcon(c,t,Xu.Icons.ShapeBgCurve,{P:f,S:r,color:p,dynamicVisible:n.index===i,dynamicPeriod:g}),p=c.getStyle("edgeHostPointHighlighColor");var v=hh(u);for(a=0,s=v.length;s>a;a++){var _=v[a],y=Xu.toScreenPosition(h,_);Xu.Icons.DrawIcon(c,t,Xu.Icons.ShapePoint,{point:{x:y.x,y:y.y},color:p,size:12,dynamicVisible:a===n.index,dynamicPeriod:g})}}},md.prototype._getRealPoint=function(){var t,e=this.screenInfo,i=e.P,n=e.S,r=-1,o=[],a=-1,s=n.length;return n.each((function(e){a++;var l=1;if(3===e)l=2;else if(4===e)l=3;else if(5===e)return;r+=l,t=a+1>=s||1===n.get(a+1),o.push({point:{x:i[2*r],y:i[2*r+1]},segmentIndex:a,pointIndex:r,isEnd:t})})),o},md.prototype.getEditingPointsInfo=function(t){var e=this,i=e.activing;if(!i)return!1;var n=i.point;if(!n)return!1;var r=this._getRealPoint(),o=[{screen:n}];i.selections&&i.selections.forEach((function(t){o.push({screen:t})}));var a,s,l=r.length;return o.forEach((function(t){for(a=0;l>a;a++)if(s=r[a],t.screen.isNearEnough(s.point)){t.segmentIndex=s.segmentIndex,t.pointIndex=s.pointIndex,t.point=e.target.getPoints().get(s.pointIndex);break}})),t&&o.sort((function(t,e){return t.segmentIndex-e.segmentIndex})),o};var Od=Xu.MoveHelper=function(t){var e=this;e.catalog="Move",e._interactor=t};Od.prototype={},Od.prototype.constructor=Od,Od.prototype.calcShift=function(t,e,i){var n,r,o=this,a=o._interactor.gv,s=a.lp(e);if("beginMove"===t&&o._gatherGridInfo(i._lastLogicalPoint||s),n=o._target){var l,h=n.downPosition;if(h){var u=o._interactor.getStyle("moveSensitivity")/a._zoom;if(h.distanceTo(s)<u)return{x:0,y:0};delete n.downPosition}r=c.Default.isShiftDown(e),r&&(s=o._dealShiftDown(s),l=n.shiftGuide.dir);var d,f=n.rawPos={x:n.pos.x+s.x-n.lp.x,y:n.pos.y+s.y-n.lp.y};if(c.Default.isCtrlDown(e)){if(d=o._calcShiftByAddon(),o._target.node instanceof Xu.Group){var g=o._target.node;g._position.x+=d.x,g._position.y+=d.y}return d}var p=o._interactor.rectGuide;if(n.node instanceof c.Data&&n.node.s("2d.attachable")){var v=o._calcAttachNodeShift(n.node,f);if(p.clear(),v)return v}for(var _,y=n.x+f.x,m=n.y+f.y,b={x:y,y:m},x={x:y+n.w/2,y:m+n.h/2},w={x:y+n.w,y:m+n.h},C=o._interactor.gridGuide,S=[p.findClosest(b,l),p.findClosest(x,l),p.findClosest(w,l),C.findClosest(b,l),C.findClosest(x,l),C.findClosest(w,l)],I=1/0,M=1/0,T=0,E=S.length;E>T;T++)_=S[T],_&&(y=_.x,m=_.y,isFinite(y)&&Math.abs(y)<Math.abs(I)&&(I=y),isFinite(m)&&Math.abs(m)<Math.abs(M)&&(M=m));if(isFinite(I)||(I=0),isFinite(M)||(M=0),d=o._calcShiftByAddon(I,M),o._target.node instanceof Xu.Group){g=o._target.node;g._position.x+=d.x,g._position.y+=d.y}var P=n.node;if(!Gn(P,a)){var D=f.x+I,O=f.y+M;o._interactor.rectGuide.gatherLines({node:P,x:n.x+D,y:n.y+O,w:n.w,h:n.h},l)}return d}},Od.prototype._calcShiftByAddon=function(t,e){var i=this._target,n=i.rawPos,r=i.node.getPosition();return t=t||0,e=e||0,{x:n.x-r.x+t,y:n.y-r.y+e}},Od.prototype._dealShiftDown=function(t){var e=this,i=e._target.shiftGuide,n=e._target.lp,r=Math.abs(t.x-n.x),o=Math.abs(t.y-n.y);r>o&&r>i.limit&&"y"===i.dir&&(i.dir="x"),o>r&&o>i.limit&&"x"===i.dir&&(i.dir="y");var a=i.dir;return"x"===a?(t.y=n.y,i.limit=Math.max(i.limit,r)):"y"===a&&(t.x=n.x,i.limit=Math.max(i.limit,o)),t},Od.prototype._isAttachableLineShape=function(t){if(!t.getSegments)return!1;var e=t.getSegments();if(!e)return!0;e instanceof c.List&&(e=e.getArray());for(var i=1,n=e.length;n>i;i++)if(2!==e[i])return!1;return!0},Od.prototype._calcAttachNodeShift=function(){var t=new qa,e=new qa,i=new qa,n=new qa;return function(r,o){var a=this._interactor.gv,s=r.getHost(),l=a.getDataAt(o,(function(t){return!!t.s("2d.hostable")}));if(l&&s!==l&&r.setHost(l),!l)return this._edgeHostGuideInfo=null,r.setHost(null);var c=this._edgeHostGuideInfo={corners:Xu.getTargetCornersOnScreen(a,l),host:l,attach:-1};if(this._isAttachableLineShape(l)){for(var h,u,d,f,g,p,v=l.getPoints(),_=v.size(),y=l.getPointsMatrix2d(),m=1/0,b=0;_>b&&(b!==_-1||l.isClosePath());b++)0!==b?e.copy(i):y.apply(v.get(b),e),y.apply(b===_-1?v.get(0):v.get(b+1),i),t.copy(o).sub(e),n.copy(i).sub(e),h=n.length(),n.divideScalar(h),u=t.dot(n),0>u?u=0:u>h&&(u=h),n.multiplyScalar(u).add(e),d=t.copy(o).sub(n).lengthSq(),m>d&&(m=d,p=b,f=u,g=h);return Math.sqrt(m)*a.getZoom()>this._interactor.getStyle("attachThreshold")?(r.s({"attach.index":-1}),void r.setHost(null)):(r.s("attach.offset.opposite")&&(f=g-f),r.s({"attach.index":p,"attach.offset":r.s("attach.offset.relative")?f/g:f}),{x:0,y:0})}var x=a.calculateAttachPoint(l,o);if(x){var w=x.point;return c.attach=x.index,this._calcShiftByAddon(w.x-o.x,w.y-o.y)}}}(),Od.prototype._gatherGridInfo=function(t){var e,i=this,n=i._interactor,r=n._getValidSelection();if(r.length){if(1===r.length){if(e=r[0],!e.getRect)return void(i._target=null)}else if(e=Xu.Group.findOrCreateGroup(r),!e)return void(i._target=null)}else{r=n.gv.sm().getSelection();if(r.length&&(e=r.get(0),!e.getRect))return void(i._target=null)}if(e){var o=e.getPosition(),a=e.getRect();i._target={node:e,x:a.x-o.x,y:a.y-o.y,w:a.width,h:a.height,lp:{x:t.x,y:t.y},pos:{x:o.x,y:o.y},shiftGuide:{dir:"x",limit:0},downPosition:new Xu.Math.Vector2(t)},n.rectGuide.gatherRects()}},Od.prototype.clear=function(){var t=this;t._edgeHostGuideInfo=null,t._interactor.rectGuide.clear(),t._interactor._42()},Od.prototype._42=function(){var t=this._edgeHostGuideInfo;t&&this._interactor._drawHostGuide(t)};var Rd="directional",zd="point",kd="spot",Ad="light.color",Vd={},Bd=function(t,e){On(e)&&en.test(e)?Fg(t,e):kn(e)&&e.modelType?jg(t,e):e===i?delete Qi[t]:Qi[t]=e},Ld=function(t){return t},Fd=function(t){var e;if(t=u.convertShape3dModelName(t),kn(t)){if(t.modelType){if(t.uuid){if(e=Qi[t.uuid])return e}else t.uuid=c.Math.generateUUID();return e===i&&(Vg&&Vg[t.uuid]||jg(t.uuid,t)),i}return t}return e=Qi[t],t&&e===i&&en.test(t)&&(Vg&&Vg[t]||Fg(t,t)),e},jd=function(t,e){t.frameStack?t.frameStack.push(e):t.frameStack=[e],t.bindFramebuffer(t.FRAMEBUFFER,e)},Hd=function(t){var e=t.frameStack;if(e){if(e.pop(),e.length)return void t.bindFramebuffer(t.FRAMEBUFFER,e[e.length-1]);t.frameStack=null}t.bindFramebuffer(t.FRAMEBUFFER,null)};Qn(u,{graph3dViewAttributes:l,graph3dViewFirstPersonMode:!1,graph3dViewMouseRoamable:!0,graph3dViewMoveStep:15,graph3dViewRotateStep:L/60,graph3dViewBlockSelectable:!0,graph3dViewEditHelperDisabled:!1,graph3dViewPannable:!0,graph3dViewRotatable:!0,graph3dViewWalkable:!0,graph3dViewResettable:!0,graph3dViewZoomable:!0,graph3dViewRectSelectable:!0,graph3dViewRectSelectBackground:ua,graph3dViewGridVisible:!1,graph3dViewGridSize:50,graph3dViewGridGap:50,graph3dViewGridColor:[.4,.75,.85,1],graph3dViewMaxPhi:L,graph3dViewMinPhi:0,graph3dViewOriginAxisVisible:!1,graph3dViewCenterAxisVisible:!1,graph3dViewAxisXColor:[1,0,0,1],graph3dViewAxisYColor:[0,1,0,1],graph3dViewAxisZColor:[0,0,1,1],graph3dViewEditSizeColor:[1,1,0,1],graph3dViewOrtho:!1,graph3dViewOrthoWidth:2e3,graph3dViewFovy:L/4,graph3dViewNear:10,graph3dViewFar:1e4,graph3dViewEye:[0,300,1e3],graph3dViewCenter:[0,0,0],graph3dViewUp:[0,1,-1e-7],graph3dViewHeadlightRange:0,graph3dViewHeadlightColor:[1,1,1,1],graph3dViewHeadlightIntensity:1,graph3dViewHeadlightDisabled:!1,graph3dViewHeadlightAmbientIntensity:.7,graph3dViewFogDisabled:!0,graph3dViewFogColor:"white",graph3dViewFogNear:1,graph3dViewFogFar:2e3,graph3dViewPickerResolution:.5,graph3dViewDashDisabled:!0,graph3dViewBatchBlendDisabled:!0,graph3dViewBatchBrightnessDisabled:!0,graph3dViewBatchColorDisabled:!1,graph3dMaxVectorCacheTime:50,setShape3dModel:Bd,getShape3dModel:Fd,convertShape3dModelName:Ld,getShape3dModelMap:function(){return Qi},getCachedShape3dModelMap:function(){return Yi},createMatrix:function(t,e){Vn(t)||(t=[t]);for(var i=t.length-1;i>=0;i--){var n=t[i];e=Hl(n.mat,n.s3,n.r3,n.rotationMode,n.t3,e)}return e},transformVec:function(t,e){return kl(t,e)},glBindFrame:jd,glUnbindFrame:Hd,createBoxModel:function(){return{vs:Ng,ns:Qg,uv:Xg,is:qg}},createRoundRectModel:function(t,e){return ap.roundRect(t,e)},createStarModel:function(t,e){return ap.star(t,e)},createRectModel:function(t,e){return ap.rect(t,e)},createTriangleModel:function(t,e){return ap.triangle(t,e)},createRightTriangleModel:function(t,e){return ap.rightTriangle(t,e)},createParallelogramModel:function(t,e){return ap.parallelogram(t,e)},createTrapezoidModel:function(t,e){return ap.trapezoid(t,e)},createSmoothSphereModel:function(t,e,i,n,r,o,a){return fh(new Jh(t,e,i,n,r,o,a))},createSphereModel:function(t,e,i,n,r,o,a){return t?Kg(t,e,i,n,r,o,a):u.createSmoothSphereModel()},createSmoothConeModel:function(t,e,i,n,r){return np(t,e,i,n,r)},createConeModel:function(t,e,i,n,r,o){return t?rp(t,e,i,n,r,o):np(o)},createSmoothCylinderModel:function(t,e,i,n,r,o,a,s){return fh(new Zh(t,e,i,n,r,o,a,s))},createCylinderModel:function(t,e,i,n,r,o,a,s){return t?ip(t,e,i,n,r,o,a,s):ep(o,a)},createSmoothTorusModel:function(t,e,i,n,r,o){return fh(new Kh(t,e,i,n,r,o))},createTorusModel:function(t,e,i,n,r,o,a,s){return t?tp(t,e,i,n,r,o,a,s):$g(o,a)},createExtrusionModel:function(t,e,i,n,r,o,a,s){return op(t,e,i,n,r,o,a,s)},createSmoothRingModel:function(t,e,i,n,r,o){for(var a=[],s=0;s<t.length-1;s+=2)a.push({x:t[s],y:t[s+1]});for(t=Ro(a,e,i)[0],a=[],s=0;s<t.length;s++){var l=t[s];a.push(new mh(l.x,0,l.y))}return fh(new iu(a,o,n,r))},createTextGeometry:function(t,e){return fh(new nu(t,e))},loadFontFace:function(t,e){u.xhrLoad(t,(function(t){if(!t)return e();var n;try{n=JSON.parse(t)}catch(i){n=JSON.parse(t.substring(65,t.length-2))}jh.loadFace(n),e&&e(n.familyName.toLowerCase())}),e?null:{sync:!0})},createRingModel:function(t,e,i,n,r,o,a,s,c,h){for(var d=[],f=0;f<t.length-1;f+=2)d.push({x:t[f],y:t[f+1]});o=o||u.shapeSide,a=a||0,s=s||o;var g,p,v,_,y,m,b,x,w,C,S,I,M,T,E,P,D,O=[],z=[],A=c?[]:l,V=c?[]:l,B=h?[]:l,L=h?[]:l,F=n?[]:l,j=n?[]:l,H=r?[]:l,G=r?[]:l,U=(t=Ro(d,e,i),fr(t)),W=0,N=2*Math.PI/o;return t.forEach((function(t){if(v=t.length,v>1){if(_=t[0],n)for(m=_.x,x=_.y,f=a;s>f;f++)S=f+1,I=f*N,M=S*N,T=R(I),E=k(I),P=R(M),D=k(M),F.push(T*m,x,-E*m,P*m,x,-D*m,0,x,0),j.push(.5-.5*T,.5-.5*E,.5-.5*P,.5-.5*D,.5,.5);for(C=0;v>C;C++){for(y=t[C],m=_.x,b=y.x,x=_.y,w=y.y,g=W/U,W+=nl(_,y),p=W/U,f=a;s>f;f++)S=f+1,I=f*N,M=S*N,T=R(I),E=k(I),P=R(M),D=k(M),O.push(T*b,w,-E*b,P*b,w,-D*b,T*m,x,-E*m,P*b,w,-D*b,P*m,x,-D*m,T*m,x,-E*m),z.push(f/o,p,S/o,p,f/o,g,S/o,p,S/o,g,f/o,g),c&&f===a&&(A.push(0,x,0,0,w,0,T*b,w,-E*b,T*b,w,-E*b,T*m,x,-E*m,0,x,0),V.push(0,.5-x,0,.5-w,2*b,.5-w,2*b,.5-w,2*m,.5-x,0,.5-x)),h&&S===s&&(B.push(0,x,0,P*b,w,-D*b,0,w,0,P*b,w,-D*b,0,x,0,P*m,x,-D*m),L.push(1,.5-x,1-2*b,.5-w,1,.5-w,1-2*b,.5-w,1,.5-x,1-2*m,.5-x));_=y}if(r)for(m=_.x,x=_.y,f=a;s>f;f++)S=f+1,I=f*N,M=S*N,T=R(I),E=k(I),P=R(M),D=k(M),H.push(P*m,x,-D*m,T*m,x,-E*m,0,x,0),G.push(.5-.5*P,.5+.5*D,.5-.5*T,.5+.5*E,.5,.5)}})),{vs:O,uv:z,bottom_vs:H,bottom_uv:G,top_vs:F,top_uv:j,from_vs:A,from_uv:V,to_vs:B,to_uv:L}}},!0),Qn(d,{"3d.move.mode":i,"3d.selectable":!0,"3d.visible":!0,"3d.movable":!0,"3d.editable":!0,"3d.clip.direction":null,"3d.clip.percentage":1,"shape.border.gradient.color":i,"edge.gradient.color":i,"edge.source.t3":i,"edge.target.t3":i,"light.type":zd,"light.center":[0,0,0],"light.color":[1,1,1,1],"light.disabled":!1,"light.angle":L/4,"light.range":0,"light.exponent":1,"light.intensity":1,"wf.visible":!1,"wf.width":1,"wf.color":Sa,"wf.short":!1,"wf.mat":i,"wf.geometry":!1,"wf.loadQuadWireframe":!1,"wf.combineTriangle":!0,batch:i,"transparent.mask":!1,brightness:i,"select.brightness":.7,"repeat.uv.length":i,envmap:0,renderTextureSamples:4,alphaTest:.4,autorotate:!1,fixSizeOnScreen:!1,alwaysOnTop:!1,"texture.cache":!1,"hide.overlapping.group":i,"vector.dynamic":!1,"vector.dynamic.maxsize":2048,"texture.scale":1,"geometry.cache":!1,"highlight.mode":!1,"highlight.visible":!0,"highlight.width":.8,"highlight.color":"rgba(190, 210, 250, 1)","color.empty":[0,0,0,0],"label.face":dt,"label.t3":i,"label.r3":i,"label.texture.scale":2,"label.rotationMode":lu,"label.light":!1,"label.blend":i,"label.reverse.flip":!1,"label.reverse.color":ca,"label.reverse.cull":!1,"label.transparent":!1,"label.autorotate":!1,"label2.face":dt,"label2.t3":i,"label2.r3":i,"label2.texture.scale":2,"label2.rotationMode":lu,"label2.light":!1,"label2.blend":i,"label2.reverse.flip":!1,"label2.reverse.color":ca,"label2.reverse.cull":!1,"label2.transparent":!1,"label2.autorotate":!1,"note.face":dt,"note.t3":i,"note.r3":i,"note.texture.scale":2,"note.rotationMode":lu,"note.light":!1,"note.blend":i,"note.reverse.flip":!1,"note.reverse.color":ca,"note.reverse.cull":!1,"note.transparent":!1,"note.autorotate":!1,"note2.face":dt,"note2.t3":i,"note2.r3":i,"note2.texture.scale":2,"note2.rotationMode":lu,"note2.light":!1,"note2.blend":i,"note2.reverse.flip":!1,"note2.reverse.color":ca,"note2.reverse.cull":!1,"note2.transparent":!1,"note2.autorotate":!1,shape3d:i,"shape3d.color":wa,"shape3d.top.color":i,"shape3d.bottom.color":i,"shape3d.from.color":i,"shape3d.to.color":i,"shape3d.image":i,"shape3d.top.image":i,"shape3d.bottom.image":i,"shape3d.from.image":i,"shape3d.to.image":i,"shape3d.light":!0,"shape3d.side":0,"shape3d.side.from":i,"shape3d.side.to":i,"shape3d.smooth":i,"shape3d.visible":!0,"shape3d.from.visible":!0,"shape3d.to.visible":!0,"shape3d.top.visible":!0,"shape3d.bottom.visible":!0,"shape3d.torus.radius":.17,"shape3d.resolution":0,"shape3d.blend":i,"shape3d.opacity":i,"shape3d.reverse.flip":!1,"shape3d.reverse.color":ca,"shape3d.reverse.cull":!1,"shape3d.transparent":!1,"shape3d.uv.offset":i,"shape3d.uv.scale":i,"shape3d.top.uv.offset":i,"shape3d.top.uv.scale":i,"shape3d.bottom.uv.offset":i,"shape3d.bottom.uv.scale":i,"shape3d.from.uv.offset":i,"shape3d.from.uv.scale":i,"shape3d.to.uv.offset":i,"shape3d.to.uv.scale":i,"shape3d.top.cap":i,"shape3d.bottom.cap":i,"shape3d.start.angle":0,"shape3d.sweep.angle":F,"shape3d.point.epsilon":1e-6,"shape3d.discard.selectable":!0,"shape3d.top.discard.selectable":!0,"shape3d.bottom.discard.selectable":!0,"shape3d.from.discard.selectable":!0,"shape3d.to.discard.selectable":!0,"shape3d.scaleable":!0,"shape3d.autorotate":!1,"shape3d.fixSizeOnScreen":!1,"shape3d.image.cache":!1,"shape3d.alwaysOnTop":!1,"shape3d.vector.dynamic":!1,"shape3d.texture.scale":1,"shape3d.reflector":!1,"shape3d.reflector.color":"rgb(128,128,128)","shape3d.reflector.background":null,"shape3d.reflector.clip":.003,"texture.mipmap.max":i,"texture.filter":i,"texture.filter.min":i,"texture.filter.mag":i,"csg.cull.color":i,"all.light":!0,"all.visible":!0,"all.color":wa,"all.image":i,"all.blend":i,"all.opacity":i,"all.reverse.flip":!1,"all.reverse.color":ca,"all.reverse.cull":!1,"all.transparent":!1,"all.uv":i,"all.uv.offset":i,"all.uv.scale":i,"all.discard.selectable":!0,mat:i,"left.mat":i,"right.mat":i,"top.mat":i,"bottom.mat":i,"front.mat":i,"back.mat":i,"edge.source.anchor.elevation":i,"edge.target.anchor.elevation":i},!0);var Gd,Ud=!1,Wd=[0,0,0,0],Nd={left:[1/255,0,0,1],right:[2/255,0,0,1],top:[3/255,0,0,1],bottom:[4/255,0,0,1],front:[5/255,0,0,1],back:[6/255,0,0,1],m:{1:gt,2:pt,3:vt,4:_t,5:dt,6:ft}},qd=function(t,e,i,n){if(e.getFaceVisible(t,i)){var r=jl(t,e.getFaceMat(t,i)||e.getMat(t));t.appendAnchorMatrix3d(r),Zf(e,r);var o=e._26I;e.getFaceReverseCull(t,i)?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),Nf(o,e._prg.uFixPickReverseColor,Nd[i]),Af(o),Ff(o,n,6),Vf(o),Qf(e)}},Xd=function(t){return t instanceof Xp},Qd=function(t){return[t.x,t.e||0,t.y]},Yd=function(t,e,i){e=Co(e);for(var n=e[0],r=e[1],o=e[2];i--;)t.push(n,r,o)},Zd=function(t,e,i){e=Co(e);for(var n=e[0],r=e[1],o=e[2],a=e[3];i--;)t.push(n,r,o,a)},Jd=function(t,e,i){if(e){var n,r,o,a=e[0],s=e[1],l=e[2],c=e[4],h=e[5],u=e[6],d=e[8],f=e[9],g=e[10],p=e[12],v=e[13],_=e[14],y=i.length,m=0;for(m=0;y>m;m+=3)n=i[m],r=i[m+1],o=i[m+2],t.push(a*n+c*r+d*o+p,s*n+h*r+f*o+v,l*n+u*r+g*o+_)}else qn(t,i)},Kd=function(t,e){var i=e.s("light.intensity"),n=Co(e.s(Ad)),r=n[0],o=n[1],a=n[2];1!==i&&(r*=i,o*=i,a*=i),t.push(r,o,a,e.s("light.disabled")?1:0)},$d=function(t,e,i){Nf(e,i.uHeadlightRange,t._headlightRange),Nf(e,i.uHeadlightAmbientIntensity,t._headlightAmbientIntensity);var n=t._headlightIntensity,r=Co(t._headlightColor);1!==n&&(r=[r[0]*n,r[1]*n,r[2]*n]),Nf(e,i.uHeadlightColor,[r[0],r[1],r[2],t._headlightDisabled?1:0]);var o=t._59O,a=t._spots,s=t._dirs;if(o.length){var l=[],c=[],h=[];o.forEach((function(e){Kd(l,e),qn(c,t._transformPointToViewSpace(e.p3())),h.push(e.s("light.range"))})),e.uniform4fv(i.uPointColor,l),e.uniform1fv(i.uPointRange,h),e.uniform3fv(i.uPointPosition,c)}if(a.length){var u=[],d=[],f=[],g=[],p=[],v=[];a.forEach((function(e){Kd(u,e),qn(d,t._transformPointToViewSpace(e.p3())),qn(p,t._transformDirectionToViewSpace(e.p3(),e.s("light.center"))),f.push(e.s("light.range")),g.push(R(e.s("light.angle")/2)),v.push(e.s("light.exponent"))})),e.uniform4fv(i.uSpotColor,u),e.uniform1fv(i.uSpotRange,f),e.uniform1fv(i.uSpotAngle,g),e.uniform1fv(i.uSpotExponent,v),e.uniform3fv(i.uSpotPosition,d),e.uniform3fv(i.uSpotDirection,p)}if(s.length){var _=[],y=[];s.forEach((function(e){Kd(_,e),qn(y,t._transformDirectionToViewSpace(e.p3()))})),e.uniform4fv(i.uDirColor,_),e.uniform3fv(i.uDirDirection,y)}},tf=function(t){return Math.max(u.graph3dViewMinPhi+Cl,Math.min(u.graph3dViewMaxPhi-Cl,t))},ef=function(){return.05+U()/2},nf=function(t,e,i,n){var r,o=t.getEye();return t.isOrtho()?(r=Ml(t.getCenter(),o),r[0]+=n[0],r[1]+=n[1],r[2]+=n[2]):r=o,rf(e,i,n,r)},rf=function(t,e,i,n){var r=El(t,e),o=Ml(n,i,!0),a=El(o,e);if(O(a)<Cl)return l;var s=(r-El(i,e))/a;return[i[0]+o[0]*s,i[1]+o[1]*s,i[2]+o[2]*s]},of=function(t,e){return{x:2*t.x-e.x,y:2*t.y-e.y}},af=function(t,e,i,n){var r,o;if(!t)return r=G(e.y-i.y,i.x-e.x),{x:e.x+n*k(r),y:e.y+n*R(r)};if(!i)return r=G(t.y-e.y,e.x-t.x),{x:e.x+n*k(r),y:e.y+n*R(r)};var a=Ml([t.x,t.y,0],[e.x,e.y,0],!0),s=Ml([i.x,i.y,0],[e.x,e.y,0],!0),l=-(a[0]+s[0])/2,c=-(a[1]+s[1])/2,h=E(l*l+c*c);if(Cl>h)return r=G(t.y-e.y,e.x-t.x),{x:e.x+n*k(r),y:e.y+n*R(r)};var u=t.x-e.x,d=t.y-e.y,f=i.x-e.x,g=i.y-e.y,p=E(u*u+d*d),v=E(f*f+g*g);r=z(El(a,s))/2,o=a[1]*s[0]-a[0]*s[1]>0?-1:1,l/=h,c/=h;var _=n/k(r),y=P(p,v)/R(r);h=Math.min(_,y);var m={x:e.x+o*h*l,y:e.y+o*h*c};return i.b&&_>v/R(r)&&(m.adjust=!0),m},sf=function(t){var e=t[1],i=t[2],n=t[3],r=t[6],o=t[7],a=t[11];t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=e,t[6]=t[9],t[7]=t[13],t[8]=i,t[9]=r,t[11]=t[14],t[12]=n,t[13]=o,t[14]=a},lf=function(t){var e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],a=t[5],s=t[6],c=t[7],h=t[8],u=t[9],d=t[10],f=t[11],g=t[12],p=t[13],v=t[14],_=t[15],y=e*a-i*o,m=e*s-n*o,b=e*c-r*o,x=i*s-n*a,w=i*c-r*a,C=n*c-r*s,S=h*p-u*g,I=h*v-d*g,M=h*_-f*g,T=u*v-d*p,E=u*_-f*p,P=d*_-f*v,D=y*P-m*E+b*T+x*M-w*I+C*S;return D?(D=1/D,t[0]=(a*P-s*E+c*T)*D,t[1]=(n*E-i*P-r*T)*D,t[2]=(p*C-v*w+_*x)*D,t[3]=(d*w-u*C-f*x)*D,t[4]=(s*M-o*P-c*I)*D,t[5]=(e*P-n*M+r*I)*D,t[6]=(v*b-g*C-_*m)*D,t[7]=(h*C-d*b+f*m)*D,t[8]=(o*E-a*M+c*S)*D,t[9]=(i*M-e*E-r*S)*D,t[10]=(g*w-p*b+_*y)*D,t[11]=(u*b-h*w-f*y)*D,t[12]=(a*I-o*T-s*S)*D,t[13]=(e*T-i*I+n*S)*D,t[14]=(p*m-g*x-v*y)*D,void(t[15]=(h*x-u*m+d*y)*D)):l},cf=function(t,e){if(e){var i=e[0],n=e[1],r=e[2];t[12]=t[0]*i+t[4]*n+t[8]*r+t[12],t[13]=t[1]*i+t[5]*n+t[9]*r+t[13],t[14]=t[2]*i+t[6]*n+t[10]*r+t[14],t[15]=t[3]*i+t[7]*n+t[11]*r+t[15]}},hf=function(t,e){if(e){var i=e[0],n=e[1],r=e[2];t[0]=t[0]*i,t[1]=t[1]*i,t[2]=t[2]*i,t[3]=t[3]*i,t[4]=t[4]*n,t[5]=t[5]*n,t[6]=t[6]*n,t[7]=t[7]*n,t[8]=t[8]*r,t[9]=t[9]*r,t[10]=t[10]*r,t[11]=t[11]*r}},uf=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],h=e[7],u=e[8],d=e[9],f=e[10],g=e[11],p=e[12],v=e[13],_=e[14],y=e[15],m=i[0],b=i[1],x=i[2],w=i[3];return t[0]=m*n+b*s+x*u+w*p,t[1]=m*r+b*l+x*d+w*v,t[2]=m*o+b*c+x*f+w*_,t[3]=m*a+b*h+x*g+w*y,m=i[4],b=i[5],x=i[6],w=i[7],t[4]=m*n+b*s+x*u+w*p,t[5]=m*r+b*l+x*d+w*v,t[6]=m*o+b*c+x*f+w*_,t[7]=m*a+b*h+x*g+w*y,m=i[8],b=i[9],x=i[10],w=i[11],t[8]=m*n+b*s+x*u+w*p,t[9]=m*r+b*l+x*d+w*v,t[10]=m*o+b*c+x*f+w*_,t[11]=m*a+b*h+x*g+w*y,m=i[12],b=i[13],x=i[14],w=i[15],t[12]=m*n+b*s+x*u+w*p,t[13]=m*r+b*l+x*d+w*v,t[14]=m*o+b*c+x*f+w*_,t[15]=m*a+b*h+x*g+w*y,t},df=function(t,e,i,n){var r,o,a,s,l,c,h,u,d,f,g=e[0],p=e[1],v=e[2],_=n[0],y=n[1],m=n[2],b=i[0],x=i[1],w=i[2];return O(g-b)<Cl&&O(p-x)<Cl&&O(v-w)<Cl?zl(t):(h=g-b,u=p-x,d=v-w,f=1/E(h*h+u*u+d*d),h*=f,u*=f,d*=f,r=y*d-m*u,o=m*h-_*d,a=_*u-y*h,f=E(r*r+o*o+a*a),f?(f=1/f,r*=f,o*=f,a*=f):(r=0,o=0,a=0),s=u*a-d*o,l=d*r-h*a,c=h*o-u*r,f=E(s*s+l*l+c*c),f?(f=1/f,s*=f,l*=f,c*=f):(s=0,l=0,c=0),t[0]=r,t[1]=s,t[2]=h,t[3]=0,t[4]=o,t[5]=l,t[6]=u,t[7]=0,t[8]=a,t[9]=c,t[10]=d,t[11]=0,t[12]=-(r*g+o*p+a*v),t[13]=-(s*g+l*p+c*v),t[14]=-(h*g+u*p+d*v),t[15]=1,t)},ff=function(t,e,i,n,r){var o=1/H(e/2),a=1/(n-r);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*a,t[15]=0,t},gf=function(t,e,i,n,r,o,a){var s=1/(e-i),l=1/(n-r),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*s,t[13]=(r+n)*l,t[14]=(a+o)*c,t[15]=1,t},pf=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=i*i+n*n+r*r+o*o,s=a?1/a:0;return t[0]=-i*s,t[1]=-n*s,t[2]=-r*s,t[3]=o*s,t},vf=function(t,e){var i=e[0]+e[5]+e[10],n=0;return i>0?(n=2*Math.sqrt(i+1),t[3]=.25*n,t[0]=(e[6]-e[9])/n,t[1]=(e[8]-e[2])/n,t[2]=(e[1]-e[4])/n):e[0]>e[5]&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/n,t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/n,t[0]=(e[1]+e[4])/n,t[1]=.25*n,t[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/n,t[0]=(e[8]+e[2])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n),t},_f=function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=n+n,l=r+r,c=o+o,h=n*s,u=n*l,d=n*c,f=r*l,g=r*c,p=o*c,v=a*s,_=a*l,y=a*c;return t[0]=1-(f+p),t[1]=u+y,t[2]=d-_,t[3]=0,t[4]=u-y,t[5]=1-(h+p),t[6]=g+v,t[7]=0,t[8]=d+_,t[9]=g-v,t[10]=1-(h+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},yf=function(t,e){if(t.vr.enable){var i=t.vr.getViewMatrix(e);if(i)return i}return df(e||Pl(),t._eye,t._center,t._up)},mf=function(t,e){if(t.vr.enable){var i=t.vr.getProjectMatrix();if(i)return i}if(!e&&t._computedProjectMatrix)return Ol(t._computedProjectMatrix);var n=t.getAspect(),r=t._near,o=t._far,a=Pl();if(t._ortho){var s=t._orthoWidth/2,l=s/n;gf(a,-s,s,-l,l,r,o)}else ff(a,t._fovy,n,r,o);return a},bf=function(t,e){if(!t)return l;var i=0,n=1,r=2,o=[],a=0,s=t.length,c=s/3;if(e){for(;s>a;a++)o[a]=0;for(a=0;a<e.length;a+=3){var h=[],u=[],d=[];h[i]=t[3*e[a+1]+i]-t[3*e[a]+i],h[n]=t[3*e[a+1]+n]-t[3*e[a]+n],h[r]=t[3*e[a+1]+r]-t[3*e[a]+r],u[i]=t[3*e[a+2]+i]-t[3*e[a+1]+i],u[n]=t[3*e[a+2]+n]-t[3*e[a+1]+n],u[r]=t[3*e[a+2]+r]-t[3*e[a+1]+r],d[i]=h[n]*u[r]-h[r]*u[n],d[n]=h[r]*u[i]-h[i]*u[r],d[r]=h[i]*u[n]-h[n]*u[i];for(var f=0;3>f;f++)o[3*e[a+f]+i]+=d[i],o[3*e[a+f]+n]+=d[n],o[3*e[a+f]+r]+=d[r]}}else for(a=0;c>a;a+=3){h=[],u=[],d=[];h[i]=t[3*(a+1)+i]-t[3*a+i],h[n]=t[3*(a+1)+n]-t[3*a+n],h[r]=t[3*(a+1)+r]-t[3*a+r],u[i]=t[3*(a+2)+i]-t[3*(a+1)+i],u[n]=t[3*(a+2)+n]-t[3*(a+1)+n],u[r]=t[3*(a+2)+r]-t[3*(a+1)+r],d[i]=h[n]*u[r]-h[r]*u[n],d[n]=h[r]*u[i]-h[i]*u[r],d[r]=h[i]*u[n]-h[n]*u[i];for(f=0;3>f;f++)o[3*(a+f)+i]=d[i],o[3*(a+f)+n]=d[n],o[3*(a+f)+r]=d[r]}for(a=0;s>a;a+=3){var g=[];g[i]=o[a+i],g[n]=o[a+n],g[r]=o[a+r];var p=E(g[i]*g[i]+g[n]*g[n]+g[r]*g[r]);0===p&&(p=Cl),g[i]=g[i]/p,g[n]=g[n]/p,g[r]=g[r]/p,o[a+i]=g[i],o[a+n]=g[n],o[a+r]=g[r]}return new Il(o)},xf=function(t,e,n,r){if(n||(n=t.createTexture()),e){var o=t.TEXTURE_2D,a=t.REPEAT,s=t.CLAMP_TO_EDGE,c=t.TEXTURE_MIN_FILTER;r=r||an;var h=r.minFilter||r.filter||t.LINEAR,u=r.magFilter||r.filter||t.LINEAR;Mf(t,n),t.texImage2D(o,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),Tf(t,t.TEXTURE_MAG_FILTER,u);var d=e.naturalWidth||e.width,f=e.naturalHeight||e.height;ja.isPOT(d)&&ja.isPOT(f)&&!e.clampToEdge?(Tf(t,t.TEXTURE_WRAP_S,a),Tf(t,t.TEXTURE_WRAP_T,a),Tf(t,c,h===t.NEAREST?t.NEAREST_MIPMAP_NEAREST:t.LINEAR_MIPMAP_LINEAR),r.mipmapMaxLevel!==i&&Tf(t,t.TEXTURE_MAX_LEVEL,r.mipmapMaxLevel),t.generateMipmap(o)):(Tf(t,t.TEXTURE_WRAP_S,s),Tf(t,t.TEXTURE_WRAP_T,s),Tf(t,c,h)),Mf(t,l)}return n},wf=function(t,e){var i=new Uint8Array(4);return e=e||t.createTexture(),Mf(t,e),Tf(t,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i),e},Cf=function(t){t._26I&&t._prg&&(t._26I.deleteProgram(t._prg),t._prg=l)},Sf=function(t,e,i,n){var r=t.createShader(i);return t.shaderSource(r,n),t.compileShader(r),t.attachShader(e,r),r},If=function(t){return t.createBuffer()},Mf=function(t,e){t.bindTexture(t.TEXTURE_2D,e)},Tf=function(t,e,i){t.texParameteri(t.TEXTURE_2D,e,i)},Ef=function(t,e){t.enable(t.POLYGON_OFFSET_FILL),t.polygonOffset(e[0],e[1])},Pf=function(t){t.disable(t.POLYGON_OFFSET_FILL)},Df=function(t,e){if(e){e=Co(e);t.clearColor(e[0],e[1],e[2],e[3])}},Of=function(t,e){Nf(t,e.uFix,!0),Xf(t,e.aNormal)},Rf=function(t,e){Nf(t,e.uFix,!1),qf(t,e.aNormal)},zf=function(t,e,i,n,r,o,a,s){t._picking||(i?(Nf(t,e.uBlend,!0),Nf(t,e.uBlendColor,i)):Nf(t,e.uBlend,!1),Nf(t,e.uLight,n==l||n),Rn(r)&&1!==r&&Nf(t,e.uPartOpacity,r),Nf(t,e.uReverseFlip,o!=l&&o),Nf(t,e.uFixPickReverseColor,a||ca)),s?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE)},kf=function(t,e){t._picking||Nf(t,e.uPartOpacity,1)},Af=function(){var t=[0,0,1,1];return function(e,i,n,r,o,a,s,l,c){return n?(Nf(e,i.uTexture,!0),Nf(e,i.uDiscardSelectable,!zn(r)||r),qf(e,i.aUv),Hf(e,o,a,i.aUv,2),c?(Nf(e,i.uBlendTexture,!0),e.activeTexture(e.TEXTURE1),Mf(e,c),e.uniform1i(i.uBlendSampler,1)):(Nf(e,i.uBlendTexture,!1),e.activeTexture(e.TEXTURE1),Mf(e,e._emptyBlendTexture)),e.activeTexture(e.TEXTURE0),Mf(e,n),e.uniform1i(i.uSampler,0),s?(t[0]=s[0],t[1]=s[1]):(t[0]=0,t[1]=0),l?(t[2]=l[0],t[3]=l[1]):(t[2]=1,t[3]=1),void Nf(e,i.uOffsetScale,t)):(e.activeTexture(e.TEXTURE0),Mf(e,e._emptyTexture),e.activeTexture(e.TEXTURE1),void Mf(e,e._emptyBlendTexture))}}(),Vf=function(t,e,i){t.activeTexture(t.TEXTURE0),Mf(t,l),t.activeTexture(t.TEXTURE1),Mf(t,l),i&&(Xf(t,e.aUv),Nf(t,e.uTexture,!1),Nf(t,e.uBlendTexture,!1))},Bf=function(t,e,i,n,r,o){!i||nt||ot||t.lineWidth(i),n&&!t._picking&&Nf(t,e.uFixPickReverseColor,n),r&&Hf(t,r,o,e.aPosition)},Lf=function(t,e,i,n){Gd&&(n=t[Gd]),t.drawArrays(n==l?t.TRIANGLES:n,e,i);var r=t._renderInfo;r&&(r.calls++,r.vertices+=i,(n==l||n===t.TRIANGLES)&&(r.faces+=i/3),n===t.LINES&&(r.lines+=i/2))},Ff=function(t,e,i,n){Gd&&(n=t[Gd]),t.drawElements(n==l?t.TRIANGLES:n,i,t.UNSIGNED_SHORT,e==l?0:2*e);var r=t._renderInfo;r&&(r.calls++,r.vertices+=i,(n==l||n===t.TRIANGLES)&&(r.faces+=i/3),n===t.LINES&&(r.lines+=i/2))},jf=function(t,e,i,n,r){var o=t.ARRAY_BUFFER;t.bindBuffer(o,e),i&&t.bufferData(o,i,t.STATIC_DRAW),n!=l&&t.vertexAttribPointer(n,r||3,t.FLOAT,!1,0,0)},Hf=function(t,e,i,n,r){return i?(Wf(t,t.ARRAY_BUFFER,e,i),void(n!=l&&t.vertexAttribPointer(n,r||3,t.FLOAT,!1,0,0))):jf(t,e,i,n,r)},Gf=function(t,e,i){var n=t.ELEMENT_ARRAY_BUFFER;t.bindBuffer(n,e),i&&t.bufferData(n,i,t.STATIC_DRAW)},Uf=function(t,e,i){Wf(t,t.ELEMENT_ARRAY_BUFFER,e,i)},Wf=function(t,e,i,n){var r=n._bufId;r||(r=n._bufId=c.Math.generateIncreasingID());var o=t._bufPool;(i=o[r])&&i._buf?t.bindBuffer(e,i._buf):(i=o[r]={_buf:If(t)},t.bindBuffer(e,i._buf),t.bufferData(e,n,t.STATIC_DRAW)),i._fid=t._renderInfo.frame},Nf=function(t,e,i){if(i!=l&&e!=l){i=Co(i);var n=i.length;3===n?t.uniform3fv(e,i):4===n?t.uniform4fv(e,i):16===n?t.uniformMatrix4fv(e,!1,i):zn(i)?t.uniform1i(e,i?1:0):2===n?t.uniform2fv(e,i):t.uniform1f(e,i)}},qf=function(t,e){e!=l&&e>=0&&t.enableVertexAttribArray(e)},Xf=function(t,e){e!=l&&e>=0&&t.disableVertexAttribArray(e)},Qf=function(t,e){var i=t.getGL(),n=t._prg;t._7O=t._8O.pop(),e&&(Nf(i,n.uMVMatrix,t._7O),t._6O=e,Nf(i,n.uNMatrix,e))},Yf=function(t,e){return e||(e=Pl()),Rl(e,t),lf(e),sf(e),e},Zf=function(t,e){var i=t.getGL(),n=t._prg,r=t._7O;e?(t._8O.push(Ol(r)),Nf(i,n.uMMatrix,e),uf(r,r,e),t._7O=r):Nf(i,n.uMMatrix,Dl),Nf(i,n.uMVMatrix,r),Nf(i,n.uNMatrix,Yf(r,t._6O))},Jf=function(t,e,i,n,r,o){if(i){if(n){var a=i.value++,s=2147483648|a,l=[(255&s>>16)/255,(255&s>>8)/255,(255&s)/255,(255&s>>24)/255];i[a]={data:r,part:o}}else l=Wd;return Nf(t,e.uFixPickReverseColor,l),l}},Kf=function(t,e,n){"target"!==n&&(n="source");var r="target"===n?e.getTargetAgent():e.getSourceAgent(),o="edge."+n+".";if(Fn(r)){var a=e.s(o+"anchor.x"),s=e.s(o+"anchor.elevation"),l=e.s(o+"anchor.y"),c=jl(r,t.getMat(r)),h=r.getAnchor3d();return kl([(a===i?.5:a)-h.x,(s===i?.5:s)-h.y,(l===i?.5:l)-h.z],c)}var u=e.s(o+"index"),d=t.getData3dUI(r);if(!d.info||!d.info.list)return!1;if(u>=0){var f,g,p,v,_=d.info._lastPointsSegments,y=_.points,m=_.segments,b=-1,x=-1;for(p=0,S=m?m.length:y.length;S>p;p++){if(g=m?m.get(p):1,3===g)v=2;else if(4===g)v=3;else{if(5===g)continue;v=1}if(b+=v,x++,x===u){f=y.get(b);break}}return f||(f=y.get(y.length-1)),[f.x,f.e||0,f.y]}var w=e.s(o+"percent")||.5;if(w=Math.max(0,Math.min(w,1)),!d||!d.getCache)return!1;var C=d.getCache(),S=C[C.length-1].length,I=(_=t.getLineOffset(r,w*S),_.point);return[I.x,I.y,I.z]},$f=function(){var t={center:function(t,e,i,n,r){var o=-e[1]/2,a={x:-e[0]/2,y:o,width:e[0],height:e[1]},s=la(t,a,i);return[s.x+n,-s.y-r,ef()]},front:function(t,e,i,n,r){var o=-e[1]/2,a={x:-e[0]/2,y:o,width:e[0],height:e[1]},s=la(t,a,i);return[s.x+n,-s.y-r,e[2]/2+ef()]},back:function(t,e,i,n,r){var o=-e[0]/2,a=-e[1]/2,s={x:o,y:a,width:e[0],height:e[1]},l=la(t,s,i);return[-l.x-n,-l.y-r,-e[2]/2-ef()]},left:function(t,e,i,n,r){var o=-e[1]/2,a={x:-e[2]/2,y:o,width:e[2],height:e[1]},s=la(t,a,i);return[-e[0]/2-ef(),-s.y-r,s.x+n]},right:function(t,e,i,n,r){var o=-e[2]/2,a=-e[1]/2,s={x:o,y:a,width:e[2],height:e[1]},l=la(t,s,i);return[e[0]/2+ef(),-l.y-r,-l.x-n]},top:function(t,e,i,n,r){var o={x:-e[0]/2,y:-e[2]/2,width:e[0],height:e[2]},a=la(t,o,i);return[a.x+n,e[1]/2+ef(),a.y+r]},bottom:function(t,e,i,n,r){var o=-e[2]/2,a={x:-e[0]/2,y:o,width:e[0],height:e[2]},s=la(t,a,i);return[s.x+n,-e[1]/2-ef(),-s.y-r]}};return function(e,i,n,r,o,a){return t[r](e,i,n,o||0,a||0)}}(),tg=function(t,e,i,n,r,o,a,s,l,c){if(r&&(e[0]+=r[0],e[1]+=r[1],e[2]+=r[2]),cf(t,i),s){var h=Pl();if(cu(h,l,c),kl(e,h),cf(t,e),t.auto=s,t.pos=kl([0,0,0],t),o){var u=t.mat2=Pl();cu(u,o,a)}}else cu(t,l,c),cf(t,e),n===gt?Ll(t,-j):n===pt?Ll(t,j):n===vt?Bl(t,-j):n===_t?Bl(t,j):n===ft&&Ll(t,L),cu(t,o,a);return t},eg=function(t,e){var i=e.auto,n=e.mat2,r=t.gv;if(i){var o,a=Pl(),s=[0,0,0,0];o="string"==typeof i?[i.indexOf("x")<0?r._eye[0]:r._center[0],i.indexOf("y")<0?r._eye[1]:r._center[1],i.indexOf("z")<0?r._eye[2]:r._center[2]]:r._eye,vf(s,df(Pl(),o,r._center,r._up)),_f(a,pf(s,s),e.pos),n&&uf(a,a,n),Zf(r,a)}else Zf(r,e)},ig=function(t,e,i,n,r){var o=t.s,a=t.gv,s=a.getGL(),l=a._prg,c=a._buffer,h=a._1O;xf(s,mo,h),eg(t,i),zf(s,l,o(e+".blend"),o(e+".light"),o(e+".opacity"),o(e+".reverse.flip"),o(e+".reverse.color"),o(e+".reverse.cull")),Af(s,l,h,r,c.uv,Gg),Hf(s,c.vs,n,l.aPosition),Hf(s,c.ns,Ug,l.aNormal),Uf(s,c.is,Wg),Ff(s,0,Wg.length),Vf(s,l,h),kf(s,l),Qf(a)},ng=function(t,e,i){var n=t.gv,r=t.data,o=t[e]={blend:n.getBodyColor(r)||n.getFaceBlend(r,e),light:n.getFaceLight(r,e),color:n.getFaceColor(r,e),opacity:n.getFaceOpacity(r,e),transparent:n.getFaceTransparent(r,e),reverseFlip:n.getFaceReverseFlip(r,e),reverseColor:n.getFaceReverseColor(r,e),reverseCull:n.getFaceReverseCull(r,e),texture:n.getFaceImage(r,e),blendTexture:n.getFaceBlendImage(r,e),discardSelectable:n.getFaceDiscardSelectable(r,e)};if("csg"!==e){o.uv=n.getFaceUv(r,e)||i&&i[e+"Uv"],o.uvScale=n.getFaceUvScale(r,e)||i&&i[e+"UvScale"],o.uvOffset=n.getFaceUvOffset(r,e)||i&&i[e+"UvOffset"];var a=n.getFaceMat(r,e);if(a){var s=jl(r,a);r.appendAnchorMatrix3d(s),o.mat=s}}return o},rg=function(t,e,i,n,r){var o=t[n];if(o){if(!r(o.transparent))return;var a=t.data,s=t.gv,l=s._buffer,c=s.getTexture(o.texture,a,n),h=s.getTexture(o.blendTexture,a);Af(e,i,c,o.discardSelectable,l.uv,o.tuv,o.uvOffset,o.uvScale,h),zf(e,i,o.blend,o.light,o.opacity,o.reverseFlip,o.reverseColor,o.reverseCull),o.cs&&!s._batchColorDisabled?(Nf(e,i.uBatchColor,!0),qf(e,i.aBatchColor),Hf(e,l.batchColor,o.cs,i.aBatchColor,4)):Nf(e,i.uDiffuse,o.color||d["color.empty"]),Hf(e,l.vs,o.vs,i.aPosition),Hf(e,l.ns,o.ns,i.aNormal),Lf(e,0,o.vs.length/3),o.cs&&!s._batchColorDisabled&&(Nf(e,i.uBatchColor,!1),Xf(e,i.aBatchColor)),kf(e,i),Vf(e,i,c)}},og=function(t,e,i,n,r,o){var a,s,l,c,h,u,d,f,g,p,v=[n-e,r-i],_=t?t.length:0;for(s=0;_>s;s++){for(l=2,a=t[s],c=a[0],h=a[1];l+1<a.length;){if(u=a[l],d=a[l+1],ar(e,i,n,r,c,h,u,d,!0)){f=[u-c,d-h],g=nl(f),f[0]/=g,f[1]/=g,g=El(v,f),g=g>0?o:-o,p=[f[0]*g,f[1]*g];break}c=u,h=d,l+=2}if(p)break}if(p)for(n=e+p[0],r=i+p[1],s=0;_>s;s++)for(l=2,a=t[s],c=a[0],h=a[1];l+1<a.length;){if(u=a[l],d=a[l+1],ar(e,i,n,r,c,h,u,d,!0))return[0,0];c=u,h=d,l+=2}return p||[n-e,r-i]},ag=c.graph3d={},sg=function(t,e,i){bl(a+".graph3d."+t,e,i)},lg="~<yfusfw!+!yjsubNQv!>!opjujtpQ`mh\v!gjeof$!\v~<fdobutjEfojMb!>!fdobutjEfojMw|*itbEv)gj\v!ITBE!gfegj$!\v\v!gjeof$!\v~<ttfouihjsCidubCb!>!ttfouihjsCidubCw|*ttfouihjsCidubCv)gj\v!TTFOUIHJSCIDUBC!gfegj$!\v\v!gjeof$!\v~<eofmCidubCb!>!eofmCidubCw|*eofmCidubCv)gj\v!EOFMCIDUBC!gfegj$!\v\v!gjeof$!\v~<spmpDidubCb!>!spmpDidubCw|*spmpDidubCv)gj\v!SPMPDIDUBC!gfegj$!\v~<wVb!>!wVs|*fsvuyfUeofmCv)gj\v~<x{/fmbdTuftggPv!+!wVb!,!zy/fmbdTuftggPv!>!wVw|*fsvuyfUv)gj<*opjujtpQb)4dfw!>!opjujtpQw~<**1/2!-opjujtpQb)5dfw!+!yjsubNNv)4dfw!>!emspXw<*yfusfw)4dfw!>!yfusfWw<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw|*ldjQva!%%!yjGva)gj<*1/2!-opjujtpQb)5dfw!+!yjsubNWNv!>!yfusfw!5dfw|!*ejpw)ojbn!ejpw\v!gjeof$!\v<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEfojMb!ubpmg!fuvcjsuub<itbEv!mppc!nspgjov\v!ITBE!gfegj$!\v\v!gjeof$!\v<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov\v!1!?!UPQT`YBN!gj$!\v\v!gjeof$!\v<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov\v!1!?!UOJPQ`YBN!gj$!\v\v!gjeof$!\v<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov\v!1!?!SJE`YBN!gj$!\v\v!gjeof$!\v<eofmCidubCw!4dfw!hojzsbw<eofmCidubCb!4dfw!fuvcjsuub<eofmCidubCv!mppc!nspgjov\v!EOFMCIDUBC!gfegj$!\v\v!gjeof$!\v<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCb!ubpmg!fuvcjsuub<ttfouihjsCidubCv!mppc!nspgjov\v!TTFOUIHJSCIDUBC!gfegj$!\v\v!gjeof$!\v<spmpDidubCw!5dfw!hojzsbw<spmpDidubCb!5dfw!fuvcjsuub<spmpDidubCv!mppc!nspgjov\v!SPMPDIDUBC!gfegj$!\v<opjujtpQw!4dfw!hojzsbw<emspXw!4dfw!hojzsbw<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<yjGv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjsubNxfjWv!5ubn!nspgjov<yjsubNOv!5ubn!nspgjov<yjsubNQv!5ubn!nspgjov<yjsubNNv!5ubn!nspgjov<yjsubNWNv!5ubn!nspgjov<opjujtpQb!4dfw!fuvcjsuub<mbnspOb!4dfw!fuvcjsuub<wVs!3dfw!hojzsbw<wVw!3dfw!hojzsbw<wVb!3dfw!fuvcjsuub<fmbdTuftggPv!5dfw!nspgjov<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov!YJGFSQ^#CBRBEJxTT87hJFI,,bX1XrIwcn3UM{ZeZ,M6HEN6nLxe2Z72s2:3johr6foKrpqwxNKYkdbJ2CN[mBbf[wXU,T0oGuSEd190ohLZkEn8IuCe[OHoWeKz:Sf,VS7xdSLw23W1YJLU:jdv2{hiDbhDzNNEh9tp3xsuEp94Sl4c3wRzqwShMDRhCLRjCDEBOH5BBVRBCFRE4cJTHrTDH1BNgHJN",cg="~~<eJ!>!spmpDhbsG`mh\v~<spmpDsfmqnbTwv!>+!eJ<*wVs!-sfmqnbTeofmCv)E3fsvuyfu!>!spmpDsfmqnbTwv!5dfw|!*fsvuyfUeofmCv)!gj!\v\v!gjeof$!\v~<ttfouihjsCidubCw!>+!chs/eJ!!!|*ttfouihjsCidubCv)gj\v!TTFOUIHJSCIDUBC!gfegj$!\v~<ttfouihjsCv!>+!chs/eJ!!!|*1/2!>a!ttfouihjsCv)gj~~<zujdbqPusbQv!>+!b/eJ!!!|*1/2!>a!zujdbqPusbQv)gj~\v!gjeof$!\v~<zujwjudfmgfSv!+!{zy/spmpDwof!>,!chs/eJ<*!spmpDwof!)sbfojMpUmfyfUqbNwof!>!spmpDwof<*!*!{z/dfWudfmgfs!-y/dfWudfmgfs)4dfw!-qbNwoFv!)fcvDfsvuyfu!>!spmpDwof!5dfw<*!mbnspOemspx!-yfusfWpUbsfnbd!)udfmgfs!>!dfWudfmgfs!4dfw<*!yjsubNxfjWv!-O!)opjudfsjEnspgtobsUftsfwoj!>!mbnspOemspx!4dfw<*!opjujtpQbsfnbDv!.!emspXw!)f{jmbnspo!>!yfusfWpUbsfnbd!4dfw|*qbNwoFftVv)!gj\v!QBNWOF`FTV!gfegj$!\v\v!gjeof$!\v<*spudbGhpg!-*x/eJ!-chs/spmpDhpGv)5dfw!-eJ)yjn!>!eJ<*iuqfe!-sbGhpGv!-sbfOhpGv)qfutiuppnt!>!spudbGhpg!ubpmg<x/esppDhbsG`mh0{/esppDhbsG`mh!>!iuqfe!ubpmg\v!HPG!gfegj$!\v\v!gjeof$!\v~~~~<chs/^j]spmpDupqTv!+!udfggFupqt!+!fhobSm!+!*1/1!-*mbnspOm.!-O)upe)ybn!>,!chs/eJ<*1/1!-*^j]uofopqyFupqTv!-udfggFupqt)xpq)ybn!>!udfggFupqt|*^j]fmhoBupqTv!?!udfggFupqt)gj<*mbnspOm!-^j]opjudfsjEupqTv)upe!>!udfggFupqt!ubpmg<*spudfWm)f{jmbnspo!>!mbnspOm!4dfw|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSupqTv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSupqTv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQupqTv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDupqTv)gj|!*,,j!<UPQT`YBN!=!j!<1>j!uoj)spg\v!1!?!UPQT`YBN!gj$!\v\v!gjeof$!\v~~~<chs/^j]spmpDuojpQv!+!fhobSm!+!*1/1!-**spudfWm)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSuojpQv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSuojpQv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQuojpQv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDuojpQv)gj|!*,,j!<UOJPQ`YBN!=!j!<1>j!uoj)spg\v!1!?!UOJPQ`YBN!gj$!\v\v!gjeof$!\v~~<chs/^j]spmpDsjEv!+!*1/1!-**^j]opjudfsjEsjEv)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!>>!x/^j]spmpDsjEv)gj|!*,,j!<SJE`YBN!=!j!<1>j!uoj)spg\v!1!?!SJE`YBN!gj$!\v~<chs/spmpDuihjmebfIv!+!nsfUusfcnbm!>+!chs/eJ~<*1/2!-fhobSuihjmebfIv0*yfusfWw)iuhofm)ojn!.!1/2!!>+!nsfUusfcnbm|*1/1!?!fhobSuihjmebfIv)gj<*1/1!-zujtofuoJuofjcnBuihjmebfIv!,!*zujtofuoJuofjcnBuihjmebfIv!.!1/2)!+!*M.!-O)upe)ybn!>!nsfUusfcnbm!ubpmg|*1/1!>>!x/spmpDuihjmebfIv)gj|*uihjMv)gj~\v!gjeof$!\v~<spmpDeofmCv!>+!eJ|*eofmCv)gj\v!ftmf$!\v~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf~<eofmCidubCw!>+!chs/eJ|*eofmCidubCv)gj\v!EOFMCIDUBC!gfegj$!\v~\v~<esbdtje|*1/1!>>!x/eJ)gj\v!gjeof$!\v<ftvggjEv!>!eJ\v!ftmf$!\v~<ftvggjEv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj\v!SPMPDIDUBC!gfegj$!\v|ftmf~<spmpDwv!>!eJ|*fsvuyfUv)gj|!ftmf~<spmpDftsfwfSldjQyjGv!>!eJ|*qjmGftsfwfSva!%%!ldbCtj)gj~<fvsu!>!ldbCtj<O.!>!O|*1/1!=!*O!-F)upe)gj<ftmbg!>!ldbCtj!mppc<F.!>!M!4dfw\v!gjeof$!\v<*yfusfWw.)f{jmbnspo!>!F!4dfw\v!ftmf$!\v<*2!-1!-1)4dfw!>!F!4dfw\v!DJIQBSHPIUSP!gfegj$!\v<*mbnspOw)f{jmbnspo!>!O!4dfw|!ftmf~\v!gjeof$!\v~~<ftvggjEv!>!eJ|ftmf~<esbdtje|*1/1!>>!x/ftvggjEv)gj|!*!fdobutjEitbEv!?!*!fdobutjEqbHitbEv!-fdobutjEfojMw!)epn!%%!itbEv)!gj\v!ITBE!gfegj$!\v\v!gjeof$!\v<spmpDftsfwfSldjQyjGv!>!eJ\v!ftmf$!\v~<spmpDftsfwfSldjQyjGv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj\v!SPMPDIDUBC!gfegj$!\v|*yjGv)gj<eJ!5dfw|ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDhbsG`mh)!gj\v!gjeof$!\v<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh\v!ftmf$!\v~<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh|ftmf~<spmpDidubCw!>!spmpDhbsG`mh|*spmpDidubCv)gj\v!SPMPDIDUBC!gfegj$!\v|*ldjQv)gj~~!<esbdtje!|!**sje!-*uofdsfQqjmDv)4dfw)upe!?!*opjujtpQw!-sje)upe)!gj~!<1/2.!>!{/sje!|!*8!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2!>!{/sje!|!*7!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2.!>!z/sje!|!*6!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2!>!z/sje!|!*5!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2.!>!y/sje!|!*4!=!opjudfsjEqjmDv)!gj!ftmf~!<1/2!>!y/sje!|!*3!=!opjudfsjEqjmDv)!gj<*1/1!-1/1!-1/1)4dfw!>!sje!4dfw|!*1!?!opjudfsjEqjmDv)!gj~~~!<esbdtje!|!*utfUbiqmBv!>=!b/spmpDwv)!gj!!!!|!ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDwv)!gj!!!!|!*uofsbqtobsUv)!gj<*wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv|**fmcbudfmfTesbdtjEv!%%!ldjQv)a!%%!fsvuyfUv)gj<spmpDwv!5dfw|!*ejpw)ojbn!ejpw~<*!{zy/*!yjsubn!+!*!1/1!-sje!)5dfw!)!)f{jmbnspo!osvufs|!*!yjsubn!5ubn!oj!-sje!4dfw!oj!)opjudfsjEnspgtobsUftsfwoj!4dfw~!<*!*!SPUDBG`BNNBH!)ubpmg!-fvmbw!)sbfojMpUbnnbH!osvufs!|!*!fvmbw!5dfw!)sbfojMpUmfyfUqbNwof!5dfw~<*!x/fvmbw!-*!*!spudbGbnnbh!)4dfw!-{zy/fvmbw!)xpq!)5dfw!osvufs|!*!spudbGbnnbh!ubpmg!oj!-fvmbw!5dfw!oj!)sbfojMpUbnnbH!5dfw<1/3!>!SPUDBG`BNNBH!ubpmg!utopd\v!gjeof$!\v<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEqbHitbEv!ubpmg!nspgjov<fdobutjEitbEv!ubpmg!nspgjov<itbEv!mppc!nspgjov\v!ITBE!gfegj$!\v\v!gjeof$!\v<sbGhpGv!ubpmg!nspgjov<sbfOhpGv!ubpmg!nspgjov<spmpDhpGv!5dfw!nspgjov\v!HPG!gfegj$!\v\v!gjeof$!\v<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]fhobSupqTv!ubpmg!nspgjov<^UPQT`YBN]fmhoBupqTv!ubpmg!nspgjov<^UPQT`YBN]uofopqyFupqTv!ubpmg!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov\v!1!?!UPQT`YBN!gj$!\v\v!gjeof$!\v<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]fhobSuojpQv!ubpmg!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov\v!1!?!UOJPQ`YBN!gj$!\v\v!gjeof$!\v<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov\v!1!?!SJE`YBN!gj$!\v\v!gjeof$!\v<eofmCidubCw!4dfw!hojzsbw<eofmCidubCv!mppc!nspgjov\v!EOFMCIDUBC!gfegj$!\v\v!gjeof$!\v<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCv!mppc!nspgjov\v!TTFOUIHJSCIDUBC!gfegj$!\v\v!gjeof$!\v<spmpDidubCw!5dfw!hojzsbw<spmpDidubCv!mppc!nspgjov\v!SPMPDIDUBC!gfegj$!\v<spmpDuihjmebfIv!5dfw!nspgjov<zujtofuoJuofjcnBuihjmebfIv!ubpmg!nspgjov<fhobSuihjmebfIv!ubpmg!nspgjov<emspXw!4dfw!hojzsbw<opjujtpQbsfnbDv!4dfw!nspgjov<yjsubNxfjWv!5ubn!nspgjov\v!gjeof$!\v<zujwjudfmgfSv!ubpmg!nspgjov<qbNwoFv!fcvDsfmqnbt!nspgjov<qbNwoFftVv!mppc!nspgjov\v!QBNWOF`FTV!gfegj$!\v<opjujtpQw!4dfw!hojzsbw<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<ftvggjEv!5dfw!nspgjov<zujdbqPusbQv!ubpmg!nspgjov<ttfouihjsCv!ubpmg!nspgjov<uihjMv!mppc!nspgjov<spmpDeofmCv!5dfw!nspgjov<eofmCv!mppc!nspgjov<uofdsfQqjmDv!ubpmg!nspgjov<opjudfsjEqjmDv!uoj!nspgjov<wVs!3dfw!hojzsbw<sfmqnbTeofmCv!E3sfmqnbt!nspgjov<sfmqnbTv!E3sfmqnbt!nspgjov<wVw!3dfw!hojzsbw<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov<uofsbqtobsUv!mppc!nspgjov<utfUbiqmBv!ubpmg!nspgjov<spmpDftsfwfSldjQyjGv!5dfw!nspgjov<qjmGftsfwfSv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjGv!mppc!nspgjov<fmcbudfmfTesbdtjEv!mppc!nspgjov!YJGFSQ\v!gjeof$!\v\v!gjeof$!\v\v!<ubpmg!qnvjefn!opjtjdfsq!\v\v!ftmf$!\v\v!<ubpmg!qihji!opjtjdfsq!\v\v!IHJI`OPJTJDFSQ`UOFNHBSG`MH!gfegj$!\v\v!TF`MH!gfegj$!\v";Qn(u,{setBatchInfo:function(t,e){Xi[t]=e},getBatchInfo:function(t){return Xi[t]},getBatchInfoMap:function(){return Xi},setBatchInfoMap:function(t){Xi=t}},!0);var hg=[1,1,1],ug=[1,0,0,0,0,1,0,1,1,1,1,0],dg=[-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5],fg=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5],gg=[.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5],pg=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5],vg=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5],_g=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5],yg=function(t,e){mg(t,e,"_batchModelMap","_batchIndexMap"),bg(t,e,"_wireframeModelMap","_wireframeIndexMap"),bg(t,e,"_polylineModelMap","_polylineIndexMap"),bg(t,e,"_wireframeModelMapSwap","_wireframeIndexMapSwap"),bg(t,e,"_polylineModelMapSwap","_polylineIndexMapSwap")},mg=function(t,e,i,n){if(!e)return t[i]={},void(t[n]={});var r=e._id,o=t[n],a=o[r];if(a){var s=t[i],l=a.batch,c=s[l],h=c.ds,u=a.index;if(c.invalidate=!0,delete o[r],h.splice(u,1),tr(h))return void delete s[l];for(var d=a.begin,f=a.size,g=3*d,p=3*f,v=4*d,_=4*f,y=c.vs,m=c.ps,b=c.uv,x=c.cs,w=c.bs,C=c.rs,S=c.ns,I=c.ls;u<h.length;u++)a=o[h[u]._id],a.index--,a.begin-=f;y.splice(g,p),m.splice(v,_),b&&b.splice(2*d,2*f),x&&x.splice(v,_),w&&w.splice(g,p),C&&C.splice(d,f),S&&S.splice(g,p),I&&I.splice(d,f)}},bg=mg,xg=function(t,e,i,n){if(!n)return l;var r=e[n];if(!r){var o=Xi[n]||an,a=o.image?[]:l;r=e[n]={vs:[],ns:[],uv:a,cs:a||o.color?l:[],bs:o.blend?[]:l,ps:[],rs:o.brightness?[]:l,ds:[]}}return r.invalidate=!0,t[i._id]={index:r.ds.length,begin:r.vs.length/3,batch:n},r.ds.push(i),r},wg=function(t,e){return e!=l&&1!==e?[t[0]*e,t[1]*e,t[2]*e,t[3]]:t},Cg=function(){var t;return function(e,n,r){var o=e.getData3dUI(n),a=o.shapeModel;if(a||(a=pp(o)),a||!o.shapeName){var s,l=n.s("wf.combineTriangle");if(r.geometry){if(!a&&(n instanceof c.Node&&!(n instanceof c.Shape)?(t||(t={vs:Ng,is:qg,uv:Xg}),a=t):a=[o.left,o.front,o.right,o.back,o.top,o.bottom],!a))return i;if(l?(l=0|Math.min(3,Math.max(1,isNaN(l)?1:l)),s=ph[l-1](a)):s=vh(a),!s||0===s.length)return}else s=r.short?Jg:Zg;var h=e.getBrightness(n),u=Co(r.color||"white"),d=u[3]<1,f=Math.ceil(r.width)||1,g=(d?"T":"O")+f,p=e._wireframeIndexMap,v=e._wireframeModelMap,_=v[g];_||(_=v[g]={vs:[],cs:[],ps:[],ds:[],T:d,W:f}),_.invalidate=!0;var y=_.vs,m=_.cs,b=_.ds,x=p[n._id]={index:b.length,begin:y.length/3,batch:g};b.push(n);var w=o.mat;n instanceof c.Edge||!(!w||!r.geometry&&n instanceof c.Shape)||(w=jl(n,r.mat),n.appendAnchorMatrix3d(w)),Jd(y,w,s);var C=x.size=y.length/3-x.begin;Zd(m,wg(u,h),C)}}}(),Sg=function(t,e,i,n,r,o,a,s,c){var h=t.getBrightness(e);h==l&&(h=1);var u=wg(Co(n),h),d=u[3]<1;o=Math.ceil(o)||1;var f=(d?"T":"O")+o;if(a){var g=a[0],p=(a[1]||g)+g;f+="-"+g+"-"+p,c&&(f+="-"+wo(c)+"-"+h,c=wg(Co(c),h))}var v=t._polylineIndexMap,_=t._polylineModelMap,y=_[f];y||(y=_[f]={vs:[],cs:[],ps:[],ds:[],ls:a?[]:l,T:d,W:o},a&&(y.D=g,y.G=p,y.A=c)),y.invalidate=!0;var m,b=y.vs,x=y.cs,w=y.ds,C=y.ls,S=v[e._id]={index:w.length,begin:b.length/3,batch:f};w.push(e),qn(b,i);var I,M=S.size=b.length/3-S.begin,T=i.length,E=0,P=[];if(a||r)for(m=0;T>m;m+=6)I=nl([i[m],i[m+1],i[m+2]],[i[m+3],i[m+4],i[m+5]]),P.push(I),E+=I;if(E&&r){var D,O=wg(Co(r),h),R=[O[0]-u[0],O[1]-u[1],O[2]-u[2],O[3]-u[3]],z=0;for(m=0;T>m;m+=6)D=z/E,Zd(x,[u[0]+R[0]*D,u[1]+R[1]*D,u[2]+R[2]*D,u[3]+R[3]*D],1),z+=P[m/6],D=z/E,Zd(x,[u[0]+R[0]*D,u[1]+R[1]*D,u[2]+R[2]*D,u[3]+R[3]*D],1)}else Zd(x,u,M);if(a)for(z=s||0,m=0;T>m;m+=6)C.push(z),z+=P[m/6],C.push(z)},Ig=function(t,e,i){if(e)for(var n=4*e.begin,r=i[e.batch].ps,o=0;o<e.size;o++)r[n++]=t[0],r[n++]=t[1],r[n++]=t[2],r[n++]=t[3]},Mg=function(t,e){var i=e+["32"],n=t[e],r=t[i];n?r&&r.length===n.length?(r.set(n),r._bufId=null):t[i]=new Il(n):delete t[i]},Tg=function(t,e,i,n,r,o,a,s,l){if(Vn(i))i.forEach((function(i){Tg(t,e,i,n,r,o,a,s,l)}));else if(On(i))Tg(t,e,pp(n,i),n,r,o,a,s,l);else if(kn(i)){var c,h=dc(i.mat,e,t),u=dc(i.s3,e,t),d=dc(i.t3,e,t),f=dc(i.r3,e,t);if((u||f||d||h)&&(c=Hl(h,u,f,dc(i.rotationMode,e,t),d),o.push(c)),i.shape3d)Tg(t,e,i.shape3d,n,r,o,a,s,i);else{var g=n.s;l=l||an;var p=o[0],v=o.length,_=g("shape3d.color",i.color,l.color);if(r||(r=g("shape3d.blend",i.blend,l.blend)),v>1){p=Ol(p);for(var y=1;v>y;y++)uf(p,p,o[y])}i.vs&&g(Xe,i.visible,l.visible)&&Eg(p,a,s,i.vs,i.uv,i.is,r,_),i.top_vs&&g(Ze,i.topVisible,l.topVisible)&&Eg(p,a,s,i.top_vs,i.top_uv,i.top_is,r,g("shape3d.top.color",i.topColor,l.topColor)||_),i.bottom_vs&&g(Je,i.bottomVisible,l.bottomVisible)&&Eg(p,a,s,i.bottom_vs,i.bottom_uv,i.bottom_is,r,g("shape3d.bottom.color",i.bottomColor,l.bottomColor)||_),i.from_vs&&g(Qe,i.fromVisible,l.fromVisible)&&Eg(p,a,s,i.from_vs,i.from_uv,i.from_is,r,g("shape3d.from.color",i.fromColor,l.fromColor)||_),i.to_vs&&g(Ye,i.toVisible,l.toVisible)&&Eg(p,a,s,i.to_vs,i.to_uv,i.to_is,r,g("shape3d.to.color",i.toColor,l.toColor)||_)}c&&o.pop()}},Eg=function(t,e,i,n,r,o,a,s){var l,c=e.cs,h=e.uv,u=e.bs;if(o){l=o.length;for(var d=0;l>d;d++){var f=o[d];Jd(i,t,[n[3*f],n[3*f+1],n[3*f+2]]),h&&qn(h,[r[2*f],r[2*f+1]])}}else l=n.length/3,Jd(i,t,n),h&&qn(h,r);c&&Zd(c,s,l),u&&(a?Yd(u,a,l):qn(u,hg,l))},Pg=function(t,e,i,n){var r=[];n?Tg(t.gv,t.data,n,t,t.getBodyColor(),[e],i,r):(Dg(t,gt,e,i,r),Dg(t,pt,e,i,r),Dg(t,dt,e,i,r),Dg(t,ft,e,i,r),Dg(t,vt,e,i,r),Dg(t,_t,e,i,r),Dg(t,"csg",e,i,r)),r.length&&(qn(i.vs,r),qn(i.ns,bf(r)))},Dg=function(t,e,i,n,r){var o=t[e];if(o){var a=o.tuv;if(a){var s,c,h,u,d=o.uvScale,f=o.uvOffset;if(d)for(s=a.length,c=d[0],h=d[1],u=0;s>u;u+=2)a[u]*=c,a[u+1]*=h;if(f)for(s=a.length,c=f[0],h=f[1],u=0;s>u;u+=2)a[u]+=c,a[u+1]+=h}Eg(i,n,r,o.vs,a,l,o.blend,o.color)}},Og=function(t,e,i,n,r,o,a,s){var l,c=i.cs,h=i.uv,u=i.bs;if(t.getFaceVisible(e,o)){var d=t.getFaceMat(e,o);if(d&&(r=jl(e,d)),Jd(a,r,s),c&&Zd(c,t.getFaceColor(e,o),6),h){var f=t.getFaceUv(e,o)||n[o+"Uv"],g=t.getFaceUvScale(e,o)||n[o+"UvScale"],p=t.getFaceUvOffset(e,o)||n[o+"UvOffset"];f=f?[f[6],f[7],f[0],f[1],f[2],f[3],f[2],f[3],f[4],f[5],f[6],f[7]]:ug;var v=f[0],_=f[1],y=f[2],m=f[3],b=f[4],x=f[5],w=f[6],C=f[7],S=f[8],I=f[9],M=f[10],T=f[11];if(g){var E=g[0],P=g[1];v*=E,_*=P,y*=E,m*=P,b*=E,x*=P,w*=E,C*=P,S*=E,I*=P,M*=E,T*=P}if(p){var D=p[0],O=p[1];v+=D,_+=O,y+=D,m+=O,b+=D,x+=O,w+=D,C+=O,S+=D,I+=O,M+=D,T+=O}h.push(v,_,y,m,b,x,w,C,S,I,M,T)}u&&(l=t.getBodyColor(e)||t.getFaceBlend(e,o),l?Yd(u,l,6):qn(u,hg,6))}},Rg=function(t,e,i,n){var r=t.getGL(),o=t._prg,a=t._buffer;if(!t.drawFilter&&!$n(e)){for(var s in Zf(t),Of(r,o),e){var c=e[s];if(!(n&&!c.T||!n&&c.T)){c.invalidate?(c.invalidate=!1,Mg(c,"vs"),Mg(c,"cs"),Mg(c,"ls"),Mg(c,"ps")):i&&Mg(c,"ps");var h=c.vs32,u=i?c.ps32:c.cs32;Bf(r,o,c.W,l,a.vs,h);var f=c.D,g=!t._dashDisabled&&f;Nf(r,o.uAlphaTest,d.alphaTest),g&&(Nf(r,o.uDash,!0),Nf(r,o.uDashDistance,f),Nf(r,o.uDashGapDistance,c.G),qf(r,o.aLineDistance),Hf(r,a.lineDistance,c.ls32,o.aLineDistance,1),Nf(r,o.uDiffuse,c.A||d["color.empty"]));var p=!t._batchColorDisabled;p&&(Nf(r,o.uBatchColor,!0),qf(r,o.aBatchColor),Hf(r,a.batchColor,u,o.aBatchColor,4)),Af(r),Lf(r,0,h.length/3,r.LINES),Vf(r),p&&(Nf(r,o.uBatchColor,!1),Xf(r,o.aBatchColor)),g&&(Nf(r,o.uDash,!1),Xf(r,o.aLineDistance))}}Rf(r,o)}},zg=function(t,e,n){var r,o,a,s,c,h,u,f,g,p,v=t.getGL(),_=t._prg,y=t._buffer,m=t._batchModelMap;if(!$n(m)&&!t.drawFilter)for(r in Zf(t),m)if(o=Xi[r]||an,!(n&&!o.transparent||!n&&o.transparent)&&(a=m[r],e||!o.transparentMask)){var b=n&&!1!==o.autoSort&&(t._33Q||a.invalidate);if(a.invalidate?(a.invalidate=!1,Mg(a,"vs"),Mg(a,"ns"),Mg(a,"cs"),Mg(a,"rs"),Mg(a,"ps"),Mg(a,"bs"),Mg(a,"uv")):e&&Mg(a,"ps"),s=a.vs32,c=e?a.ps32:a.cs32,f=a.uv32,h=a.bs32,u=a.rs32,p=s.length/3,b&&(a.is=kg(s,t.getEye())),p){o.light,g=t.getTexture(o.image),zf(v,_,l,o.light,o.opacity,o.reverseFlip,o.reverseColor,o.reverseCull),c?t._batchColorDisabled||(Nf(v,_.uBatchColor,!0),qf(v,_.aBatchColor),Hf(v,y.batchColor,c,_.aBatchColor,4)):Nf(v,_.uDiffuse,o.color||d["color.empty"]);var x=o.alphaTest;Nf(v,_.uAlphaTest,x===i?d.alphaTest:x),o.envmap!==i?(Nf(v,_.uUseEnvMap,!0),Nf(v,_.uReflectivity,o.envmap)):(Nf(v,_.uUseEnvMap,!1),Nf(v,_.uReflectivity,0));var w=h&&!t._batchBlendDisabled;w&&(Nf(v,_.uBatchBlend,!0),qf(v,_.aBatchBlend),Hf(v,y.batchBlend,h,_.aBatchBlend));var C=u&&!t._batchBrightnessDisabled;C&&(Nf(v,_.uBatchBrightness,!0),qf(v,_.aBatchBrightness),Hf(v,y.batchBrightness,u,_.aBatchBrightness,1)),f?Af(v,_,g,o.discardSelectable,y.uv,f,o.uvOffset,o.uvScale):Af(v),Hf(v,y.vs,s,_.aPosition),Hf(v,y.ns,a.ns32,_.aNormal),a.is?(Gf(v,y.is,a.is),Ff(v,0,p)):Lf(v,0,p),f?Vf(v,_,g):Vf(v),c&&!t._batchColorDisabled&&(Nf(v,_.uBatchColor,!1),Xf(v,_.aBatchColor)),w&&(Nf(v,_.uBatchBlend,!1),Xf(v,_.aBatchBlend)),C&&(Nf(v,_.uBatchBrightness,!1),Xf(v,_.aBatchBrightness)),kf(v,_)}}},kg=function(t,e){for(var i=t.length/3,n=new Array(i),r=i/3,o=new Array(r),a=0;r>a;a++)o[a]=a;o.sort((function(i,n){var r=9*i,o=[(t[r]+t[r+3]+2*t[r+6])/4,(t[r+1]+t[r+4]+2*t[r+7])/4,(t[r+2]+t[r+5]+2*t[r+8])/4];r=9*n;var a=[(t[r]+t[r+3]+2*t[r+6])/4,(t[r+1]+t[r+4]+2*t[r+7])/4,(t[r+2]+t[r+5]+2*t[r+8])/4],s=nl(e,o)-nl(e,a);return s>0?-1:0>s?1:0}));for(a=0;r>a;a++){var s=3*a,l=3*o[a];n[s]=l,n[s+1]=l+1,n[s+2]=l+2}return new Sl(n)},Ag={obj:function(t,e){var i={mat:t.mat,s3:t.s3,r3:t.r3,rotationMode:t.rotationMode,t3:t.t3,cube:t.cube==l||t.cube,center:t.center==l||t.center,ignoreMtls:t.ignoreMtls,ignoreTransparent:t.ignoreTransparent,ignoreColor:t.ignoreColor,ignoreImage:t.ignoreImage,ignoreNormal:t.ignoreNormal,prefix:t.prefix,flipY:t.flipY,flipFace:t.flipFace,reverseFlipMtls:t.reverseFlipMtls,finishFunc:function(i,n){if(i){n=[];for(var r in i){var o=i[r];n.rawS3=o.rawS3,o.center&&(n.center=o.center),n.push(o),t.eachModel&&t.eachModel(r,o)}n.json=t,e(n)}else e()}};u.loadObj(t.obj,t.mtl,i)}};u.getModelTypeHandlers=function(){return Ag},u.setModelTypeHandler=function(t,e){Ag[t]=e},u.getModelTypeHandler=function(t){return Ag[t]},u.handleModelLoaded=function(){},u.handleUnfoundModel=function(){};var Vg=l,Bg=l,Lg=function(t){Vg&&!t._loadingModelView_&&(Bg||(Bg={}),Bg[t._loadingModelView_=Bs()]=t)},Fg=function(t,e){Vg||(Vg={});var i=Vg[t];if(i){if(i.url===e)return;i.request.onload=ln,i.request.onerror=ln}var n=new wu;if(Vg[t]={request:n,url:e},e=u.beforeLoadURL(e),e.data){var r=u.parse(e.data);jg(t,r,e)}else{n.onload=function(){if(200===this.status||0===this.status){delete Vg[t];var i=u.parse(n.getResponseText());jg(t,i,e)}else Hg(t,u.handleUnfoundModel(t,e)||l)},n.onerror=function(){Hg(t,u.handleUnfoundModel(t,e)||l)};var o={};o.url=encodeURI(e),o.sync=!1,n.send(o)}},jg=function(t,e,i){var n=e.modelType;if(!n)return Hg(t,e),void u.handleModelLoaded(t,e);var r=u.getModelTypeHandler(n);if(r){if(Vg||(Vg={}),Vg[t])return;Vg[t]=!0;var o=function(n){n?(Hg(t,n),u.handleModelLoaded(t,n)):Hg(t,u.handleUnfoundModel(t,i,e)||l)};r(e,o)}else Hg(t,u.handleUnfoundModel(t,i,e)||l)},Hg=function(t,e){if(delete Vg[t],On(e)&&en.test(e))Fg(t,e);else{if(Qi[t]=e,$n(Vg)&&(Vg=l,Bg)){for(var n in Bg){var r=Bg[n];r.invalidateAll&&r.invalidateAll(i,"modelLoaded",t),r.redraw&&r.redraw(),r.iv(),delete r._loadingModelView_}Bg=l}if(e&&Bg)for(var n in Bg){r=Bg[n];r.invalidateAll&&r.invalidateAll(i,"modelLoading",t),r.redraw&&r.redraw(),r.iv()}}},Gg=new Il([0,0,0,1,1,1,1,0]),Ug=new Il([0,0,1,0,0,1,0,0,1,0,0,1]),Wg=new Sl([0,1,2,2,3,0]),Ng=new Il([-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),qg=new Sl([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Xg=new Il([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),Qg=bf(Ng,qg),Yg=(new Il([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5]),new Sl([0,1,2,3,0,7,5,4,6,7,5,3,2,4,6,1]),[gt,dt,pt,ft,vt,_t]),Zg=[-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5],Jg=[-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4],Kg=function(t,e,i,n,r,o,a){o=o||16,t=t||16,e=e||0,i=i||t;var s,l,c,h,u,d,f,g,p,v=.5,_=[],y=[],m=F/t,b=L/o;for(s=0;o>s;s++)for(d=s+1,h=s*b,p=d*b,l=e;i>l;l++)f=l+1,c=l*m,g=f*m,_.push(v*k(h)*R(c),v*R(h),-v*k(h)*k(c),v*k(p)*R(g),v*R(p),-v*k(p)*k(g),v*k(h)*R(g),v*R(h),-v*k(h)*k(g),v*k(h)*R(c),v*R(h),-v*k(h)*k(c),v*k(p)*R(c),v*R(p),-v*k(p)*k(c),v*k(p)*R(g),v*R(p),-v*k(p)*k(g)),y.push(l/t,s/o,f/t,d/o,f/t,s/o,l/t,s/o,l/t,d/o,f/t,d/o);if(a){var x=[];for(s=0,u=_.length;u>s;s+=3)x.push(2*_[s],2*_[s+1],2*_[s+2])}if(n){var w=[],C=[];for(c=e*m,s=0;o>s;s++)d=s+1,h=s*b,p=d*b,w.push(0,0,0,v*k(p)*R(c),v*R(p),-v*k(p)*k(c),v*k(h)*R(c),v*R(h),-v*k(h)*k(c)),C.push(0,.5,e/t,d/o,e/t,s/o)}if(r){var S=[],I=[];for(c=i*m,s=0;o>s;s++)d=s+1,h=s*b,p=d*b,S.push(0,0,0,v*k(h)*R(c),v*R(h),-v*k(h)*k(c),v*k(p)*R(c),v*R(p),-v*k(p)*k(c)),I.push(1,.5,i/t,s/o,i/t,d/o)}var M={vs:_,uv:y,from_vs:w,from_uv:C,to_vs:S,to_uv:I};return a&&(M.ns=x),M},$g=function(t,e,i){t=t||.17,e=e||12,i=i||18,0>t?t=0:t>.25&&(t=.25);var n,r,o,a,s,l,c,h=.5,u=[],d=[],f=[],g=F/i,p=F/e,v=h-t;for(r=0;e>=r;r++)for(a=r*p-L,l=R(a),s=k(a),n=0;i>=n;n++)o=n*g,c=v+t*l,u.push(R(o)*c,s*t,-k(o)*c),d.push(n/i,1-r/e);for(r=0;e>r;r++){var _=r*(i+1),y=(r+1)*(i+1);for(n=0;i>n;n++)f.push(_+n,y+n+1,y+n,_+n,_+n+1,y+n+1)}return{vs:u,uv:d,is:f}},tp=function(t,e,n,r,o,a,s,l){s=s||12,t=t||18,e=e||0,n=n||t,a=a||.17,0>a?a=0:a>.25&&(a=.25);var c,h,u,d,f,g,p,v,_,y,m=.5,b=[],x=[],w=F/t,C=F/s,S=m-a,I=l?[]:i;for(u=0;s>u;u++)for(d=u+1,p=u*C-L,v=d*C-L,c=e;n>c;c++)h=c+1,f=c*w,g=h*w,_=S+a*R(p),y=S+a*R(v),b.push(R(f)*_,k(p)*a,-k(f)*_,R(g)*_,k(p)*a,-k(g)*_,R(g)*y,k(v)*a,-k(g)*y,R(f)*_,k(p)*a,-k(f)*_,R(g)*y,k(v)*a,-k(g)*y,R(f)*y,k(v)*a,-k(f)*y),x.push(c/t,1-u/s,h/t,1-u/s,h/t,1-d/s,c/t,1-u/s,h/t,1-d/s,c/t,1-d/s),l&&I.push(R(f)*R(p),k(p),-k(f)*R(p),R(g)*R(p),k(p),-k(g)*R(p),R(g)*R(v),k(v),-k(g)*R(v),R(f)*R(p),k(p),-k(f)*R(p),R(g)*R(v),k(v),-k(g)*R(v),R(f)*R(v),k(v),-k(f)*R(v));if(r){var M=[],T=[];for(u=0;s>u;u++)d=u+1,p=u*C-L,v=d*C-L,f=e*w,_=S+a*R(p),y=S+a*R(v),M.push(R(f)*_,k(p)*a,-k(f)*_,R(f)*y,k(v)*a,-k(f)*y,R(f)*S,0,-k(f)*S),T.push(.5+.5*R(p),.5-.5*k(p),.5+.5*R(v),.5-.5*k(v),.5,.5)}if(o){var E=[],P=[];for(u=0;s>u;u++)d=u+1,p=u*C-L,v=d*C-L,f=n*w,_=S+a*R(p),y=S+a*R(v),E.push(R(f)*_,k(p)*a,-k(f)*_,R(f)*S,0,-k(f)*S,R(f)*y,k(v)*a,-k(f)*y),P.push(.5-.5*R(p),.5-.5*k(p),.5,.5,.5-.5*R(v),.5-.5*k(v))}var D={vs:b,uv:x,from_vs:M,from_uv:T,to_vs:E,to_uv:P};return l&&(D.ns=I),D},ep=function(t,e){for(var i,n,r,o=.5,a=16,s=[],l=[],c=[],h=F/a,u=0;a>=u;u++)i=u*h,n=R(i)*o,r=k(i)*o,s.push(n,-o,r,n,o,r),l.push(1-u/a,1,1-u/a,0);for(u=0;a>u;u++)c.push(2*u,2*u+1,2*u+3,2*u,2*u+3,2*u+2);if(e){var d=[],f=[],g=[];for(d.push(0,-o,0),f.push(.5,.5),u=0;a>=u;u++)i=u*h,n=R(i),r=k(i),d.push(n*o,-o,-r*o),f.push(.5+.5*n,.5+.5*r);for(u=0;a>u;u++)g.push(0,u+2,u+1)}if(t){var p=[],v=[],_=[];for(p.push(0,o,0),v.push(.5,.5),u=0;a>=u;u++)i=u*h,n=R(i),r=k(i),p.push(n*o,o,-r*o),v.push(.5+.5*n,.5-.5*r);for(u=0;a>u;u++)_.push(0,u+1,u+2)}return{vs:s,uv:l,is:c,bottom_vs:d,bottom_uv:f,bottom_is:g,top_vs:p,top_uv:v,top_is:_}},ip=function(t,e,i,n,r,o,a,s){t=t||12,e=e||0,i=i||t;for(var l,c,h,u,d,f,g,p,v,_=.5,y=[],m=[],b=F/t,x=e;i>x;x++)l=x+1,c=x*b,h=l*b,u=R(c)*_,d=k(c)*_,f=R(h)*_,g=k(h)*_,y.push(u,-_,-d,f,-_,-g,u,_,-d,f,-_,-g,f,_,-g,u,_,-d),m.push(x/t,1,l/t,1,x/t,0,l/t,1,l/t,0,x/t,0);if(s){var w=[];for(x=0,v=y.length;v>x;x+=3)w.push(2*y[x],0,2*y[x+2])}if(a){var C=[],S=[];for(x=e;i>x;x++)c=b*x,h=b*(x+1),u=R(c),d=k(c),f=R(h),g=k(h),C.push(u*_,-_,-d*_,0,-_,0,f*_,-_,-g*_),S.push(.5+.5*u,.5+.5*d,.5,.5,.5+.5*f,.5+.5*g)}if(o){var I=[],M=[];for(x=e;i>x;x++)c=b*x,h=b*(x+1),u=R(c),d=k(c),f=R(h),g=k(h),I.push(u*_,_,-d*_,f*_,_,-g*_,0,_,0),M.push(.5+.5*u,.5-.5*d,.5+.5*f,.5-.5*g,.5,.5)}if(n){var T=[],E=[];c=b*e,u=R(c)*_,d=k(c)*_,p=e/t,T.push(0,_,0,0,-_,0,u,-_,-d,u,-_,-d,u,_,-d,0,_,0),E.push(0,0,0,1,p,1,p,1,p,0,0,0)}if(r){var P=[],D=[];c=b*i,u=R(c)*_,d=k(c)*_,p=i/t,P.push(0,-_,0,0,_,0,u,_,-d,u,_,-d,u,-_,-d,0,-_,0),D.push(1,1,1,0,p,0,p,0,p,1,1,1)}var O={vs:y,uv:m,bottom_vs:C,bottom_uv:S,top_vs:I,top_uv:M,from_vs:T,from_uv:E,to_vs:P,to_uv:D};return s&&(O.ns=w),O},np=function(t,e,i,n,r){e=e||18,i=i||0,n=n==l?F:n,r=r==l?.5:r;for(var o,a,s,c,h,u,d=[0,.5,.75,.875,.9375],f=[],g=[],p=[],v=n/e,_=0;_<d.length;_++){var y=0===_%2?0:.5;for(o=0;e>=o;o++)a=(o+y)*v+i,s=1-d[_],f.push(R(a)*r*s,-r+2*d[_]*r,-k(a)*r*s),g.push((o+y)/e,s)}for(_=0;_<d.length-1;_++){var m=_*(e+1),b=(_+1)*(e+1);for(o=0;e>o;o++)p.push(m+o,b+o+1,b+o,m+o,m+o+1,b+o+1)}for(u=f.length/3-(e+1),o=0;e>o;o++)f.push(0,r,0),g.push((o+.5)/e,0);for(o=0;e>o;o++)p.push(u+o,u+o+1,u+(e+1)+o);if(t){var x=[],w=[],C=[];for(x.push(0,-r,0),w.push(.5,.5),o=0;e>=o;o++)a=o*v+i,c=R(a),h=k(a),x.push(c*r,-r,-h*r),w.push(.5+.5*c,.5+.5*h);for(o=0;e>o;o++)C.push(0,o+2,o+1)}return{vs:f,uv:g,is:p,bottom_vs:x,bottom_uv:w,bottom_is:C}},rp=function(t,e,i,n,r,o){t=t||16,e=e||0,i=i||t;for(var a=.5,s=[],l=[],c=F/t,h=e;i>h;h++){var u=h+1,d=c*h,f=c*u;s.push(R(d)*a,-a,-k(d)*a,R(f)*a,-a,-k(f)*a,0,a,0),l.push(h/t,1,u/t,1,(h+u)/2/t,0)}if(o){var g=[],p=[];for(h=e;i>h;h++){d=c*h,f=c*(h+1);var v=R(d),_=k(d),y=R(f),m=k(f);g.push(v*a,-a,-_*a,0,-a,0,y*a,-a,-m*a),p.push(.5+.5*v,.5+.5*_,.5,.5,.5+.5*y,.5+.5*m)}}if(n){var b=[],x=[];d=c*e,b.push(0,a,0,0,-a,0,R(d)*a,-a,-k(d)*a),x.push(0,0,0,1,e/t,1)}if(r){var w=[],C=[];d=c*i,w.push(0,-a,0,0,a,0,R(d)*a,-a,-k(d)*a),C.push(1,1,1,0,i/t,1)}return{vs:s,uv:l,bottom_vs:g,bottom_uv:p,from_vs:b,from_uv:x,to_vs:w,to_uv:C}},op=function(t,e,i,n,r,o,a,s){for(var l=[],c=0;c<t.length-1;c+=2)l.push({x:t[c],y:t[c+1]});return _h(l,e,i,n,r,o,a,s,!1)},ap={roundRect:function(t,e){return op([.5,.4,.5,.442,.471,.471,.442,.5,.4,.5,-.4,.5,-.442,.5,-.471,.471,-.5,.442,-.5,.4,-.5,-.4,-.5,-.442,-.471,-.471,-.442,-.5,-.4,-.5,.4,-.5,.442,-.5,.471,-.471,.5,-.442,.5,-.4,.5,.4],[1,3,3,2,3,3,2,3,3,2,3,3,2],t,e,3)},star:function(t,e){return op([.193,.079,.333,.5,0,.233,-.333,.5,-.194,.079,-.5,-.167,-.112,-.167,0,-.5,.111,-.167,.5,-.167],[1,2,2,2,2,2,2,2,2,2,5],t,e)},rect:function(t,e){return op([.5,-.5,.5,.5,-.5,.5,-.5,-.5],[1,2,2,2,5],t,e)},billboard:function(){return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},plane:function(){return{vs:[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,.5],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]}},triangle:function(t,e){return op([0,-.5,.5,.5,-.5,.5],[1,2,2,5],t,e)},rightTriangle:function(t,e){return op([.5,.5,-.5,.5,-.5,-.5],[1,2,2,5],t,e)},parallelogram:function(t,e){return op([.5,-.5,.25,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],t,e)},trapezoid:function(t,e){return op([.25,-.5,.5,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],t,e)}},sp={sphere:1,cylinder:1,cone:1,torus:1},lp={torus:1,sphere:1},cp=Qn(Hs(ap),{cylinder:1}),hp=Qn(Hs(ap),{cylinder:1,cone:1}),up=function(t,e,i){var n,r=dc(t.anchor3d,i,e),o=dc(t.mat,i,e),a=dc(t.s3,i,e),s=dc(t.t3,i,e),l=dc(t.r3,i,e),c=a||l||s||o;if(r||c){n=Ol(e._6O);var h=c?Hl(o,a,l,dc(t.rotationMode,i,e),s):Pl();r&&cf(h,[.5-r[0],.5-r[1],.5-r[2]]),Zf(e,h)}return n},dp=function(t,e,i,n,r,o,a){if(Vn(i))i.forEach((function(i){dp(t,e,i,n,r,o,a)}));else if(On(i))dp(t,e,pp(n,i),n,r,o,a);else if(kn(i))if(i.shape3d){var s=up(i,t,e);dp(t,e,i.shape3d,n,r,o,i),s&&Qf(t,s)}else fp(t,e,i,n.s,r,o,a)},fp=function(t,e,i,n,r,o,a){if(a=a||an,!o||o(n("shape3d.transparent",i.transparent,a.transparent))){var s=up(i,t,e);vp(i);var c=t._26I,h=t._prg,u=t._buffer,d=n("shape3d.color",i.color,a.color);r||(r=n("shape3d.blend",i.blend,a.blend));var f,g=i.opacity==l?a.opacity:i.opacity,p=n("shape3d.opacity");f=p!=l&&g!=l?g*p:g!=l?g:p,zf(c,h,r,n("shape3d.light",i.light,a.light),f,n("shape3d.reverse.flip",i.reverseFlip,a.reverseFlip),n("shape3d.reverse.color",i.reverseColor,a.reverseColor),n("shape3d.reverse.cull",i.reverseCull,a.reverseCull));var v=n("polygonOffset",i.polygonOffset,a.polygonOffset);i.vs&&n(Xe,i.visible,a.visible)&&gp(c,h,u,d,t.getTexture(n("shape3d.image",i.image,a.image),e),n("shape3d.discard.selectable",i.discardSelectable,a.discardSelectable),i.vs,i.uv,i.ns,i.is,n("shape3d.uv.offset",i.uvOffset,a.uvOffset),n("shape3d.uv.scale",i.uvScale,a.uvScale),v),i.top_vs&&n(Ze,i.topVisible,a.topVisible)&&gp(c,h,u,n("shape3d.top.color",i.topColor,a.topColor)||d,t.getTexture(n("shape3d.top.image",i.topImage,a.topImage),e,"top"),n("shape3d.top.discard.selectable",i.topDiscardSelectable,a.topDiscardSelectable),i.top_vs,i.top_uv,i.top_ns,i.top_is,n("shape3d.top.uv.offset",i.topUvOffset,a.topUvOffset),n("shape3d.top.uv.scale",i.topUvScale,a.topUvScale),v),i.bottom_vs&&n(Je,i.bottomVisible,a.bottomVisible)&&gp(c,h,u,n("shape3d.bottom.color",i.bottomColor,a.bottomColor)||d,t.getTexture(n("shape3d.bottom.image",i.bottomImage,a.bottomImage),e,"bottom"),n("shape3d.bottom.discard.selectable",i.bottomDiscardSelectable,a.bottomDiscardSelectable),i.bottom_vs,i.bottom_uv,i.bottom_ns,i.bottom_is,n("shape3d.bottom.uv.offset",i.bottomUvOffset,a.bottomUvOffset),n("shape3d.bottom.uv.scale",i.bottomUvScale,a.bottomUvScale),v),i.from_vs&&n(Qe,i.fromVisible,a.fromVisible)&&gp(c,h,u,n("shape3d.from.color",i.fromColor,a.fromColor)||d,t.getTexture(n("shape3d.from.image",i.fromImage,a.fromImage),e,"from"),n("shape3d.from.discard.selectable",i.fromDiscardSelectable,a.fromDiscardSelectable),i.from_vs,i.from_uv,i.from_ns,i.from_is,n("shape3d.from.uv.offset",i.fromUvOffset,a.fromUvOffset),n("shape3d.from.uv.scale",i.fromUvScale,a.fromUvScale),v),i.to_vs&&n(Ye,i.toVisible,a.toVisible)&&gp(c,h,u,n("shape3d.to.color",i.toColor,a.toColor)||d,t.getTexture(n("shape3d.to.image",i.toImage,a.toImage),e,"to"),n("shape3d.to.discard.selectable",i.toDiscardSelectable,a.toDiscardSelectable),i.to_vs,i.to_uv,i.to_ns,i.to_is,n("shape3d.to.uv.offset",i.toUvOffset,a.toUvOffset),n("shape3d.to.uv.scale",i.toUvScale,a.toUvScale),v),kf(c,h),s&&Qf(t,s)}},gp=function(t,e,i,n,r,o,a,s,l,c,h,u,f){a&&(f&&Ef(t,f),Nf(t,e.uDiffuse,n||d["color.empty"]),s?Af(t,e,r,o,i.uv,s,h,u):Af(t),Hf(t,i.vs,a,e.aPosition),Hf(t,i.ns,l,e.aNormal),c?(Uf(t,i.is,c),Ff(t,0,c.length)):Lf(t,0,a.length/3),s?Vf(t,e,r):Vf(t),f&&Pf(t))},pp=function(t,e){var n=t.s;if(e||(e=n(Ne)),!e)return l;var r=Fd(e);if(r)return r;if("text"===e){var o={amount:n("shape3d.text.amount"),size:n("shape3d.text.size"),font:n("shape3d.text.font"),style:n("shape3d.text.style"),weight:n("shape3d.text.weight"),fill:n("shape3d.text.fill"),curveSegments:n("shape3d.text.curveSegments"),spacing:n("shape3d.text.spacing")},a=t.gv.getShape3dText(t.data),s=a;for(var c in o)s+="_"+(o[c]===i?"U":o[c]);return t._cachedTextKey===s?t._cachedTextGeometry:(t._cachedTextKey=s,t._cachedTextGeometry=u.createTextGeometry(a,o))}c=e;if(sp[e]){var h=n("shape3d.side"),d=n("shape3d.side.from"),f=n("shape3d.side.to"),g=n(Qe),p=n(Ye);3>h?(h=0,d=0,f=0,g=!1,p=!1):((d==l||0>d)&&(d=0),(f==l||f>h)&&(f=h),0===d&&f===h&&(g=!1,p=!1));var v="cone"!==e&&n("shape3d.smooth");c+="-"+h+"-"+d+"-"+f+"-"+g+"-"+p+(v?1:0)}if(cp[e]){var _=n(Ze);c+="-"+_}if(hp[e]){var y=n(Je);c+="-"+y}if("torus"===e){var m=n("shape3d.torus.radius");0>m?m=0:m>.25&&(m=.25),c+="-"+m}if(lp[e]){var b=n(qe);c+="-"+b}return r=Yi[c],r||("box"===e?r=u.createBoxModel():ap[e]?r=ap[e](_,y):"sphere"===e?r=u.createSphereModel(h,d,f,g,p,b,v):e===Ot?r=u.createCylinderModel(h,d,f,g,p,_,y,v):"cone"===e?r=u.createConeModel(h,d,f,g,p,y):"torus"===e&&(r=u.createTorusModel(h,d,f,g,p,m,b,v)),Yi[c]=r),r},vp=function(){var t=["vs","ns","uv","top_vs","top_ns","top_uv","bottom_vs","bottom_ns","bottom_uv","from_vs","from_ns","from_uv","to_vs","to_ns","to_uv","er","al"],e=["is","top_is","bottom_is","from_is","to_is"];return v=Jn(lg.substr(lg.indexOf("^#")+2)),Nl(u[Pn(hi+t[15]+"n"+t[16])]())&&bo()?function(i){i&&!i._complete_&&(i._complete_=!0,i.vs&&tr(i.ns)&&(i.ns=bf(i.vs,i.is)),i.top_vs&&tr(i.top_ns)&&(i.top_ns=bf(i.top_vs,i.top_is)),i.bottom_vs&&tr(i.bottom_ns)&&(i.bottom_ns=bf(i.bottom_vs,i.bottom_is)),i.from_vs&&tr(i.from_ns)&&(i.from_ns=bf(i.from_vs,i.from_is)),i.to_vs&&tr(i.to_ns)&&(i.to_ns=bf(i.to_vs,i.to_is)),t.forEach((function(t){var e=i[t];Vn(e)&&(i[t]=new Il(e))})),e.forEach((function(t){var e=i[t];Vn(e)&&(i[t]=new Sl(e))})))}:void 0}(),_p=function(t,e){var i=t[e];Vn(i)&&(t[e]=new Il(i))};Qn(es,{_25Q:function(t){t._16O=function(t,e,i,n,r,o,a,s,l){var c=this.info;if(c){var h,u,d,f,g,p,v=Pl();if(wc[e]?(h=c.p3,u=c.c1,d=c.c2):xc[e]?(u=c.s1||c.c1,d=c.s2||c.c2):(u=c.t1||c.c1,d=c.t2||c.c2),h)p=$f(e,hn,i,n,s,l);else{var _=Ml(d,u),y=nl(u,d);f=[0,-G(_[2],_[0]),V(_[1]/y)],g="zyx",h=[(u[0]+d[0])/2,(u[1]+d[1])/2,(u[2]+d[2])/2],p=$f(e,[y,0,0],i,n,s,l)}return tg(v,p,h,n,r,o,a,t,f,g)}return Dl},t._80o=function(t,e,i){var n=this,r=n.shapeModel;if(r){var o=n.gv;Zf(o),dp(o,n.data,r,n,n.getBodyColor(),i)}},t.createLineModel=function(t,e,i,n,r){for(var o=this,a=o.s,s=bp(t,e,a(qe)),c=[],h=0;h<s.length;h++){var u=s[h],d=u.length;if(d>1){var f=u[0];c.push(f.x,f.y,f.z);for(var g=1;d-1>g;g++)f=u[g],c.push(f.x,f.y,f.z),c.push(f.x,f.y,f.z);f=u[d-1],c.push(f.x,f.y,f.z)}}var p,v,_,y=a(n+".color"),m=a(r),b=0;return m&&(v=a(r+".color"),p=a(r+".pattern"),b=a(r+".offset"),_=y),Sg(o.gv,o.data,c,v||y,_?l:a(n+".gradient.color"),i,p||a(n+".pattern"),b,_),s},t.createTubeModel=function(t,e,i,n){for(var r=this,o=r.s,a=o("shape3d.side")||ml,s=o("shape3d.start.angle"),c=o("shape3d.sweep.angle"),h=o(Ze)?o("shape3d.top.cap"):l,u=o(Je)?o("shape3d.bottom.cap"):l,d="flat"===h,f="flat"===u,g=d&&(n?n.uv:o("shape3d.top.image")),p=f&&(n?n.uv:o("shape3d.bottom.image")),v=n?n.uv:o("shape3d.image"),_={vs:[],uv:v?[]:l,top_vs:d?[]:l,top_uv:g?[]:l,bottom_vs:f?[]:l,bottom_uv:p?[]:l},y=bp(t,e,o(qe),i),m=0,b=y.length;b>m;m++)wp(_,y[m],o(Ke),i,a,s,c,h,u);if(n){var x=[];Tg(r.gv,r.data,_,r,r.getBodyColor(),[],n,x),x.length&&(qn(n.vs,x),qn(n.ns,bf(x)))}else r.shapeModel=_;return y},t.getCache=function(){var t=this.info;if(t){var e=t.list;if(e){var i=t.cache;return i||(i=t.cache=mp(e)),i}}return l}}});var yp=function(t,e){for(var i,n=0,r=t.length,o=0,a=r-1;a>=o;)if(n=M(o+(a-o)/2),i=t[n].length-e,0>i)o=n+1;else{if(!(i>0)){a=n;break}a=n-1}n=a;var s=t[n],l=s.point;return n===r-1||s.length===e||(l=(new mh).subVectors(t[n+1].point,l).normalize().multiplyScalar(e-s.length).add(l)),{point:l,tangent:s.tangent}},mp=function(t){for(var e,i,n=[],r=0,o=0;o<t.length;o++){for(var a=t[o],s=0;s<a.length;s++){e=a[s],i&&(r+=i.distanceTo(e));var l=new mh,c=a[s+1];c?l.subVectors(c,e):i?l.subVectors(e,i):l.x=1,l.normalize(),n.push({point:e,length:r,tangent:l}),i=e}i=null}return n},bp=function(t,e,i,n){i=i||_l;for(var r=[],o=0,a=t.size();a>o;o++){var s=t.get(o);r.push(new mh(s.x,s.e||0,s.y))}e&&(Bn(e)&&(e=e._as),e.length||(e=null));for(var c,h,u,d,f,g=[],p=0,v=0,_=e?e.length:a;_>v;v++)if(f=e?e[v]:0===v?1:2,1===f)g.push(u=[]),u.push(r[p++]);else if(2===f||5===f)if(d=2===f?r[p++]:u[0],n){var y=e?e[v+1]:_>v+1?2:l;if(2===y||5===y){var m=u[u.length-1],b=2===y?r[p]:u[0],x=(new mh).subVectors(m,d),w=(new mh).subVectors(b,d),C=x.length(),S=w.length();if(C&&S)if(n>C/2&&n>S/2)u.push(d);else for(x.multiplyScalar(D(n,C/2)/C).add(d),w.multiplyScalar(D(n,S/2)/S).add(d),c=new Qh(x,d,w).getPoints(i),h=0;i>=h;h++)u.push(c[h])}else u.push(d)}else u.push(d);else if(3===f)for(c=new Qh(u[u.length-1],r[p++],r[p++]).getPoints(i),h=1;i>=h;h++)u.push(c[h]);else if(4===f)for(c=new Yh(u[u.length-1],r[p++],r[p++],r[p++]).getPoints(i),h=1;i>=h;h++)u.push(c[h]);return g},xp=function(t){for(var e,i,n=new mh,r=[],o=[],a=[],s=0,l=t.length;l>s;s++)e=t[s],i=t[s+1],i?n.subVectors(i,e):n.subVectors(e,t[s-1]),r.push(n.normalize().clone());var c,h,u,d,f=new mh,g=new mh,p=new bh,v=1e-4,_=Number.MAX_VALUE,y=r[0],m=o[0]=new mh,b=a[0]=new mh;for(h=O(y.x),u=O(y.y),d=O(y.z),_>=h&&(_=h,f.set(1,0,0)),_>=u&&(_=u,f.set(0,1,0)),_>=d&&f.set(0,0,1),g.crossVectors(y,f).normalize(),m.crossVectors(y,g),b.crossVectors(y,m),s=1;l>s;s++)o[s]=o[s-1].clone(),a[s]=a[s-1].clone(),g.crossVectors(r[s-1],r[s]),g.length()>v&&(g.normalize(),c=z(ir(r[s-1].dot(r[s]),-1,1)),o[s].applyMatrix4(p.makeRotationAxis(g,c))),a[s].crossVectors(r[s],o[s]);return{B:a,T:r,N:o}},wp=function(){var t=function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];t.push(i.x,i.y,i.z)}},e=function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e].uv;t.push(i[0],i[1])}},n=function(t,e,i,n,r){var o=-n*R(r),a=n*k(r);return new mh(t.x+o*i.x+a*e.x,t.y+o*i.y+a*e.y,t.z+o*i.z+a*e.z)},r=function(t,e,i,r,o,a,s,c){s=s||F;for(var h=[],u=s/o,d=0;o>=d;d++){var f=n(t,e,i,r,d*u+a);h.push(f),c!=l&&(f.uv=[c,1-d/o])}return h},o=function(e,i,r,o,a,s,l,c,h){h=h||F;var u=i?e.top_vs:e.bottom_vs;if(u)for(var d=i?e.top_uv:e.bottom_uv,f=h/l,g=0;l>g;g++){var p,v;i?(p=g*f+c,v=(g+1)*f+c):(v=g*f+c,p=(g+1)*f+c),t(u,n(r,o,a,s,p),n(r,o,a,s,v),r),d&&d.push(.5-.5*R(p),.5-.5*k(p),.5-.5*R(v),.5-.5*k(v),.5,.5)}};return function(n,a,s,c,h,u,d,f,g){var p=a.length;if(p>1){var v,_,y,m,b,x,w,C=xp(a),S=C.T,I=C.N,M=C.B;"flat"===f&&o(n,!0,a[0],M[0],I[0],c,h,u,d),"flat"===g&&o(n,!1,a[p-1],M[p-1],I[p-1],c,h,u,d);var P,D,O=[],R=T(h/2),z="round"===f,k="round"===g,A=a[0],V=S[0],B=M[0],L=I[0],F=a[p-1],j=S[p-1],H=M[p-1],G=I[p-1];if(z){for(y=1;R>=y;y++)I.splice(0,0,L),M.splice(0,0,B),S.splice(0,0,V),D=-y/R*c,a.splice(0,0,V.clone().multiplyScalar(D).add(A)),O[R-y]=E(c*c-D*D);p+=R}if(k){for(y=1;R>=y;y++)I.push(G),M.push(H),S.push(j),D=y/R*c,a.push(j.clone().multiplyScalar(D).add(F)),O[a.length-1]=E(c*c-D*D);p+=R}if(n.uv){var U=0,W=0,N=[];for(s&&(U=s),b=a[0],N[0]=0,y=1;p>y;y++)m=a[y],N[y]=b.distanceTo(m),b=m,s||(U+=N[y]);for(P=[],y=0;p>y;y++)W+=N[y],P[y]=U?W/U:0}for(y=0;p>y;y++){if(m=a[y],x=M[y],w=I[y],v=r(m,x,w,O[y]===i?c:O[y],h,u,d,P?P[y]:l),_)for(var q=0;h>q;q++){var X=_[q],Q=_[q+1]||_[0],Y=v[q],Z=v[q+1]||v[0];t(n.vs,Q,X,Y,Y,Z,Q),n.uv&&e(n.uv,Q,X,Y,Y,Z,Q)}_=v}}}}();Qn(u,{getLineLength:function(t){return t[t.length-1].length},getLineOffset:function(t,e){return yp(t,e)},getLineCacheInfo:function(t,e,i,n){return mp(bp(t,e,i,n))}});var Cp=c.graph3d.RenderLite={},Sp=new Array(0),Ip=Cp.Buffer=function(t,e,i,n){this.gl=t,this.buffer=t.createBuffer(),this.type=e||t.ARRAY_BUFFER,this.drawType=n||t.STATIC_DRAW,this.data=Sp,i&&this.upload(i)};Ip.prototype.upload=function(t,e,i){i||this.bind();var n=this.gl;t=t||this.data,e=e||0,this.data.byteLength>=t.byteLength?n.bufferSubData(this.type,e,t):n.bufferData(this.type,t,this.drawType),this.data=t},Ip.prototype.bind=function(){var t=this.gl;t.bindBuffer(this.type,this.buffer)},Ip.createVertexBuffer=function(t,e,i){return new Ip(t,t.ARRAY_BUFFER,e,i)},Ip.createIndexBuffer=function(t,e,i){return new Ip(t,t.ELEMENT_ARRAY_BUFFER,e,i)},Ip.create=function(t,e,i,n){return new Ip(t,e,n)},Ip.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};var Mp=Cp.Shader=function(t,e,i){this.gl=t,this.program=Tp(t,e,i),this.attributes=Dp(t,this.program);var n=Pp(t,this.program);this.uniforms=Fp(t,n)};Mp.prototype.bind=function(){this.gl.useProgram(this.program)},Mp.prototype.destroy=function(){this.gl};var Tp=function(t,e,i){var n=Ep(t,t.VERTEX_SHADER,e),r=Ep(t,t.FRAGMENT_SHADER,i);t.getShaderParameter(r,t.COMPILE_STATUS)||console.error(t.getError());var o=t.createProgram();return t.attachShader(o,n),t.attachShader(o,r),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)||(console.error("Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",t.getProgramParameter(o,t.VALIDATE_STATUS)),console.error("gl.getError()",t.getError()),""!==t.getProgramInfoLog(o)&&console.warn("Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(o)),t.deleteProgram(o),o=null),t.deleteShader(n),t.deleteShader(r),o},Ep=function(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.log(t.getShaderInfoLog(n)),null)},Pp=function(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r=0;n>r;r++){var o=t.getActiveUniform(e,r),a=o.name.replace(/\[.*?\]/,""),s=kp(t,o.type);i[a]={type:s,size:o.size,location:t.getUniformLocation(e,a),value:Bp(s,o.size)}}return i},Dp=function(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),r=0;n>r;r++){var o=t.getActiveAttrib(e,r),a=kp(t,o.type);i[o.name]={type:a,size:Rp(a),gl:t,location:t.getAttribLocation(e,o.name),pointer:Op}}return i},Op=function(t,e,i,n,r){var o=this.gl;o.enableVertexAttribArray(this.location),t instanceof Cp.Buffer||(t=Cp.Buffer.createVertexBuffer(o,t)),o.bindBuffer(t.type,t.buffer),o.vertexAttribPointer(this.location,this.size,e||o.FLOAT,i||!1,n||0,r||0)},Rp=function(t){return zp[t]},zp={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},kp=function(t,i){if(!Ap){var n=e.keys(Vp);Ap={};for(var r=0;r<n.length;++r){var o=n[r];Ap[t[o]]=Vp[o]}}return Ap[i]},Ap=null,Vp={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"},Bp=function(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return Lp(2*e);case"bvec3":return Lp(3*e);case"bvec4":return Lp(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},Lp=function(t){for(var e=new Array(t),i=0;i<e.length;i++)e[i]=!1;return e},Fp=function(t,i){var n={data:{}};n.gl=t;for(var r=e.keys(i),o=0;o<r.length;o++){var a=r[o],s=a.split("."),l=s[s.length-1],c=Gp(s,n),h=i[a];c.data[l]=h,c.gl=t,e.defineProperty(c,l,{get:jp(l),set:Hp(l,h)})}return n},jp=function(t){var e=Up.replace("%%",t);return new Function(e)},Hp=function(t,e){var i,n=Wp.replace(/%%/g,t);return i=1===e.size?Np[e.type]:qp[e.type],i&&(n+="\nthis.gl."+i+";"),new Function("value",n)},Gp=function(t,e){for(var i=e,n=0;n<t.length-1;n++){var r=i[t[n]]||{data:{}};i[t[n]]=r,i=r}return i},Up=["return this.data.%%.value;"].join("\n"),Wp=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),Np={float:"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])",int:"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},qp={float:"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)",int:"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"},Xp=c.Light=function(){Kn(Xp,this),this.s(Ad,d[Ad]),this.s(Ne,"sphere"),this.s("shape3d.reverse.cull",!0),this.s3(20,20,20)};xl("Light",ru,{_image:"light_icon",_icon:"light_icon",onStyleChanged:function(t,e,i){Xp.superClass.onStyleChanged.apply(this,arguments),t===Ad&&this.s("shape3d.color",i)}});var Qp=ag.Graph3dView=function(t,e){var i=this;i._webGLVersion=1,i._attributes=e||u.graph3dViewAttributes,i._25I={},i._view=mr(1,i);var n=i._canvas=wr(i._view);w(n,"webglcontextlost",(function(t){t.preventDefault(),Cf(i),i._26I&&i._doBufferGC(i._26I,!0),i._26I=l,i._1o.texture=l,i._35O=!0})),w(n,"webglcontextrestored",(function(){i._35O=!1,i.iv()})),i._batchIndexMap={},i._batchModelMap={},i._wireframeIndexMap={},i._wireframeModelMap={},i._wireframeIndexMapSwap={},i._wireframeModelMapSwap={},i._polylineIndexMap={},i._polylineIndexMap={},i._polylineIndexMapSwap={},i._polylineIndexMapSwap={},i._8O=[],i._7O=Pl(),i._6O=Pl(),i._1o=new ov(i),i._30O=new hv(i),i._31O=new av(i),i._32O=new sv(i),i._raycaster=new xv(i),i._highlightHelper=new lv(i),i._postProcessing=new Ov(i),i._cameras=[],i._cameraId=0,i.vr=new Ev(i),i._33Q=!0,i._eye=Hs(u.graph3dViewEye),i._center=Hs(u.graph3dViewCenter),i._up=Hs(u.graph3dViewUp),i._lightChanged=!1,i._59O=[],i._spots=[],i._dirs=[],i._frameId=0,i.overlappingBox=new xu(i),i.dm(t||new yc),i._coreInteractor=new ju(this),i.setInteractors([new $p(i)]),i._initView()},Yp={fogDisabled:1,dashDisabled:1,batchColorDisabled:1,batchBlendDisabled:1,batchBrightnessDisabled:1,ortho:1},Zp=function(t,e,i,n){t.clearColor(0,0,0,0),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.useProgram(i),Nf(t,i.uBrightness,1),Nf(t,i.uOpacity,1),Nf(t,i.uPartOpacity,1),Nf(t,i.uPick,n._picking),Nf(t,i.uTexture,!1),Nf(t,i.uBlendTexture,!1),Nf(t,i.uAlphaTest,d.alphaTest),Nf(t,i.uTransparent,!1),Nf(t,i.uFix,!1),Nf(t,i.uBatchColor,!1),Nf(t,i.uBatchBlend,!1),Nf(t,i.uBatchBrightness,!1),Nf(t,i.uReflectivity,n._envmapReflectivity),Nf(t,i.uCameraPosition,e.getEye()),Nf(t,i.uPMatrix,n._projectMatrix),Nf(t,i.uViewMatrix,n._viewMatrix),e.bindEnvMap(t),n._picking||($d(e,t,i),e._fogDisabled||(Nf(t,i.uFogColor,e._fogColor),Nf(t,i.uFogNear,e._fogNear),Nf(t,i.uFogFar,e._fogFar))),qf(t,i.aPosition),qf(t,i.aNormal),Xf(t,i.aUv),Xf(t,i.aBatchColor),Xf(t,i.aBatchBlend),Xf(t,i.aBatchBrightness),Xf(t,i.aLineDistance),t.depthMask(!0)},Jp=0;sg("Graph3dView",e,{ms_v:1,ms_tip:1,ms_gv:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_51o:1,ms_ac:["devicePixelRatio","boundaries","moveStep","rotateStep","editHelperDisabled","blockSelectable","sizeEditableFunc","rotationEditableFunc","editableFunc","rotatable","zoomable","pannable","walkable","resettable","mouseRoamable","zoomToCenter",pe,_e,"firstPersonMode",Te,"movableFunc","gridVisible","gridSize","gridGap","gridColor","originAxisVisible","centerAxisVisible","axisXColor","axisYColor","axisZColor","editSizeColor","rectSelectable","rectSelectBackground","headlightRange","headlightColor","headlightIntensity","headlightAmbientIntensity","headlightDisabled","ortho","orthoWidth","fovy","near","far",mt,yt,"up","aspect","fogDisabled","fogColor","fogNear","fogFar","pickerResolution","dashDisabled","batchColorDisabled","batchBlendDisabled","batchBrightnessDisabled","hoverDelay"],_editable:!1,_editHelperDisabled:u.graph3dViewEditHelperDisabled,_blockSelectable:u.graph3dViewBlockSelectable,_devicePixelRatio:i,_boundaries:i,_moveStep:u.graph3dViewMoveStep,_rotateStep:u.graph3dViewRotateStep,_pannable:u.graph3dViewPannable,_rotatable:u.graph3dViewRotatable,_walkable:u.graph3dViewWalkable,_resettable:u.graph3dViewResettable,_zoomable:u.graph3dViewZoomable,_zoomToCenter:!0,_firstPersonMode:u.graph3dViewFirstPersonMode,_mouseRoamable:u.graph3dViewMouseRoamable,_gridVisible:u.graph3dViewGridVisible,_gridSize:u.graph3dViewGridSize,_gridGap:u.graph3dViewGridGap,_gridColor:u.graph3dViewGridColor,_originAxisVisible:u.graph3dViewOriginAxisVisible,_centerAxisVisible:u.graph3dViewCenterAxisVisible,_axisXColor:u.graph3dViewAxisXColor,_axisYColor:u.graph3dViewAxisYColor,_axisZColor:u.graph3dViewAxisZColor,_ortho:u.graph3dViewOrtho,_orthoWidth:u.graph3dViewOrthoWidth,_fovy:u.graph3dViewFovy,_near:u.graph3dViewNear,_far:u.graph3dViewFar,_headlightColor:u.graph3dViewHeadlightColor,_headlightIntensity:u.graph3dViewHeadlightIntensity,_headlightRange:u.graph3dViewHeadlightRange,_headlightAmbientIntensity:u.graph3dViewHeadlightAmbientIntensity,_headlightDisabled:u.graph3dViewHeadlightDisabled,_rectSelectable:u.graph3dViewRectSelectable,_rectSelectBackground:u.graph3dViewRectSelectBackground,_editSizeColor:u.graph3dViewEditSizeColor,_autoMakeVisible:os,_fogDisabled:u.graph3dViewFogDisabled,_fogColor:u.graph3dViewFogColor,_fogNear:u.graph3dViewFogNear,_fogFar:u.graph3dViewFogFar,_pickerResolution:u.graph3dViewPickerResolution,_dashDisabled:u.graph3dViewDashDisabled,_batchColorDisabled:u.graph3dViewBatchColorDisabled,_batchBlendDisabled:u.graph3dViewBatchBlendDisabled,_batchBrightnessDisabled:u.graph3dViewBatchBrightnessDisabled,addCamera:function(t){var i=e.freeze({id:this._cameraId++,priority:t.priority||0,ignoreInPick:!!t.ignoreInPick,useDefaultProgram:!!t.useDefaultProgram,render:t.render});this._cameras.push(i),this._cameras.sort((function(t,e){return t.priority!==e.priority?t.priority-e.priority:t.id-e.id}))},setEye:function(t,e,i){1===arguments.length&&(e=t[1],i=t[2],t=t[0]);var n=this._eye;n[0]=t,n[1]=e,n[2]=i,this.fp(mt,l,n)},setCenter:function(t,e,i){1===arguments.length&&(e=t[1],i=t[2],t=t[0]);var n=this._center;n[0]=t,n[1]=e,n[2]=i,this.fp(yt,l,n)},setUp:function(t,e,i){1===arguments.length&&(e=t[1],i=t[2],t=t[0]);var n=this._up;n[0]=t,n[1]=e,n[2]=i,this.fp("up",l,n)},getDevicePixelRatio:function(){return this._devicePixelRatio||rs},isTransparentMask:function(t){return t.s("transparent.mask")},getCoreInteractor:function(){return this._coreInteractor},getHighlightHelper:function(){return this._highlightHelper},getRaycaster:function(){return this._raycaster},getAspect:function(){var t=this,e=t._aspect;return e||(e=t.getWidth()/t.getHeight(),e||1.2)},getCanvas:function(){return this._canvas},setDataModel:function(t){var e=this,i=e._dataModel,n=e._selectionModel;i!==t&&(i&&(i.ump(e.handleDataModelPropertyChange,e),i.umm(e.handleDataModelChange,e),i.umd(e.handleDataPropertyChange,e),n||i.sm().ums(e.handleSelectionChange,e)),e._dataModel=t,t.mp(e.handleDataModelPropertyChange,e),t.mm(e.handleDataModelChange,e),t.md(e.handleDataPropertyChange,e),n?n._21I(t):t.sm().ms(e.handleSelectionChange,e),e._postProcessing.handleDataModleChange(i,t),e.invalidateAll(!0),e.invalidateLight(),e.fp(Ge,i,t),e._canvas.style.background=t.getBackground()||"")},handleDataModelPropertyChange:function(t){if("background"===t.property){var e=this._canvas.style.background,i=t.newValue||"";this._canvas.style.background=i,this.fp("canvasBackground",e,i)}else"envmap"===t.property&&this.iv()},handleDataPropertyChange:function(t){var e=t.data;this.invalidateData(e),Xd(e)&&"s:light.type"===t.property&&this.invalidateLight()},invalidateLight:function(){this._lightChanged||(this._lightChanged=!0,this.iv())},onPropertyChanged:function(t){var e=this,i=t.property;e.iv(),e._18Q=l,"eye"===i?e._33Q=!0:"devicePixelRatio"===i?e._42(l,e.getDevicePixelRatio()):Yp[i]&&Cf(e)},_5O:function(t){var e=t._22Q();return e?new e(this,t):l},getData3dUI:function(t){var e=this._25I[t._id];return e===i&&(e=this._5O(t),this._25I[t._id]=e),e},invalidateAll:function(t){var e=this;if(t){for(var i in e._25I){var n=e._25I[i];n&&n.dispose()}e._25I={},e.iv(),yg(e)}else yg(e),e.dm().each((function(t){e.invalidateData(t)}))},invalidateSelection:function(){var t=this;t.sm().each((function(e){t.invalidateData(e)}))},invalidateData:function(t){var e=this,i=e.getData3dUI(t);i&&(i.iv(),e.iv()),yg(e,t)},getShape3dText:function(t){return t.getStyle("shape3d.text")||this.getLabel(t)},invalidateBatch:function(t){var e=this,n=e._batchModelMap,r=n[t],o=[],a={};if(r){r.ds.forEach((function(t){var i=e.getData3dUI(t);i&&i.iv(),delete e._batchIndexMap[t._id],o.push(t._id)})),delete n[t];for(var s,l,c,h,u,d,f,g,p,v=["_wireframeModelMap","_polylineModelMap","_wireframeModelMapSwap","_polylineModelMapSwap"],_=["_wireframeIndexMap","_polylineIndexMap","_wireframeIndexMapSwap","_polylineIndexMapSwap"],y=0;y<v.length;y++){var m=e[v[y]],b=e[_[y]];for(a={},g=0;g<o.length;g++){var x=b[o[g]];if(x){delete b[o[g]],p=x.batch,s=m[p];var w=x.begin,C=x.size,S=3*w,I=3*C,M=4*w,T=4*C;for(l=s.ds,c=s.vs,h=s.cs,u=s.ps,d=s.ls,f=x.index,s.invalidate=!0,l[f]=i,f=S;S+I>f;f++)c[f]=i;for(f=M;M+T>f;f++)h[f]=i;for(f=M;M+T>f;f++)u[f]=i;if(d)for(f=S;S+I>f;f++)d[f]=i;a[p]=!0}}for(p in a){s=m[p],l=s.ds,c=s.vs,h=s.cs,u=s.ps,d=s.ls;var E=[];for(f=0;f<l.length;f++)l[f]!==i&&E.push(l[f]);if(0===E.length)delete m[p];else{for(s.ds=E,E=[],f=0;f<c.length;f++)c[f]!==i&&E.push(c[f]);for(s.vs=E,E=[],f=0;f<h.length;f++)h[f]!==i&&E.push(h[f]);for(s.cs=E,E=[],f=0;f<u.length;f++)u[f]!==i&&E.push(u[f]);if(s.ps=E,d){for(E=[],f=0;f<d.length;f++)d[f]!==i&&E.push(d[f]);s.ls=E}}}}e.iv()}},handleDataModelChange:function(t){var e=this,i=t.kind,n=t.data;if("add"===i)e.invalidateData(n),jn(n)&&n.getEdgeGroup()&&n.getEdgeGroup().eachSiblingEdge(e.invalidateData,e),Xd(n)&&e.invalidateLight();else if(i===At){var r=n._id,o=e._25I[r];o&&(o.dispose(),delete e._25I[r],e.iv()),n===e._currentSubGraph&&e.setCurrentSubGraph(l),yg(e,n),Xd(n)&&e.invalidateLight()}else i===Vt&&(e.invalidateAll(!0),e.setCurrentSubGraph(l),yg(e),e.invalidateLight())},toCanvas:function(t,e,i){var n=this,r=n.getGL();if(n.validate(),t){var o=r.getParameter(r.COLOR_CLEAR_VALUE);Df(r,t)}n._42(l,1);var a=n.getWidth()||1,s=n.getHeight()||1,c=new Uint8Array(4*a*s),h=wr(),d=h.getContext("2d");r.readPixels(0,0,a,s,r.RGBA,r.UNSIGNED_BYTE,c),Ir(h,a,s,1);for(var f=d.getImageData(0,0,a,s),g=f.data,p=0;p<g.length;p+=4){var v=p/4,_=M(v/a),y=v-_*a;v=4*((s-1-_)*a+y),g[v]=c[p],g[v+1]=c[p+1],g[v+2]=c[p+2],g[v+3]=c[p+3]}if(d.putImageData(f,0,0),t&&Df(r,o),n._42(l,n.getDevicePixelRatio()),e&&i){var m=wr(),b=m.getContext("2d");return e=e,i=i,Ir(m,e,i,1),u.drawImage(b,h,0,0,e,i),m}return h},toDataURL:function(t,e){var i=this,n=i.getGL();if(i.validate(),t){var r=n.getParameter(n.COLOR_CLEAR_VALUE);Df(n,t)}i._42(l,1);var o=i._canvas.toDataURL(e||"image/png",1);return t&&Df(n,r),i._42(l,i.getDevicePixelRatio()),o},getGL:function(){var t=this._26I;if(t)return this.acquireProgram(),t;var e=this,i=e._canvas,n=e._attributes;try{t=i.getContext("webgl2",n)||i.getContext("experimental-webgl2",n),t&&(e._webGLVersion=2,e._26I=t)}catch(c){}if(!t)try{t=i.getContext("webgl",n)||i.getContext("experimental-webgl",n)}catch(c){throw new Error("WebGL not supported")}if(!t)throw new Error("WebGL not supported");e._26I=t,e._glExtensions=new r(t),e._glCapabilities=new o(t,e._glExtensions),e._2O={},t._compiledShader={},t._emptyTexture=wf(t),t._emptyBlendTexture=wf(t),t._bufPool={},t._id=++Jp,e._buffer={vs:If(t),ns:If(t),is:If(t),uv:If(t),batchColor:If(t),batchBlend:If(t),batchBrightness:If(t),lineDistance:If(t)},e._1O=xf(t);var a=e._cube={vs:If(t),ns:If(t),is:If(t),uv:If(t)};return jf(t,a.vs,Ng),jf(t,a.ns,Qg),jf(t,a.uv,Xg),Gf(t,a.is,qg),e.acquireProgram(),t},getEnvmap:function(){return this._glCapabilities&&this._glCapabilities.maxVertexTextures<16?null:this.dm().getEnvmap()},acquireProgram:function(){var t=this,e=t._26I;if(e){var i=u.getImage(t.getEnvmap()),n=!(!i||!i.tagName),r=!(!t._prg||!t._prg.envMapFlag);if(!t._prg||n!==r){var o=t._prg=e.createProgram();if(!o)return l;o.envMapFlag=n;var a=t._dirs.length,s=t._spots.length,c=t._59O.length,h=["uPMatrix","uMVMatrix","uMMatrix","uReflectivity","uViewMatrix","uUseEnvMap","uEnvMap","uCameraPosition","uNMatrix","uViewMatrix","aNormal","aUv","uOffsetScale","uDiffuse","uBlend","uBlendColor","uBrightness","uPartOpacity","uAlphaTest","uTransparent","uClipDirection","uClipPercent","uTexture","uBlendTexture","uSampler","uBlendSampler","uDiscardSelectable","uFix","uPick","uReverseFlip","uFixPickReverseColor","uBatchBrightness","aBatchBrightness","uBatchColor","aBatchColor","uBatchBlend","aBatchBlend","uDash","aLineDistance","uDashDistance","uDashGapDistance","uLight","uHeadlightRange","uHeadlightAmbientIntensity","uHeadlightColor","uFogColor","uFogNear","uFogFar"];a&&h.push("uDirColor","uDirDirection"),s&&h.push("uSpotColor","uSpotRange","uSpotAngle","uSpotExponent","uSpotPosition","uSpotDirection"),c&&h.push("uPointColor","uPointRange","uPointPosition"),Df(e,[0,0,0,0]),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),Ud||(lg=Jn(lg.substring(0,lg.indexOf("^#"))),cg=Jn(cg),Ud=!0);var d=["#define MAX_DIR "+a,"#define MAX_SPOT "+s,"#define MAX_POINT "+c,t._fogDisabled?"":"#define FOG",t._dashDisabled?"":"#define DASH",n?"#define USE_ENVMAP":"",t.isOrtho()?"#define ORTHOGRAPHIC":"",t._batchColorDisabled?"":"#define BATCHCOLOR",t._batchBlendDisabled?"":"#define BATCHBLEND",t._batchBrightnessDisabled?"":"#define BATCHBRIGHTNESS",""].join("\n"),f=Sf(e,o,e.VERTEX_SHADER,lg.replace("PREFIX",d));e.getShaderParameter(f,e.COMPILE_STATUS)||console.error("compile vs shader faild, error info : ",e.getShaderInfoLog(f));var g=Sf(e,o,e.FRAGMENT_SHADER,cg.replace("PREFIX",d));e.getShaderParameter(g,e.COMPILE_STATUS)||console.error("compile fs shader faild, error info : ",e.getShaderInfoLog(g)),nt?h.push("aPosition"):(o.aPosition=0,e.bindAttribLocation(o,0,"aPosition")),e.linkProgram(o),h.forEach((function(t){o[t]=/^u/.test(t)?e.getUniformLocation(o,t):e.getAttribLocation(o,t)})),e.useProgram(o),e.deleteShader(f),e.deleteShader(g)}}},getBrightness:function(t){var e=t.s("brightness"),i=this.isSelected(t)?t.s("select.brightness"):l;return e==l?i:i==l?e:e*i},setHighlightMode:function(t){var e;e="selection"===t||"selected"===t?lv.Mode.Selection:"mouseover"===t||"hover"===t?lv.Mode.MouseOver:"style"===t?lv.Mode.Style:lv.Mode.Disable;var i=this._highlightHelper.mode;this._highlightHelper.mode=e,this.firePropertyChange("highlightMode",i,e)},getHighlightMode:function(){var t=this._highlightHelper.mode;return t===lv.Mode.Selection?"selected":t===lv.Mode.MouseOver?"hover":t===lv.Mode.Style?"style":"disabled"},getDataHighlightMode:function(t){return t.s("highlight.mode")},getHighlightColor:function(){return this._highlightHelper.color||d["highlight.color"]},setHighlightColor:function(t){var e=this._highlightHelper.color;this._highlightHelper.color=t,this.firePropertyChange("highlightColor",e,t)},getHighlightWidth:function(){return this._highlightHelper.width||d["highlight.width"]},setHighlightWidth:function(t){var e=this._highlightHelper.width;this._highlightHelper.width=t,this.firePropertyChange("highlightWidth",e,t)},bindEnvMap:function(t){var e=this,i=e._prg,n=5,r=e.getEnvmap(),o=u.getImage(r);if(o&&o.tagName){if(r!==e._lastEnvMap){o=u.resizeImagePOT(o,!0),e._envMapTexture&&t.deleteTexture(e._envMapTexture);var a=e._envMapTexture=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,a),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o),t.bindTexture(t.TEXTURE_CUBE_MAP,null),e._lastEnvMap=r}t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_CUBE_MAP,e._envMapTexture),t.uniform1i(i.uEnvMap,n)}},getWireframe:function(t){var e=t.s("wf.visible"),i=t.s("wf.width");return!0===e||i>0&&"selected"===e&&this.isSelected(t)?{color:t.s("wf.color"),width:i,short:t.s("wf.short"),mat:t.s("wf.mat")}:void 0},_transformPointToViewSpace:function(t){var e=[t[0],t[1],t[2]];return kl(e,this._viewMatrix),e},_transformDirectionToViewSpace:function(t,e){var i=[t[0],t[1],t[2]];kl(i,this._viewMatrix);var n=e?[e[0],e[1],e[2]]:[0,0,0];kl(n,this._viewMatrix);var r=n[0]-i[0],o=n[1]-i[1],a=n[2]-i[2],s=Math.sqrt(r*r+o*o+a*a);return s?[r/s,o/s,a/s]:[r,o,a]},getWireframeGeometry:function(t){return t.s("wf.geometry")?{color:t.s("wf.color"),width:t.s("wf.width"),mat:t.s("wf.mat"),geometry:!0}:void 0},getBodyColor:function(t){return t.s("body.color")},getMat:function(t){return t.getMat?t.getMat():t.s("mat")},getFaceMat:function(t,e){return t.getFaceMat?t.getFaceMat(e):t.s(e+".mat")},getFaceBlend:function(t,e){return t.s(e+".blend")||t.s("all.blend")},getFaceColor:function(t,e){return t.s(e+".color")||t.s("all.color")},getFaceImage:function(t,e){return t.s(e+".image")||t.s("all.image")},getFaceBlendImage:function(t,e){return t.s(e+".blend.image")||t.s("all.blend.image")},getFaceDiscardSelectable:function(t,e){var i=t.s(e+".discard.selectable");return i==l?t.s("all.discard.selectable"):i},getFaceUv:function(t,e){return t.s(e+".uv")||t.s("all.uv")},getFaceUvOffset:function(t,e){return t.s(e+".uv.offset")||t.s("all.uv.offset")},getFaceUvScale:function(t,e){return t.s(e+".uv.scale")||t.s("all.uv.scale")},getFaceLight:function(t,e){var i=t.s(e+".light");return i==l?t.s("all.light"):i},getFaceVisible:function(t,e){var i=t.s(e+".visible");return i==l?t.s("all.visible"):i},getFaceOpacity:function(t,e){var i=t.s(e+".opacity");return i==l?t.s("all.opacity"):i},getFaceTransparent:function(t,e){var i=t.s(e+".transparent");return i==l?t.s("all.transparent"):i},getFaceReverseColor:function(t,e){return t.s(e+".reverse.color")||t.s("all.reverse.color")},getFaceReverseFlip:function(t,e){var i=t.s(e+".reverse.flip");return i==l?t.s("all.reverse.flip"):i},getFaceReverseCull:function(t,e){var i=t.s(e+".reverse.cull");return i==l?t.s("all.reverse.cull"):i},getTextureMap:function(){return this._2O},deleteTexture:function(t){var e=this,i=e._2O[t];i&&(delete e._2O[t],e.getGL().deleteTexture(i))},invalidateCachedTexture:function(t){var e=this.getData3dUI(t);e.invalidateCachedTexture(this.getGL()),this.invalidateData(t)},invalidateShape3dCachedImage:function(t){this.invalidateCachedTexture(t)},invalidateCachedGeometry:function(t){var e=this.getData3dUI(t);e.invalidateCachedGeometry(),this.invalidateData(t)},isInteractive:function(t){return t.s("interactive")},getTexture:function(t,e,n){if(!t)return l;var r=this,o=r.getGL(),a=r._2O[t];if(!a){var s=zs(t),h={mipmapMaxLevel:e?e.s("texture.mipmap.max"):i};if(!s)return o._emptyTexture;if(s.uuid||(s.uuid=c.Math.generateUUID()),s.tagName){if(s.dynamic)return xf(o,s,r._1O,h);a=r._2O[t]=xf(o,s,i,h)}else{var d,f=e&&(e.s("texture.cache")||e.s("shape3d.image.cache")||s.textureCache),g=r.vr.isPresenting();if(g&&(e._textureUpdateFrame===o._renderInfo.frame?f=!0:e._textureUpdateFrame=o._renderInfo.frame),f&&(d=r.getData3dUI(e),a=d.getCachedTexture(n),a&&d.interactiveInfo&&a.interactiveInfo&&(d.interactiveInfo[a.interactiveInfo.key]=a.interactiveInfo.info)),!a){var p,v=o._renderInfo.textureCache;if(f){if(v.time>u.graph3dMaxVectorCacheTime)return r.redraw(),o._emptyTexture;if(!ks(s,e))return o._emptyTexture}e&&(1!==e.s("texture.scale")?p=e.s("texture.scale"):1!==e.s("shape3d.texture.scale")&&(p=e.s("shape3d.texture.scale"))),p||(p=1);var _=e&&(e.s("fixSizeOnScreen")||e.s("shape3d.fixSizeOnScreen")),y=_?o.NEAREST:o.LINEAR;_?"number"==typeof _&&(p*=0>_?1:_):e&&(e.s("vector.dynamic")||e.s("shape3d.vector.dynamic"))&&(d||(d=r.getData3dUI(e)),_=d.getVectorDynamicSize());var m,b,x,w=e&&e.s("shape3d");"billboard"===w?x=e.getTall()/e.getWidth():"plane"===w&&(x=e.getHeight()/e.getWidth());var C=hc(s,e);if(_){var S=r.getDevicePixelRatio();m=_[0]>0?_[0]*S:p*C*S,b=_[1]>0?_[1]*S:p*(x?uc(s,e,r,Math.min(4096,C*x)):uc(s,e))*S}else m=p*C,b=p*(x?uc(s,e,r,Math.min(4096,C*x)):uc(s,e));if(m>=1&&b>=1){var I=0;(f||g)&&(I=Date.now());var M=xo(m,b);if(!d&&e&&(d=r.getData3dUI(e)),d&&d.interactiveInfo){var T=t;"object"==typeof T&&(T=T.uuid||(T.uuid=c.Math.generateUUID()));var E=d.interactiveInfo[T]={};M.interactiveInfo=E.bodyInfo={compInfos:[],matrix:new Ha,rect:{x:0,y:0,width:m,height:b}}}fc(M,s,0,0,m,b,e,r),M.interactiveInfo&&(M.interactiveInfo=null),M.restore(),v.count++,v.pixels+=m*b,e?(h.minFilter=e.s("texture.filter.min")||e.s("texture.filter")||y,h.magFilter=e.s("texture.filter.mag")||e.s("texture.filter")||y):h.minFilter=h.magFilter=y,f||g?(a=xf(o,mo,null,h),d.setCachedTexture(a,n),v.time+=Date.now()-I,E&&(a.interactiveInfo={key:T,info:E}),mo=null):a=xf(o,mo,r._1O,h)}}}}return a},redraw:function(){this.iv()},validateImpl:function(){var t=this;if(t._lightChanged){t._lightChanged=!1;var e=[],i=[],n=[];t.dm().each((function(t){if(Xd(t)){var r=t.s("light.type");r===zd?e.push(t):r===kd?i.push(t):r===Rd&&n.push(t)}})),(e.length!==t._59O.length||i.length!==t._spots.length||n.length!==t._dirs.length)&&Cf(t),t._59O=e,t._spots=i,t._dirs=n}t._42(),t._1o.iv()},getRenderInfo:function(){var t=this.getGL();return t?t._renderInfo:void 0},getDebugTip:function(){var t=this,i=t.getRenderInfo();if(i){var n=t.getGL()._validBufCount||0,r="Draw Calls: "+i.calls+"<br/>Vertices: "+i.vertices+"<br/>Faces: "+i.faces+"<br/>Lines: "+i.lines+"<br/>Buffers: "+n+"<br/>Cache Models: "+e.keys(Yi).length+"<br/>Shape3d Models: "+e.keys(Qi).length;t.vr.isPresenting()&&(r+="<br/>VR fps: "+t.vr.getFps());var o=i.textureCache.count;if(r+="<br/>2D Dynamic Textures: "+i.textureCache.count,o>0){var a,s=i.textureCache.pixels;a=s>1e6?Math.round(s/1e6)+"M":s>1e3?Math.round(s/1e3)+"K":Math.round(s),r+="<br/>2D Dynamic pixels: "+a}return r}},_42:function(t,e){var i=this;if(!i._35O&&(!Wi||Fi(Wi))){var n,r;t&&(t instanceof ru?r=t:n=t);var o=i._canvas,a=i.getGL(),s=i._prg;if(a){var h=i.getWidth(),u=i.getHeight();if(h&&u){e?t||Ir(o,h,u,e):(e=i.getDevicePixelRatio(),t||h===o.clientWidth&&u===o.clientHeight||(Ir(o,h,u,e),h&&Math.abs(a.drawingBufferWidth-h*e)>1&&(i.setDevicePixelRatio(e=a.drawingBufferWidth/h),Ir(o,h,u,e)))),a.clear(a.COLOR_BUFFER_BIT),i.drawFilter||(a._renderInfo={calls:0,vertices:0,faces:0,lines:0,frame:t?i._frameId:++i._frameId,textureCache:{time:0,count:0,pixels:0},reflectDepth:0});var d,f=this._cameras,g=0,p=f.length,v=!1,_=c.Default.cameraPriority.skybox,y=c.Default.cameraPriority.main,m=c.Default.cameraPriority.top,b=h*e,x=u*e,w=function(){i.overlappingBox.clear(),i._81O=l,a.clear(a.DEPTH_BUFFER_BIT),a._picking=!!t;var e={_picking:!!t,_envmapReflectivity:i._envmapReflectivity||.5,_projectMatrix:i._projectMatrix=mf(i),_viewMatrix:yf(i,i._7O)};if(i._viewMatrix=Ol(i._7O),r){Zp(a,i,s,e);var o=a.getParameter(a.COLOR_CLEAR_VALUE);a.clearColor(0,0,0,0),a.disable(a.BLEND),Xf(a,s.aNormal),jf(a,i._cube.vs,l,s.aPosition),Gf(a,i._cube.is),qd(r,i,gt,0),qd(r,i,dt,6),qd(r,i,pt,12),qd(r,i,ft,18),qd(r,i,vt,24),qd(r,i,_t,30),qf(a,s.aNormal),Df(a,o)}else if(n){for(n.value=2;p>g;g++)if(d=f[g],!d.ignoreInPick){if(d.priority>=y)break;d.useDefaultProgram&&Zp(a,i,s,e),d.render(a,i,n)}Zp(a,i,s,e);o=a.getParameter(a.COLOR_CLEAR_VALUE);for(a.clearColor(0,0,0,0),a.disable(a.BLEND),a.textureBatch&&!Fi[(ONE_FRAME_TIME-6)/2]||i._95I(a,s,n),zg(i,n),Rg(i,i._polylineModelMap,n),Rg(i,i._wireframeModelMap,n),Nf(a,s.uTransparent,!0),i._95I(a,s,n,!0),zg(i,n,!0),Rg(i,i._polylineModelMap,n,!0),Rg(i,i._wireframeModelMap,n,!0),Nf(a,s.uTransparent,!1);p>g;g++)if(d=f[g],!d.ignoreInPick){if(d.priority>=m)break;d.useDefaultProgram&&Zp(a,i,s,e),d.render(a,i,n),v=!0}for(v&&(Zp(a,i,s,e),v=!1),a.clear(a.DEPTH_BUFFER_BIT),i._swapLineMap(),i._95I(a,s,n,!1,!0),Rg(i,i._polylineModelMap,n),Rg(i,i._wireframeModelMap,n),i._swapLineMap(),i._swapLineMap(),i._95I(a,s,n,!1,!0),Rg(i,i._polylineModelMap,n),Rg(i,i._wireframeModelMap,n),Nf(a,s.uTransparent,!0),i._95I(a,s,n,!0,!0),Rg(i,i._polylineModelMap,n,!0),Rg(i,i._wireframeModelMap,n,!0),Nf(a,s.uTransparent,!1),i._swapLineMap(),a.disable(a.DEPTH_TEST),i.drawFilter||i._30O._42(a,s,n),a.enable(a.DEPTH_TEST);p>g;g++)d=f[g],d.ignoreInPick||(d.useDefaultProgram&&Zp(a,i,s,e),d.render(a,i,n));Df(a,o)}else{for(;p>g&&(d=f[g],!(d.priority>=_));g++)d.useDefaultProgram&&Zp(a,i,s,e),d.render(a,i);for(Zp(a,i,s,e),a.disable(a.BLEND),i.drawSky(a,s),i.drawReflectors(a,b,x,w,t)&&(e._projectMatrix=i._projectMatrix=mf(i),e._viewMatrix=yf(i,i._7O),i._viewMatrix=Ol(i._7O),Zp(a,i,s,e));p>g&&(d=f[g],!(d.priority>=y));g++)d.useDefaultProgram&&Zp(a,i,s,e),d.render(a,i),v=!0;for(v&&(Zp(a,i,s,e),v=!1),i._31O._42(a,s),i._95I(a,s),zg(i),Rg(i,i._polylineModelMap),Rg(i,i._wireframeModelMap),a.enable(a.BLEND),a.depthMask(!1),Nf(a,s.uTransparent,!0),i._95I(a,s,l,!0),zg(i,l,!0),Rg(i,i._polylineModelMap,l,!0),Rg(i,i._wireframeModelMap,l,!0),a.depthMask(!0),Nf(a,s.uTransparent,!1);p>g&&(d=f[g],!(d.priority>=m));g++)d.useDefaultProgram&&Zp(a,i,s,e),d.render(a,i),v=!0;for(v&&(Zp(a,i,s,e),v=!1),a.clear(a.DEPTH_BUFFER_BIT),i._swapLineMap(),a.disable(a.BLEND),i._95I(a,s,l,!1,!0),Rg(i,i._polylineModelMap),Rg(i,i._wireframeModelMap),a.enable(a.BLEND),Nf(a,s.uTransparent,!0),a.depthMask(!1),i._95I(a,s,l,!0,!0),Rg(i,i._polylineModelMap,l,!0),Rg(i,i._wireframeModelMap,l,!0),a.depthMask(!0),Nf(a,s.uTransparent,!1),i._swapLineMap(),a.disable(a.DEPTH_TEST),a.disable(a.BLEND),i._32O._42(a,s),i._30O._42(a,s),i._highlightHelper._42(a,s),a.enable(a.DEPTH_TEST);p>g;g++)d=f[g],d.useDefaultProgram&&Zp(a,i,s,e),d.render(a,i)}jf(a,l),Gf(a,l)},C=!1,S=i.vr;S.enable&&S._42(a,b,x,w)&&(C=!0);var I=i.envRenderer;I&&I.enable&&I._42(a,b,x,w)&&(C=!0);var M=i._postProcessing;M._42(a,b,x,w,t)&&(C=!0),C||(i.setViewport(a,0,0,h*e,u*e),w()),i._33Q=!1,i.drawFilter||i.countFrame(),i._doBufferGC(a)}}}},drawReflectors:function(t,e,i,n,r){t._renderInfo.reflectDepth++;var o,a,s,l=this,c=l._dataModel.getReflectors(),h=!1;for(o in c)a=c[o],l.isVisible(a)&&(s=l.getData3dUI(a),s&&s.drawReflector(t,e,i,n,r)&&(h=!0));return t._renderInfo.reflectDepth--,h},getPostProcessing:function(){return this._postProcessing},enablePostProcessing:function(t,e){return this._postProcessing.enableModule(t,e)},getPostProcessingModule:function(t){return this._postProcessing.getModule(t)},getPostProcessingValue:function(t,e){var n=this._postProcessing.getModule(t);return n?n[e]:i},setPostProcessingValue:function(t,e,i){var n=this.getPostProcessingValue(t,e),r=this._postProcessing.getModule(t);r&&n!==i&&("enable"===e?this.enablePostProcessing(t,i):r[e]=i,this.firePropertyChange("postProcessing."+t+"."+e,n,i))},setViewport:function(t,e,i,n,r){this._viewport=[e,i,n,r],t.viewport(e,i,n,r)},getViewport:function(){return this._viewport},setBufferGCInterval:function(t){this._bufferGCInterval=t},_doBufferGC:function(t,e){var i,n,r=t._bufPool,o=0,a=0,s=t._renderInfo.frame,l=this._bufferGCInterval||10;for(i in r)o++,n=r[i],n&&(e||s-n._fid>l?(t.deleteBuffer(n._buf),n._buf=null,r[i]=null):a++);if(o/2>a&&o>128){var c={};for(i in r)r[i]&&(c[i]=r[i]);t._bufPool=c}t._validBufCount=a},_swapLineMap:function(){var t=this;tt=t._polylineModelMap,t._polylineModelMap=t._polylineModelMapSwap,t._polylineModelMapSwap=tt,tt=t._wireframeModelMap,t._wireframeModelMap=t._wireframeModelMapSwap,t._wireframeModelMapSwap=tt,tt=t._polylineIndexMap,t._polylineIndexMap=t._polylineIndexMapSwap,t._polylineIndexMapSwap=tt,tt=t._wireframeIndexMap,t._wireframeIndexMap=t._wireframeIndexMapSwap,t._wireframeIndexMapSwap=tt},_updateSkyBox:function(t){if(this._skyBox&&t){var e=t.property,i=!1,n=this._skyBox;if("eye"===e||"forceUpdate"===e){var r=this._eye;n.p3(r[0],r[1],r[2]),i=!0}if("near"===e||"far"===e||"forceUpdate"===e){var o=this._near,a=this._far,s=n.getFinalScale3d();if(s[0]/=2,s[1]/=2,s[2]/=2,s[0]<=o||s[0]>=a||s[1]<=o||s[1]>=a||s[2]<=o||s[2]>=a){var l=2*o*a/(o+a),c=Math.min(s[0],s[1],s[2]),h=l/c,u=n.getScale3d();n.setScale3d(u[0]*h,u[1]*h,u[2]*h),i=!0}}i&&this.invalidateData(n)}},getSkyBox:function(){return this._skyBox},setSkyBox:function(t){var e=this._skyBox;e&&(this._skyBoxStyleMap&&e.setStyleMap(this._skyBoxStyleMap),this._skyBoxStyleMap=null,this._skyBoxAnchor3d&&e.setAnchor3d(this._skyBoxAnchor3d),this._skyBoxAnchor3d=null,this._skyBoxP3&&e.p3(this._skyBoxP3),this._skyBoxP3=null),this._skyBox=t,this.ump(this._updateSkyBox,this),t&&(t.dm()&&t.dm().remove(t),this._skyBoxStyleMap=c.Default.clone(t.getStyleMap()),this._skyBoxAnchor3d=t.getAnchor3d(),t.setAnchor3d(.5,.5,.5),this._skyBoxP3=t.p3().slice(0),t.s({"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!1,"all.reverse.flip":!0,"all.reverse.cull":!1,"front.reverse.flip":!0,"front.reverse.cull":!1,"back.reverse.flip":!0,"back.reverse.cull":!1,"left.reverse.flip":!0,"left.reverse.cull":!1,"right.reverse.flip":!0,"right.reverse.cull":!1,"top.reverse.flip":!0,"top.reverse.cull":!1,"bottom.reverse.flip":!0,"bottom.reverse.cull":!1}),this.mp(this._updateSkyBox,this),this._updateSkyBox({property:"forceUpdate"})),this.fp("skyBox",e,t)},drawSky:function(t,e,i){var n=this,r=n._skyBox;if(r){var o=n._headlightIntensity,a=Co(n._headlightColor);e=n._prg;1!==o&&(a=[a[0]*o,a[1]*o,a[2]*o]),Nf(t,e.uHeadlightColor,[a[0],a[1],a[2],1]);var s=n.getData3dUI(r);if(s){var l,c=n.isOrtho(),h=c||this._computedProjectMatrix;h&&(l=n._projectMatrix,c&&(n._ortho=!1),Nf(t,e.uPMatrix,n._projectMatrix=mf(n,!0)));var u=r.p3(),d=this._eye;(u[0]!==d[0]||u[1]!==d[1]||u[2]!==d[2])&&(r._position.x=d[0],r._54O=d[1],r._position.y=d[2]),s._42(t,e,i,(function(){return!0})),h&&(c&&(n._ortho=!0),Nf(t,e.uPMatrix,n._projectMatrix=l))}t.clear(t.DEPTH_BUFFER_BIT),Nf(t,e.uHeadlightColor,[a[0],a[1],a[2],n._headlightDisabled?1:0])}},_95I:function(t,e,i,n,r){function o(n){if(!(!n.s("alwaysOnTop")&&!n.s("shape3d.alwaysOnTop"))==!!r&&a.isVisible(n)&&(!N||q)){if(!i&&a.isTransparentMask(n))return;var o=a.getData3dUI(n);o&&o._42(t,e,i,s)}}var a=this,s=function(t){return n?t:!t};a.sky&&t.clear(t.DEPTH_BUFFER_BIT);var l=a.drawFilter;l?a.dm().each((function(t){l(t)||o(t)})):a.dm().each((function(t){o(t)}))},getLogicalPoint:function(t){return dl(t,this._canvas)},isRectOverlapping:function(t){var e=this.getData3dUI(t);return e._rectOverlapping},getHitFaceInfo:function(t){t.target&&(t=this.lp(t));var e=this.getDataInfoAt(t);if(e){var i=this._1o.face(e.data,Tn(t.x,t.y));if(i)return{data:e.data,face:i}}return l},unproject:function(t,e){var i=this,n=i.getWidth(),r=i.getHeight(),o=t.target?i.lp(t):t,a=o.x-n/2,s=o.y-r/2,l=a/n*2,c=-1*s/r*2;e=e||0;var h=Pl(),u=mf(i),d=yf(i);uf(h,u,d),lf(h);var f=Al([l,c,e,1],h);return[f[0]/f[3],f[1]/f[3],f[2]/f[3]]},getDataAt:function(t){var e=this.getDataInfoAt(t);return e?e.data:l},getDataInfoAt:function(t,e){return t.target&&(t=this.lp(t)),this._1o.get(Tn(t.x,t.y,e),!0)},getDatasInRect:function(t){return this._1o.get(t)},setEditable:function(t){var e=this,i=e._editable;e._editable=t,this.fp(Re,i,t)},isEditable:function(t){var e=this;return t?!!e._editable&&(!!Fn(t)&&(!!t.s("3d.editable")&&(!e._editableFunc||e._editableFunc(t)))):e._editable},isSelectable:function(t){return t.s("3d.selectable")&&this.sm().isSelectable(t)},isMovable:function(t){var e=this;return(!jn(t)||t.getStyle(se)===Nt)&&(!!t.s("3d.movable")&&(!e._movableFunc||e._movableFunc(t)))},isSizeEditable:function(t){return!!Fn(t)&&(!this._sizeEditableFunc||this._sizeEditableFunc(t))},isRotationEditable:function(t){return!(!Fn(t)||!1===t.IRotatable)&&(!this._rotationEditableFunc||this._rotationEditableFunc(t))},handleDelete:function(){this._editable&&this.removeSelection()},zoomIn:function(t){this.setZoom(Is,t)},zoomOut:function(t){this.setZoom(1/Is,t)},setZoom:function(){var t=new Na,e=new Na,i=new Na,n=new Na;return function(r,o){if(1!==r){var a=this;a._14o&&a._14o.stop(!0);var s,l=1/r;t.copy(a.getCenter()),e.copy(a.getEye());var c=a._ortho;if(c){if(s=a._orthoWidth,s<a._moveStep&&r>1)return}else if(t.distanceTo(e)<a._moveStep&&1>l)return;var h=!1;return!1===a._zoomToCenter&&a._lastZoomLP&&(i.copy(e).sub(t).normalize(),a._81O=null,n.copy(a.getHitPosition(a._lastZoomLP,t.toArray(),i.toArray())),h=!0,a._lastZoomHit=n),(o=Xn(o))?(o.action=function(r){a.fi({kind:a._zooming?"betweenZoom":"beginZoom"}),a._zooming=1;var o=(l-1)*r+1;c&&a.setOrthoWidth(s*o),h?(a.setEye(i.lerpVectors(n,e,o).toArray()),a.setCenter(i.lerpVectors(n,t,o).toArray())):c||a.setEye(i.lerpVectors(t,e,o).toArray())},o._37o=function(){delete a._14o,delete a._zooming,a.fi({kind:"endZoom"}),a.onZoomEnded()},a._14o=Us(o)):(c&&a.setOrthoWidth(s*l),void(h?(a.setEye(i.lerpVectors(n,e,l).toArray()),a.setCenter(i.lerpVectors(n,t,l).toArray())):c||a.setEye(i.lerpVectors(t,e,l).toArray())))}}}(),setOrthoZoom:function(t,e){return this.setZoom(t,e)},getPositionInfo:function(t){var e=this,i=e._eye,n=e._center,r=e.getAspect(),o=t?El(Ml(n,i,!0),Ml(t,i)):nl(i,n);if(e._ortho){var a=e._orthoWidth;return{length:o,height:a/r,width:a}}var s=2*H(e._fovy/2)*o;return{length:o,height:s,width:s*r}},getCenterInfo:function(){var t=this;return t._81O||(t._81O=t.getPositionInfo()),Hs(t._81O)},rotate:function(t,e,i,n){var r=this;if(t||e){n==l&&(n=r._firstPersonMode),r._88O&&r._88O.stop(!0);var o=r._center,a=r._eye,s=r.getCenterInfo().length,c=n?o:a,h=n?a:o,u=Ml(c,h),d=G(u[0],u[2]),f=G(E(u[0]*u[0]+u[2]*u[2]),u[1]),g=n?yt:mt;return n&&(e=-e),(i=Xn(i))?(i.action=function(i){r.fi({kind:r._rotating?"betweenRotate":"beginRotate"}),r._rotating=1;var o=d+t*i,a=f+e*i;a=n?L-tf(L-a):tf(a),u[0]=s*k(a)*k(o),u[1]=s*R(a),u[2]=s*k(a)*R(o),c[0]=h[0]+u[0],c[1]=h[1]+u[1],c[2]=h[2]+u[2],r.fp(g,l,c)},i._37o=function(){delete r._88O,delete r._rotating,r.fi({kind:"endRotate"}),r.onRotateEnded()},r._88O=Us(i)):(d+=t,f+=e,f=n?L-tf(L-f):tf(f),u[0]=s*k(f)*k(d),u[1]=s*R(f),u[2]=s*k(f)*R(d),c[0]=h[0]+u[0],c[1]=h[1]+u[1],c[2]=h[2]+u[2],void r.fp(g,l,c))}},pan:function(t,e,i,n){if(t||e){var r=this;n==l&&(n=r._firstPersonMode),r._89O&&r._89O.stop(!0);var o=yf(r),a=[o[0]*t,o[4]*t,o[8]*t],s=[o[1]*e,o[5]*e,o[9]*e],c=a[0]+s[0],h=a[1]+s[1],u=a[2]+s[2],d=r._center,f=r._eye;if(n){var g=og(r.getBoundaries(),f[0],f[2],f[0]+c,f[2]+u,E(c*c+u*u));c=g[0],u=g[1]}if(i=Xn(i)){var p=Hs(f),v=Hs(d);return i.action=function(t){r.fi({kind:r._panning?"betweenPan":"beginPan"}),r._panning=1,d[0]=v[0]+c*t,d[1]=v[1]+h*t,d[2]=v[2]+u*t,f[0]=p[0]+c*t,f[1]=p[1]+h*t,f[2]=p[2]+u*t,r.fp(mt,l,f),r.fp(yt,l,d)},i._37o=function(){delete r._89O,delete r._panning,r.fi({kind:"endPan"}),r.onPanEnded()},r._89O=Us(i)}d[0]+=c,d[1]+=h,d[2]+=u,f[0]+=c,f[1]+=h,f[2]+=u,r.fp(mt,l,f),r.fp(yt,l,d)}},walk:function(t,e,i){if(t){var n=this;i==l&&(i=n._firstPersonMode),n._90O&&n._90O.stop(!0);var r=n._center,o=n._eye,a=Ml(r,o,!0);if(i){var s=og(n.getBoundaries(),o[0],o[2],o[0]+a[0]*t,o[2]+a[2]*t,O(t));if(t=nl(s),!t)return;a=[s[0]/t,0,s[1]/t]}if(e=Xn(e)){var c=Hs(o),h=Hs(r);return e.action=function(e){n.fi({kind:n._walking?"betweenWalk":"beginWalk"}),n._walking=1;var i=t*e;o[0]=c[0]+a[0]*i,o[1]=c[1]+a[1]*i,o[2]=c[2]+a[2]*i,r[0]=h[0]+a[0]*i,r[1]=h[1]+a[1]*i,r[2]=h[2]+a[2]*i,n.fp(mt,l,o),n.fp(yt,l,r)},e._37o=function(){delete n._90O,delete n._walking,n.fi({kind:"endWalk"}),n.onWalkEnded()},n._90O=Us(e)}o[0]+=a[0]*t,o[1]+=a[1]*t,o[2]+=a[2]*t,r[0]+=a[0]*t,r[1]+=a[1]*t,r[2]+=a[2]*t,n.fp(mt,l,o),n.fp(yt,l,r)}},handleScroll:function(t,e){t.preventDefault();var i=this,n=i._moveStep,r=i.getDataInfoAt(t);if(r){var o=r.data;if(o&&i.isInteractive(o)){var a=i.intersectObject(t,o);if(a){var s=a.part,l=zs(o.s(s+".image")||o.s("shape3d."+s+".image")||o.s("all.image")||o.s("shape3d.image"));if(l&&dc(l.scrollable,o,i))return}}}return i.isFirstPersonMode()?void(i.isPannable()&&i.pan(0,e>0?n:-n)):void(i.isZoomable()&&(i._lastZoomLP=i.lp(t),i.setZoom(0>e?1/Ms:Ms),i._lastZoomLP=i._lastZoomHit=null))},handlePinch:function(t,e){if(this.isZoomable()){if(Math.abs(t-e)<u.pinchZoomThreshold)return;this.setZoom(e>t?1/Ts:Ts)}},reset:function(){this.setCenter(u.graph3dViewCenter),this.setEye(u.graph3dViewEye),this.setUp(u.graph3dViewUp)},moveSelection:function(t,e,i){var n=this;n.dm().beginTransaction(),na(this.sm().toSelection(this.isMovable,this),t,e,i),n.dm().endTransaction()},getMoveMode:function(t,e){var i=e.s("3d.move.mode");if(i)return i;var n="88",r="89",o="90";return $s(t)||Zi[n]&&Zi[r]&&Zi[o]?"xyz":Zi[n]&&Zi[r]?"xy":Zi[n]&&Zi[o]?"xz":Zi[r]&&Zi[o]?"yz":Zi[n]?"x":Zi[r]?"y":Zi[o]?"z":"xz"},handleTick:function(){var t=this,e=!1,i=t._moveStep,n=i,r=!1,o=!0,a=t._rotateStep*(o?-1:1);if(t.isWalkable()||(n=0),t.isPannable()||(i=0),t.isRotatable()||(a=0),t._32Q){var s=(mn()-t._32Q)/50;n*=s,i*=s,a*=s}t._31Q&&(Fs(t._31Q),delete t._31Q,delete t._32Q),oo()&&(e=!0,t.pan(-i,0,r,o)),so()&&(e=!0,t.pan(i,0,r,o)),lo()&&(e=!0,$s()?t.pan(0,i,r,o):t.walk(n,r,o)),ao()&&(e=!0,$s()?t.pan(0,-i,r,o):t.walk(-n,r,o)),co()&&(e=!0,t.rotate(-a,0,r,o)),uo()&&(e=!0,t.rotate(a,0,r,o)),ho()&&(e=!0,t.rotate(0,-a/2,r,o)),fo()&&(e=!0,t.rotate(0,a/2,r,o)),e&&(t._32Q=mn(),t._31Q=Ls(t.handleTick,t))},handleKeyDown:function(t){var e=this;!tl(t)&&_o[t.keyCode]?e.handleTick():to(t)?e.selectAll():eo(t)?e.handleDelete(t):go(t)&&this.isResettable()&&e.reset()},checkDoubleClickOnNote:function(t,e,i){var n=this;if(i===Jt){if(e.s("note.toggleable"))return e.s(ne,!e.s(ne)),n.fi({kind:"toggleNote",event:t,data:e,part:i}),!0}else if(i===Kt&&e.s("note2.toggleable"))return e.s(re,!e.s(re)),n.fi({kind:"toggleNote2",event:t,data:e,part:i}),!0;return!1},checkDoubleClickOnRotation:function(t,e,i){return i===gv?(e.setRotationX(0),!0):i===pv?(e.setRotationY(0),!0):i===vv&&(e.setRotationZ(0),!0)},onRotateEnded:function(){},onWalkEnded:function(){},getViewRatio:function(t){var e=this;if(e.isOrtho())return e.getWidth()/e.getOrthoWidth();var i=e.getCenter(),n=e.getHeight(),r=e.getEye(),o=[i[0]-r[0],i[1]-r[1],i[2]-r[2]],a=[t[0]-r[0],t[1]-r[1],t[2]-r[2]],s=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]),l=1/Math.tan(e.getFovy()/2);return n*s*l/(a[0]*o[0]+a[1]*o[1]+a[2]*o[2])},inViewSpace:function(t){var e,i=this,n=i._transformPointToViewSpace(t),r=i.getAspect(),o=i.getNear(),a=i.getFar();return!(-n[2]<o||-n[2]>a)&&(i.isOrtho()?(e=i.getOrthoWidth()/2,Math.abs(n[0])<=e&&Math.abs(n[1]*r)<=e):(e=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])*Math.tan(i.getFovy()/2),Math.abs(n[1]<=e)&&Math.abs(n[0])<=e*r))},getPVMatrix:function(){var t=this,e=t.getWidth()/2,i=t.getHeight()/2,n=t._18Q;return n&&n._wh===e/i||(n=mf(t),t._18Q=uf(n,n,yf(t)),t._18Q._wh=e/i),n},getFrustum:function(){var t=new Ka,e=new Ja,i=new Array(16);return function(){for(var n=this.getPVMatrix(),r=!1,o=0;16>o;o++)n[o]!==i[o]&&(r=!0,i[o]=n[o]);return r&&e.setFromMatrix(t.fromArray(n)),e}}(),toViewPosition:function(t){var e=this,i=e.getWidth()/2,n=e.getHeight()/2,r=e.getPVMatrix();return t=Al([t[0],t[1],t[2],1],r),{x:i+i*t[0]/t[3],y:n-n*t[1]/t[3],z:t[2]/t[3]}},getHitPosition:function(t,e,i){var n=this,r=n.getWidth(),o=n.getHeight(),a=t.target?n.lp(t):t,s=a.x-r/2,l=a.y-o/2,c=n.getCenterInfo(),h=yf(n);e=e||[0,0,0],i=i||[0,1,0],s=s/r*c.width,l=-1*l/o*c.height;var u=[h[0]*s,h[4]*s,h[8]*s],d=[h[1]*l,h[5]*l,h[9]*l],f=[u[0]+d[0],u[1]+d[1],u[2]+d[2]],g=n.getCenter(),p=nf(n,e,i,[f[0]+g[0],f[1]+g[1],f[2]+g[2]]);return p||[0,0,0]},intersectObject:function(t,e){return this._raycaster.intersectObject(t,e)},intersectObjects:function(t,e,i){return this._raycaster.intersectObjects(t,e,i)},getLineLength:function(t){this.validate();var e=this.getData3dUI(t);if(e&&e.getCache){var i=e.getCache();if(i)return i[i.length-1].length}return 0},getLineOffset:function(t,e){var i=this.getData3dUI(t);if(i&&i.getCache){var n=i.getCache();if(n){var r=yp(n,e);if(!t.r3)return r;var o=t.r3();if(0===o[0]&&0===o[1]&&0===o[2])return r;var a=new Na(t.p3()),s=new Na(r.point).sub(a),c=new Na(r.tangent).add(s),h=(new Ua).setFromEuler(new ts(o,t.getRotationMode(),!0));return s.applyQuaternion(h),c.applyQuaternion(h),{point:s.add(a),tangent:c.sub(s).normalize()}}}return l},isLabelVisible:function(){return!0},isNoteVisible:function(){return!0},moveCamera:function(t,e,i){var n=this,r=n.getEye();r=[r[0],r[1],r[2]];var o=n.getCenter();if(o=[o[0],o[1],o[2]],t||(t=r),e||(e=o),n._flyAnim&&n._flyAnim.stop(!0),i=Xn(i),!i)return n.setEye(t[0],t[1],t[2]),n.setCenter(e[0],e[1],e[2]),delete n._flyAnim,!0;var a=[t[0]-r[0],t[1]-r[1],t[2]-r[2]],s=[e[0]-o[0],e[1]-o[1],e[2]-o[2]];return i.action=function(t){n.setCenter(o[0]+s[0]*t,o[1]+s[1]*t,o[2]+s[2]*t),n.setEye(r[0]+a[0]*t,r[1]+a[1]*t,r[2]+a[2]*t)},i._37o=function(){delete n._flyAnim},n._flyAnim=Us(i)},flyTo:function(){function t(t,e,i){if(i instanceof c.Node){a.fromArray(jl(i,e.getMat(i)));var n=i.getAnchor3d();t.push((new Na).set(0-n.x,0-n.y,0-n.z).applyMatrix4(a)),t.push((new Na).set(0-n.x,0-n.y,1-n.z).applyMatrix4(a)),t.push((new Na).set(0-n.x,1-n.y,0-n.z).applyMatrix4(a)),t.push((new Na).set(0-n.x,1-n.y,1-n.z).applyMatrix4(a)),t.push((new Na).set(1-n.x,0-n.y,0-n.z).applyMatrix4(a)),t.push((new Na).set(1-n.x,0-n.y,1-n.z).applyMatrix4(a)),t.push((new Na).set(1-n.x,1-n.y,0-n.z).applyMatrix4(a)),t.push((new Na).set(1-n.x,1-n.y,1-n.z).applyMatrix4(a))}}var e=new Na,n=new Na,r=new Na,o=new Na,a=new Ka,s=new c.Math.Quaternion,l=new ts;return function(a,h,u){var d=this;if(u!==i)h={animation:h,ratio:u};else{var f=typeof h;("boolean"===f||"object"===f&&h.duration)&&(h={animation:h})}h=h||{},e.fromArray(d.getEye()),n.fromArray(d.getCenter());var g,p,v=[],_=h.center,y=h.distance===i;if(_&&r.fromArray(_),a instanceof c.Node)_||r.fromArray(a.p3()),y&&(t(v,d,a),g=v.length);else{if(a||(a=d.dm().getDatas()),!a.length)return;if((y||!_)&&(v=[],a.forEach((function(e){t(v,d,e)})),g=v.length,!g))return;if(!_){for(r.set(0,0,0),p=0;g>p;p++)r.add(v[p]);r.multiplyScalar(1/g)}}if(d.setCenter(r.x,r.y,r.z),o.subVectors(e,n),h.direction||h.worldDirection){!h.worldDirection&&a instanceof c.Node?s.setFromEuler(l.set(a.r3(),a.getRotationMode(),!0)):s.set(0,0,0,1);var m=o.length();o.fromArray(h.worldDirection||h.direction).applyQuaternion(s).setLength(m)}var b=0;if(y){u=h.ratio||.8;var x,w,C,S=h.xRatio||u,I=h.yRatio||u;if(d.isOrtho()){var M=-1/0;for(d._eye[0]=o.x+r.x,d._eye[1]=o.y+r.y,d._eye[2]=o.z+r.z,x=mf(d),uf(x,x,yf(d)),p=0;g>p;p++)C=v[p],w=Al([C.x,C.y,C.z,1],x),M=Math.max(M,Math.max(Math.abs(w[0])/S,Math.abs(w[1])/I));b=d.getOrthoWidth()*M,o.add(r)}else{for(var T,E,P=d.getNear(),D=10;D--;){for(d._eye[0]=o.x+r.x,d._eye[1]=o.y+r.y,d._eye[2]=o.z+r.z,x=mf(d),uf(x,x,yf(d)),T=!0,E=-1/0,p=0;g>p;p++){if(C=v[p],w=Al([C.x,C.y,C.z,1],x),w[3]<P&&D){o.multiplyScalar(2),T=!1;break}E=Math.max(E,Math.max(Math.abs(w[0])/S,Math.abs(w[1])/I)-w[3])}if(T)break}o.setLength(E+o.length()).add(r)}}else o.setLength(h.distance).add(r);d._flyAnim&&d._flyAnim.stop(!0);var O=Xn(h.animation);if(O){d.setEye(e.x,e.y,e.z),d.setCenter(n.x,n.y,n.z);var R=(new Na).subVectors(o,e),z=(new Na).subVectors(r,n);if(b)var k=d.getOrthoWidth();var A=new Na,V=new Na,B=O.action,L=O._37o,F=e.clone(),j=n.clone();return O.action=function(t,e){A.copy(F).addScaledVector(R,t),V.copy(j).addScaledVector(z,t),d.setCenter(V.x,V.y,V.z),d.setEye(A.x,A.y,A.z),b&&d.setOrthoWidth((b-k)*t+k),B&&B(t,e)},O._37o=function(){delete d._flyAnim,L&&L()},{lastEye:e,lastCenter:n,eye:o,center:r,orthoWidth:b,animation:d._flyAnim=Us(O)}}return d.setEye(o.x,o.y,o.z),b&&d.setOrthoWidth(b),delete d._flyAnim,{lastEye:e,lastCenter:n,eye:o,center:r,orthoWidth:b}}}(),getBoundingBox:function(){function t(t,i,n){e.fromArray(jl(n,i.getMat(n)));var r=n.getAnchor3d();t.push((new Na).set(0-r.x,0-r.y,0-r.z).applyMatrix4(e)),t.push((new Na).set(0-r.x,0-r.y,1-r.z).applyMatrix4(e)),t.push((new Na).set(0-r.x,1-r.y,0-r.z).applyMatrix4(e)),t.push((new Na).set(0-r.x,1-r.y,1-r.z).applyMatrix4(e)),t.push((new Na).set(1-r.x,0-r.y,0-r.z).applyMatrix4(e)),t.push((new Na).set(1-r.x,0-r.y,1-r.z).applyMatrix4(e)),t.push((new Na).set(1-r.x,1-r.y,0-r.z).applyMatrix4(e)),t.push((new Na).set(1-r.x,1-r.y,1-r.z).applyMatrix4(e))}var e=new Ka;return function(e){if(e=e||this.sm().getSelection(),e instanceof c.Node&&(e=[e]),0===e.length)return l;var i=[];e.forEach((function(e){t(i,this,e)}),this);var n=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];return i.forEach((function(t){n[0]=Math.min(t.x,n[0]),n[1]=Math.min(t.y,n[1]),n[2]=Math.min(t.z,n[2]),r[0]=Math.max(t.x,r[0]),r[1]=Math.max(t.y,r[1]),r[2]=Math.max(t.z,r[2])})),{min:n,max:r}}}()}),ag.RenderEnv=function(t){this.gv=t,this.enable=!1},e.defineProperties(ag.RenderEnv.prototype,{debugOn:{get:function(){return this._debugOn},set:function(t){this._debugOn=t,this.capture&&this.capture()}}}),e.assign(ag.RenderEnv.prototype,{renderEnvToCube:function(t,e,i,n){var r=this,o=r.gv;if(!t||!e||!i)return r.enable=!1,void(r._42=null);r.enable=!0;var a=Math.floor(n/t*e),s=o.getGL(),l=r._renderTargets;l?l.length<i&&(l=r._renderTargets=l.concat(new Array(i-l.length))):l=r._renderTargets=new Array(i);for(var c=0;i>c;c++)l[c]?l[c].setSize(s,n,a):l[c]=new ag.RenderTarget(o,s,n,a);var h=!1;r.capture=function(){h=!0,o._42(),h=!1};var u=new Na,d=new Na,f=new Na,g=new Na,p=(new Na).setY(0),v=2*Math.PI/i,_=t/2/Math.tan(Math.PI/i),y=2*Math.atan2(e/2,_),m=t/e;r._42=function(t,e,n,a){var s=r._debugOn;if(!h&&!s)return!1;u.copy(o.getEye()),g.copy(o.getCenter()).sub(u);var c=Math.atan2(g.z,g.x),b=o.getNear(),x=o.getFovy(),w=o.getAspect();d.copy(o.getCenter());for(var C,S=0;i>S;S++)if(C=l[S],p.setZ(Math.cos(c)).setX(Math.sin(c)).multiplyScalar(_),c-=v,f.addVectors(u,p),o.setNear(_),o.setCenter([f.x,f.y,f.z]),o.setFovy(y),o.setAspect(m),s){var I=Math.round(e/i);t.viewport(I*S,0,I,n),a()}else jd(t,C.frame),t.viewport(0,0,C.width,C.height),t.clear(t.COLOR_BUFFER_BIT),a(),Hd(t),C.assureTexture();return o.setNear(b),o.setCenter([d.x,d.y,d.z]),o.setFovy(x),o.setAspect(w),!0},r.capture()},getTextureInfo:function(t){var e=this._renderTargets;if(!e)return null;var i=this._renderTargets[t];return i?{index:t,texture:i.texture,textureName:i.uuid}:null}}),e.assign(ag.Graph3dView.prototype,{renderEnvToCube:function(t,e,i,n){var r=this;r.envRenderer||(r.envRenderer=new ag.RenderEnv(r)),r.envRenderer.renderEnvToCube(t,e,i,n)}}),ag.RenderTarget=function(t,e,i,n,r){var o=this;r=r||{},r.samples=Math.min(t._glCapabilities.maxSamples,r.samples&&r.samples>1&&2===t._webGLVersion?r.samples:0),o.options=r,o.uuid=c.Math.generateUUID(),o.gv=t,o.init(t,e,r),r.samples&&!t._glCapabilities._maxSamplesChecked?o.setSize(e,i||1,n||1):o.setSize(e,i,n)},e.assign(ag.RenderTarget.prototype,{bind:function(t){jd(t,this.options.samples?this._MSAAFbo:this.frame)},unbind:function(t){Hd(t),this.options.samples&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,this._MSAAFbo),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.frame),t.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,t.COLOR_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null))},init:function(t,e,i){var n=this,r=n.texture=e.createTexture();e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r);var o=i.samples,a=o?e.NEAREST:e.LINEAR;e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i.minFilter||a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i.magFilter||a),e.bindTexture(e.TEXTURE_2D,null),n.render=e.createRenderbuffer(),n.frame=e.createFramebuffer(),t._2O[n.uuid]=r},assureTexture:function(){var t=this,e=t.uuid,i=t.gv._2O;i[e]||(i[e]=t.texture)},setSize:function(t,e,i){var n=this;if(e&&i&&(n.width!==e||n.height!==i)){var r=t.RGBA,o=t.TEXTURE_2D,a=t.RENDERBUFFER,s=t.FRAMEBUFFER,c=n.options.samples;if(Mf(t,n.texture),t.texImage2D(o,0,r,e,i,0,r,t.UNSIGNED_BYTE,l),ja.isPOT(e)&&ja.isPOT(i)&&!n.options.clampToEdge?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),t.bindRenderbuffer(a,n.render),c){var h=n.gv._glCapabilities;if(h._maxSamplesChecked)t.renderbufferStorageMultisample(a,c,t.DEPTH_COMPONENT16,e,i);else{for(t.getError();c>1&&(t.renderbufferStorageMultisample(a,c,t.DEPTH_COMPONENT16,e,i),t.getError());)c=Math.floor(c>>1);1>=c&&(c=0,t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n.options.minFilter||t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n.options.magFilter||t.LINEAR),t.renderbufferStorage(a,t.DEPTH_COMPONENT16,e,i)),h._maxSamplesChecked=!0,h.maxSamples=n.options.samples=c}}else t.renderbufferStorage(a,t.DEPTH_COMPONENT16,e,i);c&&!n._MSAAFbo&&(n._MSAAFbo=t.createFramebuffer(),n._MSAARbO=t.createRenderbuffer()),jd(t,n.frame),t.framebufferTexture2D(s,t.COLOR_ATTACHMENT0,o,n.texture,0),c||t.framebufferRenderbuffer(s,t.DEPTH_ATTACHMENT,a,n.render),Hd(t),c&&(t.bindRenderbuffer(t.RENDERBUFFER,n._MSAARbO),t.renderbufferStorageMultisample(t.RENDERBUFFER,c,t.RGBA8,e,i),jd(t,n._MSAAFbo),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,n._MSAARbO),t.framebufferRenderbuffer(s,t.DEPTH_ATTACHMENT,a,n.render),Hd(t)),Mf(t,l),t.bindRenderbuffer(a,l),n.width=e,n.height=i}},toCanvas:function(){var t=this,e=t.gv.getGL();jd(e,t.frame);var i=t.width,n=t.height,r=new Uint8Array(4*i*n);e.readPixels(0,0,i,n,e.RGBA,e.UNSIGNED_BYTE,r),Hd(e);var o=s.createElement("canvas");o.width=i,o.height=n;var a=o.getContext("2d"),l=a.createImageData(i,n);return l.data.set(r),a.putImageData(l,0,0),o}});var Kp=ag.Interactor=function(t){this.gv=this.g3d=t};sg("Interactor",e,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()}});var $p=ag.DefaultInteractor=function(t){Kn($p,this,[t])};sg("DefaultInteractor",Kp,{getDataInfoAt:function(t,e){var i=this.gv,n=i.getDataInfoAt(t);if(!i.isBlockSelectable()||!n||!n.data)return n;if(!e&&i.isSelected(n.data))return n;for(var r=n.data;(r=r.getParent())&&r instanceof c.Block&&i.isSelectable(r);){var o=i.isSelected(r);if(o&&e)break;if(n={data:r,part:n},o&&!e)break}return n},handle_contextmenu:function(t){Os(t)},handle_mousewheel:function(t){this.gv.handleScroll(t,t.wheelDelta/40)},handle_DOMMouseScroll:function(t){2===t.axis&&this.gv.handleScroll(t,-t.detail)},handle_keydown:function(t){this.gv.handleKeyDown(t)},handle_mousedown:function(t){this.handle_touchstart(t)},handle_touchstart:function(t){Os(t);var e=this,i=e.gv,n=Qs(t),r=e.getDataInfoAt(t),o=r?r.data:l,a=r?r.part:l,s=i.sm(),c=Kr(t),h=Js(t);i.setFocus(t)&&(e._62O=l,e._57I=l,e.pendingClickThrough=l,e.__lastClientPoint__=el(t),o?tl(t)?s.co(o)?s.rs(o):s.as(o):s.co(o)?o instanceof du&&o.isClickThroughEnabled()&&Qs(t)&&(e.pendingClickThrough=el(t)):s.ss(o):n&&(tl(t)?i.isRectSelectable()&&(e._62O=ge):e._57I=el(t)),e._31Q&&(Fs(e._31Q),delete e._31Q,delete e._32Q),e._62O||(i.isFirstPersonMode()&&($s(t)||Ys(t)||h>2?e._62O="pan":i.isMouseRoamable()||Nr(t)?(e._62O="roaming",e.foward=c&&Qs(t),e._32Q=mn(),e._31Q=Ls(e.tick,e)):n||(e._62O="roaming")),e._62O||(n&&c&&bv[a]?(e._62O=a,e.p3=o.p3()):n&&c&&Fn(o)&&i.isSelected(o)?i.isMovable(o)?(e._62O="move",e.p3=o.p3(),e.movedata=o):i._39Q(o)&&(e._62O="none"):Nr(t)&&(h>2?e._62O="pan":2===h&&(e.dist=Jo(t),e._62O="pinch")))),e.point=i.lp(t),gl(e,t),Ks(t)?i.handleDoubleClick(t,o,a):i.handleClick(t,o,a))},tick:function(){var t=this,e=t.gv,i=e._moveStep;t.point&&e.isWalkable()&&(t._32Q&&(i*=(mn()-t._32Q)/50),e.walk(t.foward?i:-i),t._32Q=mn(),t._31Q=Ls(t.tick,t))},handle_mouseup:function(t){this.handle_touchend(t)},handle_touchend:function(t){var e=this._57I;if(e&&(nl(e,el(t))<=1&&this.gv.sm().cs(),this._57I=l),e=this.pendingClickThrough){if(nl(e,el(t))<=1){var i=this.getDataInfoAt(t);i&&i.data instanceof du&&i.data.isClickThroughEnabled()&&(i=this.getDataInfoAt(t,!0),i&&(t.clickThrough=!0,this.gv.sm().ss(i.data)))}this.pendingClickThrough=null}},handleWindowMouseMove:function(t){this.handleWindowTouchMove(t)},handleWindowTouchMove:function(t){var e,i,n=this,r=n.gv,o=n._62O,a=n.point,s=r.dm(),l=r.lp(t),c=l.x-a.x,h=l.y-a.y,d=r.getWidth(),f=r.getHeight();if(d&&f){var g=el(t),p=Uc(r,g,n.__lastClientPoint__),v=nl({x:0,y:0},p),_=-F*c/d,y=-F*h/f;if("roaming"===o)n.rotate(t,_/2,y/2);else if(o===gv||o===pv||o===vv)r._86O||s.beginTransaction(),r.fi({kind:r._86O?"betweenEditRotation":"beginEditRotation",event:t}),r._86O=1,r.sm().each((function(t){if(Fn(t)&&r.isRotationEditable(t)){var e=O(_)>O(y)?_:y;o===gv?t.setRotationX(t.getRotationX()+e):o===pv?t.setRotationY(t.getRotationY()+e):o===vv&&t.setRotationZ(t.getRotationZ()+e)}}));else if("move"===o||bv[o]){if(o===_v||o===yv||o===mv)r._87O||s.beginTransaction(),r.fi({kind:r._87O?"betweenEditScale":"beginEditScale",event:t}),r._87O=1;else{if(!r._moving){if(v<u.touchMoveThreshold)return;s.beginTransaction()}r.fi({kind:r._moving?"betweenMove":"beginMove",event:t}),r._moving=1}var m,b=n.p3,x=r.getPositionInfo(b),w=yf(r);m=o===uv?"x":o===dv?"y":o===fv?"z":o===_v?"sx":o===yv?"sy":o===mv?"sz":r.getMoveMode(t,n.movedata),c=c/d*x.width,h=-1*h/f*x.height;var C,S=[w[0]*c,w[4]*c,w[8]*c],I=[w[1]*h,w[5]*h,w[9]*h],M=S[0]+I[0],T=S[1]+I[1],E=S[2]+I[2],P=[b[0]+M,b[1]+T,b[2]+E],D=Ml(r.getEye(),P,!0);if("xyz"===m?(C=P,r.moveSelection(M,T,E)):"xz"===m?(C=nf(r,b,[0,1,0],P),C&&r.moveSelection(C[0]-b[0],0,C[2]-b[2])):"xy"===m?(C=nf(r,b,[0,0,1],P),C&&r.moveSelection(C[0]-b[0],C[1]-b[1],0)):"yz"===m?(C=nf(r,b,[1,0,0],P),C&&r.moveSelection(0,C[1]-b[1],C[2]-b[2])):"x"===m||"sx"===m?(D[0]=0,C=nf(r,b,D,P),C&&(z=C[0]-b[0],"x"===m?r.moveSelection(z,0,0):r.sm().each((function(n){Fn(n)&&r.isSizeEditable(n)&&(e=n.getScaleX()+z/100,i=e/n.getScaleX(),n.setScaleX(e),$s(t)&&(n.setScaleY(n.getScaleY()*i),n.setScaleTall(n.getScaleTall()*i)))})))):"y"===m||"sy"===m?(D[1]=0,C=nf(r,b,D,P),C&&(z=C[1]-b[1],"y"===m?r.moveSelection(0,z,0):r.sm().each((function(n){Fn(n)&&r.isSizeEditable(n)&&(e=n.getScaleTall()+z/100,i=e/n.getScaleTall(),n.setScaleTall(e),$s(t)&&(n.setScaleY(n.getScaleY()*i),n.setScaleX(n.getScaleX()*i)))})))):("z"===m||"sz"===m)&&(D[2]=0,C=nf(r,b,D,P),C&&(z=C[2]-b[2],"z"===m?r.moveSelection(0,0,z):r.sm().each((function(n){Fn(n)&&r.isSizeEditable(n)&&(e=n.getScaleY()+z/100,i=e/n.getScaleY(),n.setScaleY(e),$s(t)&&(n.setScaleX(n.getScaleX()*i),n.setScaleTall(n.getScaleTall()*i)))})))),!C)return;n.p3=C}else if(o===ge){var R=n.div;R||(R=n.div=xr(),Mr(n.getView(),R),R.op=a,R.style.background=r.getRectSelectBackground()),r.fi({kind:r._rectSelecting?"betweenRectSelect":"beginRectSelect",event:t}),r._rectSelecting=1,R.rect=rl(R.op,l),Gr(R,R.rect)}else if("pinch"===o&&2===Js(t)){r.fi({kind:r._pinching?"betweenPinch":"beginPinch",event:t}),r._pinching=1;var z=Jo(t);r._lastZoomLP||(r._lastZoomLP=Ko(t)),r.handlePinch(z,n.dist),n.dist=z}else"pan"===o||$s(t)||Ys(t)?n.pan(t,c,h):"none"===o||r.isFirstPersonMode()||n.rotate(t,_,y);n.point=l}},pan:function(t,e,i){var n=this.gv;if(n.isPannable()){var r=n.getWidth(),o=n.getHeight();if(!r||!o)return;var a=n.getCenterInfo(),s=e/r*a.width,l=-1*i/o*a.height;n.fi({kind:n._panning?"betweenPan":"beginPan",event:t}),n._panning=1,n.pan(-s,-l)}},rotate:function(t,e,i){var n=this.gv;n.isRotatable()&&(n.fi({kind:n._rotating?"betweenRotate":"beginRotate",event:t}),n._rotating=1,n.rotate(e,i))},handleWindowMouseUp:function(t){this.handleWindowTouchEnd(t)},handleWindowTouchEnd:function(t){var e=this,i=e.gv,n=i.dm(),r=e.div;if(r){var o=i.getDatasInRect(r.rect);if(!o.isEmpty()){var a=i.sm(),s=a.toSelection();o.each((function(t){a.co(t)?s.remove(t):s.add(t)})),a.ss(s)}pl(r)}i._moving&&(delete i._moving,i.fi({kind:"endMove",event:t}),i.onMoveEnded(),n.endTransaction()),i._panning&&(delete i._panning,i.fi({kind:"endPan",event:t}),i.onPanEnded()),i._rotating&&(delete i._rotating,i.fi({kind:"endRotate",event:t}),i.onRotateEnded()),i._86O&&(delete i._86O,i.fi({kind:"endEditRotation",event:t}),n.endTransaction()),i._87O&&(delete i._87O,i.fi({kind:"endEditScale",event:t}),n.endTransaction()),i._pinching&&(delete i._pinching,i.fi({kind:"endPinch",event:t}),i.onPinchEnded()),i._rectSelecting&&(delete i._rectSelecting,i.fi({kind:"endRectSelect",event:t}),i.onRectSelectEnded()),i._walking&&(delete i._walking,i.fi({kind:"endWalk",event:t}),i.onWalkEnded()),i._lastZoomLP=i._lastZoomHit=null,e.dist=e.point=e._62O=e.p3=e.movedata=e.div=e._57I=e.pendingClickThrough=e._32Q=e._31Q=e.foward=l,e.__lastClientPoint__=l}});var tv=ag.MapInteractor=function(t){Kn(tv,this,[t]),this._keepHorizon=!0,this._threshold=2,this._touchScaleThreshold=.05,this._touchRotateThreshold=.03,this._touchScaleCheckAccuracy=.01,this._panButton="right",this.maxPhi=5*Math.PI/12};sg("MapInteractor",Kp,{handle_contextmenu:function(t){Os(t)},handle_mousewheel:function(t){this.gv.handleScroll(t,t.wheelDelta/40)},handle_DOMMouseScroll:function(t){2===t.axis&&this.gv.handleScroll(t,-t.detail)},handle_keydown:function(t){this.gv.handleKeyDown(t)},handle_mousedown:function(t){this.handle_touchstart(t)},handle_touchstart:function(t){Os(t);var e=this,i=e.gv;if(i.setFocus(t)){var n=i.getDataInfoAt(t),r=n?n.data:l,o=n?n.part:l,a=e.editing={point:i.lp(t)};Nr(t)?a.touch=!0:(a.touch=!1,a.clickLeft=Qs(t),a.pan=!!Ys(t)||"left"===this.panButton===a.clickLeft),r&&i._39Q(r)&&(a.preventDefault=!0),gl(e,t),Ks(t)?i.handleDoubleClick(t,r,o):i.handleClick(t,r,o)}},handle_mouseup:function(t){this.handle_touchend(t)},handle_touchend:function(){},handleWindowMouseMove:function(t){this.handleWindowTouchMove(t)},handleWindowTouchMove:function(t){var e=this,i=e.gv,n=e.editing;if(n){var r=i.lp(t),o=n.point,a=r.x-o.x,s=r.y-o.y;if(!n.moved){if(Math.abs(a)<e.threshold&&Math.abs(s)<e.threshold&&!(t.touches&&t.touches.length>1))return;n.moved=!0}if(!n.preventDefault)if(n.point=r,n.touch){var c=t.touches.length;if(2!==c)e.pan(t,a,s);else{if(1>=c)return;var h=t.touches,u={x:h[0].clientX,y:h[0].clientY},d={x:h[1].clientX,y:h[1].clientY},f={x:d.x-u.x,y:d.y-u.y},g=n.lastCenter,p=Math.atan2(f.y,f.x),v=n.theta,_=0;v==l?v=n.theta=p:(_=p-v,n.thetaStarted||Math.abs(_)>e.touchRotateThreshold?(n.thetaStarted=!0,n.theta=p):_=0);var y=L*(u.y+d.y)/2/i.getHeight(),m=n.phi,b=0;m==l?m=n.phi=y:(b=y-m,n.phiStarted||Math.abs(b)>e.touchRotateThreshold?(n.phiStarted=!0,n.phi=y):b=0);var x,w=Math.sqrt(f.x*f.x+f.y*f.y),C=n.vlen;if(C){var S=u.x-g.x,I=u.y-g.y,M=d.x-g.x,T=d.y-g.y,E=Math.sqrt(S*S+I*I),P=Math.sqrt(M*M+T*T),D=C/2,O=e._sign2(E-D),R=e._sign2(P-D);0>O*R||0===O&&0===R?(x=1,n.vlen=w):(x||(x=w/C),n.scaleStarted||Math.abs(x-1)>e.touchScaleThreshold?(n.vlen=w,n.scaleStarted=!0):x=1)}else C=n.vlen=w,x=1;1!==x&&i.setZoom(x),(b||_)&&e.rotate(t,_,-b),n.lastCenter={x:(d.x+u.x)/2,y:(d.y+u.y)/2}}}else if(n.pan)e.pan(t,a,s);else{var z=i.getWidth(),k=i.getHeight();if(!z||!k)return;var A=-F*a/z,V=-F*s/k;e.rotate(t,A,V)}}},_sign2:function(t){return Math.abs(t)<this._touchScaleCheckAccuracy?0:t>0?1:-1},handleWindowMouseUp:function(t){this.handleWindowTouchEnd(t)},handleWindowTouchEnd:function(t){var e=this,i=e.editing;if(e.editing=null,i){var n=e.gv;if(i.moved||!i.clickLeft&&!i.touch)n._panning=null,n._rotating=null,n.fi({kind:i.pan?"endPan":"endRotate",event:t});else{var r=n.getDataAt(t);r?n.sm().setSelection([r]):n.sm().clearSelection()}}},pan:function(t,e,i){var n=this,r=n.gv;if(r.isPannable()){var o=r.getWidth(),a=r.getHeight();if(o&&a){var s=r.getCenterInfo(),c=-e/o*s.width,h=1*i/a*s.height;r.fi({kind:r._panning?"betweenPan":"beginPan",event:t}),r._panning=1;var u=n.keepHorizon,d=n.editing.touch;if((d&&t.touches&&t.touches.length>1||!d&&$s(t))&&(u=!u),!u)return r.pan(c,h);if(c||h){var f=yf(r),g=[f[0]*c,f[4]*c,f[8]*c],p=[f[1],0,f[9]],v=Math.sqrt(p[0]*p[0]+p[2]*p[2]);v&&(p=[p[0]/v*h,0,p[2]/v*h]);var _=g[0]+p[0],y=g[1]+p[1],m=g[2]+p[2],b=r._center,x=r._eye;b[0]+=_,b[1]+=y,b[2]+=m,x[0]+=_,x[1]+=y,x[2]+=m,r.fp(mt,l,x),r.fp(yt,l,b)}}}},rotate:function(t,e,i){var n=this,r=n.gv;if(r.isRotatable()){var o=r._center,a=r._eye,s=Ml(a,o),l=G(E(s[0]*s[0]+s[2]*s[2]),s[1]),c=tf(l+i);i=c-l,r.fi({kind:r._rotating?"betweenRotate":"beginRotate",event:t}),r._rotating=1,r.rotate(e,i)}}}),e.defineProperties(tv.prototype,{panButton:{get:function(){return this._panButton},set:function(t){this._panButton=t}},minPhi:{get:function(){return u.graph3dViewMinPhi},set:function(t){u.graph3dViewMinPhi=t}},maxPhi:{get:function(){return u.graph3dViewMaxPhi},set:function(t){u.graph3dViewMaxPhi=t}},keepHorizon:{get:function(){return this._keepHorizon},set:function(t){this._keepHorizon=t}},threshold:{get:function(){return this._threshold},set:function(t){this._threshold=t}},touchScaleThreshold:{get:function(){return this._touchScaleThreshold},set:function(t){this._touchScaleThreshold=t}},touchRotateThreshold:{get:function(){return this._touchRotateThreshold},set:function(t){this._touchRotateThreshold=t}}});var ev,iv="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAEyUlEQVRYR62XW0xcVRSG/58cmIG2HmstE9N4SX2xtVqBCISoFS/RmDSpKQSvTWNixUStQSqVyBQYJUGttrQVtYkPatuQPmhivMUHqbUBZ2itl1qjTzZpImNUZhDLsUeWWXgOOd2cgcGyk3mYs/de69trr70uxP8YIlJKMi0i9wIgyf0iEiM5PFdxzGeDiBQAuB7AjQBuALCN5NcGQDmANgBfeL8UyYnZ5M8KICJ3AXgAwAlfOMl/VHAQwPtveYAKuQLA2yQ/ngliRgAR2QogA2AvSdcUZAIE50VEYR4BsIDkC7kgQgFE5GIAuwDsJnkk1+aZAPw9IqLX1gjgcZK/m7KmAXjK4wBaSf4ZplxEIgCuA3Cz3gSAfgDHSf6dY/0FAJ4D0G5ChAEcAPBwmHIRqXNd90nLsiocx/k+k8n8oK/Atu2rIpHIStd1v7QsawfJd0Ouywawh6T609Q4B8C788NhZnddt29sbGxBd3f39q6urtNhJ43H48uam5u3lJSUjFiWdV8IxE0Aqki+6M9NAXjefjnJXsOZogBGBgYGttbU1Hw427PS+cHBwbVVVVUJAItJOoa8xwD8RPIT/T4J4L3zfQAeNL1dRMZra2ur+/v7/8pHub+mvr7+wr6+vs8KCgoWGABFAN4EsEHjhA9QBeA2ks8HF6vZk8nkQL4nNwGTyeTa8vLycsuy7jcg1Mk/IpnyAZoBaOQ6FHg+ddlsdqNt201zObm5NpvN7ly0aNHrJN8LyL4FwGqSr/gAOrnej3C60HXdw/F4PJ7L4fKFSiQSl7W0tLQVFRWtCQDoNRwguZ6aWABcorE9sEDf+QjJ1fkqmmmdiHwHoCToXyKiceR0rkhY5TjOq9FoVLPdeY/x8fG+SCSySe/cFKYWCFOyPJ1Or4zFYh3nrR3A8PBwe2lp6TcAfg4DmBYwAFyRTqdXxWKx9nkE+DYUIEyBiFQ6jvNaNBq9Zz4AZruCGIBlJI8ZXpolee18AORwwgoAp/xnqMmjPuilZ8+ePZRIJNo7OztD436+YB0dHZe2trY+W1hYWGsccD/JOh/gKQBHSWpanRwicnc2m91k2/bmfJWFrRsdHd29cOHCXSTfD8i+FcA1JHcEQ/HtJDVnTw3XdfcPDQ0dra6unto8F5hUKrWurKxslWVZG4L7RGQbgA9IDgWT0VsANprJaGJi4kxDQ8OagwcPjsxFeWNj49Le3l6N91qMTA2vmNnr6fovGXkmvxPAlST3hGz4LZVKbausrMzLEnryioqKNpJLzCpJRJ4AcJLkp6rHLEieBjBA8rB5Wtd1942NjS3p6el5qa2t7VSYNdThmpqaWoqLi38xze4dUku4CpLb/f1hJZnWBY+SzJpKRGSdV5LVOI5zIpPJnNQ1tm2viEQiV7uue8SyrJeDDhew8GIAO0me4w9hABdp8ahNBkktyacNr+Qu84pSndfX81VY6e6dXJV3AoiT/CMoMFcyUogeAG+Q/DyX8+VZlqvZHwKw2VQ+zQdCTL4FwBkPZFrJPUtjoildG5PC4J2bOvJpze7QWhHAj4HWbBImpDXTQsPvH5cDeMf39lxWnBXAU6TNqcZu7fn0lyB53GhOdf6ZQHN6bF6a0xxOuJTkrwbA5LdcJ831/V8SOUYQxYGhRwAAAABJRU5ErkJggg==",nv=32,rv=ag.GlobeInteractor=function(t,e){Kn(rv,this,[t]);var i,n=e.radius||6378137,r=this,o=null;ev||(ev=xr(),ev.style.border="",ev.style.backgroundImage="url("+iv+")");var a=new Ua,s=new Na,c=new Na,h=new Na,u=new Qa,d="number"==typeof n?{x:n,y:n,z:n}:n,f={center:new Na(0,0,0),radius:d},g=function(e){t._81O=null;var i=t.getHitPosition(e,t.getCenter(),s.copy(t.getEye()).sub(c.copy(t.getCenter())).toArray());return u.origin.copy(t.getEye()),u.direction.copy(i).sub(u.origin).normalize(),u.intersectEllipsoid(f)},p=function(e,i){t._81O=null,u.origin.copy(t.getEye());for(var n,r,o=t.getCenter(),a=s.copy(t.getEye()).sub(c.copy(t.getCenter())).toArray(),l=1,h=16,d=0,g=1,p={x:0,y:0};h--;){if(p.x=i.x+(e.x-i.x)*l,p.y=i.y+(e.y-i.y)*l,n=t.getHitPosition(p,o,a),u.direction.copy(n).sub(u.origin).normalize(),r=u.intersectEllipsoid(f),r&&1===l)return{hit:r};r?d=l:g=l,l=(d+g)/2}return{hit:r,out:1>l}},v=function(e,i){if(o){var n=Date.now();o.deltaTime=o.lastTime?n-o.lastTime:1e3,o.lastTime=n,o.lastAxis=e,o.lastAngle=i}i&&(a.setFromAxisAngle(e,i),t.setEye(s.copy(t.getEye()).applyQuaternion(a).toArray()),t.setCenter(s.copy(t.getCenter()).applyQuaternion(a).toArray()),t.setUp(s.copy(t.getUp()).applyQuaternion(a).toArray()))};r._showCrossIcon=function(t){Mr(r.getView(),ev),Gr(ev,{x:t.clientX-nv/2,y:t.clientY-nv/2,width:nv,height:nv})},r._hideCrossIcon=function(){pl(ev)},r._scrollImpl=function(e,i){o={point:t.lp(e),screen:el(e),hit:g(e),type:"right"},o.hitNormalize=o.hit?o.hit.clone().normalize():new Na;var n={clientX:o.screen.x,clientY:o.screen.y+10*i};r._handleMoveImpl(n),r._endMoveImpl(n)},r._startMoveImpl=function(e){i&&(i.stop(!0),i=null),o={point:t.lp(e),screen:el(e),hit:g(e)},o.hitNormalize=o.hit?o.hit.clone().normalize():new Na,Nr(e)?1===e.touches.length?o.hit&&(o.type="left"):2===e.touches.length&&(o.type="touch2"):(Qs(e)?o.hit&&(o.type="left"):Zs(e)?o.type="right":Ys(e)&&o.hit&&(o.type="middle"),!o.hit||"right"!==o.type&&"middle"!==o.type||r._showCrossIcon(e)),o.type&&gl(r,e)},r._handleMoveImpl=function(t){if(o)switch(o.type){case"left":return r._handleLeft(t);case"right":return r._handleRight(t);case"middle":return r._handleMiddle(t);case"touch2":return r._handleTouch2(t)}},r._endMoveImpl=function(){if(o){if(this._hideCrossIcon(),"left"===o.type||"middle"===o.type){var t=o.lastAngle/(o.deltaTime||30)*1e3,e=o.lastAxis,n=o.lastTime,a=function(){var o=Date.now(),a=(o-n)/1e3;return n=o,t*=Math.pow(Math.abs(r.decelerationRate),3*a),Math.abs(t)<.01?(t=0,void(i&&i.stop())):void v(e,t*a)};i=Us({action:function(){a(arguments)},duration:5e3})}o=null}},r._handleLeft=function(t){if(!o.finished){var e=el(t),i=p(e,o.lastScreen||o.screen);if(o.lastScreen=e,!i.hit)return o.finished=!0,void r._endMoveImpl(t);var n=i.hit;n.normalize();var a=o.hitNormalize,s=Math.acos(n.dot(a)),l=n.cross(a).normalize();v(l,s),i.out&&(o.finished=!0,r._endMoveImpl(t))}},r._handleRight=function(e){var i=o.lastScreen||o.screen,n=i.y;i=o.lastScreen=el(e);var a=i.y,l=a-n;if(l){var u=Math.min(.5,l*r.scaleSpeed);s.copy(t.getEye());var f=o.hit;f||(f=s.clone().divide(d).normalize().multiply(d)),c.copy(s).lerp(f,u),t.setEye(c.toArray()),s.copy(t.getUp()),c.normalize();var p=s.clone().cross(c).normalize();if(h.copy(t.getCenter()),h.sub(p.multiplyScalar(h.dot(p))),t.setCenter(h.toArray()),o.hit){var _=g(o.screen),y=o.hitNormalize;if(_){_.normalize();var m=Math.acos(_.dot(y)),b=_.cross(y).normalize();m&&v(b,m)}}}};var _=function(t){return Math.abs(t)<.01?0:t>0?1:-1};r._handleTouch2=function(e){var i=e.touches.length;if(2===i){var r=e.touches,a={x:r[0].clientX,y:r[0].clientY},s={x:r[1].clientX,y:r[1].clientY},h={x:s.x-a.x,y:s.y-a.y},u=o.lastCenter,d=Math.atan2(h.y,h.x),f=o.theta,g=0;f==l?f=o.theta=d:(g=d-f,o.thetaStarted||Math.abs(g)>.03?(o.thetaStarted=!0,o.theta=d):g=0);var p,y=Math.sqrt(h.x*h.x+h.y*h.y),m=o.vlen;if(m){var b=a.x-u.x,x=a.y-u.y,w=s.x-u.x,C=s.y-u.y,S=Math.sqrt(b*b+x*x),I=Math.sqrt(w*w+C*C),M=m/2,T=_(S-M),E=_(I-M);0>T*E||0===T&&0===E?(p=1,o.vlen=y):(p||(p=y/m),o.scaleStarted||Math.abs(p-1)>.05?(o.vlen=y,o.scaleStarted=!0):p=1)}else m=o.vlen=y,p=1;h=c.copy(t.getEye()).clone();1!==p&&t.setEye(h.setLength((h.length()-n)/p+n).toArray()),g&&v(h.normalize(),g),o.lastCenter={x:(s.x+a.x)/2,y:(s.y+a.y)/2}}},r._handleMiddle=function(e){var i=el(e),n=o.screen;o.screen=i;var a=(i.y-n.y)/180*Math.PI*r.rollSpeed;c.copy(t.getCenter()).sub(s.copy(t.getEye())).normalize(),s.copy(t.getUp()).cross(c).normalize(),c.copy(t.getEye()).sub(o.hit).applyAxisAngle(s,a).add(o.hit);var l=c.clone();c.copy(t.getCenter()).sub(o.hit).applyAxisAngle(s,a).add(o.hit);var u=c.clone(),d=c.copy(t.getUp()).applyAxisAngle(s,a).clone(),f=!1;a>0&&(h.copy(d),c.copy(u).sub(l).normalize(),s.copy(l).multiplyScalar(-1).normalize(),s.dot(h)-c.dot(h)>0&&(f=!0)),f||h.copy(o.hit).sub(l).dot(o.hitNormalize)>=0&&(f=!0),f||(t.setEye(l.toArray()),t.setCenter(u.toArray()),t.setUp(d.toArray()));var g=-(i.x-n.x)/180*Math.PI*r.rotateSpeed;v(o.hitNormalize,g)}};sg("GlobeInteractor",Kp,{handle_contextmenu:function(t){Os(t)},handle_mousewheel:function(t){this._scrollImpl(t,t.wheelDelta/40)},handle_DOMMouseScroll:function(t){2===t.axis&&this._scrollImpl(t,-t.detail)},handle_keydown:function(t){this.gv.handleKeyDown(t)},handle_mousedown:function(t){this.handle_touchstart(t)},handle_touchstart:function(t){Os(t);var e=this.gv;if(e.setFocus(t)){var i=e.getDataInfoAt(t),n=i?i.data:l;n&&e.isInteractive(n)||this._startMoveImpl(t);var r=i?i.part:l;Ks(t)?e.handleDoubleClick(t,n,r):e.handleClick(t,n,r)}},handle_mouseup:function(t){this.handle_touchend(t)},handle_touchend:function(){},handleWindowMouseMove:function(t){this.handleWindowTouchMove(t)},handleWindowTouchMove:function(t){this._handleMoveImpl(t)},handleWindowMouseUp:function(t){this.handleWindowTouchEnd(t)},handleWindowTouchEnd:function(t){this._endMoveImpl(t)}}),e.defineProperties(rv.prototype,{rotateSpeed:{get:function(){return this._rotateSpeed||.3},set:function(t){this._rotateSpeed=t}},rollSpeed:{get:function(){return this._rollSpeed||.1},set:function(t){this._rollSpeed=t}},scaleSpeed:{get:function(){return this._scaleSpeed||.002},set:function(t){this._scaleSpeed=t}},decelerationRate:{get:function(){return this._decelerationRate||.04},set:function(t){this._decelerationRate=t}}});var ov=function(t){this.gv=t};bl(ov,e,{_iv:!0,iv:function(){this._iv=!0},face:function(t,e){var i=this,n=i.gv.getGL();if(!n||!Fn(t))return l;var r=i._resolution,o=Math.round(e.x*r),a=Math.ceil(e.width*r),s=Math.ceil(e.height*r),c=i.height-Math.round(e.y*r)-s,h=M(a/2),u=new Uint8Array(4*a*s),d=0;for(i.iv(),i.validate(t),jd(n,i.frame),n.readPixels(o,c,a,s,n.RGBA,n.UNSIGNED_BYTE,u),Hd(n),i.iv();h>=d;d++)for(var f=h-d,g=h+d,p=f;g>=p;p++)for(var v=f;g>=v;v++)if(p===f||p===g||v===f||v===g){var _=Nd.m[u[4*(p*a+v)]];if(_)return _}},get:function(t,e){this.validate();var i=this,n=i.gv.getGL();if(!n)return l;var r,o,a=i._resolution,s=Math.round(t.x*a),c=Math.ceil(t.width*a),h=Math.ceil(t.height*a),u=i.height-Math.round(t.y*a)-h,d=M(c/2),f=new Uint8Array(4*c*h),g=0,p=f.length,v=e?l:new gc,_=e?l:{};if(jd(n,i.frame),n.readPixels(s,u,c,h,n.RGBA,n.UNSIGNED_BYTE,f),Hd(n),e){for(;d>=g;g++)for(var y=d-g,m=d+g,b=y;m>=b;b++)for(var x=y;m>=x;x++)if((b===y||b===m||x===y||x===m)&&(r=i.info(f,4*(b*c+x))))return r}else for(;p>g;g+=4)r=i.info(f,g),r&&(o=r.data,_[o._id]||(v.add(o),_[o._id]=o));return v},info:function(t,e){return this.colorMap[(t[e]<<16)+(t[e+1]<<8)+t[e+2]+((127&t[e+3])<<24)]},validate:function(t){var e=this,i=e.gv,n=i.getGL();if(n){var r=e._resolution=i._pickerResolution*i.getDevicePixelRatio(),o=Math.round(r*i.getWidth()),a=Math.round(r*i.getHeight()),s=n.RGBA,c=n.TEXTURE_2D,h=n.RENDERBUFFER,u=n.FRAMEBUFFER;e.texture||(e.texture=xf(n),e.render=n.createRenderbuffer(),e.frame=n.createFramebuffer()),(e.width!==o||e.height!==a)&&(Mf(n,e.texture),n.texImage2D(c,0,s,o,a,0,s,n.UNSIGNED_BYTE,l),Tf(n,n.TEXTURE_MIN_FILTER,n.LINEAR),n.bindRenderbuffer(h,e.render),n.renderbufferStorage(h,n.DEPTH_COMPONENT16,o,a),jd(n,e.frame),n.framebufferTexture2D(u,n.COLOR_ATTACHMENT0,c,e.texture,0),n.framebufferRenderbuffer(u,n.DEPTH_ATTACHMENT,h,e.render),Mf(n,l),n.bindRenderbuffer(h,l),Hd(n),e.width=o,e.height=a),e._iv&&(e._iv=!1,jd(n,e.frame),i._42(t||(e.colorMap={}),r),Hd(n))}}});var av=function(t){this.gv=t};bl(av,e,{gap:0,size:0,_42:function(t,e){var i=this,n=i.gv,r=n._gridGap,o=n._gridSize;if(n._gridVisible){if(i.gap!==r||i.size!==o){for(var a=[],s=n._gridSize/2,c=r*s,h=0;2*s+1>h;h++){var u=6*h,d=6*(2*s+1)+u;a[u]=-c,a[u+1]=0,a[u+2]=h*r-c,a[u+3]=c,a[u+4]=0,a[u+5]=h*r-c,a[d]=h*r-c,a[d+1]=0,a[d+2]=-c,a[d+3]=h*r-c,a[d+4]=0,a[d+5]=c}i.vs=new Il(a),i.gap=r,i.size=o}Zf(n),Of(t,e),Af(t),Bf(t,e,1,n._gridColor,n._buffer.vs,i.vs),Lf(t,0,i.vs.length/3,t.LINES),Vf(t),Rf(t,e)}else i.vs=i.gap=i.size=l}});var sv=function(t){this.gv=t};bl(sv,e,{_42:function(t,e){var i=this.gv,n=i._buffer.vs,r=i._axisXColor,o=i._axisYColor,a=i._axisZColor,s=i._originAxisVisible,c=i._centerAxisVisible;if(s||c){var h=nt?t.TRIANGLES:t.TRIANGLE_FAN,u=t.LINES;if(Zf(i),Of(t,e),Af(t),s){var d=i.getCenterInfo(),f=D(d.width,d.height)/5,g=.8*f,p=.05*f;Bf(t,e,1.5,r,n,new Il([0,0,0,f,0,0,g,p,0,g,0,p,g,-p,0,g,0,-p,g,p,0,0,0,0,0,f,0,p,g,0,0,g,p,-p,g,0,0,g,-p,p,g,0,0,0,0,0,0,f,p,0,g,0,p,g,-p,0,g,0,-p,g,p,0,g])),Lf(t,0,2,u),Lf(t,1,6,h),Bf(t,e,l,o),Lf(t,7,2,u),Lf(t,8,6,h),Bf(t,e,l,a),Lf(t,14,2,u),Lf(t,15,6,h)}if(c){var v=i._center,_=v[0],y=v[1],m=v[2];d=i.getPositionInfo(v);f=D(d.width,d.height)/20,Bf(t,e,1.5,r,n,new Il([_,y,m,_+f,y,m,_,y,m,_,y+f,m,_,y,m,_,y,m+f])),Lf(t,0,2,u),Bf(t,e,l,o),Lf(t,2,2,u),Bf(t,e,l,a),Lf(t,4,2,u)}Vf(t),Rf(t,e)}}});var lv=function(t){this.gv=t,this.onMouseOver=this.onMouseOver.bind(this),this.mode=lv.Mode.Style,this.color=i,this.width=i};lv.Mode={Disable:0,Selection:1,MouseOver:2,Style:3},bl(lv,e,{onMouseOver:function(t){u.preventDefault(t);var e=this.gv.getDataAt(t);e!==this.mouseOverData&&(this.mouseOverData=e,this.gv.iv())},setFetchTargetFunc:function(t){this.fetchTargetFunc=t},_42:function(t,e){var i,n,r=this,o=r._mode,a=r.gv;if(!t._renderInfo.reflectDepth&&o!==lv.Mode.Disable){if(o===lv.Mode.Selection?i=a.sm().getSelection().toArray((function(t){return t.s("highlight.visible")})):o===lv.Mode.MouseOver&&r.mouseOverData&&r.mouseOverData.s("highlight.visible")&&(i=[r.mouseOverData]),r.fetchTargetFunc&&(i=r.fetchTargetFunc(i)),o===lv.Mode.Style)i=i||[],n=function(t){if(i.indexOf(t)>=0)return!1;var e=a.getDataHighlightMode(t);return!1===e||!0!==e&&("selected"===e?!a.isSelected(t):"hover"!==e||t!==r.mouseOverData)};else{if(!i||!i.length)return;n=function(t){return i.indexOf(t)<0||void 0}}var s=a.vr.isPresenting(),l=a.getWidth();if(s){var c=a.getWidth;l/=2,a.getWidth=function(){return l};var h=a.getViewport()}var u,d=a.getDevicePixelRatio(),f=l*d,g=a.getHeight()*d;(u=r._renderTarget)?u.setSize(t,f,g):r._renderTarget=u=new ag.RenderTarget(a,t,f,g),jd(t,u.frame),a.drawFilter=n,a._42({}),a.drawFilter=null,Hd(t),nt&&Xf(t,e.aPosition),Xf(t,e.aNormal),s&&(a.getWidth=c,a.setViewport(t,h[0],h[1],h[2],h[3]));var p=t._compiledShader.highlight;p||(p=t._compiledShader.highlight=new Cp.Shader(t,cv.vs,cv.fs)),p.bind(),t.enable(t.BLEND),t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,u.texture),p.uniforms.image=0,p.uniforms.textureSize=[f,g],p.uniforms.edgeWidth=a.getHighlightWidth();var v=a.getHighlightColor();if(r._lastHighlightColor!==v){var _=wo(r._lastHighlightColor=v);r._highlightColorData=[_[0]/255,_[1]/255,_[2]/255,_[3]/255]}p.uniforms.edgeColor=r._highlightColorData,r.ibuffer?(r.ibuffer.upload(),r.vbuffer.upload()):(r.ibuffer=Cp.Buffer.createIndexBuffer(t,new Uint16Array([0,2,1,1,2,3])),r.vbuffer=Cp.Buffer.createVertexBuffer(t,new Float32Array([0,0,1,0,0,1,1,1]))),p.attributes.pos.pointer(r.vbuffer),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.disable(t.BLEND),t.bindTexture(t.TEXTURE_2D,null),t.useProgram(e),nt&&qf(t,e.aPosition)}}}),e.defineProperties(lv.prototype,{mode:{get:function(){return this._mode},set:function(t){var e=this._mode;t!==e&&(this._mode=t,t===lv.Mode.MouseOver||t===lv.Mode.Style?w(this.gv.getView(),"mousemove",this.onMouseOver):(e===lv.Mode.MouseOver||e===lv.Mode.Style)&&C(this.gv.getView(),"mousemove",this.onMouseOver))}}});var cv={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","uniform vec2 textureSize;","uniform float edgeWidth;","uniform vec4 edgeColor;","varying vec2 vUv;","float getCol(vec2 coord) {","return texture2D(image, coord).a;","}","void main() {","vec2 cc = vUv;","float center = getCol(cc);","float dx = edgeWidth / textureSize.x;","float dy = edgeWidth / textureSize.y;","vec2 coord;","float topLeft = getCol(cc+vec2(-dx, -dy));","float top = getCol(cc+vec2(0.0, -dy));","float topRight = getCol(cc+vec2(dx, -dy));","float left = getCol(cc+vec2(-dx, 0.0));","float right = getCol(cc+vec2(dx, 0.0));","float bottomLeft = getCol(cc+vec2(-dx, dy));","float bottom = getCol(cc+vec2(0.0, dy));","float bottomRight = getCol(cc+vec2(dx, dy));","float v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;","float h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;","float edge = sqrt(h * h + v * v);","edge = smoothstep(0.9, 1.0, edge);","if (edge < 0.5) {","discard;","}","gl_FragColor = edgeColor;","}"].join("\n")},hv=function(t){this.gv=t},uv="edit_tx",dv="edit_ty",fv="edit_tz",gv="edit_rx",pv="edit_ry",vv="edit_rz",_v="edit_sx",yv="edit_sy",mv="edit_sz",bv={};bv[uv]=1,bv[dv]=1,bv[fv]=1,bv[gv]=1,bv[pv]=1,bv[vv]=1,bv[_v]=1,bv[yv]=1,bv[mv]=1,bl(hv,e,{_42:function(t,e,i){var n=this,r=n.gv,o=r.sm().ld();if(o&&r.isEditable(o)&&!r.isEditHelperDisabled()&&Fn(o)&&(!r.isFirstPersonMode()||!r.isMouseRoamable()&&!lt)){Zf(r);var a,s,l=r.isMovable(o),c=r.isRotationEditable(o),h=r.isSizeEditable(o),u=r._axisXColor,d=r._axisYColor,f=r._axisZColor,g=r._editSizeColor,p=o.p3(),v=nl(r.getEye(),p)/10,_=v/(i?5:10),y=.7*v,m=.4*y,b=p[0],x=p[1],w=p[2];a=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],l&&n._17O(t,e,o,i,uv,u,a,[b,x-_,w,b+y,x-_,w,b+y,x,w,b+y,x,w,b,x,w,b,x-_,w,b,x-_,w+_,b+y,x-_,w+_,b+y,x-_,w,b+y,x-_,w,b,x-_,w,b,x-_,w+_]),s=b+y,h&&n._17O(t,e,o,i,_v,g,a,[s,x-_,w,s+m,x-_,w,s+m,x,w,s+m,x,w,s,x,w,s,x-_,w,s,x-_,w+_,s+m,x-_,w+_,s+m,x-_,w,s+m,x-_,w,s,x-_,w,s,x-_,w+_]),s+=m,c&&n._17O(t,e,o,i,gv,u,a,[s,x-_,w,s+m,x-_,w,s+m,x,w,s+m,x,w,s,x,w,s,x-_,w,s,x-_,w+_,s+m,x-_,w+_,s+m,x-_,w,s+m,x-_,w,s,x-_,w,s,x-_,w+_]),a=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],l&&n._17O(t,e,o,i,dv,d,a,[b,x,w,b,x+y,w,b-_,x+y,w,b-_,x+y,w,b-_,x,w,b,x,w,b,x,w,b,x,w-_,b,x+y,w-_,b,x+y,w-_,b,x+y,w,b,x,w]),s=x+y,h&&n._17O(t,e,o,i,yv,g,a,[b,s,w,b,s+m,w,b-_,s+m,w,b-_,s+m,w,b-_,s,w,b,s,w,b,s,w,b,s,w-_,b,s+m,w-_,b,s+m,w-_,b,s+m,w,b,s,w]),s+=m,c&&n._17O(t,e,o,i,pv,d,a,[b,s,w,b,s+m,w,b-_,s+m,w,b-_,s+m,w,b-_,s,w,b,s,w,b,s,w,b,s,w-_,b,s+m,w-_,b,s+m,w-_,b,s+m,w,b,s,w]),a=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],l&&n._17O(t,e,o,i,fv,f,a,[b,x,w,b,x,w+y,b,x-_,w+y,b,x-_,w+y,b,x-_,w,b,x,w,b,x-_,w,b-_,x-_,w,b-_,x-_,w+y,b-_,x-_,w+y,b,x-_,w+y,b,x-_,w]),s=w+y,h&&n._17O(t,e,o,i,mv,g,a,[b,x,s,b,x,s+m,b,x-_,s+m,b,x-_,s+m,b,x-_,s,b,x,s,b,x-_,s,b-_,x-_,s,b-_,x-_,s+m,b-_,x-_,s+m,b,x-_,s+m,b,x-_,s]),s+=m,c&&n._17O(t,e,o,i,vv,f,a,[b,x,s,b,x,s+m,b,x-_,s+m,b,x-_,s+m,b,x-_,s,b,x,s,b,x-_,s,b-_,x-_,s,b-_,x-_,s+m,b-_,x-_,s+m,b,x-_,s+m,b,x-_,s])}},_17O:function(t,e,i,n,r,o,a,s){var c=this.gv._buffer;Jf(t,e,n,!0,i,r),zf(t,e,l,!0,l,!0,l,!1),Nf(t,e.uDiffuse,o),jf(t,c.vs,new Il(s),e.aPosition),jf(t,c.ns,new Il(a),e.aNormal),Af(t),Lf(t,0,12),Vf(t),kf(t,e)}});var xv=c.Raycaster=function(t){this.gv=t,this.maxTriangleTest=1/0,this.backfaceCulling=!0};xl("Raycaster",e,{intersect:function(t){var e=this,i=e.gv,n=i.getDataAt(t);return n?e.intersectObject(t,n):null},intersectObjects:function(t,e,i){var n,r,o,a,s=this,l=1/0,c=t.origin||(new Na).fromArray(s.gv.getEye()),h=s.maxTriangleTest,u=[];return e.forEach((function(t){i&&!1===i(t)||!1!==t.s("intersect")&&u.push(t)})),u.sort((function(t,e){return c.distanceToSquared2(t.p3())-c.distanceToSquared2(e.p3())})),s.countTriangles=0,u.forEach((function(e){s.countTriangles>h||(n=s.intersectObject(t,e),n&&(r=c.distanceToSquared(n.world),l>r&&(o=e,a=n,l=r)))})),s.countTriangles=0,{data:o,intersect:a}},intersectObject:function(t,e){if(t instanceof Qa)return this._intersectObjectImpl(t,e);var i=this,n=i.gv,r=n.unproject(t),o=new Na,a=n.getEye(),s=new Na;if(n.isOrtho()){var l=new Na(a);s.copy(n.getCenter()).sub(l).normalize();var h=o.copy(r).sub(l).dot(s);o.copy(s).setLength(-h).add(l.copy(r))}else o.copy(a),s.copy(r).sub(o).normalize();var u=new c.Math.Ray(o,s);return i._intersectObjectImpl(u,e)},_intersectObjectImpl:function(){function t(){var t=new Na;return t.subVectors(g,f),y.subVectors(d,f),t.cross(y).normalize(),t}function e(t,e,i,n,r,o,a){return $a.barycoordFromPoint(t,e,i,n,b),r.multiplyScalar(b.x),o.multiplyScalar(b.y),a.multiplyScalar(b.z),r.add(o).add(a),r.clone()}function i(t,e,n){Vn(t)?t.forEach((function(t){i(t,e,n)})):On(t)?i(pp(e,t),e,n):kn(t)&&t.shape3d?i(t.shape3d,e,n):n.push(t)}var n=new Ka,r=new Ka,o=new Qa,a=new Na,s=new Na,l=new Na,h=new Na,u=new Na,d=new Na,f=new Na,g=new Na,p=new qa,v=new qa,_=new qa,y=new Na,m={vs:Ng,is:qg,uv:Xg},b=new Na,x=Yg.slice(0);return x.push("csg"),function(y,b){var w=this.gv.getData3dUI(b),C=b.mat||w.mat;C?n.fromArray(C):n.identity(),r.getInverse(n),o.copy(y).applyMatrix4(r);var S,I,M,T="body",E=w.shapeModel;if(E||(E=pp(w)),E||(c.CSGNode&&b instanceof c.CSGNode||c.CSGShape&&b instanceof c.CSGShape?(M=!0,E=[w.left,w.front,w.right,w.back,w.top,w.bottom,w.csg]):b instanceof c.Node&&!(b instanceof c.Shape)?(S=!0,E=m):(I=!0,E=[w.left,w.front,w.right,w.back,w.top,w.bottom])),!E)return console.log("Can not find shape model."),null;Vn(E)||(E=[E]);var P,D,O,R,z,k,A,V,B,L,F,j,H,G,U,W=1/0,N=["","top_","bottom_"],q=!1,X=this.backfaceCulling,Q=[];for(i(E,w,Q),P=0,D=Q.length;D>P;P++)if(j=Q[P])for(O=0,R=N.length;R>O;O++)if(H=N[O],A=j[H+"vs"],V=j[H+"is"],B=j[H+"uv"]||j[H+"tuv"],A){if(G=j[H+"boundingBox"]){var Y=o.intersectBox(G);if(!Y)continue;if(o.origin.distanceTo(Y)>W)continue;U=!1}else j[H+"boundingBox"]=G=new c.Math.Box3,U=!0;for(z=0,k=V?V.length:A.length/3;k>z;z+=3)this.countTriangles++,V?(s.fromArray(A,3*V[z]),l.fromArray(A,3*V[z+1]),h.fromArray(A,3*V[z+2])):(s.fromArray(A,3*z),l.fromArray(A,3*(z+1)),h.fromArray(A,3*(z+2))),U&&(G.expandByPoint(s),G.expandByPoint(l),G.expandByPoint(h)),L=o.intersectTriangle(s,l,h,X,a),L&&(F=o.origin.distanceTo(L),W>F&&(W=F,u.copy(L),d.copy(s),f.copy(l),g.copy(h),""!==H?T=H.slice(0,-1):S?T=Yg[Math.floor(z/6)]:I?T=Yg[P]:M&&(T=x[P]),B&&(q=!0,V?(p.fromArray(B,2*V[z]),v.fromArray(B,2*V[z+1]),_.fromArray(B,2*V[z+2])):(p.fromArray(B,2*z),v.fromArray(B,2*(z+1)),_.fromArray(B,2*(z+2))))))}if(!isFinite(W))return null;var Z,J=u.clone().applyMatrix4(n);q&&(Z=e(u,d,f,g,p,v,_));var K=t(d,f,g),$=t(d.applyMatrix4(n),f.applyMatrix4(n),g.applyMatrix4(n)),tt=o.direction.dot(K);return tt>0&&(K.multiplyScalar(-1),$.multiplyScalar(-1)),{world:J,local:u.clone(),worldNormal:$,normal:K,uv:Z,part:T}}}()});var wv=function(t,e){this.gv=t,this.s=function(i,n,r){return n==l&&(n=r),n==l?e.getStyle(i):dc(n,e,t)},this.data=e};bl(wv,e,{I3d:!0,ms_icons:1,_iv:!0,iv:function(){this._iv=!0},_42:function(t,e,n,r){var o,a,s,h,d,f,g,p=this,v=p.data,_=p.gv,y=v._id,m=p.s("alwaysOnTop")||p.s("shape3d.alwaysOnTop")?null:p.s("batch"),b=_._batchIndexMap,x=_._batchModelMap,w=_.isSelectable(v),C=_.getBrightness(v),S=C!=l&&1!==C;if(wv.getTitle===i)for(var I in wv.getTitle=0,u)if(I.length===Zt.length+1&&I[Zt.length]===Ce[4].toUpperCase()&&I[Zt.length-1]===Ce[Zt.length+1].toUpperCase()){wv.getTitle=sr;break}if(!wv.getTitle||Fi[Zt.length+2]){if(wv.getHead===i)for(var I in wv.getHead=0,B){var M="box-sizing";if(6===I.length&&I[0]===Ce[4]&&I[3]===M[0]&&I[4]===M[1]&&I[5]===M[2]){wv.getHead=sr;break}}if(!wv.getHead||Fi[Zt.length]){if(p.needValidate(t)){s=xg(b,x,v,m);var T=p.validate(s,m?Xi[m]||an:l);if(s&&(h=b[y],d=h.size=s.vs.length/3-h.begin,g=s.rs))for(C=S?C:1,f=0;d>f;f++)g.push(C);var E=_.getWireframeGeometry(v);if(E)Cg(_,v,E);else if(Fn(v)){var P=_.getWireframe(v);P&&Cg(_,v,P)}p.labelInfo=p.label2Info=p.noteInfo=p.note2Info=p._38o=l,p._24O(Yt,"getLabel"),p._24O(Zt,"getLabel2"),p._26O(Jt,"getNote"),p._26O(Kt,"getNote2"),p._15O(),p.interactiveInfo=_.isInteractive(v)?{}:l,!1!==T&&(p._iv=!1)}S&&Nf(t,e.uBrightness,C),Nf(t,e.uAlphaTest,p.s("alphaTest")),Nf(t,e.uUseEnvMap,!!v.s("envmap")),Nf(t,e.uReflectivity,v.s("envmap")||.01);var D=p.s("3d.clip.direction"),O=!0;if(D){var R=p.s("3d.clip.percentage");switch(0===R&&(O=!1),D){case"left":D=2;break;case"top":D=3;break;case"bottom":D=4;break;case"front":D=5;break;case"back":D=6;break;case"right":default:D=1}if(0===D%2&&(R=1-R),v instanceof c.Shape){var z=v.s3(),k=v.p3(),A=v.getAnchor3d();R=3>D?(R-A.x)*z[0]+k[0]:5>D?(R-A.y)*z[1]+k[1]:(R-A.z)*z[2]+k[2]}else R-=.5;Nf(t,e.uClipPercent,R)}t.uniform1i(e.uClipDirection,D||0),a=Jf(t,e,n,w,v,Qt),a&&(Ig(a,b[y],x),Ig(a,_._polylineIndexMap[y],_._polylineModelMap),Ig(a,_._wireframeIndexMap[y],_._wireframeModelMap)),!b[y]&&O&&p._80o(t,e,r),_.isLabelVisible(v)&&((o=p.labelInfo)&&(Jf(t,e,n,w,v,Yt),p._28O(o,Yt,r)),(o=p.label2Info)&&(Jf(t,e,n,w,v,Zt),p._28O(o,Zt,r))),_.isNoteVisible(v)&&((o=p.noteInfo)&&(Jf(t,e,n,w,v,Jt),p._29O(o,Jt,r)),(o=p.note2Info)&&(Jf(t,e,n,w,v,Kt),p._29O(o,Kt,r))),(o=p._38o)&&p._99O(t,e,o,n,w,r),S&&Nf(t,e.uBrightness,1),D&&t.uniform1i(e.uClipDirection,0)}}},needValidate:function(){return this._iv},validate:function(){},_16O:function(){return Dl},_80o:function(){},dispose:function(){},getBodyColor:function(t){var e=this.data,i=this.gv.getBodyColor(e);return i||(t?e.getStyle(t):l)},getCachedTexture:function(t){var e=this._cachedTextures;return e?e[t||"main"]:null},setCachedTexture:function(t,e){var i=this._cachedTextures;return i||(i=this._cachedTextures={}),i[e||"main"]=t,t},invalidateCachedTexture:function(t){var e=this._cachedTextures;for(var i in e)t.deleteTexture(e[i]);this._cachedTextures={}},invalidateCachedGeometry:function(){},_24O:function(t,e){var i=this,n=i.data,r=i.gv,o=i.s,a=r[e](n);if(a!=l){var s=o(t+".scale"),c=o(t+".max"),h=i[t+"Info"]={label:a,textureScale:o(t+".texture.scale"),color:r[e+"Color"](n),font:o(t+".font"),align:o(t+".align"),background:r[e+"Background"](n)},u=h.rect=Tr(h,a);c>0&&c<u.width&&(h.labelWidth=u.width,u.width=c),u.x=u.y=0,u.width*=s,u.height*=s,h.mat=i._16O(o(t+".autorotate"),o(t+".position"),u,o(t+".face"),o(t+".t3"),o(t+".r3"),o(t+".rotationMode"));var d=u.width/2,f=u.height/2;h.vs=new Il([-d,f,0,-d,-f,0,d,-f,0,d,f,0]),u.width/=s,u.height/=s}},_26O:function(t,e){var i=this,n=i.data,r=i.gv,o=i.s,a=r[e](n);if(a!=l){var s=o(t+".scale"),c=this[t+"Info"]={note:a,textureScale:o(t+".texture.scale"),expanded:o(t+".expanded"),font:o(t+".font"),color:o(t+".color"),align:o(t+".align"),borderWidth:o(t+".border.width"),borderColor:o(t+".border.color"),background:r[e+"Background"](n)};if(c.expanded){var h=o(t+".max"),u=Tr(c,a);u.width+=6,u.height+=2,h>0&&h<u.width&&(c.labelWidth=u.width,u.width=h);var d={x:-u.width/2,y:-8-u.height,width:u.width,height:u.height+8}}else d={x:-6,y:-18,width:12,height:18};c.mat=i._16O(o(t+".autorotate"),o(t+".position"),l,o(t+".face"),o(t+".t3"),o(t+".r3"),o(t+".rotationMode")),c.rect=d,1!==s&&(d=Hs(d),d.x*=s,d.height*=s,d.y=-d.height,d.width*=s);var f=d.x,g=d.y,p=d.width,v=d.height;c.vs=new Il([f,-g,0,f,-g-v,0,f+p,-g-v,0,f+p,-g,0])}},_28O:function(t,e,i){if(i(this.s(e+".transparent"))){var n=t.rect,r=t.textureScale,o=n.width*r,a=n.height*r;if(o>=1&&a>=1){var s=xo(o,a);1!==r&&(s.translate(s,n.x,n.y),s.scale(r,r),s.translate(s,-n.x,-n.y)),Wc(s,t),s.restore(),ig(this,e,t.mat,t.vs,!0)}}},_29O:function(t,e,i){if(i(this.s(e+".transparent"))){var n=t.rect,r=t.textureScale,o=n.x,a=n.y,s=n.width*r,l=n.height*r;if(s>=1&&l>=1){n.x=n.y=0;var c=xo(s,l);1!==r&&c.scale(r,r),Nc(c,t),c.restore(),n.x=o,n.y=a,ig(this,e,t.mat,t.vs,!1)}}},_99O:function(t,e,i,n,r,o){if(i){var a=this,s=a.gv,c=a.data,h=s._buffer,u=s._1O,d=i.icons;for(var f in d){var g=d[f],p=i.rects[f];if(p&&o(dc(g.transparent,c,s))){Jf(t,e,n,r,c,f);var v=dc(g.shape3d,c,s),_=v?[v]:dc(g.names,c,s),y=_?_.length:0,m=dc(g.textureScale,c,s)||1,b=dc(g.light,c,s);b==l&&(b=!!v),zf(t,e,dc(g.blend,c,s),b,dc(g.opacity,c,s),dc(g.reverseFlip,c,s),dc(g.reverseColor,c,s),dc(g.reverseCull,c,s));for(var x=0;y>x;x++){var w=_[x],C=p[x];if(eg(a,C.mat),v)dp(s,c,pp(a,v),a);else{var S=zs(w);if(S){var I=C.width*m,M=C.height*m;if(I>=1&&M>=1){var T=xo(I,M);Vs(T,S,dc(g.stretch,c,s),0,0,I,M,c,s),T.restore(),xf(t,mo,u),Af(t,e,u,dc(g.discardSelectable,c,s),h.uv,Gg),jf(t,h.vs,C.vs,e.aPosition),Hf(t,h.ns,Ug,e.aNormal),Uf(t,h.is,Wg),Ff(t,0,Wg.length),Vf(t,e,u)}}}Qf(s)}kf(t,e)}}}}});var Cv=function(t,e){Kn(Cv,this,[t,e])};bl(Cv,wv,{_16O:function(t,e,i,n,r,o,a,s,l){var c=this.data,h=c.getFinalScale3d(),u=$f(e,h,i,n,s,l);if(c.hasOwnProperty("_anchor")||c.hasOwnProperty("_anchorElevation")){var d=c.getAnchor3d();u[0]-=(d.x-.5)*h[0],u[1]-=(d.y-.5)*h[1],u[2]-=(d.z-.5)*h[2]}return tg(Pl(),u,c.p3(),n,r,o,a,t,c.getFinalRotation3d(),c.getRotationMode())},clear:function(){var t=this;t.faceMat=t.mat=t.shapeModel=t.left=t.right=t.front=t.back=t.top=t.bottom=t.csg=l},needValidate:function(t){if(this._iv)return this._validateFrameId=t._renderInfo.frame,!0;if(this.s("autorotate")||this.s("shape3d.autorotate")||this.s("fixSizeOnScreen")||this.s("shape3d.fixSizeOnScreen")||this.s("hide.overlapping.group")){var e=t._renderInfo.frame;if(this._validateFrameId!==e)return this._validateFrameId=e,!0}return!1},validate:function(t,e){var i=this,n=i.gv,r=i.data,o=i.shapeName=i.s(Ne),a=pp(i,o);i._updateAutoRotation(),i._updateFixSize2d(),i._updateOverlapping(),(this.s("autorotate")||this.s("shape3d.autorotate")||this.s("fixSizeOnScreen")||this.s("shape3d.fixSizeOnScreen"))&&(bg(n,r,"_wireframeModelMap","_wireframeIndexMap"),bg(n,r,"_wireframeModelMapSwap","_wireframeIndexMapSwap"));var s=jl(r,n.getMat(r),!a||i.s("shape3d.scaleable"));if(r.appendAnchorMatrix3d(s),r.mat=s,i.clear(),a||!o)if(t){var l=[];a?Tg(n,r,a,i,i.getBodyColor(),[s],t,l):(Og(n,r,t,e,s,gt,l,dg),Og(n,r,t,e,s,pt,l,fg),Og(n,r,t,e,s,vt,l,gg),Og(n,r,t,e,s,_t,l,pg),Og(n,r,t,e,s,dt,l,vg),Og(n,r,t,e,s,ft,l,_g)),l.length&&(qn(t.vs,l),qn(t.ns,bf(l)))}else i.mat=s,(i.shapeModel=a)||(i._cubeUvs=null,i.vf(gt,0),i.vf(pt,16),i.vf(dt,8),i.vf(ft,24),i.vf(vt,32),i.vf(_t,40))},_updateAutoRotation:function(){var t=new ts,e=new Ka,i=new Na,n=new Na,r=new Na;return function(){var o=this,a=o.data,s=o.s("autorotate")||o.s("shape3d.autorotate");if(s){var l,c=o.gv;r.copy(o.s("shape3d.autorotate.up")||c._up),l="string"==typeof s?[s.indexOf("x")<0?c._eye[0]:c._center[0],s.indexOf("y")<0?c._eye[1]:c._center[1],s.indexOf("z")<0?c._eye[2]:c._center[2]]:c._eye;var h=c._center,u=a.p3();i.copy(u),n.set(l[0]-h[0],l[1]-h[1],l[2]-h[2]).add(i),e.lookAt(n,i,r),t.set(0,0,0,a.getRotationMode(),!0).setFromRotationMatrix(e);var d=a._dynamicRotation;d&&Math.abs(d[0]-t.x)<1e-5&&Math.abs(d[1]-t.y)<1e-5&&Math.abs(d[2]-t.z)<1e-5||(a._dynamicRotation=[t.x,t.y,t.z])}else a._dynamicRotation&&delete a._dynamicRotation}}(),_updateFixSize2d:function(){var t=this,e=t.data,i=t.s("fixSizeOnScreen")||t.s("shape3d.fixSizeOnScreen");if(i){var n=t.gv,r=jl(e,n.getMat(e)),o=kl([0,0,0],r),a=n.toViewPosition(o);if(!isNaN(a.x)&&!isNaN(a.y)){var s=kl([1,0,0],r),l=n.toViewPosition(s),c=kl([0,1,0],r),h=n.toViewPosition(c),u=l.x-a.x,d=h.y-a.y;if(u&&d){var f,g,p=e._dynamicScale3d||[1,1,1],v=zs(e.s("shape3d.image"));if(i[0]>0&&(f=i[0]),i[1]>0&&(g=i[1]),!f||!g){var _=i>0?i:1;f||(f=(hc(v,e)||e.getWidth())*_),g||(g=(uc(v,e)||e.getTall())*_)}var y=Math.abs(u/f),m=Math.abs(d/g);Math.abs(y-1)<.001&&Math.abs(m-1)<.001||(e._dynamicScale3d=[p[0]/y,p[1]/m,p[2]])}}}else e._dynamicScale3d&&delete e._dynamicScale3d},_updateOverlapping:function(){var t=this,e=t.s("hide.overlapping.group");if(e){var n,r,o,a=t.gv,s=t.data,l=jl(s,a.getMat(s)),c=1/0,h=1/0,u=-1/0,d=-1/0,f=s.getAnchor3d(),g=f.x,p=f.y,v=f.z;for(n=0;8>n;n++){if(r=kl([(n>>2)-g,(1&n>>1)-p,(1&n)-v],l),o=a.toViewPosition(r),isNaN(o.x)||isNaN(o.y))return;c=Math.min(c,o.x),u=Math.max(u,o.x),h=Math.min(h,o.y),d=Math.max(d,o.y)}var _={x:c,y:h,w:u-c,h:d-h};t._rectOverlapping=a.overlappingBox.isOverlapping(e,_)}else t._rectOverlapping&&(t._rectOverlapping=i)},getVectorDynamicSize:function(){var t,e=this,i=e.s("shape3d"),n=e.data;if("billboard"===i||"plane"===i||(t=n._currentCubeElementId)!=l){var r,o,a=e.gv,s=jl(n,a.getMat(n)),c=n.getAnchor3d(),h=.5-c.x,u=.5-c.y,d=.5-c.z,f=e.s("vector.dynamic.maxsize"),g=function(t,e){t[0]+=h,t[1]+=u,t[2]+=d,e[0]+=h,e[1]+=u,e[2]+=d;var i=a.toViewPosition(kl(t,s)),n=a.toViewPosition(kl(e,s)),r=i.x-n.x,o=i.y-n.y;return Math.min(f,Math.sqrt(r*r+o*o))};if("billboard"===i)r=g([-.5,0,0],[.5,0,0]),o=g([0,-.5,0],[0,.5,0]);else if("plane"===i)r=g([-.5,0,0],[.5,0,0]),o=g([0,0,-.5],[0,0,.5]);else if(n._currentCubeElementId!=l){var p=3*qg[t+1],v=3*qg[t],_=3*qg[t+2];r=g([Ng[p],Ng[p+1],Ng[p+2]],[Ng[_],Ng[_+1],Ng[_+2]]),o=g([Ng[p],Ng[p+1],Ng[p+2]],[Ng[v],Ng[v+1],Ng[v+2]])}return[r,o]}},vf:function(t,e){var i=this;if(i.gv.getFaceVisible(i.data,t)){var n=ng(i,t);n.mat&&(i.faceMat=!0);var r=n.uv;if(r){var o=i._cubeUvs;o||(o=i._cubeUvs=new Il([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]));for(var a=0;8>a;a++)o[e+a]=r[a]}return n}},_billboardInView:function(){var t=[-.5,-.5,0,-.5,.5,0,.5,-.5,0,.5,.5,0],e=[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,.5],i=new Ya,n=new Na,r=new Ka;return function(o){var a=this;if(!a.mat)return!0;var s=a.gv.getFrustum(),l="billboard"===o?t:e;i.makeEmpty(),r.fromArray(a.mat);for(var c=0,h=l.length;h>c;c+=3)i.expandByPoint(n.fromArray(l,c).applyMatrix4(r));return s.intersectsBox(i)}}(),_80o:function(t,e,i){var n=this;if(n._rectOverlapping)return!0;var r=n.shapeModel;if(r||!n.shapeName){var o=n.s("shape3d");if(("billboard"===o||"plane"===o)&&!n._billboardInView(o))return!0;var a=n.gv,s=n.data,c=a._cube;Zf(a,n.mat),n.s("shape3d.reflector")&&!t._picking||(r?dp(a,s,r,n,n.getBodyColor(),i):(jf(t,c.vs,l,e.aPosition),jf(t,c.ns,l,e.aNormal),Gf(t,c.is),n._18O(t,e,"left",0,i),n._18O(t,e,"front",6,i),n._18O(t,e,"right",12,i),n._18O(t,e,"back",18,i),n._18O(t,e,"top",24,i),n._18O(t,e,"bottom",30,i))),Qf(a),n.faceMat&&(n._18O(t,e,"left",0,i,!0),n._18O(t,e,"front",6,i,!0),n._18O(t,e,"right",12,i,!0),n._18O(t,e,"back",18,i,!0),n._18O(t,e,"top",24,i,!0),n._18O(t,e,"bottom",30,i,!0))}},_18O:function(t,e,i,n,r,o){var a=this[i];if(a){if(!r(a.transparent))return;if(o&&!a.mat||!o&&a.mat)return;var s=this.data.s("polygonOffset");s&&Ef(t,s),o&&Zf(this.gv,a.mat);var c=this,h=c.data;h._currentCubeElementId=n;var u=c.gv,f=u.getTexture(a.texture,h,i),g=a.uv,p=a.uvScale,v=a.uvOffset,_=a.discardSelectable;f?g?Af(t,e,f,_,u._buffer.uv,c._cubeUvs,v,p):Af(t,e,f,_,u._cube.uv,l,v,p):Af(t),zf(t,e,a.blend,a.light,a.opacity,a.reverseFlip,a.reverseColor,a.reverseCull),Nf(t,e.uDiffuse,a.color||d["color.empty"]),Ff(t,n,6),kf(t,e),Vf(t,e,f),o&&Qf(u),s&&Pf(t),h._currentCubeElementId=null}},drawReflector:function(){var t=new Na,e=new Na,n=new ts,r=new Ka,o=new Na,a=new Na,s=new Na,c=new Na,h=new Ka,u=new Ka,d=new Xa,f=new Wa,g=new Wa,p=function(t,e,i){t[i]=e[0],t[i+1]=e[1],t[i+2]=e[2]},v=function(t,e){p(t,e.getEye(),0),p(t,e.getCenter(),3),p(t,e.getUp(),6)},_=function(t,e){e._eye=[t[0],t[1],t[2]],e._center=[t[3],t[4],t[5]],e._up=[t[6],t[7],t[8]],e._18Q=l;var i=e._skyBox;i&&(i.p3([t[0],t[1],t[2]]),e.getData3dUI(i).iv())};return function(p,y,m,b,x){var w=this;w._reflectorInfo=null;var C=w.data;if(C._reflecting)return!1;var S=w.gv;if(x)return!1;var I=w._reflectorRenderTarget;if(I?I.setSize(p,y,m):I=w._reflectorRenderTarget=new ag.RenderTarget(S,p,y,m),t.copy(C.p3()),e.copy(S.getEye()),r.makeRotationFromEuler(n.set(C.r3(),C.getRotationMode(),!0)),!w._reflectNormal){var M=pp(w,w.s("shape3d"));if(!M)return!1;if(!M.ns&&M.length&&(M=M[0]),!M.ns||!M.vs)return!1;w._reflectNormal=[M.ns[0],M.ns[1],M.ns[2]],w._reflectorVbuffer=Cp.Buffer.createVertexBuffer(p,new Float32Array(M.vs))}if(o.copy(w._reflectNormal),o.applyMatrix4(r),a.subVectors(t,e),a.dot(o)>0)return!1;a.reflect(o).negate(),a.add(t),s.copy(S.getCenter()).negate().add(t),s.reflect(o).negate(),s.add(t),c.copy(S.getUp()),c.reflect(o);var T=[0,0,0,0,0,0,0,0,0];v(T,S),S._eye=a.toArray(),S._center=s.toArray(),S._up=c.toArray(),S._18Q=l;var E=S._skyBox;E&&(E.p3(S._eye),S.getData3dUI(E).iv()),jd(p,I.frame),p.viewport(0,0,I.width,I.height);var P=C.s("shape3d.reflector.background");if(P){var D=p.getParameter(p.COLOR_CLEAR_VALUE);Df(p,P)}else p.clearColor(0,0,0,1);p.clear(p.COLOR_BUFFER_BIT);var O=mf(S),R=yf(S);d.setFromNormalAndCoplanarPoint(o,t),d.applyMatrix4(u.fromArray(R)),f.set(d.normal.x,d.normal.y,d.normal.z,d.constant),g.x=(Math.sign(f.x)+O[8])/O[0],g.y=(Math.sign(f.y)+O[9])/O[5],g.z=-1,g.w=(1+O[10])/O[14],f.multiplyScalar(2/f.dot(g));var z=C.s("shape3d.reflector.clip"),k=z===i?.003:z;O[2]=f.x,O[6]=f.y,O[10]=f.z+1-k,O[14]=f.w;var A=S._computedProjectMatrix;S._computedProjectMatrix=O,C._reflecting=!0,b(),S._computedProjectMatrix=A,h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(u.fromArray(S._projectMatrix)),h.multiply(u.fromArray(S._viewMatrix)),P&&Df(p,D),Hd(p),_(T,S);var V=p._compiledShader.reflector;return V||(V=p._compiledShader.reflector=new Cp.Shader(p,Vd.Reflector.vs,Vd.Reflector.fs)),V.bind(),p.activeTexture(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,I.texture),V.uniforms.tDiffuse=0,V.uniforms.color=Co(C.s("shape3d.reflector.color")||"rgb(128,128,128)"),V.uniforms.textureMatrix=h.toArray(),V.uniforms.modelMatrix=jl(C),V.uniforms.viewMatrix=yf(S),V.uniforms.projectionMatrix=mf(S),w._reflectorVbuffer.upload(),V.attributes.pos.pointer(w._reflectorVbuffer),p.drawArrays(p.TRIANGLES,0,6),C._reflecting=!1,p.useProgram(S._prg),!0}}()}),Vd.Reflector={vs:["attribute vec3 pos;","uniform mat4 textureMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying vec4 vUv;","void main() {","\tvUv = textureMatrix * modelMatrix * vec4( pos, 1.0 );","\tgl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( pos, 1.0 );","}"].join("\n"),fs:["precision highp float;","uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","\treturn( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","\treturn vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","\tvec4 base = texture2DProj( tDiffuse, vUv );","   vec2 tUv = vUv.xy / vUv.w;","   if (tUv.x < .0 || tUv.y < .0 || tUv.x > 1. || tUv.y > 1.) discard;","\tgl_FragColor = vec4( blendOverlay( base.rgb, color ), base.a );","}"].join("\n")};var Sv=function(t,e){Kn(Sv,this,[t,e])};bl(Sv,Cv,{_80o:function(){}});var Iv=function(t,e){Kn(Iv,this,[t,e])};bl(Iv,wv,{_25Q:1,validate:function(t){var e=this;if(!e.s("geometry.cache")||!e.info){var i=e.gv,n=e.data,r=e.s,o=r("edge.width"),a=n._40I,s=n._41I;if(e.shapeModel=e.info=l,a&&s){var c,h,d,f,g,p,v,_,y,m,b=n.isLooped(),x=r(se),w=u.getEdgeType(x);if(w){var C=w(n,Yc(e,i,n,b,x),i,e._19Q);if(!C.points||C.points.isEmpty())return;p=e.info={},v=C.segments,g=C.points,_=g.size();for(var S=a.getElevation(),I=s.getElevation(),M=0;_>M;M++){var T=g.get(M);T.e==l&&(T.e=S+(I-S)*M/(_-1))}y=Qd(g.get(0)),m=Qd(g.get(_-1));var E=_%2;0===E?(p.c1=Qd(g.get(_/2-1)),p.c2=Qd(g.get(_/2))):p.p3=Qd(g.get((_-E)/2)),p.s1=y,p.s2=Qd(g.get(1)),p.t1=Qd(g.get(_-2)),p.t2=m}else{g=new gc,p=e.info={};var P=r("edge.offset"),O=r("edge.center"),R=r("edge.source.t3"),z=r("edge.target.t3"),k=Kf(i,n,"source"),A=Kf(i,n,"target");if(!k||!A)return i.invalidateData(n),delete e.info,!1;if(R&&(k[0]+=R[0],k[1]+=R[1],k[2]+=R[2]),z&&(A[0]+=z[0],A[1]+=z[1],A[2]+=z[2]),x===Nt){v=r("edge.segments");var V=p.points=r(ae)||pc;if(_=V.size()){y=Qd(V.get(0)),m=Qd(V.get(_-1)),!O&&P&&(d=Ml(y,k,!0),P=D(P,nl(k,y)),k=[k[0]+d[0]*P,k[1]+d[1]*P,k[2]+d[2]*P],d=Ml(A,m,!0),P=D(P,nl(m,A)),A=[A[0]-d[0]*P,A[1]-d[1]*P,A[2]-d[2]*P]);E=_%2;0===E?(c=Qd(V.get(_/2-1)),h=Qd(V.get(_/2))):p.p3=Qd(V.get((_-E)/2)),p.s1=k,p.s2=y,p.t1=m,p.t2=A}else!O&&P&&(d=Ml(A,k,!0),f=nl(k,A),P=qc(P,f),k=[k[0]+d[0]*P,k[1]+d[1]*P,k[2]+d[2]*P],A=[A[0]-d[0]*P,A[1]-d[1]*P,A[2]-d[2]*P]),c=k,h=A;g.add({x:k[0],y:k[2],e:k[1]}),g.addAll(V),g.add({x:A[0],y:A[2],e:A[1]})}else{var B=Yc(e,i,n,b,x);if(e._19Q||(B=-B),b){var L=k[0],F=k[1],j=k[2],H=a.getTall()/2+B;c=[L-B,F+H,j],h=[L+B,F+H,j],g.add({x:L-B,y:j,e:F}),g.add({x:L-B,y:j,e:F+H}),g.add({x:L+B,y:j,e:F+H}),g.add({x:L+B,y:j,e:F})}else{d=Ml(A,k,!0),f=nl(k,A);var G={x:k[0],y:k[2]},U={x:A[0],y:A[2]},W=af(l,G,U,B),N=W.x-G.x,q=W.y-G.y;P=qc(P,f),d[0]*=P,d[1]*=P,d[2]*=P,c=[k[0]+d[0]+N,k[1]+d[1],k[2]+d[2]+q],h=[A[0]-d[0]+N,A[1]-d[1],A[2]-d[2]+q],O?(g.add({x:k[0],y:k[2],e:k[1]}),g.add({x:c[0],y:c[2],e:c[1]}),g.add({x:h[0],y:h[2],e:h[1]}),g.add({x:A[0],y:A[2],e:A[1]})):(g.add({x:c[0],y:c[2],e:c[1]}),g.add({x:h[0],y:h[2],e:h[1]}))}}p.c1=c,p.c2=h}p._lastPointsSegments={points:g,segments:v},p.list=r(Ne)===Ot?e.createTubeModel(g,v,o/2,t):e.createLineModel(g,v,o,"edge","edge.dash")}}},invalidateCachedGeometry:function(){this.info=l}});var Mv=function(t,e){Kn(Mv,this,[t,e])};bl(Mv,Cv,{_80o:function(t,e,i){var n=this,r=n.gv,o=n.shapeModel;Zf(r,n.mat),o?dp(r,n.data,o,n,n.getBodyColor(),i):(rg(n,t,e,"left",i),rg(n,t,e,"front",i),rg(n,t,e,"right",i),rg(n,t,e,"back",i),rg(n,t,e,"top",i),rg(n,t,e,"bottom",i)),Qf(r)},validate:function(t,e){var i,n,r=this,o=r.s,a=r.data,s=(a.p3(),a._thickness/2),c=a.isClosePath(),h=a.getPoints(),u=a.getSegments(),d=o(qe),f=t&&t.uv;if(r.clear(),0>s){try{n=r.shapeModel=_h(h,u,o(Ze),o(Je),d,o(Ke),a.getTall(),a.getShapeElevation(),c)}catch(Z){n=r.shapeModel={}}o(Xe)?o("shape3d.image")||delete n.uv:(delete n.vs,delete n.ns,delete n.uv),o("shape3d.top.image")||delete n.top_uv,o("shape3d.bottom.image")||delete n.bottom_uv}else if(o(Ne)===Ot)i=Ro(h,u,d,c),n=r.shapeModel={vs:[]},o("shape3d.image")&&(n.uv=[],n.sum=o(Ke)||fr(i)||1,n.len=0),o(Ze)&&!c&&(n.top_vs=[],o("shape3d.top.image")&&(n.top_uv=[])),o(Je)&&!c&&(n.bottom_vs=[],o("shape3d.bottom.image")&&(n.bottom_uv=[])),r._12O(i,s);else{var g,p,v,_,y,m,b,x,w,C;if(i=Ro(h,u,d,c),y=r.vf(dt,f,!1,e),s&&(m=r.vf(ft,f,!1,e),b=c?l:r.vf(gt,f,!1,e),x=c?l:r.vf(pt,f,!1,e),w=r.vf(vt,f,!1,e),C=r.vf(_t,f,!1,e)),s){for(var S=0,I=i.length;I>S;S++)i[S]=r._tryRemoveBezierPoints(i[S],s);r._12O(i,s)}else y&&i.forEach((function(t){if(_=t.length,_>0)for(g=t[0],v=1;_>v;v++)p=t[v],r.addV(y.vs,g,p),g=p}));r._20Q(i),t||(y&&(y.ns=bf(y.vs),_p(y,"vs"),_p(y,ue)),s&&(m&&(m.ns=bf(m.vs),_p(m,"vs"),_p(m,ue)),b&&(b.ns=bf(b.vs),_p(b,"vs"),_p(b,ue)),x&&(x.ns=bf(x.vs),_p(x,"vs"),_p(x,ue)),w&&(w.ns=bf(w.vs),_p(w,"vs"),_p(w,ue)),C&&(C.ns=bf(C.vs),_p(C,"vs"),_p(C,ue))))}var M=r.mat=a.getPointsMatrix3d().getElements();t&&(Pg(r,M,t,n),r.clear())},_20Q:function(t){var e,i,n,r,o,a,s,c=this,h=c.front,u=c.back,d=c.top,f=c.bottom,g=h?h.tuv:l,p=u?u.tuv:l,v=d?d.tuv:l,_=f?f.tuv:l,y=0;(g||p||v||_)&&(e=c.s(Ke)||fr(t)||1,t.forEach((function(t){if(i=t.length,i>0)for(a=t[0],n=1;i>n;n++)s=t[n],r=y/e,y+=nl(a,s),o=y/e,c._14O(h,r,o),c._14O(u,1-o,1-r),c._14O(d,r,o),c._14O(f,r,o),a=s})))},_14O:function(t,e,i){if(t){var n=t.uv,r=t.tuv;if(r){if(n)var o=n[0]+(n[6]-n[0])*e,a=n[1]+(n[7]-n[1])*e,s=n[2]+(n[4]-n[2])*e,l=n[3]+(n[5]-n[3])*e,c=n[2]+(n[4]-n[2])*i,h=n[3]+(n[5]-n[3])*i,u=n[0]+(n[6]-n[0])*i,d=n[1]+(n[7]-n[1])*i;else o=e,a=0,s=e,l=1,c=i,h=1,u=i,d=0;r.push(s,l,c,h,u,d,u,d,o,a,s,l)}}},_13O:function(t){var e=t.uv,i=t.tuv;i&&(e?i.push(e[2],e[3],e[4],e[5],e[6],e[7],e[6],e[7],e[0],e[1],e[2],e[3]):i.push(0,1,1,1,1,0,1,0,0,0,0,1))},_tryRemoveBezierPoints:function(t,e){var i=t.length;if(4>i)return t;var n,r,o,a,s,l,c=!1,h=function(e){return t[e]},u=function(e){return t[i-1-e]};for(s=0;1>=s;s++)for(l=s?u:h,r=l(0),o=l(1),n=2;i-1>n;n++)if(a=l(n),!a.remove)if(a.b){var d=af(r,o,a,e);d.adjust?(a.remove=!0,c=!0):(r=o,o=a)}else r=o,o=a;if(!c)return t;var f=[];for(n=0;i>n;n++)t[n].remove||f.push(t[n]);return f},_12O:function(t,e){var i,n,r,o,a,s=this.s("shape3d.point.epsilon"),c=this;t.forEach((function(t){if(a=t.length,a>0)for(i={p:t[0],n:!0},o=1;a>o;o++)n=t[o],r=a-1>o?t[o+1]:l,r&&Math.abs(n.x-r.x)<s&&Math.abs(n.y-r.y)<s||c.addPoint(i,n,r,e,t)}))},addPoint:function(t,e,i,n,r){var o,a,s,c,h,u,d,f,g,p=this,v=t.p,_=t.f,y=t.b,m=p.s("shape3d.side")||ml,b=p.s("shape3d.start.angle"),x=p.s("shape3d.sweep.angle"),w=p.shapeModel,C=p.data.isClosePath();if(t.n&&(t.n=!1,_=C&&r.length>2?af(r[r.length-2],v,e,n):af(l,v,e,n),y=of(v,_),w?w.top_vs&&p._10O(y,_,m,b,x,w.top_vs,w.top_uv):(o=p.left)&&(p.addV(o.vs,y,_),p._13O(o))),a=i?af(v,e,i,n):C&&r.length>2?af(v,e,r[1],n):af(v,e,l,n),s=of(e,a),w){var S,I,M=w.vs,T=w.uv,E=w.sum;for(T&&(S=w.len/E,w.len+=nl(v,e),I=w.len/E),u=p._9O(y,_,m,b,x),d=p._9O(s,a,m,b,x),f=0;m>f;f++)g=f+1,qn(M,u[g]),qn(M,d[f]),qn(M,u[f]),qn(M,d[f]),qn(M,u[g]),qn(M,d[g]),T&&(c=f/m,h=g/m,T.push(S,h,I,c,S,c,I,c,S,h,I,h));!i&&w.bottom_vs&&p._10O(s,a,m,b,x,w.bottom_vs,w.bottom_uv,!0)}else!i&&(o=p.right)&&(p.addV(o.vs,a,s),p._13O(o)),(o=p.front)&&p.addV(o.vs,_,a),(o=p.back)&&p.addV(o.vs,s,y),(o=p.top)&&p.addH(o.vs,_,a,s,y,!0),(o=p.bottom)&&p.addH(o.vs,y,s,a,_);t.p=e,t.f=a,t.b=s},_10O:function(t,e,i,n,r,o,a,s){var l,c,h=this,u=h.data,d=h._9O(t,e,i,n,r),f=(t.x+e.x)/2,g=(t.y+e.y)/2,p=u.getShapeElevation(),v=0;for(v=0;i>v;v++)s?(qn(o,d[v]),qn(o,d[v+1])):(qn(o,d[v+1]),qn(o,d[v])),qn(o,[f,p,g]),a&&(s?(l=F*(v+1)/i+n,c=F*v/i+n):(l=F*v/i+n,c=F*(v+1)/i+n),a.push(.5-.5*R(c),.5-.5*k(c),.5-.5*R(l),.5-.5*k(l),.5,.5))},_9O:function(t,e,i,n,r){var o,a,s=this,c=s.data,h=[],u=(t.x+e.x)/2,d=(t.y+e.y)/2,f=c.getTall()/2,g=c.getShapeElevation(),p=0;for(r==l&&(r=F);i>=p;p++)o=r*p/i+n,a=R(o),h.push([u+(t.x-u)*a,g+f*k(o),d+(t.y-d)*a]);return h},addV:function(t,e,i){var n=e.x,r=e.y,o=i.x,a=i.y,s=this.data,l=s.getShapeElevation(),c=s.getTall()/2;t.push(n,l-c,r,o,l-c,a,o,l+c,a,o,l+c,a,n,l+c,r,n,l-c,r)},addH:function(t,e,i,n,r,o){var a=this.data,s=a.getTall()/2,l=a.getShapeElevation()+(o?s:-s);t.push(e.x,l,e.y,i.x,l,i.y,n.x,l,n.y,n.x,l,n.y,r.x,l,r.y,e.x,l,e.y)},vf:function(t,e,i,n){var r,o=this,a=o.gv.getFaceVisible(o.data,t);return(i||a)&&(r=ng(o,t,n),r.vs=[],r.tuv=a&&(r.texture||e)?[]:l,r.visible=a),r}});var Tv=function(t,e){Kn(Tv,this,[t,e])};bl(Tv,wv,{_25Q:1,validate:function(t){var e=this,i=e.data,n=e.s,r=i.getPoints(),o=r.size();if((!e.s("geometry.cache")||!e.shapeModel)&&(e.shapeModel=e.info=l,o>1)){var a=e.info={},s=i.getSegments(),c=i.getThickness(),h=Qd(r.get(0)),u=Qd(r.get(o-1)),d=o%2;0===d?(a.c1=Qd(r.get(o/2-1)),a.c2=Qd(r.get(o/2))):a.p3=Qd(r.get((o-d)/2)),a.s1=h,a.s2=Qd(r.get(1)),a.t1=Qd(r.get(o-2)),a.t2=u,a.list=n(Ne)===Ot?e.createTubeModel(r,s,c/2,t):e.createLineModel(r,s,c,"shape.border","shape.dash")}var f=i.p3(),g=e.mat=Pl();cf(g,f),cu(g,i.getFinalRotation3d(),i.getRotationMode());var p=i.getScale3d(),v=i._dynamicScale3d;v&&(p[0]*=v[0],p[1]*=v[1],p[2]*=v[2]),hf(g,p),cf(g,Tl(f))},invalidateCachedGeometry:function(){this.shapeModel=this.info=l},_80o:function(t,e,i){var n=this,r=n.shapeModel;if(r){var o=n.gv;Zf(o,n.mat),dp(o,n.data,r,n,n.getBodyColor(),i),Qf(o)}}});var Ev=c.graph3d.VR=function(e){var i=this;i.gv=e,i._controllers=[],i.switch=new Dv(i),i._enable=!1,i._defaultCallLater=c.Default.callLater,i._defaultCancelLater=Fs,"undefined"!=typeof t&&"VRFrameData"in t&&(i._frameData=new t.VRFrameData),i.measureOflength=1,i.eyesOffset=[0,0,0],i._orientation=new ja.Quaternion,i._lastHeadPose=[0,0,0],i._offsetToBeAdd=[0,0,0],i._originalOrientation=null,i._fpsInfo={time:0,fps:0,frames:0}};bl(Ev,e,{ms_fire:!0,setOriginalYRotation:function(t){var e=this;if(null!=t){var i=new ja.Vector3(0,1,0),n=(new ja.Quaternion).setFromAxisAngle(i,-t),r=(new ja.Matrix4).makeRotationFromQuaternion(n);return n.setFromAxisAngle(i,t),e._originalOrientation={quaternion:n,matrixInverse:r},!0}e._originalOrientation=null},_42:function(t,e,i,n){var r=this,o=r.gv;if(!o.drawFilter&&r._deviceInAction){var a=r._device;if(a){var s=r._measureOflength;a.depthNear=o.getNear()*s,a.depthFar=o.getFar()*s;var l=r._offsetToBeAdd;if(r.eyesOffset[0]+=l[0],r.eyesOffset[1]+=l[1],r.eyesOffset[2]+=l[2],l[0]=0,l[1]=0,l[2]=0,!1===a.isPresenting)return r._controllers.forEach((function(t){t&&t.update()})),o.iv(),!1;var c=r._frameData;a.getFrameData(c);var h=c.pose.position;if(h){var u=r.toViewPosition(h);o.setEye(u),r._orientation.fromArray(c.pose.orientation),r._originalOrientation&&r._orientation.premultiply(r._originalOrientation.quaternion);var d=new ja.Vector3(0,0,-10*r._scaleFactor);d.applyQuaternion(r._orientation),o.setCenter([u[0]+d.x,u[1]+d.y,u[2]+d.z])}r._controllers.forEach((function(t){t&&t.update()})),o.setViewport(t,0,0,e/2,i),r._viewMatrix=r._copyViewMatrix(c.leftViewMatrix),r._projectMatrix=r._copyProjectMatrix(c.leftProjectionMatrix),n(),o.setViewport(t,e/2,0,e/2,i),r._viewMatrix=r._copyViewMatrix(c.rightViewMatrix),r._projectMatrix=r._copyProjectMatrix(c.rightProjectionMatrix),n(),r._lastViewMatrix=r._viewMatrix,r._lastProjectMatrix=r._projectMatrix,r._viewMatrix=null,r._projectMatrix=null,r.submitFrame();var f=Date.now(),g=r._fpsInfo;return f-g.time>1e3?(g.fps=Math.round(1e3*(g.frames+1)/(f-g.time)),g.time=f,g.frames=0):g.frames++,!0}}},onVRDisplayPresentChange:function(){var t=this.isPresenting();this._injectGraphView(t),this.fp("present",!t,t)},getOrientation:function(){return this._orientation},addController:function(t){t=t||0;var e=this,i=e.getController(t);return i||(i=new Pv(e,t),e._controllers.push(i),i)},getController:function(t){t=t||0;for(var e=this._controllers,i=0,n=e.length;n>i;i++)if(e[i]&&e[i].id===t)return e[i];return null},removeController:function(t){t=t||0;for(var e=this._controllers,i=0,n=e.length;n>i;i++)if(e[i]&&e[i].id===t)return e.splice(i,1),!0;return!1},getLastHeadPose:function(){return this._lastHeadPose},toViewPosition:function(t,e){var i=this,n=i._scaleFactor,r=i._eyesOffset,o=i._lastHeadPose;if(i._originalOrientation){var a=i._originalOrientation.quaternion,s=new ja.Vector3(t);s.applyQuaternion(a).multiplyScalar(n).toArray(o)}else o[0]=t[0]*n,o[1]=t[1]*n,o[2]=t[2]*n;return e?(e[0]=o[0]+r[0],e[1]=o[1]+r[1],e[2]=o[2]+r[2],e):[o[0]+r[0],o[1]+r[1],o[2]+r[2]]},addEyesOffset:function(t,e,i){var n=this._offsetToBeAdd;n[0]+=t,n[1]+=e,n[2]+=i},_copyViewMatrix:function(t){var e=this,i=e.dup(t);if(e._originalOrientation){var n=(new ja.Matrix4).fromArray(i);n.multiply(e._originalOrientation.matrixInverse).toArray(i)}var r=e._scaleFactor;i[12]*=r,i[13]*=r,i[14]*=r;var o=e._eyesOffset;if(o&&(o[0]||o[1]||o[2])){var a=o[0],s=o[1],l=o[2];i[12]-=i[0]*a+i[4]*s+i[8]*l,i[13]-=i[1]*a+i[5]*s+i[9]*l,i[14]-=i[2]*a+i[6]*s+i[10]*l}return i},shutdown:function(){var t=this._device;t&&t.isPresenting&&t.exitPresent()},isPresenting:function(){var t=this._device;return t&&t.isPresenting},_copyProjectMatrix:function(t){var e=this.dup(t),i=this._scaleFactor;return e[14]*=i,e},dup:function(t,e){for(var i=t.length,n=e||new Array(i);i--;)n[i]=t[i];return n},getViewMatrix:function(t){var e=this._viewMatrix;return e?this.dup(e,t):void 0},getProjectMatrix:function(){var t=this._projectMatrix;return t?this.dup(t):void 0},submitFrame:function(){var t=this;if(t._enable&&t._deviceInAction){var e=t._device;e&&e.isPresenting&&(e.submitFrame(),t.gv.iv())}},getFps:function(){return this._fpsInfo.fps},intersectWorld:function(t){var e=this.gv;return e.intersectObjects(t,e.dm().getDatas())},setDevice:function(t){var e=this;e._device=t},_injectGraphView:function(){var t,e,i;return function(n){var r=this.gv;if(n){var o=this._device,a=o.getEyeParameters("left"),s=a.renderWidth,l=a.renderHeight;t=r.getWidth,e=r.getHeight,i=r.getDevicePixelRatio,r.getWidth=function(){return 2*s},r.getHeight=function(){return l},r.getDevicePixelRatio=function(){return 1}}else t&&(r.getWidth=t,r.getHeight=e,r.getDevicePixelRatio=i)}}(),_injectCallLaterFunc:function(t){var e=this;if(!t)return Ls=c.Default.callLater=e._defaultCallLater,void(Fs=c.Default.cancelLater=e._defaultCancelLater);e=this;Ls=c.Default.callLater=function(t,i,n,r){var o=e._device;return o&&o.isPresenting?r?J((function(){Ls(t,i,n)}),r):o.requestAnimationFrame((function(){e._deviceInAction=!0,t.apply(i,n),e._deviceInAction=!1})):e._defaultCallLater(t,i,n,r)},Fs=c.Default.cancelLater=function(t,i){var n=e._device;return n&&n.isPresenting?i?K(t):n.cancelAnimationFrame(t):e._defaultCancelLater(t,i)}}}),e.defineProperties(Ev.prototype,{enable:{get:function(){return this._enable},set:function(t){var e=this;e._enable!==t&&(e._enable=t,t?(e.switch.showButton(),e._injectCallLaterFunc(!0)):(e.shutdown(),e.switch.hideButton(),e._injectCallLaterFunc(!1)),e.fp("enable",!t,t))}},measureOflength:{get:function(){return this._measureOflength},set:function(t){this._measureOflength=t;var e=this._scaleFactor=1/t;this._controllers.forEach((function(t){t&&t._setScaleFactor(e)}))}},eyesOffset:{get:function(){return this._eyesOffset},set:function(t){this._eyesOffset=t}},controllerModel:{get:function(){return this._controllerModel},set:function(t){var e;"object"==typeof t?(e=t.mtl,t=t.obj):(e=t+".mtl",t+=".obj");var i=this,n=i._controllerModel;n&&n.obj===t&&n.mtl===e||(n=i._controllerModel={obj:t,mtl:e},u.loadObj(t,e,{finishFunc:function(t,e){i._controllerModel===n&&u.setShape3dModel("vrControllerModel",e)}}))}},interactive:{get:function(){return!!this._interactive},set:function(t){!!t!=!!this._interactive&&(this._interactive=t,t&&this.addController(0),this.gv.getCoreInteractor().enableVR(t))}}});var Pv=function(t,e){function n(t){var e=navigator.getGamepads&&navigator.getGamepads();if(e)for(var i=0,n=0,r=e.length;r>i;i++){var o=e[i];if(o){var a=o.id;if("OpenVR Gamepad"===a||0===a.indexOf("Oculus Touch")||a.indexOf("Controller")>=0){if(n===t)return o;n++}}}}function r(t,e,i){return Math.abs(t[0]-e[0])<i&&Math.abs(t[1]-e[1])<i&&Math.abs(t[2]-e[2])<i}var o=this;o.vr=t,o.id=e;var a,s=[0,0],l=[{id:"thumbpad",pressed:!1},{id:"trigger",pressed:!1},{id:"grips",pressed:!1},{id:"menu",pressed:!1}],c=new ru;c.s("shape3d","vrControllerModel"),c.isController=!0,c.s("intersect",!1),o.getGamepad=function(){return a},o.isButtonPressed=function(t){for(var e,i=0,n=l.length;n>i;i++)if(e=l[i],e.id===t)return e.pressed;return!1},o.getNode=function(){return c};var h=.003;o.setRotationEpsilon=function(t){h=t};var d=5e-4,f=d;o.setPositionEpsilon=function(t){d=t,f=t*o.vr._scaleFactor},o._setScaleFactor=function(t){c.s3(t,t,t),f=d*t},o._setScaleFactor(o.vr._scaleFactor);var g,p=new Ua,v=new Ka,_=[0,0,0],y=[0,0,0],m=new ts,b=new Na,x=new Qa;o.getRay=function(){return g?(x.origin.fromArray(_),x.direction.copy(b),g=!1,x):x},o.update=function(){if(a,a=n(e),!a||a.pose===i)return a=null,void c.s("3d.visible",!1);if(u.getShape3dModel("vrControllerModel")){c.dm()||t.gv.dm().add(c),c.s("3d.visible",!0);var d=a.pose;if(null!==d){if(d.position&&(o.vr.toViewPosition(d.position,_),r(c.p3(),_,f)||(g=!0,c.p3(_))),d.orientation){p.fromArray(d.orientation);var x=o.vr._originalOrientation;x&&p.premultiply(x.quaternion),b.set(0,0,-1).applyQuaternion(p).normalize(),v.makeRotationFromQuaternion(p),m.set(0,0,0,c.getRotationMode(),!0).setFromRotationMatrix(v),y[0]=m.x,y[1]=m.y,y[2]=m.z,r(c.r3(),y,h)||(g=!0,c.r3(y))}g&&t.fp("gamepad.pose",null,{position:_,rotation:y,id:e});var w=a.axes;(s[0]!==w[0]||s[1]!==w[1])&&(s=[w[0],w[1]],t.fp("gamepad.axes",null,{id:e,axes:s}));var C,S,I,M,T=a.buttons;for(C=0,S=T.length;S>C;C++)if(I=T[C],I&&(M=I.pressed,l[C]||(l[C]={id:"button"+C,pressed:!1}),M!==l[C].pressed)){l[C].pressed=M;var E={id:e},P="state";E[P]=E._62O=M?"down":"up",t.fp("gamepad.button."+l[C].id,null,E)}}}}},Dv=function(t){this.vr=t,this._button=null};bl(Dv,e,{showButton:function(){var t=this.assureButton();if(!t.parentNode){var e=this.vr.gv,i=e.getView();e._79O?i.insertBefore(t,e._79O):i.appendChild(t)}},hideButton:function(){var t=this._button;t&&t.parentNode&&t.parentNode.removeChild(t)},assureButton:function(){var t=this._button;return t||(this._button=this.createButton(this.vr.gv))},createButton:function(e){function i(t,e){t.textContent=e&&e.isPresenting?"关闭 VR 显示":"开启 VR 显示"}function n(t){a.style.display="",a.style.cursor="pointer",a.style.left="calc(50% - 50px)",a.style.width="100px",i(a,t),a.onmouseenter=function(){a.style.opacity="1.0"},a.onmouseleave=function(){a.style.opacity="0.5"},a.onclick=function(){t.isPresenting?t.exitPresent():t.requestPresent([{source:e.getCanvas()}])},e.vr.setDevice(t)}function r(){a.style.display="",a.style.cursor="auto",a.style.left="calc(50% - 75px)",a.style.width="150px",i(a,null),a.onmouseenter=null,a.onmouseleave=null,a.onclick=null,e.vr.setDevice(null)}function o(t){t.style.position="absolute",t.style.bottom="20px",t.style.padding="12px 6px",t.style.border="1px solid #fff",t.style.borderRadius="4px",t.style.color="#000",t.style.font="normal 13px sans-serif",t.style.textAlign="center",t.style.opacity="0.5",t.style.outline="none",t.style.zIndex="999"}if("getVRDisplays"in navigator){var a=this._button=s.createElement("button");return a.style.display="none",o(a),w(t,"vrdisplayconnect",(function(t){n(t.display)})),w(t,"vrdisplaydisconnect",(function(){r()})),w(t,"vrdisplaypresentchange",(function(t){i(a,t.display),e.vr.onVRDisplayPresentChange()})),navigator.getVRDisplays().then((function(t){t.length>0?n(t[0]):r()})),a}var l=s.createElement("a");return l.href="https://webvr.info",l.innerHTML="当前不支持 webvr",l.style.left="calc(50% - 90px)",l.style.width="180px",l.style.textDecoration="none",o(l),l}}),e.defineProperties(Dv.prototype,{});var Ov=c.graph3d.PostProcessing=function(t){function n(){if(!r){var e=t.getGL();r=new ag.RenderTarget(t,e,null,null,{samples:d.renderTextureSamples||1}),o=new Cp.Shader(e,u.vs,u.fs),a=Cp.Buffer.createIndexBuffer(e,new Uint16Array([0,2,1,1,2,3])),s=Cp.Buffer.createVertexBuffer(e,new Float32Array([0,0,1,0,0,1,1,1]))}}var r,o,a,s,l=this,c={},h=!1;!function(){e.keys(Ov).forEach((function(e){c[e]=new Ov[e](t)}))}(),l.getModule=function(t){return t?c[t]:l},l.getModuleList=function(){return e.keys(c)},l._serializable=!0,l.handleDataModleChange=function(t,e){t&&(l._serializable&&t.setPostProcessingData(l.serialize()),t.removeSerializeListener(l.onDataModelSerialize,l)),e&&(e.addSerializeListener(l.onDataModelSerialize,l),l.deserialize(e))},l.onDataModelSerialize=function(e){"serialize"===e.type?l._serializable&&(t.dm()._postProcessingData=l.serialize()):"deserialize"===e.type&&l.deserialize(t.dm())},l.isDeserializeDisabled=function(t){return!l._serializable||t.a("sceneBloom")!==i},l.isSerializable=function(){return l._serializable},l.setSerializable=function(e){l._serializable=e,e||t.dm().setPostProcessingData(i)},l.serialize=function(){var t,i,n,r,o={};for(i in c)if(n=c[i],r=n.serializeProperties){for(var a in t={},n.enable&&(t.enable=!0),r){var s=n[a];s!=r[a]&&(t[a]=s)}e.keys(t).length&&(o[i.toLowerCase()]=t)}return o},l.deserialize=function(t){var e,n,r,o,a={},s={};for(e in c){r=c[e],o=r.serializeProperties;var h={},u="scene"+e,d=t.a(u);for(var f in d!==i&&(h.enable=d),o)d=t.a(u+f[0].toUpperCase()+f.slice(1)),d!==i&&d!==o[f]&&(h[f]=d);$n(h)||(s[e.toLowerCase()]=h)}if($n(s)&&(s=t.getPostProcessingData()),s)for(n in s)if(n&&(e=n[0].toUpperCase()+n.slice(1),r=c[e])){a[e]=!0,o=s[n];var g=!!o.enable;for(f in l.enableModule(e,g),e="scene"+e,t.a(e,g),r.resetProperties&&r.resetProperties(),o)if("enable"!==f){d=o[f];r[f]=d,t.a(e+f[0].toUpperCase()+f.slice(1),d)}}for(e in c)a[e]||(r=c[e],r.enable=!1,r.resetProperties&&r.resetProperties())},l.decodeShader=function(t){var e,i,n,r="",o="";for(n=0;n<t.length;n++)e=t[n],"%"===e?e="'":"a"===e?e='"':"]"===e&&(e="\\"),i=String.fromCharCode(e.charCodeAt(0)-1),n%2?o+=i:r=i+r;return o+r},l.createShader=function(t,e,i){var n=e.indexOf("^#"),r=l.decodeShader(e.substr(0,n)),o=l.decodeShader(e.substr(n+2));if(i){var a=i(r,o);a&&a.vs&&(r=a.vs),a&&a.fs&&(o=a.fs)}return new Cp.Shader(t,r,o)},l.enableModule=function(t,e){var i,r,o,a=t.split(",");for(i=0,r=a.length;r>i;i++)o=a[i].trim(),c[o]&&(c[o].enable=e);for(o in h=!1,c)if(c[o].enable){h=!0;break}h&&n()};var u={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};l._42=function(e,i,n,l,u){if(h&&!u){r.setSize(e,i,n),r.bind(e);var d=e.getParameter(e.COLOR_CLEAR_VALUE);d&&0===d[0]&&0===d[1]&&0===d[2]&&0===d[3]?d=null:Df(e,[0,0,0,0]),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),t.setViewport(e,0,0,i,n),l(),r.unbind(e);for(var f=0,g=t._glCapabilities.maxAttributes;g>f;f++)e.disableVertexAttribArray(f);var p,v=r;for(p in c)v=c[p]._42(e,v)||v;return t.setViewport(e,0,0,i,n),d&&Df(e,d),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),o.bind(),e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,v.texture),o.uniforms.image=0,a.upload(),s.upload(),o.attributes.pos.pointer(s),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),e.bindTexture(e.TEXTURE_2D,null),e.useProgram(t._prg),!0}}},Rv=c.graph3d.PostProcessing.Bloom=function(t){function i(){var e=t.getGL();if(e)for(var i=t._postProcessing,n=0;b>n;n++)w[n]=i.createShader(e,Rv._35Q,(function(t,e){return{fs:e.replace(/DEFINE_VALUE/g,x[n]).replace("%OVERRIDE_ALPHA_DEFINE%",s?"#define OVERRIDE_ALPHA":"")}}))}function n(){var e=t.getWidth(),n=t.getHeight();if(e&&n){_=[e,n],d=!0;var r,o=t.getGL(),a=Math.round(_[0]/2),s=Math.round(_[1]/2);for(f=new ag.RenderTarget(t,o,a,s),r=0;b>r;r++)y.push(new ag.RenderTarget(t,o,a,s)),m.push(new ag.RenderTarget(t,o,a,s)),a=Math.round(a/2),s=Math.round(s/2);var h=t._postProcessing;g=h.createShader(o,Rv._34Q),i(),p=h.createShader(o,Rv._36Q,(function(t,e){return{fs:e.replace(/NUM_MIPS/g,b)}})),v=h.createShader(o,Rv.finalShader),l=Cp.Buffer.createIndexBuffer(o,new Uint16Array([0,2,1,1,2,3])),c=Cp.Buffer.createVertexBuffer(o,new Float32Array([0,0,1,0,0,1,1,1]))}}var r,o,a,s,l,c,h=this,u=!1,d=!1;this.serializeProperties={strength:1.5,threshold:.55,radius:.4,overrideAlpha:!0},this.resetProperties=function(){var t=this.serializeProperties;for(var e in t)this[e]=t[e]},e.defineProperties(h,{enable:{get:function(){return u},set:function(e){!!u!=!!e&&(u=e,e&&!d&&n(),t.iv())}},strength:{get:function(){return r},set:function(e){r!==e&&(r=e,t.iv())}},threshold:{get:function(){return o},set:function(e){o!==e&&(o=e,t.iv())}},radius:{get:function(){return a},set:function(e){a!==e&&(a=e,t.iv())}},overrideAlpha:{get:function(){return s},set:function(e){!!s!=!!e&&(s=e,d&&i(),t.iv())}}}),this.resetProperties();var f,g,p,v,_=[256,256],y=[],m=[],b=5,x=[3,5,7,9,11],w=[];h._42=function(e,i){function s(i,n,r,o){jd(e,n.frame),t.setViewport(e,0,0,n.width,n.height),o?o(e):e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),h!==i&&i.bind();var a=0;for(var s in r){var u=r[s];u instanceof WebGLTexture&&(e.activeTexture(e.TEXTURE0+a),e.bindTexture(e.TEXTURE_2D,u),u=a,a++),i.uniforms[s]=u}for(h!==i&&(l.upload(),c.upload(),i.attributes.pos.pointer(c),h=i),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0);a--;)e.activeTexture(e.TEXTURE0+a),e.bindTexture(e.TEXTURE_2D,null);Hd(e)}if(u&&(d||(n(),d))){var h;s(g,f,{smoothWidth:.01,luminosityThreshold:o,tDiffuse:i.texture});var x,C=f,S=Math.round(_[0]/2),I=Math.round(_[1]/2);for(x=0;b>x;x++)s(w[x],y[x],{colorTexture:C.texture,direction:[1,0],texSize:[S,I]}),s(w[x],m[x],{colorTexture:y[x].texture,direction:[0,1],texSize:[S,I]}),S=Math.round(S/2),I=Math.round(I/2),C=m[x];return s(p,y[0],{blurTexture1:m[0].texture,blurTexture2:m[1].texture,blurTexture3:m[2].texture,blurTexture4:m[3].texture,blurTexture5:m[4].texture,bloomStrength:r,bloomRadius:a,bloomTintColor:[1,1,1]}),s(v,i,{image:y[0].texture},(function(t){t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE)})),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),i}}};Rv._34Q="~b\vu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<t\vpwqb)s3zdjfowh!!>w!fwdV3w!\vw<V*w1</\v2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!\v+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~q\vs<f*d!jbtijqpmob!!i-jmhfiyqf!ug!m-psbpum<p\vDvuovjqgupvspn!!)tybjnnq!m>f!ss3pEm!puDEhjbgsgGv`tmfh<\v\v<v*o!jwg!p-sinu!egjmXpibuup!pmnvtn!j,o!petmjpuiztUfissifUtziupjmtep<o\vjvnovjmg!p-senm!pgimtpfbsui!UtznupjptupioXjjnevumi!<)\vqwfbustzijuophp!nwtf!d>3!!bwiVqwm<b\v!wupbjpem!gn\vb<j*o1)/*1!!|-\v1w/f1d!5-!1u/f1y!f-m1!/>1!)u5fdyfuwv!s>f!3sEp)m!puDEujvgqguvvtpf!-5!dwfVww\v!<**<!\vbwnfvdm4!!-m{vznyb/!m>f!ywffud!4))u!p1e/!3>:!:w-!!u1b/p6m9g8\v-<!*1!/522",Rv._35Q="~b\vu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<t\vpwqb)s3zdjfowh!!>w!fwdV3w!\vw<V*w1</\v2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!\v+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~q\vsgfjdejotfj$p\vo<!*ibj/hyijqQ!fgsmvpubyuf<u\v!w-bnsvzTjuoihh!jwffxd03n!vwTVfwt<v\vgvgojjeg)p5sdnf!wt!b>n!qsmpfmsp3DEh!bdspGm`pmshU\vffytumvfs$f\v<<\v*v1o/j2g!p-snnv!Twufidh3j!fuxf0ynTvjT{fft<v\vgvgojjeg)p5sdnf!ww!f>d!3s!pemjpsDfhdbusjGp`om<h\v\v$BeIfQgMjBo`fF!ELJFSSSOFFWMP`!SgBfEeJgVjT$!\vE~F\vG<JxO!F+`!W1B/M3V!F>\v,$!enfvgTjuoifh!jTfJxH\vN<Bx!!E+F!G*J3OfFm`qWnBbMtV!F,\v!&2PfWmFqSnSbJtE)F!`>B,M!QnIvBT`fEtFvGgJgOjFe&\v\v<gcmhpsb/u*!uhfbtvgtgtPjwbvo!Q.e!gw)Vjwo!!-gfmspvbuuy!fyU-s!pjmop!dg!m)pEb3uf!stvjuhynfbu*!!>|!\v3sffmuqvnsbot!!14/d4f:w9\v:<5c!h+s!/f*yuqf)t!g.g1P/w6v!!+,!!yw!V+w!!y-0f)s!vtujyhfnUbs!p+m!ptdj!h)nEb3*f*s0vtujyhfnub!<>\v!~2\vfwmpqjneb!tn!b4jdof)w*\v!<|y\v!w+f!df3{!jjTowwoTjj!{+f!!o>p!j2u/d1f!s0j!eu!f>y!Tujf{tfg<g\vPgwmvp!b3ud!fgwT\vj<h*nbbn!h>j!Tggm!p-byu))gTeJQHoNbBj*t<t\vvgbmhp!b>u!!xx!fujbhpimugT\vv<n*!j>)!uhbbpvmtgt!j>b!oyQ!eugb)p1m/g1\v-|!!g*T!j,h,n!bj*!<<\vTwVfJdE5B!Su`fMyFuOvSsFfLQ!j=y!!j>!!<u2f!y>u!vjs!fu3oEj)!!)dsppmgp\vs<UnfvyTuuvishfj-f!xw!V+w!*c<h\vsw/fydj4Q!fesjvgugyvftuf!T>v!n",Rv._36Q="~b\vu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<t\vpwqb)s3zdjfowh!!>w!fwdV3w!\vw<V*w1</\v2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!\v+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~q\vs<f*d!j*twjVpwo!!-i6jfhsivqu!ygfmUpsbvum<c\v)wEb3sfzsjvouhy!fwuf!d+3!!*w1V/w2<!\v-vsopjmgppDsuno!jtUbnnpqpmmfcs)35Ed!fcwm!v+s!U*f3y/u1v)ssfp2u<d\vbvGonjpgppmsCnq!stfbmn\vq!m,f!s*3wEV!wc!m-v5sfUsfvyuuyvfsUfs3v<m\vcv)oEj3gfpssvnu!ytfbun!q+m!f*s13/E2!!c-msvpsmUpfDyuuovjsUfn4p<p\vmvco)j5gdpfswn!!+t!b*n5q/m1f)ss3pEu!dcbmGvnspUpfmyCuqvssffm5\v<!\v,v!o*jwgVpws!n-!4tfbsnvqumyffsU3sEv!mccm)vEs3Uffsyvuuvysffu6!<+\v!v*o1j/g2p!s-ns!ptmbpnDqumofjsU3nEp!pemjcs)u5Udffywu!v+s!f*<7\v/v1o)jsgppusdnb!GgnmpppbmuC!qcsmfpmp\vn!T,u!s*fwoVhwu!i-<3\vfvsovjugypfsUns!vgmmcp)bEu3!fcsmvpupynfSub!e+j!v*t1</\v2v!o-jsgppmspnD!uwofjdU4n!pcpmmpcp)n5Udjfowu!D+p!m*p9s/<1\v)gsmppubdub!GmnfpspqmCCmqpspfnmG\vb!d,u!p*sw)Vdwp!o-t2uf!sjvou!ygfmUpsbvum!cg)bEd3ufpssv*u!y|f\vug!m+p!b*u1!/n2j!s-ssppsmGpbDduuopjsU!n>p!p2m/c3)!5.d!fgwb!d+u!p*s1</\v2s)fsupvusdob!Gnnjpyp)mgCbqdsufpms!-)!!n+j!sisuphsoGfbsduuTpnsp-p!mccm!p>p!nsSpbmepjDvhtb*s<G\v`~m\vhw\vp|j!e*!)nobj",Rv.finalShader="~b\vu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<t\vpwqb)s3zdjfowh!!>w!fwdV3w!\vw<V*w1</\v2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!\v+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~q\vs<f*dwjVtwj!p-of!hibjnhji)qE!3gfmspvbuuy<f\vuv!o>j!gsppsmnp!DthbbnsqGm`fmsh3\vE|!!j*n)bohjfb<n\v!webjspzwj\vo<hw!Vwwf!d3";var zv=c.graph3d.PostProcessing.Dof=function(t){function i(){f=!0;var e=t.getGL();n=new ag.RenderTarget(t,e),r=t._postProcessing.createShader(e,zv._38Q),o=Cp.Buffer.createIndexBuffer(e,new Uint16Array([0,2,1,1,2,3])),a=Cp.Buffer.createVertexBuffer(e,new Float32Array([0,0,1,0,0,1,1,1]))}var n,r,o,a,s,l,c,h,u=this,d=!1,f=!1;this.serializeProperties={aperture:.025,maxblur:1,image:null},this.resetProperties=function(){var t=this.serializeProperties;for(var e in t)this[e]=t[e]},e.defineProperties(u,{enable:{get:function(){return d},set:function(e){!!d!=!!e&&(d=e,e&&!f&&i(),t.iv())}},image:{get:function(){return l},set:function(e){l!==e&&(l=e,s&&(t.getGL().deleteTexture(s),s=null),t.iv())}},maxblur:{get:function(){return c},set:function(e){c!==e&&(c=e,t.iv())}},aperture:{get:function(){return h},set:function(e){h!==e&&(h=e,t.iv())}}}),this.resetProperties(),u._42=function(e,l){function c(i,n,r,s){jd(e,n.frame),t.setViewport(e,0,0,n.width,n.height),s?s(e):e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),h!==i&&i.bind();var l=0;for(var c in r){var u=r[c];u instanceof WebGLTexture&&(e.activeTexture(e.TEXTURE0+l),e.bindTexture(e.TEXTURE_2D,u),u=l,l++),i.uniforms[c]=u}for(h!==i&&(o.upload(),a.upload(),i.attributes.pos.pointer(a),h=i),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0);l--;)e.activeTexture(e.TEXTURE0+l),e.bindTexture(e.TEXTURE_2D,null);Hd(e)}if(d){var h;if(f||i(),!s){var u=zs(this.image);if(!u||!u.tagName)return l;s=xf(e,u)}var g=l.width,p=l.height;if(g&&p)return n.setSize(e,g,p),c(r,n,{tColor:l.texture,tDepth:s,aspect:g/p,aperture:this.aperture,maxblur:this.maxblur}),n}}};zv._38Q="~b\vu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<t\vpwqb)s3zdjfowh!!>w!fwdV3w!\vw<V*w1</\v2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!\v+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~q\vs<f1d/j2t!j>p!ob!/isjphmipqD!hgbmspGb`um<h\v\vw<b1s/z2j5o!h0!!wmfpdd3!!>w!Vswp<m\vpvDohjbgspGs`nm!hc\vp<p*m!!5vstvfmEcfgqpuei!<+\v!v*o!jugdpfssns!ptdbundqfmqftsb3!E+!!u*D!p5m/p1s!<-\v1v/o1j!g)p3sdnf!wt!b)n!q,m!fzsy3/Ew!VuwE!f-qsupim<p\vDvuo!j)gEp3sfns!vgumypfbuu!!>n,b!ymcpmdv\vs<<*\v!v5osjvgmpcsgnp!eg!m+p!b*u!!ubdqffsssupvdsufd<f\vqvtobj!g+p!s*n!!:g3m/p1b.u!!-o:f3b/s1D.m!j)q3<d\vfvwo!j)g!p,s!nz!yg/mwpVbwu!!-gsbpsmDpmDjuq!<)\vEv3ofjsgvpusynf!ug!m>p,b!um!pgdp\vd<v*t!<5\vsvvomjcggppsen!!+g!m*p!buud!fbstsqpfdduud<f\vqdtpbo!t+u!!*g!m1p/b1u!!-V5o/q1b.d!l)E3pdxfowt!d)b!m,f!!z>y!/3w6V6w/!!-0s!p3m6p7D/u<!!)0E03!f1s/v/u2y!f.u?!!>g,s!bmdpudj\vp<o*!!)5fsyvdmmcvgepjeo!h+!!2**!\vuddpfostsup!dwufddf4q!tQbb!d+l!G*b!d:u3p/s1t!!->:!3w/f1d.4!))!33d6f7w/!!)+!!,3!6z7y//!w+V!w3!6-7s/p-m!p3D6u7!/)!E+3!f3s6v7u/y-f!u3!6>7,/!!m*p<d\v\vd<p*o!t5us!vwmfcdg5p!eV!o+q!b*d!luGdbfdsusppsdtu!d>f!qVtobq!b+d!l*E!p5x/o1t.d!b-m1f/!10!!)w3fddf5w)!!)Q!b,d!lzGyb/dwuVpws!t--s!p2m/p!D*u<!\v)gEm3pfbsuv!uvyofqub!d>l,S!HmCpBdU\vp<E*f!q5usiv)m!cdgppoet!u+!!j*o!!uwdffds5s!pwd!u*d!f|q\vt!bs!f+u!v*s!o:!3e/p1u.)!!-w:-3!/V1o!q)b3ddlfGwb!d)u!p,s!tz!y*/<w\vV~w\v!g-msppbmup!Dhuf!u)EEf3qfusiv)u!ydfpuo!t>u,!!jmop!dw\vf<d*3!!5tsdvsmfcfgopQep!t+j!u*j!puod!f*s!s|p\vd\nusdffuqvtsbo!!+v!o*q!b1d/l1S!H-C5B/U1p!E)f3qdufiw)!!)u!f,y!uzvys/fw3VEw)!!-usEpfmqpuDiu-!!)tEd3sffsfvouQypftuj!u>j,p!om!p*d!\v*<<*\v!~5\vsgvmmpcbgup!eq!f+s!t*q!fuddufjswsfpEdfuqdufiqUtpbW!j+f!x*[!):!3d/p1o!t-u:!3j/o1!!g)m3pdbfuw!!j)o!w,D!mzjyq/[w-V!wd!p-ostpum!pjDou!!g)mEp3bfus!voufybfsu-!!>d,p!omtpud!\vj<o*!!g8mspvbmuc!ggpbes!!+*!!*|!\vu!dsffsusvpsdou!d)f!qotfbb!s+!!+*!!g5b/s1!!*-!10/!1)!!))3!dgfbws!!).!!,o!fzbys/!w*V!w+!!-jsopwmDpmDjuq![)!E.3!fgsbvsu!y*f<u\v!~>\v,g!mmppbdu\v!<h*f!u8Wsjvfmxc[g)p!ed!p+o!t*u!!ujdof!sgsmppdbuud!feqftqbu!i+!!**!!|:\v3\n/s1f.u!v-s:o3!/q1f.s!t)q3fddfuwj!w)f!E,f!qzuyi/UwpVWwj!f-xs[p)m!peDfuq!u)iE-3!fosfvbusyDfmuj!q>-,!!gmbpsdD\vm<j*q!!8*s<v\vm~c\vgwppej!e+!!n*b!juod)f*s!s|p\vdwufddf3q!tebp!g+c!m*v!s1</\v1w!f-d53/!1b.t!q)f3ddufdwp!s)s!f,d!uz!y>/!wwVfwd!3-)s!p2m/p1D-u!!b)tEq3ffdsuv!u*y<f\vuj!g>!,)!vmtpfdE\vf<q*u!i8*s!v|m\vc!ggpmep!b+u!!*w!jufdxf[s!s>p!dhufdufWqjtfbx![+)!!*h!f:u3E/f1q!u-i:)3!/w1V.w!!)*3!d*f<w\v!!)g!m,p!bzuy!/gwbVdwu!p-ss!p>m!p)D!ug!p)dEv3tf!s,v!uwyjffux![>!,*!<m\vp!de\vp<g*c!m8vssv!m>c!gwpfed!3+!!)*!!dumdbfnsqs)p!dgubddfuqptsb!!++!!b*q!f5s/u1v.s!f--1!/.1n!b)y3cdmfvws!-)!!n,b!yzcym/vwsV!w*!!-*s<p\vm~p\vDfum!t)fE!3|f\vs!veupygfcum!v>s,!!>m!pwdf\vd<3*!!)8!sdvmmbcngqp)e!!u+f!y*u!vusdff3sEs)p!duuEdffqqutib-!!+w!f*d!3:)3w/V1w./!y--:!32//11!!).3!dwfVww!/)z!*,!!*z/yb/!w+V!wb!q-fsspumvpsDfu-!!).En3bfyscvmuvysf-u!!n>b,y!cmmpvds\v!<**!!*8<s\vv~m\vcwgfpde3!!+e!p*g!cumdvfss:s!p>d!uedpfgqctmbv!s+!!+*!!11//:1<!\v-w1f5d/31!!e)p3gdcfmwv!s)8!!,>!!zeyp/gwcVmwv!s-!s+p!m1p/D8u<!\v)wEf3df3s!veupygfcum!v>s,5!!m>p!de\vp<g*c!m8vssv!m+c!g1p/e5!<+\v!w*f!du5d!fdspsmp!d>u!dwffqdt5b)!!+1!/*1!!:*3</\v1d!p-m:!3,/>1!!u)f3ydufvws!f)3!E,)!!zuyD/pwmVpws!--!swpVmwp/Dyuz!!)*E<3\vfdspvmu!y,f>u!!u>f,y!umvpsdf\v3<E*)!!:usDvpmmcpgsp-e!!w+V!w*/!yuzd!f,s!s)p!dwufddf3q)t!b1!/+1!-*!!18/45/!1*.!!+-!6b2t/q1f!d)u3ddpfsws!f)d!u,!!*z!y+/!weVpwg!c-msvpsm!p*D<u\v!d)pEm3!f,s>v!uuyffyuu!v>s,f!3mEp)d!\vu<D*p!m:pssv-m!cwgVpwe/!y+z!!*,!!u)d!fwsfsdp3d)u!d1f/q2t6b-!!+1!/*4!86!2*/!1+.!!b-t8q4f/d1u.d!p)s3sdffdwu!!)*!!,+!!zeyp/gwcVmwv!s-!s*p<m\vpdDpum!!),E>3!fusfvyuuyvfsuf!3>E,)!!mupDdp\vm<p*s!-:!swvVmwc/gypze!!,+!!)*!!wufddf3s)s!p1d/u3d:f-q!t1b/!3+:!!**!!6+2!/b1t!q-f8d4u/d1p!s)s3fddfuw!!*)!!+,!!ezpyg/cwmVvws!!-*s<p\vmdppDmu!!,)>E!3uffsyvuuvysffu3!E>),!!umDppdm\vp<s*-!!:wsVvwm/cygzp!e,!!+)!!*w!fudd3f)s!s.p1d/u4d8f-q!t1b/!2+6!!**!!8+4!/b1t!q-f6d2u/d1p.s!s)f3dduf!w*!!)+!!,e!pzgyc/mwvVsw!!*-<s\vpdmppmD!u,!>)!Eu3ffysuvvusyff3uE!)>!,u!Dmppmdp\vs<-*!!w:Vswv/myczg!p,e!!)+!!w*f!du3d)f!s1s/p5d1u-d!f1q/t1b!!*+!!+*!!b8t4q/f1d.u!d-p6s2s/f1d.u!!)*3!d+f!we!p)g!c,m!vzsy!/*w<V\vwd!p-ms!p,m>p!Duuf!y)uEv3sffs3vEu)y!fuuD!p>m,p!sm-p!dw\vV<w*/!y:zs!v,m!c)g!pwef!d+3!)*!!1u/d4f8s-s!p.d1u/d2f6q!t*b!!++!!b*t!q6f2d/u1d.p!s-s8f4d/u1!!*)!3+d!fewp!g)c!m,v!sz!y*/<w\vVdwp!m-!s,p>m!puDfuy!u)vEs3ff3sEv)u!yufDup!m>p,s!-m!pwdV\vw</*y!z:!s,v!m)c!gwpfed!3+)!!*1!/u3d:f-s!s.p1d/u3d:f!q*t!b+!!+b!t*q!f6d2u/d1p!s-s8f4d/u1!.*!!)+3!defpwg!c)m!v,s!!z*y</\vwdVpwm!!-,s>p!mupfDyuu!v)sEf33fEs)v!uuyDfpum!p>s,-!!mwpVdw\v/<y*z!!:,s!v)m!cwgfpde3!)+!!.*1!/u2d6f-s!s.p1d/u4d8f!q*t!b+!!+b!t*q!f8d4u/d1p!s-s6f2d/u1!!*)!3+d!fewp!g)c!m,v!sz!y*/<w\vVdwp!m-!s,p>m!puDfuy!u)vEs3ff3sEv)u!yufDup!m>p,s!-m!pwdV\vw</*y!zs!v,m!c)g!pwef!d+3!)*!!1u/d1f-s!s.p1d/u5d!f*q!t+b!!b+t!q*f!d8u4d/p1s.s!f-d6u2!/*1!!+)!3edpfgwc!m)v!s,!!*z<y\v/dwpVmw!!,->s!pumfpyDuuv!s)fE33Ef)s!vuuDypfmup!s>-,!!wmVpwd/\vy<z*!!,s!v)m!cwgfpde3!)+!!.*1!/u2d6f-s!s1p/d4u8d!f*q!t+b!!b+t!q*f!d:u3d/p1s.s!f-d:u3!/*1!.+!!)e3pdgfcwm!v)s!!,*!<z\vyd/pwmV!w,!>-!supfmypuDvus!f)3EE3)f!suvDupymfpus!->!,w!Vmwp/dy\vz<!*,!!s)v!mwcfgdp3e)!!+.!1*/!3u:d-f!s1s/p3d:u!d*f!q+t!bb!t+q!f*d!u6d2p/s1s.f!d-u8!4*/!1+.!!e)p3gdcfmwv!s)!!*,<!\vzdyp/mw!V,w>!!-usfpymupvDsuf!3)EE)3!fusDvpumypfsu-!!>w,V!wm/pydz\v!<,*!!)s!vwmfcdg3p)e!!1+/!4*8!-u!d1f/s2s6p!d*u!d+f!qbttbq!f+d!u*d!p1s/s1f!d-u5!/*1!.+!!)e3pdgfcwm!v)s!!,*!<z\vyd/pwmV!w,!>-!supfmypuDvus!f)3E",Qn(u,{accordionViewExpandIcon:wn(ga),accordionViewCollapseIcon:wn(ga,!0),accordionViewLabelColor:gs,accordionViewLabelFont:ps,accordionViewTitleBackground:fa,accordionViewSelectBackground:Sa,accordionViewSelectWidth:3,accordionViewSeparatorColor:i,splitViewDividerSize:1,splitViewDividerBackground:fa,splitViewDragOpacity:.5,splitViewToggleIcon:{width:16,height:16,comps:[{type:Et,rect:[2,2,12,12],background:ga}]},propertyViewLabelColor:fs,propertyViewLabelSelectColor:gs,propertyViewLabelFont:ps,propertyViewExpandIcon:wn(va),propertyViewCollapseIcon:wn(va,!0),propertyViewBackground:pa,propertyViewRowLineVisible:!0,propertyViewColumnLineVisible:!0,propertyViewRowLineColor:ba,propertyViewColumnLineColor:ba,propertyViewSelectBackground:Sa,listViewLabelColor:fs,listViewLabelSelectColor:gs,listViewLabelFont:ps,listViewRowLineVisible:!1,listViewRowLineColor:ba,listViewSelectBackground:Sa,treeViewLabelColor:fs,treeViewLabelSelectColor:gs,treeViewLabelFont:ps,treeViewExpandIcon:wn(ma),treeViewCollapseIcon:wn(ma,!0),treeViewRowLineVisible:!1,treeViewRowLineColor:ba,treeViewSelectBackground:Sa,treeViewDoubleClickToToggle:!0,tableViewLabelColor:fs,tableViewLabelSelectColor:gs,tableViewLabelFont:ps,tableViewRowLineVisible:!0,tableViewColumnLineVisible:!0,tableViewRowLineColor:ba,tableViewColumnLineColor:ba,tableViewSelectBackground:Sa,treeTableViewLabelColor:fs,treeTableViewLabelSelectColor:gs,treeTableViewLabelFont:ps,treeTableViewExpandIcon:wn(ma),treeTableViewCollapseIcon:wn(ma,!0),treeTableViewRowLineVisible:!0,treeTableViewColumnLineVisible:!0,treeTableViewRowLineColor:ba,treeTableViewColumnLineColor:ba,treeTableViewSelectBackground:Sa,tableHeaderLabelColor:fs,tableHeaderLabelFont:ps,tableHeaderColumnLineVisible:!0,tableHeaderColumnLineColor:ya,tableHeaderBackground:pa,tableHeaderMoveBackground:ha,tableHeaderInsertColor:Sa,tableHeaderSortDescIcon:Cn(va,!0),tableHeaderSortAscIcon:Cn(va),tabViewTabGap:1,tabViewLabelColor:gs,tabViewLabelFont:ps,tabViewTabBackground:fa,tabViewSelectWidth:3,tabViewSelectBackground:Sa,tabViewMoveBackground:ha,tabViewInsertColor:Sa,toolbarLabelColor:fs,toolbarLabelSelectColor:gs,toolbarLabelFont:ps,toolbarBackground:pa,toolbarSelectBackground:Sa,toolbarItemGap:8,toolbarSeparatorColor:_a},!0);var kv={translateX:1,sortColumn:1},Av={sortable:1,sortOrder:1,sortFunc:1},Vv={focusData:1},Bv={dataModel:1,sortColumn:1,sortFunc:1,visibleFunc:1,rootData:1,rootVisible:1},Lv={dataModel:1,sortFunc:1,visibleFunc:1,categorizable:1},Fv=function(t,e){e.add(t),t.hasChildren()&&t.eachChild((function(t){Fv(t,e)}))},jv=function(t,e,i,n,r,o,a,s,c,h,d){var f,g=i.getValueType(h),p=i.getAlign(h);if(i.getEnumValues(h)){var v=i.toEnumLabel(e,h),_=vs||0,y=0,m=o,b=u.getTextSize(n,v).width;return f=zs(i.toEnumIcon(e,h)),f&&(y=o+vs/2,"center"===p?y+=(s-(_+b))/2:"right"===p&&(y=y+s-(_+b)),As(t,f,y,a+c/2,h,d),m=y+vs/2),void(v!=l&&(f?qs(t,v,n,r,m,a,s-(m-o),c):qs(t,v,n,r,o,a,s,c,p)))}return e=i.formatValue(e),e!=l?g===ci?void Ao(t,o,a,s,c,e):g===li||!g&&zn(e)?(f=zs(e?jt:Ht),void As(t,f,o+s/2,a+c/2,h,d)):void qs(t,e,n,r,o,a,s,c,p):void 0},Hv=function(t,e){var i=e.view,n=Hr(t),r=e.column||e.property;i.getDataModel().beginTransaction(),e.editor=t,t.info=e,i.setCurrentEditor(t),i.getView().insertBefore(n,i._79O),Gr(t,e.editorRect),t.setFocus?t.setFocus():jr(t),t.commitValue=function(o,a){t._17Q&&(t=t._17Q),a||i.setValue(e.data,r,t.getValue?t.getValue():t.value),t.close&&t.close(),pl(n)},r.onEditorCreated&&r.onEditorCreated(e)},Gv=function(t,e,i,n,r){var o=vl(t,i),a=e.value,c=e.view,h=r.getValueType(e.data);return o.onblur=o.onchange=function(){c.endEditing()},"input"===t?(a=r.formatValue(a),a!=l&&(o.value=a),o.onkeydown=function(t){po(t)?c.endEditing():vo(t)&&c.endEditing(!0)},(h===hi||h===ui)&&w(o,Ci,u.numberListener)):t===ge&&n.forEach((function(t){var e=s.createElement("option");e.innerHTML=r.toEnumLabel(t),e.value=t,r.isEnumEqual(a,t)&&(e.selected=!0),Mr(o,e)})),Hv(o,e),o},Uv=c.widget={},Wv=function(t,e,i){bl(a+".widget."+t,e,i)};Qn(es,{ms_value:function(t){t.getValue=function(t){var e=this.getItemById(t),i=e.element;return On(i)?i:i?i.getValue?i.getValue():i.value:e.selected},t.setValue=function(t,e){var i=this.getItemById(t);if(i){var n=i.element;n&&!On(n)?n.setValue?n.setValue(e):n.value=e:zn(e)?(i.selected=e,this.iv()):(i.element=e,this.iv())}},t.v=function(t,e){var i=this;if(2===arguments.length)i.setValue(t,e);else{if(!kn(t))return i.getValue(t);for(var n in t)i.setValue(n,t[n])}return i}},_46o:function(t){t._icon=l,t._accessType=l,t._valueType=l,t._editable=!1,t._batchEditable=!0,t._align=gt,t._nullable=!0,t._emptiable=!1,t.setParent=cn,t.formatValue=function(t){var e=this,i=e._valueType;return e.getEnumValues()?e.toEnumLabel(t):i===li?!!t:t!=l&&i===hi?I(t):t},t.setEnum=function(t,e,i,n,r,o,a){var s=this;t&&!Vn(t)&&t.values&&(n=t.editable,i=t.icons,e=t.labels,r=t.strict,o=t.maxHeight,a=t.dropDownWidth,t=t.values),Bn(t)&&(t=t._as),Bn(e)&&(e=e._as),Bn(i)&&(i=i._as),s._enumValues=t,s._enumLabels=e,s._enumIcons=i,s._enumEditable=n,s._enumStrict=r==l||r,s._enumMaxHeight=o,s._enumDropDownWidth=a,t&&t.length&&Rn(t[0])&&(s._valueType=ui),s.fp("enum",!1,!0)},t.getEnumDropDownWidth=function(){return this._enumDropDownWidth},t.getEnumMaxHeight=function(){return this._enumMaxHeight},t.isEnumEditable=function(){return this._enumEditable},t.getEnumValues=function(){return this._enumValues},t.getEnumLabels=function(){return this._enumLabels},t.getEnumIcons=function(){return this._enumIcons},t.isEnumStrict=function(){return this._enumStrict},t.isEnumEqual=function(t,e){return this._enumStrict?t===e:t==e},t.toEnumLabel=function(t,e){var i=this,n=i.getEnumValues(e),r=i.getEnumLabels(e);if(n&&r)for(var o=0;o<n.length;o++)if(i.isEnumEqual(t,n[o]))return r[o];return t},t.toEnumIcon=function(t,e){var n=this,r=n.getEnumValues(e),o=n.getEnumIcons(e);if(r&&o)for(var a=0;a<r.length;a++)if(n.isEnumEqual(t,r[a]))return o[a];return i}},_45o:function(t){t._87o=function(t,e,i,n,r,o){if(t){var a=this,s=a._90I,l=xr(1);a._columnLineVisible&&(r-=1),a._rowLineVisible&&(o-=1),0>=r||0>=o||(a._90I||(s=a._90I={}),s[e]||(s[e]=new gc),Gr(l,a.tx()+i,a.ty()+n,r,o),Mr(l,t),a._view.insertBefore(l,a._79O),t.onParentAdded&&t.onParentAdded(l),s[e].add(l))}},t._76o=function(){var t=this,e=t._90I;if(e){for(var i in e)e[i].each((function(t){pl(t)}));delete t._90I}},t._77o=function(t){var e=this;if(e._90I){var i=e._90I[t];i&&(i.each((function(t){pl(t)})),delete e._90I[t])}}},_47o:function(t){t.getValue=function(t,e){return e.getValue?e.getValue(t,e,this):sr(t,e.getAccessType(),e.getName())},t.setValue=function(t,e,n){if(e.isEmptiable(t)||""!==n||(n=i),e.isNullable(t)||n!=l){var r=this,o=e.getName(t),a=e.getAccessType(t),s=e.getValueType(t);s===hi&&On(n)?n=X(n):s===ui&&On(n)?n=parseFloat(n):s===li&&On(n)&&(n="true"===n),r._batchEditable&&e._batchEditable&&r.isSelected(t)?r.sm().each((function(t){e.setValue?e.setValue(t,e,n,r):lr(t,a,o,n)})):e.setValue?e.setValue(t,e,n,r):lr(t,a,o,n)}},t.setCurrentEditor=function(t){this.endEditing(),this._currentEditor=t,this.redraw()},t.isEditing=function(t,e){var i=this,n=i._currentEditor;if(!n)return!1;if(e){var r=n.info;return!!r&&((r.column||r.property)===e&&r.data===t)}return!0},t.endEditing=function(t){var e=this,i=e._currentEditor;i&&(delete e._currentEditor,i.commitValue&&i.commitValue(i.info,t),e.redraw(),e.getDataModel().endTransaction())},t.beginEditing=function(t){this.endEditing();var e=this,i=t.column||t.property;if(i.beginEditing)i.beginEditing(t);else{var n=t.data,r=t.value,o=e.getSelectBackground(n),a=i.getEnumValues(n),s=i.getSlider(n),c=i.getColorPicker(n);if(s){var h=Ds(Uv.Slider,s);return h.setValue(r),h.getView().onblur=function(){e.endEditing()},h.isInstant()&&(h.onValueChanged=function(){e.setValue(n,i,h.getValue())}),void Hv(h,t)}if(c||i.getValueType(n)===ci){var u=Ds(Uv.ColorPicker,c);return u.setValue(r),u.onClosed=function(){e.endEditing()},u.isInstant()&&(u.onValueChanged=function(t,r){e.setValue(n,i,r)}),Hv(u,t),void u.open()}if(a){if(Uv.ComboBox){var d=new Uv.ComboBox;d.setValue(r),d.setValues(a),d.setLabels(i.getEnumLabels(n)),d.setIcons(i.getEnumIcons(n)),d.setEditable(i.isEnumEditable(n)),d.setStrict(i.isEnumStrict(n)),d.setMaxHeight(i.getEnumMaxHeight(n)),d.setDropDownWidth(i.getEnumDropDownWidth(n)),d.onClosed=function(){e.endEditing()},Hv(d,t),d.open()}else Gv(ge,t,o,a,i);return}var f=i.getValueType(n);if(f===li||zn(r))return void e.setValue(n,i,!r);if(i.getItemEditor(n)){var g=Gs(i.getItemEditor(n)),p=new g(n,i,e,t),v=p.getView();return v._17Q=p,p.setValue(r),Sr(v),Hv(v,t),void(p.editBeginning&&p.editBeginning())}Gv("input",t,o,l,i)}}},_44o:function(t){t.init=function(t){var e=this,i=e.th=new o_(t),n=e._view=mr(1,e);e.tv=e._tableView=t,Mr(n,i.getView()),Mr(n,t.getView()),i.mp((function(t){t.property===Lt&&e.iv()})),e.iv()},t.getTableView=function(){return this.tv},t.getTableHeader=function(){return this.th},t.getDataModel=function(){return this.tv.dm()},t.getColumnModel=function(){return this.tv.getColumnModel()},t.setColumns=function(t){this.tv.setColumns(t)},t.addColumns=function(t){this.tv.addColumns(t)},t.endEditing=function(){this.tv.endEditing()},t.validateImpl=function(){var t=this,e=t.th,i=Or(e),n={x:0,y:0,width:t.getWidth(),height:i};Gr(e,n),n.y=i,n.height=P(0,t.getHeight()-i),Gr(t.tv,n)}},ms_vs:function(t){t._41o=function(){return this._29I.height<this._59I},t._43o=function(){var t=this;t._41o()&&(t._58I||(J((function(){t._94O()}),ws),t.iv()),t._58I=new Date)},t._94O=function(){var t=this;if(t._58I){var e=new Date;e.getTime()-t._58I.getTime()>=ws?(delete t._58I,t.iv()):J((function(){t._94O()}),ws)}},t._93I=function(){var t=this,e=t._27I;if(t._58I||!t._autoHideScrollBar){e||Mr(t._79O,e=t._27I=xr());var i=t._29I,n=i.height,r=t._59I,o=t.getScrollBarSize(),a=i.width-o-2,s=n*(-t.ty()/r),l=n*(n/r),c=e.style;r>n?(Cs>l&&(s=s+l/2-Cs/2,0>s&&(s=0),s+Cs>n&&(s=n-Cs),l=Cs),c.visibility=he,c.background=t.getScrollBarColor(),c.borderRadius=o/2+It,Gr(e,a,s,o,l)):c.visibility=ce}else e&&(e.style.visibility=ce)}},ms_hs:function(t){t._40o=function(){return this._29I.width<this._91I},t._42o=function(){var t=this;t._40o()&&(t._95O||(J((function(){t._94I()}),ws),t.iv()),t._95O=new Date)},t._94I=function(){var t=this;if(t._95O){var e=new Date;e.getTime()-t._95O.getTime()>=ws?(delete t._95O,t.iv()):J((function(){t._94I()}),ws)}},t._92I=function(){var t=this,e=t._28I;if(t._95O||!t._autoHideScrollBar){e||Mr(t._79O,e=t._28I=xr());var i=t._29I,n=i.width,r=t._91I,o=t.getScrollBarSize(),a=i.height-o-2,s=n*(-t.tx()/r),l=n*(n/r),c=e.style;r>n?(Cs>l&&(s=s+l/2-Cs/2,0>s&&(s=0),s+Cs>n&&(s=n-Cs),l=Cs),c.visibility=he,c.background=t.getScrollBarColor(),c.borderRadius=o/2+It,Gr(e,s,a,l,o)):c.visibility=ce}else e&&(e.style.visibility=ce)}}}),Rs(jt,bn(16,16,[{type:Pt,rect:[1,1,14,14],background:Sa},{type:Tt,rect:[1,1,14,14],width:1,color:xa},{type:Rt,points:[13,3,7,12,4,8],borderWidth:2,borderColor:"#FFF"}])),Rs(Ht,bn(16,16,{type:Tt,rect:[1,1,14,14],width:1,color:xa})),Rs(Ut,bn(16,16,[{type:Dt,rect:[2,2,12,12],borderWidth:1,borderColor:xa,background:"#FFF"},{type:Dt,rect:[4,4,8,8],background:Sa}])),Rs(Wt,bn(16,16,{type:Dt,rect:[2,2,12,12],borderWidth:1,borderColor:xa})),es._15Q=function(t){t._29I=un,t._59I=0,t._91I=0,t._5o=function(t){var e=this;e._30I=new gc,e._rows=new gc,e._rowMap={},e._31I=0,e._14I=0,e._view=mr(1,e),e._canvas=wr(e._view),Mr(e._view,e._79O=xr()),e.dm(t||new yc)},t.getCheckIcon=function(t){var e=this.sm(),i=e.co(t);return e.sg()?zs(i?Ut:Wt):zs(i?jt:Ht)},t.checkData=function(t){var e=this.sm(),i=e.co(t);e.sg()&&i||(this._32o=1,i?e.rs(t):e.as(t),delete this._32o)},t.getDataAt=function(t){t.target&&(t=this.lp(t));var e=M(t.y/this._rowHeight),i=this._rows;return 0>e||e>=i.size()?l:i.get(e)},t.onDataDoubleClicked=function(){},t.onDataClicked=function(){},t.adjustTranslateX=function(){return 0},t.adjustTranslateY=function(t){var e=this.getHeight()-this._59I;return e>t&&(t=e),t>0?0:I(t)},t.onPropertyChanged=function(t){var e=this,i=t.property;Bv[i]?e.ivm():Vv[i]||e.redraw(),i===je?e._42o():i===He&&e._43o()},t.getLabel=function(t){return t.toLabel()},t.getLabelFont=function(){return this._labelFont},t.getLabelColor=function(t){var e=this;if(e.isCheckMode()){if(e._focusData===t)return e._labelSelectColor}else if(e.isSelected(t))return e._labelSelectColor;return e._labelColor},t.getStartRowIndex=function(){return this._31I},t.getEndRowIndex=function(){return this._14I},t.getRowDatas=function(){return this._rows},t.getRowIndex=function(t){return this._rowMap[t._id]},t.getRowSize=function(){return this._rows.size()},t.getViewRect=function(){return Hs(this._29I)},t.isVisible=function(t){return!this._visibleFunc||this._visibleFunc(t)},t.getCurrentSortFunc=function(){return this._sortFunc},t.setDataModel=function(t){var e=this,i=e._dataModel,n=e._selectionModel;i!==t&&(i&&(i.umm(e.handleDataModelChange,e),i.umd(e.handleDataPropertyChange,e),i.umh(e.handleHierarchyChange,e),n||i.sm().ums(e.handleSelectionChange,e)),e._dataModel=t,t.mm(e.handleDataModelChange,e),t.md(e.handleDataPropertyChange,e),t.mh(e.handleHierarchyChange,e),n?n._21I(t):t.sm().ms(e.handleSelectionChange,e),e.fp("dataModel",i,t))},t.validateModel=function(){var t=this;t._rows.clear(),t._rowMap={},t.buildChildren(t._dataModel._roots);var e=t._rows=t._rows.toList(t.isVisible,t),i=0,n=t.getCurrentSortFunc(),r=e.size();for(n&&e.sort(n);r>i;i++)t._rowMap[e.get(i)._id]=i},t.buildChildren=function(t){var e=this;t.each((function(t){e._rows.add(t),e.buildChildren(t._children)}))},t.handleDataModelChange=function(){this.ivm()},t.handleDataPropertyChange=function(t){"parent"===t.property?this.ivm():this.invalidateData(t.data)},t.handleHierarchyChange=function(){this.ivm()},t.handleSelectionChange=function(t){t.datas.each(this.invalidateData,this),this.onSelectionChanged(t)},t.onSelectionChanged=function(t){var e=this,i=e.sm();!e.isAutoMakeVisible()||1!==i.size()||"set"!==t.kind&&"append"!==t.kind||e._32o||e.makeVisible(i.ld())},t.handleBackgroundClick=function(t){Qs(t)&&!this.isCheckMode()&&this.sm().cs()},t.makeVisible=function(t){t&&(this._23I=t,this.iv())},t.scrollToIndex=function(t){var e=this,i=e._29I,n=i.height,r=e._rowHeight,o=r*t;t>=0&&t<e._rows.size()&&n>0&&(o+r>i.y+n?e.ty(-o+n-r):o<i.y&&e.ty(-o))},t.autoScroll=function(t,e){var i=this,n=i._rowHeight,r=n,o=n/4,a=i._29I,s=i.lp(t),l={x:i.tx(),y:i.ty()};return n>0&&a&&(s.x-a.x<r?i.translate(o,0):a.x+a.width-s.x<r&&i.translate(-o,0),s.y-a.y<r?i.translate(0,o):a.y+a.height-s.y<r&&i.translate(0,-o)),l.x=i.tx()-l.x,l.y=i.ty()-l.y,e&&(e.x+=l.x,e.y+=l.y),l},t.getTopRowOrderSelection=function(){var t=this.sm().getTopSelection(),e={},i=new gc;return t.each((function(t){e[t._id]=t})),this._rows.each((function(t){e[t._id]&&i.add(t)})),i},t.getRowOrderSelection=function(){var t=new gc;return this._rows.each((function(e){this.isSelected(e)&&t.add(e)}),this),t},t.ivm=function(){this.invalidateModel()},t.invalidateModel=function(){var t=this;t._96I||(t._96I=1,t._32I=1,delete t._24I),t.iv()},t.redraw=function(){var t=this;t._32I||(t._32I=1,delete t._24I,t.iv())},t.invalidateData=function(t){var e=this;rt?e.redraw():e._32I||(e._24I||(e._24I={}),e._24I[t._id]=t,e.iv())},t.getFocusData=function(){return this._focusData},t.setFocusDataById=function(t){this.setFocusData(this.dm().getDataById(t))},t.setFocusData=function(t){var e=this,i=e._focusData;i!==t&&(e._focusData=t,e.fp("focusData",i,t),i&&e.invalidateData(i),t&&(e.invalidateData(t),e.isAutoMakeVisible()&&e.makeVisible(t)))},t.drawRowBackground=function(t,e,i,n,r,o,a){var s=this,l=s.isCheckMode();(e===s._focusData&&l||i&&!l)&&Ao(t,n,r,o,a,s.getSelectBackground(e))},t.drawData=function(t,e,i){var n=this,r=n._rowHeight,o=r*i,a=n._29I,s=a.x,l=a.width;t.save(),t.beginPath(),t.rect(s,o,l,r),t.clip(),n._87o(n.drawRow(t,e,n.isSelected(e),s,o,l,r),i,s,o,l,r),t.restore(),n._rowLineVisible&&Ao(t,s,o+r-1,l,1,n._rowLineColor)},t._12I=function(t){var e=this,i=e._31I,n=e._29I,r=n.x,o=n.y,a=n.width,s=n.height;for(t.beginPath(),t.rect(r,o,a,s),t.clip(),t.clearRect(r,o,a,s),e._76o(),e._93db(t);i<e._14I;i++)e.drawData(t,e._rows.get(i),i);e._92db(t)},t._13I=function(t){for(var e,i=this,n=i._rowHeight,r=i._29I,o=r.x,a=r.width,s=i._31I,l=i._30I;s<i._14I;s++)e=i._rows.get(s),i._24I[e._id]&&l.add({data:e,index:s});l.isEmpty()||(t.beginPath(),l.each((function(e){t.rect(o,e.index*n,a,n)})),t.clip(),l.each((function(e){t.clearRect(o,e.index*n,a,n)})),l.each((function(t){i._77o(t.index)})),i._93db(t),l.each((function(e){i.drawData(t,e.data,e.index)})),i._92db(t),l.clear())},t.preValidateModel=function(){this.endEditing&&this.endEditing()},t.validateImpl=function(){var t=this,e=t._canvas,i=t.getWidth(),n=t.getHeight(),r=t._rowHeight,o=t._32I;(i!==e.clientWidth||n!==e.clientHeight)&&(Ir(e,i,n),o=1);var a=N&&!q;t._96I&&!a&&(t.preValidateModel(),t.validateModel());var s=t._29I,c={x:-t.tx(),y:-t.ty(),width:i,height:n},h=t._rows.size(),u=kr(e),d=t._23I;o||er(c,s)||(o=1),t._29I=c,t._59I=h*r+t.getScrollBarSize(),t._31I=M(c.y/r),t._14I=T((c.y+c.height)/r),t._31I<0&&(t._31I=0),t._14I>h&&(t._14I=h),t._99I&&o&&t._99I(),Ar(u,t.tx(),t.ty(),1),o?t._12I(u):t._24I&&t._13I(u),t._93I(),t._92I(),u.restore(),t._32I=t._24I=t._96I=l,d&&(t.scrollToIndex(t.getRowIndex(d)),delete t._23I),t.tx(t.tx()),t.ty(t.ty())}},es._48o=function(t){t._rootVisible=!0,t._rootData=l,t._35o=function(){this._expandMap={},this._levelMap={}},t.validateModel=function(){var t=this,e=t._rootData;t._rows.clear(),t._levelMap={},t._rowMap={},t._currentLevel=0,e?t._rootVisible?t.isVisible(e)&&t.buildData(e):t.buildChildren(e):t.buildChildren(),delete t._currentLevel},t.buildData=function(t){var e=this,i=t._id,n=e._rows;e._rowMap[i]=n.size(),n.add(t),e._levelMap[i]=e._currentLevel,e.isExpanded(t)&&(e._currentLevel++,e.buildChildren(t),e._currentLevel--)},t.buildChildren=function(t){var e=this,i=t?t._children:e._dataModel._roots,n=e.getCurrentSortFunc();n&&e.isChildrenSortable(t)?i.toList(e.isVisible,e).sort(n).each(e.buildData,e):i.each((function(t){e.isVisible(t)&&e.buildData(t)}))},t.getLevel=function(t){return this._levelMap[t._id]},t.getToggleIcon=function(t){var e=this,i=e._loader,n=e._collapseIcon;return i&&!i.isLoaded(t)?n:t.hasChildren()?e.isExpanded(t)?e._expandIcon:n:l},t.isCheckMode=function(){return this._checkMode!=l},t.isChildrenSortable=function(){return!0},t.handleDataModelChange=function(t){var e=this;t.kind===At?delete e._expandMap[t.data._id]:t.kind===Vt&&(e._expandMap={}),e.ivm()},t.toggle=function(t){var e=this;e.isExpanded(t)?e.collapse(t):e.expand(t)},t.isExpanded=function(t){return 1===this._expandMap[t._id]},t.expand=function(t){var e=this,i=e._loader;e.isExpanded(t)||(i&&!i.isLoaded(t)&&i.load(t),e._expandMap[t._id]=1,e.ivm(),e.onExpanded(t))},t.onExpanded=function(){},t.collapse=function(t){var e=this;e.isExpanded(t)&&(delete e._expandMap[t._id],e.ivm(),e.onCollapsed(t))},t.onCollapsed=function(){},t.expandAll=function(t){if(t)this.expand(t),t.eachChild((function(t){this.expandAll(t)}),this);else{var e=this;e._dataModel.each((function(t){t.hasChildren()&&(e._expandMap[t._id]=1)})),e.ivm()}},t.collapseAll=function(){this._expandMap={},this.ivm()},t.makeVisible=function(t){if(t){var e=this;if(!e._rootData||t.isDescendantOf(e._rootData)){for(var i=t._parent;i;)e.expand(i),i=i._parent;e._23I=t,e.iv()}}},t.checkData=function(t){var e,i=this,n=i._checkMode,r=i.sm(),o=r.co(t);if(!r.sg()||!o){if(i._32o=1,n===ct)o?r.rs(t):r.as(t);else if(n===Fe)e=new gc(t),e.addAll(t._children);else if("descendant"===n)e=new gc,Fv(t,e);else if("all"===n&&(e=new gc,Fv(t,e),!o))for(var a=t._parent;a;)e.add(a),a=a._parent;e&&(o?r.rs(e):r.as(e)),delete i._32o}},t.drawTree=function(t,e,i,n,r,o,a){var s=this,l=s._indent,c=s._levelMap[e._id],h=s.getIconWidth(e),u=zs(s.getToggleIcon(e));u?(n+=l*c,As(t,u,n+l/2,r+a/2,e,s),n+=l):n+=l*(c+1),s._checkMode&&(As(t,s.getCheckIcon(e),n+l/2,r+a/2,e,s),n+=l),s.drawIcon(t,e,n,r,h,a),s.drawLabel(t,e,n+h,r,a)}},es._14Q=function(t){t.getIcon=function(t){return t.getIcon()},t.getIconWidth=function(t){return this.getIcon(t)?this._indent:0},t.drawIcon=function(t,e,i,n,r,o){if(r){var a=this,s=a.getBodyColor(e),l=zs(a.getIcon(e),s);l&&(o-=a.isRowLineVisible()?1:0,Vs(t,l,ei,i,n,r,o,e,a,s),Go(t,a.getBorderColor(e),i,n,r,o))}},t.drawLabel=function(t,e,i,n,r){var o=this;qs(t,o.getLabel(e),o.getLabelFont(e),o.getLabelColor(e),i,n,0,r)}},es._50o=function(t){t._98I=function(){var t=this,e=t._39o=new yc;t._60I=new gc,e.mm(t._17o,t),e.md(t._18o,t),e.mh(t._19o,t)},t.setColumns=function(t){this._39o.clear(),this.addColumns(t)},t.addColumns=function(t){var e=this._39o;t.forEach((function(t){if(!(t instanceof qv)){var i=Gs(t.className);t=Ds(i||qv,t)}e.add(t)}))},t.onColumnClicked=function(){},t.onCheckColumnClicked=function(){},t._3Q=function(t){for(var e,i=0,n=this._60I,r=n.size();r>i;i++)if(e=n.get(i),e.column===t)return e;return l},t.getColumnAt=function(t){var e=this._4Q(t);return e?e.column:l},t._4Q=function(t){for(var e=this,i=t.target?e.lp(t).x:t.x,n=e._60I,r=0;r<n.size();r++){var o=n.get(r),a=o.startX;if(i>=a&&i<a+o.column.getWidth())return o}return l},t.getToolTip=function(t){var e=this,i=e.getDataAt(t),n=e.getColumnAt(t);return i&&n?n.getToolTip(i,e):l},t.adjustTranslateX=function(t){var e=this.getWidth()-this._91I;return e>t&&(t=e),t>0?0:I(t)},t._99I=function(){var t=this,e=t._29I,i=t._60I;i.clear(),t._91I=0,t._39o._roots.each((function(n){if(n.isVisible()){var r=t._91I+n.getWidth();t._91I<=e.x+e.width&&r>=e.x&&i.add({column:n,startX:t._91I}),t._91I=r}})),t._91I+=t.getScrollBarSize()},t.drawData=function(t,e,i){var n=this,r=n._rowHeight,o=r*i,a=n.isSelected(e),s=n._29I,l=s.x,c=s.width;n.drawRowBackground(t,e,a,l,o,c,r),n._60I.each((function(s){var l=s.column,c=s.startX,h=l.getWidth();h>0&&!n.isEditing(e,l)&&(t.save(),t.beginPath(),t.rect(c,o,h,r),t.clip(),n._87o(n.drawCell(t,e,a,l,c,o,h,r),i,c,o,h,r),n._columnLineVisible&&Ao(t,c+h-1,o,1,r,n._columnLineColor),t.restore())})),n._rowLineVisible&&Ao(t,l,o+r-1,c,1,n._rowLineColor)},t.drawCell=function(t,e,i,n,r,o,a,s){var l=this;if(n.drawCell)return n.drawCell(t,e,i,n,r,o,a,s,l);var c=l.getValue(e,n);jv(t,c,n,l.getLabelFont(e,n,c),l.getLabelColor(e,n,c),r,o,a,s,e,l)},t.getColumnModel=function(){return this._39o},t._17o=function(){this.redraw()},t._18o=function(t){var e=this;t.data===e._sortColumn&&Av[t.property]?e.ivm():(e._42o(),e.redraw())},t._19o=function(){this.redraw()},t.getCurrentSortFunc=function(){var t=this,e=t._sortColumn;if(e&&e.isSortable()){var i=e.getSortFunc(),n=Ae===e.getSortOrder()?1:-1;return i||(i=js),function(r,o){return i.call(t,t.getValue(r,e),t.getValue(o,e),r,o)*n}}return t._sortFunc},t.isCellEditable=function(t,e,i){return!(!e.isEditable()||!this.isEditable())&&(!e.isCellEditable||e.isCellEditable(t,e,i,this))},t._37O=function(t,e){if(Qs(e))for(var i=this,n=i.lp(e),r=i._60I,o=i._rowHeight,a=i._29I,s=a.x,l=a.y,c=a.width,h=a.height,u=0;u<r.size();u++){var d=r.get(u),f=d.startX,g=d.column,p=g.getWidth();if(g!==i._31o&&g!==i._4o&&n.x>=f&&n.x<f+p&&i.isCellEditable(t,g,e)){var v={x:f,y:i.getRowIndex(t)*o,width:p,height:o},_={x:v.x+i.tx(),y:v.y+i.ty(),width:v.width,height:v.height},y=0,m=0;return v.x<s?y=v.x-s:v.x+v.width>s+c&&(y=v.x+v.width-s-c),y&&(i.tx(i.tx()-y),_.x-=y),v.y<l?m=v.y-l:v.y+o>l+h&&(m=v.y+o-l-h),m&&(i.ty(i.ty()-m),_.y-=m),void i.beginEditing({data:t,column:g,value:i.getValue(t,g),event:e,rect:v,editorRect:_,view:i})}}}},Uv.BaseItemEditor=function(t,e,i,n){this._data=t,this._column=e,this._master=i,this._editInfo=n},Wv("BaseItemEditor",e,{ms_ac:["data","column","master","editInfo"],editBeginning:function(){},getView:function(){},getValue:function(){},setValue:function(){}});var Nv=c.Tab=function(){Kn(Nv,this)};xl("Tab",_c,{ms_ac:["view","closable","disabled","visible"],_icon:l,_closable:!1,_disabled:!1,_visible:!0,setParent:cn});var qv=c.Column=function(){Kn(qv,this)};xl("Column",_c,{_46o:1,ms_ac:["accessType","valueType",he,Re,ze,Bt,"align",ci,"sortOrder",Oe,"sortable","clickable","nullable","emptiable","slider","colorPicker","itemEditor"],_visible:!0,_width:80,_sortOrder:Ae,_sortFunc:l,_sortable:!0,_clickable:!0,setWidth:function(t){16>t&&(t=16);var e=this._width;this._width=t,this.fp(Bt,e,t)},getToolTip:function(t,e){return this.formatValue(e.getValue(t,this))}});var Xv=c.Property=function(){Kn(Xv,this)};xl("Property",_c,{_46o:1,ms_ac:["accessType","valueType",Re,ze,"categoryName",ci,"align","nullable","emptiable","slider","itemEditor","colorPicker"],_categoryName:l,getToolTip:function(t,e,i){var n=this;return e?n.formatValue(i.getValue(t,n)):i.getPropertyName(n)}}),Uv.AccordionView=function(){var t=this;t._20o={},t._21o=new gc,t._10o=l,t._9o=l,t._11o=l,t._view=mr(0,t),t.iv()},Wv("AccordionView",e,{ms_v:1,ms_fire:1,ms_ac:[Ee,Pe,"titleHeight",ee,te,"titleBackground","selectWidth",ve,"orientation","separatorColor"],_expandIcon:u.accordionViewExpandIcon,_collapseIcon:u.accordionViewCollapseIcon,_titleHeight:ms,_labelColor:u.accordionViewLabelColor,_labelFont:u.accordionViewLabelFont,_titleBackground:u.accordionViewTitleBackground,_selectBackground:u.accordionViewSelectBackground,_selectWidth:u.accordionViewSelectWidth,_orientation:"v",_separatorColor:u.accordionViewSeparatorColor,onPropertyChanged:function(){this.iv()},getView:function(){return this._view},getTitles:function(){return this._21o},getCurrentTitle:function(){return this._10o},add:function(t,e,i,n){var r=this,o=xr(),a={content:e,div:o,canvas:wr(o),icon:n};if(r._20o[t])throw t+" already exists";var s=a.downEventFunc=function(t){Os(t)},l=a.upEventFunc=function(e){Os(e),Qs(e)&&(r._10o===t?r.collapse():r.expand(t))};[bi,vi].forEach((function(t){w(o,t,s)})),[wi,yi].forEach((function(t){w(o,t,l)})),o.style.cursor=gi,Mr(r._view,o),r._20o[t]=a,r._21o.add(t),i&&r.expand(t),r.iv()},remove:function(t){var e=this,i=e._20o[t];if(i){var n=i.div;pl(n),[bi,vi].forEach((function(t){C(n,t,i.downEventFunc)})),[wi,yi].forEach((function(t){C(n,t,i.upEventFunc)})),delete e._20o[t],e._21o.remove(t),e.iv()}},clear:function(){var t=this;t._21o.toArray().forEach(t.remove,t),t._20o={},t._21o.clear(),t.iv()},isExpanded:function(t){return this._10o===t},expand:function(t){var e=this;e._20o[t]&&e._10o!==t&&(e._10o=t,e.onExpanded(t),e.iv())},onExpanded:function(){},collapse:function(){var t=this;t._10o&&(t.onCollapsed(t._10o),delete t._10o,t.iv())},onCollapsed:function(){},initCanvas:function(t,e,i){Ir(t,e,i);var n=kr(t);return Ar(n,0,0,1),n.clearRect(0,0,e,i),n},drawTitle:function(t,e,i,n,r){var o=this,a=zs(r.icon),s=o.isExpanded(e),l=o._titleHeight,c=o._titleBackground,h=o._selectWidth,u=o._separatorColor,d=zs(s?o._expandIcon:o._collapseIcon),f=h+4;Ao(t,0,0,i,n,c),s&&h&&Ao(t,0,0,h,n,o._selectBackground),(s||o._21o.get(o._21o.size()-1)!==e)&&Ao(t,0,n-1,i,1,u||Ws(c)),a&&(As(t,a,f+hc(a)/2,l/2),f+=hc(a)+2),qs(t,e,o.getLabelFont(e),o.getLabelColor(e),f,0,0,l),d&&As(t,d,i-hc(d)/2-4,l/2)},validateImpl:function(){var t=this,e=t._view,i=0,n=0,r=t.getWidth(),o=t.getHeight(),a=t._titleHeight,s=t._21o.size()*a,l=t._11o,c=t._9o;delete t._11o,delete t._9o,t._21o.each((function(e){var l,c,h=t._20o[e],u=h.content,d=t._10o===e;Sn(t)?(Gr(h.div,i,0,a,o),l=t.initCanvas(h.canvas,a,o),Vr(l,0,o),Br(l,-j),t.drawTitle(l,e,o,a,h),l.restore(),d?(c=P(0,r-s),u&&(t._11o=u,t._9o=Hr(u),Gr(u,i+a,0,c,o)),i+=a+c):i+=a):(Gr(h.div,0,n,r,a),l=t.initCanvas(h.canvas,r,a),t.drawTitle(l,e,r,a,h),l.restore(),d?(c=P(0,o-s),u&&(t._11o=u,t._9o=Hr(u),Gr(u,0,n+a,r,c)),n+=a+c):n+=a)}));var h=t._9o;l&&l!==t._11o&&l.endEditing&&l.endEditing(),h&&h!==c&&Mr(e,h),c&&c!==h&&pl(c)}}),Uv.SplitView=function(t,e,i,n){var r=this,o=r._dividerDiv=xr(),a=r._60O=wr(),s=r._61O=wr(),c=a.style,h=s.style;r._view=mr(1,r),Mr(r._view,o),c.msTouchAction=pi,c.pointerEvents=pi,c.cursor=gi,h.msTouchAction=pi,h.pointerEvents=pi,h.cursor=gi,t&&r.setLeftView(t),e&&r.setRightView(e),i&&r.setOrientation(i),n!=l&&r.setPosition(n),r.setStatus(kt),new Qv(r)},Wv("SplitView",e,{ms_v:1,ms_fire:1,ms_ac:["continuousLayout","dividerSize","dividerBackground","toggleIcon","togglable","dragOpacity","orientation","draggable","status"],_continuousLayout:!1,_position:.5,_togglable:!0,_orientation:"h",_draggable:!0,_dividerSize:u.splitViewDividerSize,_dividerBackground:u.splitViewDividerBackground,_dragOpacity:u.splitViewDragOpacity,_toggleIcon:u.splitViewToggleIcon,onPropertyChanged:function(){this.iv()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(t,e){var i=this,n=i._position;isNaN(t)||(e||(i._82O=0>t?-1:t>1?1:0),i._position=t,i.fp(Be,n,t))},getLeftView:function(){return this._leftView},setLeftView:function(t){var e=this,i=e._leftView,n=e._view;if(e._leftView!==t){if(i&&i!==e._rightView){var r=Hr(i);r.parentNode===n&&pl(r)}if(e._leftView=t,t){var o=Hr(t);o.parentNode!==n&&n.insertBefore(o,e._dividerDiv)}e.fp("leftView",i,t)}},getRightView:function(){return this._rightView},setRightView:function(t){var e=this,i=e._rightView,n=e._view;if(e._rightView!==t){if(i&&i!==e._leftView){var r=Hr(i);r.parentNode===n&&pl(r)}if(e._rightView=t,t){var o=Hr(t);o.parentNode!==n&&n.insertBefore(o,e._dividerDiv)}e.fp("rightView",i,t)}},validateImpl:function(){var t=this,e=t._draggable,i=t._position,n=t.getWidth(),r=t.getHeight(),o=t._dividerSize,a=t._dividerBackground,s=lt?18:8,l=t._dividerDiv,c=t._82O,h=t._60O,u=t._61O,d=t._toggleIcon,f=t._status,g=l.style,p=null,v=lt?20:4,_=d.comps[0];o>=s||0===o?t._coverDiv&&(pl(t._coverDiv),delete t._coverDiv):t._coverDiv||(t._coverDiv=xr(),nt&&(t._coverDiv.style.background=ni),Mr(l,t._coverDiv)),t._togglable?h.parentNode||(Mr(l,h),Mr(l,u)):(pl(h),pl(u));var y=t._coverDiv,m=t._leftView,b=t._rightView;if(Sn(t)){if(o>n&&(o=n),f===kt)if(1===c)var x=D(i,n),w=P(0,n-o-x);else-1===c?(w=D(-i,n),x=P(0,n-o-w)):(x=I((n-o)*i),w=P(0,n-o-x));else"cl"===f?(x=0,w=P(0,n-o)):"cr"===f&&(w=0,x=P(0,n-o));m&&Gr(m,0,0,x,r),b&&Gr(b,x+o,0,w,r),Gr(l,x,0,o,r),t._22o=x,y&&(Gr(y,o/2-s/2,0,s,r),y.style.cursor=e?di:""),l.style.cursor=e?di:"";var C=l.clientHeight/2,S=l.clientWidth;Ir(h,S,S),Gr(h,0,C-S-v,S,S),p=kr(h),Ar(p,0,0,1),_.rotation=-j,fc(p,d,0,0,S,S),p.restore(),Ir(u,S,S),Gr(u,0,C+v,S,S),p=kr(u),Ar(p,0,0,1),_.rotation=j,fc(p,d,0,0,S,S),p.restore()}else{if(o>r&&(o=r),f===kt)if(1===c)var M=D(i,r),T=P(0,r-o-M);else-1===c?(T=D(-i,r),M=P(0,r-o-T)):(M=I((r-o)*i),T=P(0,r-o-M));else"cl"===f?(M=0,T=P(0,r-o)):"cr"===f&&(T=0,M=P(0,r-o));m&&Gr(m,0,0,n,M),b&&Gr(b,0,M+o,n,T),Gr(l,0,M,n,o),t._22o=M,y&&(Gr(y,0,o/2-s/2,n,s),y.style.cursor=e?fi:""),g.cursor=e?fi:"";var E=l.clientWidth/2;S=l.clientHeight;Ir(h,S,S),Gr(h,E-S-v,0,S,S),p=kr(h),Ar(p,0,0,1),_.rotation=0,fc(p,d,0,0,S,S),p.restore(),Ir(u,S,S),Gr(u,E+v,0,S,S),p=kr(u),Ar(p,0,0,1),_.rotation=L,fc(p,d,0,0,S,S),p.restore()}g.background=a}});var Qv=function(t){this.sv=t,this.addListeners()};bl(Qv,e,{ms_listener:1,getView:function(){return this.sv.getView()},handle_touchstart:function(t){var e=this,i=e.sv,n=i._dividerDiv,r=i._60O,o=i._61O,a=i._status,s=t.target;if(s===r)a===kt?i.setStatus("cl"):"cr"===a&&i.setStatus(kt);else if(s===o)a===kt?i.setStatus("cr"):"cl"===a&&i.setStatus(kt);else if(Kr(t)&&(s===n||s===i._coverDiv)&&(Os(t),i.isDraggable())){i.getLeftView(),i.getRightView();var l=e.maskDiv=xr();if(l.style.left=0,l.style.top=0,l.style.width=i.getWidth()+"px",l.style.height=i.getHeight()+"px",i.getView().appendChild(l),!i.isContinuousLayout()){var c=e.resizeDiv=xr();c.style.left=n.style.left,c.style.top=n.style.top,c.style.width=n.style.width,c.style.height=n.style.height,c.style.opacity=i.getDragOpacity(),c.style.background=i.getDividerBackground(),Mr(e.getView(),c)}e._lastAbsPosition=i._22o,e._86o=Sn(i)?el(t).x:el(t).y,gl(e,t)}},handleWindowTouchMove:function(t){Kr(t)&&this.update(t,this.sv.isContinuousLayout())},handleWindowTouchEnd:function(t){var e=this;e.update(t,!0),e.sv.setStatus(kt),e.maskDiv&&pl(e.maskDiv),e.resizeDiv&&pl(e.resizeDiv),e.maskDiv=e.resizeDiv=l},handle_mousedown:function(t){Qs(t)&&this.handle_touchstart(t)},handleWindowMouseMove:function(t){this.handleWindowTouchMove(t)},handleWindowMouseUp:function(t){this.handleWindowTouchEnd(t)},update:function(t,e){var i=this,n=i.sv,r=Sn(n)?n.getWidth():n.getHeight(),o=n._dividerSize,a=i._lastAbsPosition-i._86o;Sn(n)?(a+=el(t).x,a>r-o&&(a=r-o),0>a&&(a=0),i.resizeDiv&&(i.resizeDiv.style.left=a+It)):(a+=el(t).y,a>r-o&&(a=r-o),0>a&&(a=0),i.resizeDiv&&(i.resizeDiv.style.top=a+It)),e&&r!==o&&(1===n._82O?n.setPosition(a,1):-1===n._82O?n.setPosition(a-r+o,1):n.setPosition(a/(r-o),1))}}),Uv.TabView=function(){var t=this,e=t._view=mr(1,t),i=t._91O=xr(1),n=t._tabModel=new yc,r=n.sm(),o=t.invalidate;t._7o=new gc,t._canvas=wr(i),Mr(e,i),Mr(e,t._92O=xr(1)),r.setSelectionMode(ht),r.ms(t.handleSelectionChange,t),n.mm(o,t),n.mh(o,t),n.md(o,t),t._interactor=new Yv(t),t.iv()},Wv("TabView",e,{ms_v:1,ms_fire:1,ms_tx:1,ms_ty:1,ms_lp:1,ms_ac:["movable","tabGap","tabHeight","tabPosition",ee,te,"tabHPadding","tabBackground","selectWidth",ve,"moveBackground","insertColor"],_tabHPadding:0,_tabPosition:vt,_tabHeight:ms,_tabGap:u.tabViewTabGap,_labelColor:u.tabViewLabelColor,_labelFont:u.tabViewLabelFont,_tabBackground:u.tabViewTabBackground,_selectWidth:u.tabViewSelectWidth,_selectBackground:u.tabViewSelectBackground,_moveBackground:u.tabViewMoveBackground,_insertColor:u.tabViewInsertColor,_movable:!0,handleSelectionChange:function(){this._selectionChanged=!0,this.invalidate()},getContentDiv:function(){return this._92O},getTitleDiv:function(){return this._91O},getTabModel:function(){return this._tabModel},add:function(t,e,i){var n,r=this._tabModel;return t instanceof Nv?(n=t,e&&n.setView(e)):(n=new Nv,n.setName(t),n.setView(e)),r.add(n),i&&r.sm().ss(n),n},getLabel:function(t){return t.toLabel()},onPropertyChanged:function(){this.iv()},_7Q:function(t){this._23o=t,this.iv()},get:function(t){var e,i=this,n=i._tabModel;return Rn(t)?n._roots.get(t):On(t)?(n.each((function(n){t===i.getLabel(n)&&(e=n)})),e):t instanceof Nv?t:l},select:function(t){this._tabModel.sm().ss(this.get(t))},remove:function(t){var e=this;if(t=e.get(t)){var i=e._tabModel,n=i._roots.indexOf(t);e._tabModel.remove(t),e.selectByIndex(--n)}},getCurrentTab:function(){return this._8o},hideTabView:function(t,e){e.parentNode===this._92O&&(Wn(e)?(e.style.display=St,e._tab_=t):pl(e),cs())},showTabView:function(t,e){Wn(e)&&(e.style.display="block",e._tab_=t),e.parentNode!==this._92O&&(Mr(this._92O,e),cs())},_24o:function(){var t,e=this,i=e._8o,n=e._9o,r=e._tabModel.sm().ld();r&&(t=Hr(r.getView())),t!==n&&(n&&(i.getView()&&i.getView().endEditing&&i.getView().endEditing(),e.hideTabView(i,n)),t&&e.showTabView(r,t)),e._8o=r,e._9o=t,i!==r&&e.onTabChanged(i,r)},onTabClosing:function(){return!0},onTabChanged:function(){},onTabClosed:function(t,e){this.selectByIndex(--e)},selectByIndex:function(t){var e=this,i=e._tabModel,n=i.size();if(n&&!i.sm().ld()){t==l&&(t=0),t>=n&&(t=n-1),0>t&&(t=0);for(var r=t;r>=0;r--){var o=e.get(r);if(!o.isDisabled())return e.select(o),o}for(r=t+1;n>r;r++)if(o=e.get(r),!o.isDisabled())return e.select(o),o}},getTabWidth:function(t){var e=this.getTabHPadding(),i=4+2*e,n=zs(t.getIcon());n&&(i+=hc(n,t)+4);var r=this.getLabel(t);return r&&(i+=Xs(this.getLabelFont(t),r).width+4),t.isClosable()&&(i+=10),i},drawTab:function(t,e,i,n,r,o,a){var s,l=this,c=l._tabPosition,h=this.getTabHPadding(),u=i+4+h,d=l._selectWidth,f=zs(e.getIcon()),g=e.isDisabled(),p=l.getLabelColor(e),v=l.getLabelFont(e),_=l.getLabel(e),y=l._selectBackground,m=c===gt+"-vertical",b=c===pt+"-vertical";(m||b)&&(u=n+4+h),g&&(t.globalAlpha=is),Ao(t,i,n,r,o,a),e===l._8o&&d&&(c===vt?Ao(t,i,n+o-d,r,d,y):c===gt?Ao(t,i+r-d,n,d,o,y):c===pt?Ao(t,i,n,d,o,y):m?Ao(t,i+r-d,n,d,o,y):b?Ao(t,i,n,d,o,y):Ao(t,i,n,r,d,y));var x=r/2;if(m&&(Vr(t,x,n+o/2),Br(t,L),Vr(t,-x,-n-o/2)),f){var w=uc(f,e),C=hc(f,e);if(m||b){var S=i+r/2,I=u+w/2;Vr(t,S,I),Br(t,j),Vr(t,-S,-I),As(t,f,i+r/2,u+w/2,e,l),Vr(t,S,I),Br(t,-j),Vr(t,-S,-I),u+=w+4}else As(t,f,u+C/2,n+o/2,e,l),u+=C+4}return m||b?(Vr(t,r/2,u+r/2),Br(t,j),Vr(t,-r/2,-u-r/2),qs(t,_,v,p,i,u,o,r),Vr(t,r/2,u+r/2),Br(t,-j),Vr(t,-r/2,-u-r/2)):qs(t,_,v,p,u,n,r,o),m&&(Vr(t,x,n+o/2),Br(t,-L),Vr(t,-x,-n-o/2)),e.isClosable()&&(s=b?{x:i+r-12,y:n+o-12,width:12,height:12}:{x:i+r-12,y:n+2,width:12,height:12},this.drawCloseIcon(e,t,p,s)),g&&(t.globalAlpha=1),s},drawCloseIcon:function(t,e,i,n){var r=n.x,o=n.y;e.strokeStyle=i,e.lineWidth=1,e.beginPath(),e.moveTo(r+2,o+8),e.lineTo(r+8,o+2),e.moveTo(r+8,o+8),e.lineTo(r+2,o+2),e.stroke()},getTabAt:function(t){var e=this._interactor._8Q(t);return e?e.tab:null},validateImpl:function(){var t=this;t._24o();var e,i=t._canvas,n=t._tabPosition,r=t._91O,o=t._92O,a=t._tabModel,s=t.getWidth(),l=t.getHeight(),c=t._tabHeight,h=t._7o,u=t._tabGap,d=n===vt,f=n===gt,g=n===pt,p=n===gt+"-vertical",v=n===pt+"-vertical",_=t._23o,y=0;if((f||g)&&a._roots.each((function(e){y=P(t.getTabWidth(e),y)})),d?(Gr(r,0,0,s,c),e={x:0,y:c,width:s,height:P(0,l-c)}):f?(Gr(r,0,0,y,l),e={x:y,y:0,width:P(0,s-y),height:l}):g?(Gr(r,s-y,0,y,l),e={x:0,y:0,width:P(0,s-y),height:l}):p?(Gr(r,0,0,c,l),e={x:c,y:0,width:P(0,s-c),height:l}):v?(Gr(r,s-c,0,c,l),e={x:0,y:0,width:P(0,s-c),height:l}):(Gr(r,0,l-c,s,c),e={x:0,y:0,width:s,height:P(0,l-c)}),Gr(o,e),p||v){t._9o&&(e.x=0,Gr(t._8o.getView(),e)),Ir(i,c,l);var m=kr(i),b=0;if(Ar(m,0,t.ty(),1),m.clearRect(0,0,c,l),h.clear(),a._roots.each((function(e){if(e.isVisible()){var i,n=t.getTabWidth(e);_&&_.tab===e||(i=t.drawTab(m,e,0,b,c,n,t._tabBackground)),h.add({_75o:i,tab:e,startY:b,endY:b+n,height:n}),b+=n+u}})),t._23Q=P(0,b-u),_){var x=_.position;t.drawTab(m,_.tab,0,_.startY,c,_.height,t._moveBackground),Ao(m,0,x,c,1,t._insertColor)}if(m.restore(),t._selectionChanged){t._selectionChanged=!1;for(var w=t.ty(),C=0;C<h.size();C++){var S=h.get(C);if(S.tab===t._8o){if(S.endY+w<0){t.ty(-S.startY);break}if(S.startY+w>l){t.ty(l-S.endY);break}}}}t.ty(t.ty())}else if(f||g){t._9o&&(e.x=0,Gr(t._8o.getView(),e)),Ir(i,y,l);m=kr(i),b=0;if(Ar(m,0,t.ty(),1),m.clearRect(0,0,y,l),h.clear(),a._roots.each((function(e){var i;e.isVisible()&&(_&&_.tab===e||(i=t.drawTab(m,e,0,b,y,c,t._tabBackground)),h.add({_75o:i,tab:e,startY:b,endY:b+c,height:c}),b+=c+u)})),t._23Q=P(0,b-u),_){x=_.position;t.drawTab(m,_.tab,0,_.startY,y,_.height,t._moveBackground),Ao(m,0,x,y,1,t._insertColor)}if(m.restore(),t._selectionChanged){t._selectionChanged=!1;for(w=t.ty(),C=0;C<h.size();C++){S=h.get(C);if(S.tab===t._8o){if(S.endY+w<0){t.ty(-S.startY);break}if(S.startY+w>l){t.ty(l-S.endY);break}}}}t.ty(t.ty())}else{t._9o&&(e.y=0,Gr(t._8o.getView(),e)),Ir(i,s,c);m=kr(i);var I=0;if(Ar(m,t.tx(),0,1),m.clearRect(0,0,s,c),h.clear(),a._roots.each((function(e){if(e.isVisible()){var i,n=t.getTabWidth(e);_&&_.tab===e||(i=t.drawTab(m,e,I,0,n,c,t._tabBackground)),h.add({_75o:i,tab:e,startX:I,endX:I+n,width:n}),I+=n+u}})),t._64I=P(0,I-u),_){x=_.position;t.drawTab(m,_.tab,_.startX,0,_.width,c,t._moveBackground),hr(m,t._insertColor,x,0,c)}if(m.restore(),t._selectionChanged){t._selectionChanged=!1;var M=t.tx();for(C=0;C<h.size();C++){S=h.get(C);if(S.tab===t._8o){if(S.endX+M<0){t.tx(-S.startX);break}if(S.startX+M>s){t.tx(s-S.endX);break}}}}t.tx(t.tx())}var T=[],E=o.children;for(C=0;C<E.length;C++){var D=E[C],O=D._tab_;O&&!a.contains(O)&&T.push(D)}T.forEach((function(t){o.removeChild(t)}))}});var Yv=function(t){this.tv=t,this.addListeners()};bl(Yv,e,{ms_listener:1,getView:function(){return this.tv._91O},handle_mousewheel:function(t){this.handleScroll(t,t.wheelDelta/40*10)},handle_DOMMouseScroll:function(t){this.handleScroll(t,10*-t.detail)},handleScroll:function(t,e){Os(t);var i=this.tv,n=i._tabPosition;!i._40o()||n!==vt&&n!==_t||i.tx(this.tv.tx()+e),!i._41o()||n!==gt&&n!==pt&&n!==gt+"-vertical"&&n!==pt+"-vertical"||i.ty(this.tv.ty()+e)},_8Q:function(t){var e,i,n=this.tv,r=n._tabPosition,o=n._7o;if(r===vt||r===_t){var a=n.lp(t).x;for(e=0;e<o.size();e++)if(i=o.get(e),i.startX<=a&&a<=i.endX)return i}else if(r===gt||r===pt||r===gt+"-vertical"||r===pt+"-vertical"){var s=n.lp(t).y;for(e=0;e<o.size();e++)if(i=o.get(e),i.startY<=s&&s<=i.endY)return i}return l},isClickable:function(t){var e=this.tv,i=e._tabPosition,n=this._73o=this._8Q(t);return!(!e._40o()||i!==vt&&i!==_t)||(!(!e._41o()||i!==gt&&i!==pt&&i!==gt+"-vertical"&&i!==pt+"-vertical")||n&&(!n.tab.isDisabled()||e.isMovable()))},handle_mousemove:function(t){var e=this;Xr?e._74o=e._8Q(t):e.getView().style.cursor=e.isClickable(t)?gi:""},handle_mousedown:function(t){this.handle_mousemove(t),this.handle_touchstart(t)},handle_touchstart:function(t){var e=this,i=e.tv,n=i._tabPosition;Os(t),Qs(t)&&e.isClickable(t)&&(n===vt||n===_t?(e.x=el(t).x,e.lp=i.lp(t),e.tx=i.tx()):(e.y=el(t).y,e.lp=i.lp(t),e.ty=i.ty()),gl(e,t))},handleWindowMouseMove:function(t){this.handleWindowTouchMove(t)},handleWindowTouchMove:function(t){var e,i=this,n=i.tv,r=n._tabPosition,o=i._73o;if(r===vt||r===_t){if(e=el(t).x-i.x,!i._25o&&!i.moving&&O(e)>2&&(n._40o()&&!tl(t)?i._25o=1:o&&n.isMovable()&&(i.moving=1)),i._25o)n.tx(i.tx+e);else if(i.moving){var a=i.lp.x+e,s=n._tabGap/2;n._7o.each((function(t){var i=t.endX,r=a-t.startX<i-a;a>=t.startX&&i>=a&&n._7Q({tab:o.tab,startX:o.startX+e,width:o.width,front:r,insertTab:t.tab,position:r?P(0,t.startX-s):D(n._64I,i+s)})}))}}else if(e=el(t).y-i.y,!i._25o&&!i.moving&&O(e)>2&&(n._41o()&&!tl(t)?i._25o=1:o&&n.isMovable()&&(i.moving=1)),i._25o)n.ty(i.ty+e);else if(i.moving){var l=i.lp.y+e;s=n._tabGap/2;n._7o.each((function(t){var i=t.endY,r=l-t.startY<i-l;l>=t.startY&&i>=l&&n._7Q({tab:o.tab,startY:o.startY+e,height:o.height,front:r,insertTab:t.tab,position:r?P(0,t.startY-s):D(n._23Q,i+s)})}))}},handleWindowMouseUp:function(t){this.handleWindowTouchEnd(t)},handleWindowTouchEnd:function(){var t=this,e=t.tv,i=e._tabPosition,n=e.getTabModel(),r=n._roots,o=t._73o;if(t.moving){var a=e._23o;if(a&&a.insertTab!==a.tab){var s=a.tab,c=r.remove(s),h=r.indexOf(a.insertTab);h>=0&&(a.front||h++,h<=r.size()&&(r.add(s,h),n._38I(s,c,h)))}e._7Q(l),delete t.moving}else if(!t._25o&&o){s=o.tab;var u=t._74o;if(!u||u.tab===s)if(!s.isDisabled()&&al(o._75o,t.lp)){var d=function(){var t=r.indexOf(s);n.remove(s),e.onTabClosed(s,t)};e.onTabClosing(s,d)&&d()}else s.isDisabled()||e._8o===s||n.sm().ss(s)}t._25o=t._73o=t._74o=i===vt||i===_t?t.x=t.lp=t.tx=l:t.y=t.lp=t.ty=l}}),Uv.PropertyView=function(t){var e=this;e._view=mr(1,e),e._canvas=wr(e._view),Mr(e._view,e._79O=xr()),e._rows=new gc,e._28o=new gc,e._26o={},e._26Q={};var i=e._propertyModel=new yc,n=e.ivm;i.mm(n,e),i.md(n,e),i.mh(n,e),e.dm(t||new yc),new Zv(e)},Wv("PropertyView",e,{ms_ac:[ee,ie,te,Re,ze,"categorizable",xe,Oe,Te,Ee,Pe,me,be,ye,"selectRowIndex",ve,"background",we,Me,Se,Ie,Ce],ms_v:1,ms_dm:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,_45o:1,_47o:1,ms_tip:1,_29I:un,_59I:0,_9I:0,_selectRowIndex:-1,_editable:!0,_batchEditable:!0,_categorizable:!0,_indent:vs,_background:u.propertyViewBackground,_expandIcon:u.propertyViewExpandIcon,_collapseIcon:u.propertyViewCollapseIcon,_scrollBarColor:bs,_scrollBarSize:xs,_autoHideScrollBar:as,_selectBackground:u.propertyViewSelectBackground,_rowHeight:_s,_rowLineVisible:u.propertyViewRowLineVisible,_rowLineColor:u.propertyViewRowLineColor,_10I:.5,_columnLineVisible:u.propertyViewColumnLineVisible,_columnLineColor:u.propertyViewColumnLineColor,_labelColor:u.propertyViewLabelColor,_labelSelectColor:u.propertyViewLabelSelectColor,_labelFont:u.propertyViewLabelFont,getRows:function(){return this._rows},getColumnPosition:function(){return this._10I},setColumnPosition:function(t){0>t&&(t=0),t>1&&(t=1);var e=this,i=e._10I;e._10I=t,e.fp("columnPosition",i,t)},getPropertyName:function(t){return t.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(t,e,i){return i===this._selectRowIndex?this._labelSelectColor:this._labelColor},getPropertyFont:function(){return this._labelFont},getPropertyColor:function(t,e){return e===this._selectRowIndex?this._labelSelectColor:t.getColor()||this._labelColor},getCategoryFont:function(){return this._labelFont},getCategoryColor:function(){return this._labelColor},adjustTranslateX:function(){return 0},adjustTranslateY:function(t){var e=this.getHeight()-this._59I;return e>t&&(t=e),t>0?0:I(t)},isExpanded:function(t){if(!t)return!0;var e=this._26o[t];return e?e.isExpanded:!(!1===this._26Q[t])},toggle:function(t){var e=this;e.isExpanded(t)?e.collapse(t):e.expand(t)},expandAll:function(){for(var t in this.validate(),this._26o)this.expand(t)},expand:function(t){if(t&&t!==St){var e=this,i=e._26o[t];i&&!i.isExpanded&&(i.isExpanded=!0,e.onExpanded(t),e.ivm())}},onExpanded:function(){},collapseAll:function(){for(var t in this.validate(),this._26o)this.collapse(t)},collapse:function(t){if(t&&t!==St){var e=this,i=e._26o[t];i&&i.isExpanded&&(i.isExpanded=!1,e.onCollapsed(t),e.ivm())}},onCollapsed:function(){},getCategoryName:function(t){if(!this.isCategorizable())return St;var e=t.getCategoryName();return e||St},getPropertyModel:function(){return this._propertyModel},handleSelectionChange:function(){this.ivm()},setDataModel:function(t){var e=this,i=e._dataModel;i!==t&&(i&&(i.umd(e.handlePropertyChange,e),e._selectionModel||i.sm().ums(e.handleSelectionChange,e)),e._dataModel=t,t.md(e.handlePropertyChange,e),e._selectionModel?e._selectionModel._21I(t):t.sm().ms(e.handleSelectionChange,e),e.fp(Ge,i,t))},isVisible:function(t){return!this._visibleFunc||this._visibleFunc(t)},onPropertyChanged:function(t){var e=this,i=t.property;Lv[i]?e.ivm():e.iv(),i===He&&e._43o()},getCurrentData:function(){return this._27o},updateCurrentData:function(){this._27o=this.sm().ld()},getRawProperties:function(){return this._27o?this._propertyModel._roots:pc},handlePropertyChange:function(t){this._27o===t.data&&this.iv()},ivm:function(){this.invalidateModel()},invalidateModel:function(){var t=this;t._96I||(t.setSelectRowIndex(-1),t._96I=1,t.iv())},redraw:function(){this.iv()},validateModel:function(){var t=this,e=t._rows,n=t._28o,r={},o=new gc,a=t._27o;for(var s in t.updateCurrentData(),a!==t._27o&&t.endEditing(),e.clear(),n.clear(),t.getRawProperties().each((function(e){if(t.isVisible(e)){o.add(e);var a=t.getCategoryName(e);r[a]||(n.add(a,a===St?0:i),r[a]={isExpanded:t.isExpanded(a),properties:new gc})}})),t._sortFunc&&o.sort(t._sortFunc),t._26o)t._26Q[s]=t.isExpanded(s);t._26o=r,n.each((function(i){i!==St&&e.add(i);var n=r[i];n.isExpanded&&o.each((function(r){t.getCategoryName(r)===i&&(n.properties.add(r),e.add({property:r,data:t._27o}))}),t)}))},validateImpl:function(){var t=this;t._76o(),t._96I&&(t.validateModel(),delete t._96I);var e=t._canvas,i=t.getWidth(),n=t.getHeight(),r=-t.ty(),o=t._rowHeight,a=t._indent,s=i-a,c=t._rows,h=c.size(),u=t._9I=a+s*t._10I,d=t._59I=h*o;Ir(e,i,n),t._29I={x:0,y:r,width:i,height:n},t._31I=M(r/o),t._14I=T((r+n)/o),t._31I<0&&(t._31I=0),t._14I>h&&(t._14I=h);var f=kr(e),g=t._background;Ar(f,0,-r,1),f.beginPath(),f.rect(0,r,i,n),f.clip(),f.clearRect(0,r,i,n),t._93db(f),g&&Ao(f,0,0,a,d,g);for(var p=t._31I;p<t._14I;p++){var v=c.get(p);r=o*p;if(On(v))g&&Ao(f,a,r,s,o,g),m=zs(t.isExpanded(v)?t._expandIcon:t._collapseIcon),m&&Vs(f,m,ei,0,r,a,o),f.save(),f.beginPath(),f.rect(a,r,s,o),f.clip(),t.drawCategoryName(f,v,p,a,r,s,o),f.restore();else{var _=v.property,y=v.data,m=zs(_.getIcon()),b=t._selectRowIndex===p?t.getSelectBackground():l;if(m&&Vs(f,m,ei,0,r,a,o),b&&Ao(f,a,r,s,o,b),f.save(),f.beginPath(),f.rect(a,r,u-a,o),f.clip(),t.drawPropertyName(f,_,p,a,r,u-a,o),f.restore(),!t.isEditing(y,_)){var x=u+1,w=i-u-1;f.save(),f.beginPath(),f.rect(x,r,w,o),f.clip(),t._87o(t.drawPropertyValue(f,_,t.getValue(y,_),p,x,r,w,o,y),p,x,r,w,o),f.restore()}}t._rowLineVisible&&Ao(f,a,r+o-1,s,1,t._rowLineColor)}t._columnLineVisible&&(Ao(f,u,0,1,d,t._columnLineColor),Ao(f,i-1,0,1,d)),t._92db(f),t._93I(),f.restore(),t.ty(t.ty())},drawCategoryName:function(t,e,i,n,r,o,a){qs(t,e,this.getCategoryFont(e),this.getCategoryColor(e),n,r,o,a)},drawPropertyName:function(t,e,i,n,r,o,a){return e.drawPropertyName?void e.drawPropertyName(t,e,i,n,r,o,a,this):void qs(t,this.getPropertyName(e),this.getPropertyFont(e,i),this.getPropertyColor(e,i),n,r,o,a)},drawPropertyValue:function(t,e,i,n,r,o,a,s,l){return e.drawPropertyValue?e.drawPropertyValue(t,e,i,n,r,o,a,s,l,this):void jv(t,i,e,this.getLabelFont(e,i,n),this.getLabelColor(e,i,n),r,o,a,s,l,this)},isPropertyEditable:function(t){return t.isEditable()&&this.isEditable()},setProperties:function(t){this._propertyModel.clear(),this.addProperties(t)},addProperties:function(t){if(t){var e=this._propertyModel;t.forEach((function(t){if(!(t instanceof Xv)){var i=Gs(t.className);t=Ds(i||Xv,t)}e.add(t)}))}},getRowIndexAt:function(t){var e=this,i=M(e.lp(t).y/e._rowHeight);return i>=0&&i<e._rows.size()?i:-1},getPropertyAt:function(t){var e=this,i=e.getRowIndexAt(t);return i>=0?e._rows.get(i).property:l},getToolTip:function(t){var e=this,i=e.getPropertyAt(t),n=e._27o;return i&&n?i.getToolTip(n,e._9I<e.lp(t).x,e):l}});var Zv=function(t){this.pv=t,this.addListeners()};bl(Zv,e,{ms_listener:1,getView:function(){return this.pv._view},setCursor:function(t){this.getView().style.cursor=t},clear:function(){var t=this;t._62O=t.cp=t.ty=t.p=l,t.setCursor(ct)},handle_mousedown:function(t){this.handle_touchstart(t)},handle_touchstart:function(t){var e=this,i=e.pv;Os(t),i.setFocus(t)&&(Qs(t)?(e.cp=el(t),e.ty=i.ty(),e.p=i.getColumnPosition(),e.handle_touchmove(t)):i.setSelectRowIndex(i.getRowIndexAt(t)))},handleWindowMouseUp:function(){this.clear()},handleWindowTouchEnd:function(){this.clear()},handle_mouseup:function(t){this.handle_touchend(t)},handle_touchend:function(t){var e=this;if(e.cp&&!e._62O){var i=e.pv,n=i.lp(t),r=n.x,o=n.y,a=i._indent,s=i.getRowIndexAt(t),l=i._9I;if(s>=0){var c=i._rowHeight,h=c*s,u=i._rows.get(s),d=u.property;if(On(u))(zs(i.isExpanded(u)?i._expandIcon:i._collapseIcon)&&r>=0&&a>=r&&o>=h&&h+c>=o||Ks(t))&&i.toggle(u);else if(r>l&&i.isPropertyEditable(d,t)){var f={x:l+1,y:h,width:i.getWidth()-l-1,height:c},g={x:f.x+i.tx(),y:f.y+i.ty(),width:f.width,height:f.height},p=0,v=i._29I;f.y<v.y?p=f.y-v.y:f.y+c>v.y+v.height&&(p=f.y+c-v.y-v.height),p&&(i.ty(i.ty()-p),g.y-=p),i.beginEditing({data:u.data,property:d,value:i.getValue(u.data,d),event:t,rect:f,editorRect:g,view:i})}}i.setSelectRowIndex(s)}e.clear()},handleWindowMouseMove:function(t){this.handleWindowTouchMove(t)},handleWindowTouchMove:function(t){var e=this,i=e.pv,n=e.ty,r=e.cp,o=el(t),a=e._62O;if("p"===a)i.setTranslateY(n+o.y-r.y);else if("c"===a){var s=i.getWidth()-i._indent;if(s>16){var l=e.p-(r.x-o.x)/s,c=16/s;c>l&&(l=c),l>1-c&&(l=1-c),i.setColumnPosition(l)}}else"s"===a&&i.setTranslateY(n+(r.y-o.y)*i._59I/i._29I.height)},handle_mousemove:function(t){this.handle_touchmove(t)},handle_touchmove:function(t){if(!Xr&&Qs(t)){var e=this,i=e.pv,n=O(i.lp(t).x-i._9I)<=(lt?8:3);e.cp?e._62O||(n?(e._62O="c",gl(e,t)):O(el(t).y-e.cp.y)>=2&&(e._62O=e.isV(t)?"s":"p",gl(e,t))):(n?e.setCursor(di):e.setCursor(ct),e.isV(t)&&i._43o())}},isV:function(t){var e=this.pv,i=e._29I;return e._41o()&&i.x+i.width-e.lp(t).x<Ss},handle_mousewheel:function(t){this.handleScroll(t,t.wheelDelta/40)},handle_DOMMouseScroll:function(t){2===t.axis&&this.handleScroll(t,-t.detail)},handleScroll:function(t,e){var i=this.pv;Os(t),i.endEditing(),i.translate(0,e*i.getRowHeight())},handle_keydown:function(t){var e=this.pv,i=e._rows.size(),n=e._selectRowIndex+(ho(t)?-1:1);(ho(t)||fo(t))&&(0>n&&(n=0),n>=i&&(n=i-1),e.setSelectRowIndex(n))}}),Uv.ListView=function(t){this._5o(t),new Jv(this)},Wv("ListView",e,{ms_ac:[ee,ie,te,we,xe,Me,Se,Oe,Te,me,be,ye,_e,ve],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,_14Q:1,ms_dm:1,_45o:1,_checkMode:!1,_indent:vs,_rowHeight:_s,_rowLineVisible:u.listViewRowLineVisible,_rowLineColor:u.listViewRowLineColor,_scrollBarColor:bs,_scrollBarSize:xs,_autoMakeVisible:os,_autoHideScrollBar:as,_selectBackground:u.listViewSelectBackground,_labelColor:u.listViewLabelColor,_labelSelectColor:u.listViewLabelSelectColor,_labelFont:u.listViewLabelFont,isCheckMode:function(){return this._checkMode},setCheckMode:function(t){var e=this,i=e._checkMode;e._checkMode=t,e.fp(De,i,t)},drawRow:function(t,e,i,n,r,o,a){var s=this,l=0,c=s._indent,h=s.getIconWidth(e);s.drawRowBackground(t,e,i,n,r,o,a),s._checkMode&&(As(t,zs(s.getCheckIcon(e)),l+c/2,r+a/2,e,s),l+=c),s.drawIcon(t,e,l,r,h,a),s.drawLabel(t,e,l+h,r,a)}});var Jv=function(t){this.list=t,this._lastSelectDataTime=mn(),this.addListeners()};bl(Jv,e,{ms_listener:1,getView:function(){return this.list._view},clear:function(t){var e=this,i=e.list;t&&"d"===e._62O&&!e.dragCancel&&i.handleDragAndDrop(t,"end"),i.draggingData&&(i.draggingData=null,i.redraw()),e.dragCancel=e._62O=e._isV=e._isH=e.cp=e.tx=e.ty=l},handle_mousedown:function(t){this.handle_touchstart(t)},handle_touchstart:function(t){var e=this,i=e.list;if(Os(t),i.setFocus(t)){var n=i.getDataAt(t);e.cp=el(t),e.tx=i.tx(),e.ty=i.ty(),Qs(t)?n&&i.handleDragAndDrop&&!e.isV(t)&&!e.isH(t)&&(i.draggingData=n,i.redraw(),i.handleDragAndDrop(t,"prepare")):(n&&e._33o(t,n),e.clear(t))}},handleWindowMouseUp:function(t){this.clear(t)},handleWindowTouchEnd:function(t){this.clear(t)},handle_mouseup:function(t){this.handle_touchend(t)},handle_touchend:function(t){var e=this,i=e.list;if(!e._isV&&!e._isH&&e.cp&&!e._62O){var n=i.getDataAt(t);n?(i.isCheckMode()?e._34o(t,n):e._33o(t,n),Ks(t)?i.onDataDoubleClicked(n,t):i.onDataClicked(n,t)):i.handleBackgroundClick(t)}e.clear(t)},handleWindowMouseMove:function(t){this.handleWindowTouchMove(t)},handleWindowTouchMove:function(t){var e=this,i=e.list,n=e._62O,r=e.tx,o=e.ty,a=e.cp,s=el(t),l=i._29I;"p"===n?i.setTranslate(r+s.x-a.x,o+s.y-a.y):"v"===n?i.ty(o+(a.y-s.y)*i._59I/l.height):"h"===n?i.tx(r+(a.x-s.x)*i._91I/l.width):"d"===n&&(e.dragCancel||i.handleDragAndDrop(t,"between"))},handle_mousemove:function(t){this.handle_touchmove(t)},handle_touchmove:function(t){if(!Xr&&Qs(t)){var e=this,i=e.list;if(e._isV=e.isV(t),e._isH=e.isH(t),e.cp){if(!e._62O){if(nl(el(t),e.cp)<2)return;e._isV?e._62O="v":e._isH?e._62O="h":i.draggingData&&!this.dragCancel?(e._62O="d",i.handleDragAndDrop(t,"begin")):e._62O="p",e._62O&&"d"!==e._62O&&i.draggingData&&(i.draggingData=null,i.redraw()),gl(e,t)}}else e._isV&&i._43o(),e._isH&&i._42o()}},isV:function(t){var e=this.list,i=e._29I;return e._41o()&&i.x+i.width-e.lp(t).x<Ss},isH:function(t){var e=this.list,i=e._29I;return e._40o()&&i.y+i.height-e.lp(t).y<Ss},handle_mousewheel:function(t){this.handleScroll(t,t.wheelDelta/40,t.wheelDelta!==t.wheelDeltaX)},handle_DOMMouseScroll:function(t){this.handleScroll(t,-t.detail,1)},handleScroll:function(t,e,i){var n=this.list;Os(t),n.endEditing&&n.endEditing(),i&&n._41o()?n.translate(0,e*n.getRowHeight()):n._40o()&&n.translate(10*e,0)},handle_keydown:function(t){if(!u.isInput(t.target)){var e,i=this.list,n=i.sm(),r=i._rows,o=r.size();if(to(t))i.selectAll();else if(eo(t))i.handleDelete&&i.handleDelete(t);else if(vo(t))"d"!==this._62O||this.dragCancel||(i.handleDragAndDrop(t,"cancel"),this.dragCancel=!0);else if(go(t))i.isCheckMode()&&(e=i.getFocusData(),e&&i.checkData(e));else if(ho(t)||fo(t)){var a=i.isCheckMode();if(e=a?i.getFocusData():n.ld()){var s=i.getRowIndex(e);s>=0&&(ho(t)?0!==s&&(e=r.get(s-1),a?i.setFocusData(e):n.ss(e)):s!==o-1&&(e=r.get(s+1),a?i.setFocusData(e):n.ss(e)))}else o>0&&(e=r.get(0),a?i.setFocusData(e):n.ss(e))}}},_34o:function(t,e){var i=this.list,n=i.lp(t).x;return n>=0&&n<=i._indent?void i.checkData(e):void i.setFocusData(e)},_33o:function(t,e){var i=this.list,n=i.sm(),r=n.ld();if(tl(t))i.isSelected(e)?n.rs(e):n.as(e);else if($s(t))if(r)for(var o=i.getRowIndex(r),a=i.getRowIndex(e);o!==a;)o+=a>o?1:-1,n.as(i._rows.get(o));else n.ss(e);else if(Qs(t)){var s=mn();if(n.contains(e)){var l=s-this._lastSelectDataTime;i.handleDataDoubleSelect&&l>500&&1500>l&&i.handleDataDoubleSelect(t,e)}n.ss(e),this._lastSelectDataTime=s}else n.contains(e)||n.ss(e)}}),Uv.TreeView=function(t){var e=this;e._35o(),e._5o(t),new Kv(e)},Wv("TreeView",e,{ms_ac:[ee,ie,te,"rootVisible",De,"rootData",Oe,Te,me,be,ye,xe,we,Me,Se,Ee,Pe,_e,ve,"loader","doubleClickToToggle"],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,_48o:1,_14Q:1,_45o:1,_checkMode:l,_indent:vs,_rowHeight:_s,_rowLineVisible:u.treeViewRowLineVisible,_rowLineColor:u.treeViewRowLineColor,_scrollBarColor:bs,_scrollBarSize:xs,_autoHideScrollBar:as,_expandIcon:u.treeViewExpandIcon,_collapseIcon:u.treeViewCollapseIcon,_autoMakeVisible:os,_selectBackground:u.treeViewSelectBackground,_labelColor:u.treeViewLabelColor,_labelSelectColor:u.treeViewLabelSelectColor,_labelFont:u.treeViewLabelFont,_doubleClickToToggle:u.treeViewDoubleClickToToggle,drawRow:function(t,e,i,n,r,o,a){var s=this;s.drawRowBackground(t,e,i,n,r,o,a),s.drawTree(t,e,i,0,r,o,a)},isOnToggleIcon:function(t){var e=this.getDataAt(t);if(e){var i=this.getIndent(),n=this.lp(t).x;if(zs(this.getToggleIcon(e))){var r=i*this.getLevel(e);if(n>=r&&r+i>=n)return!0}}return!1}});var Kv=function(t){Kn(Kv,this,[t])};bl(Kv,Jv,{toggle:function(t,e,i,n){var r=this.list,o=r.lp(t).x;if(zs(r.getToggleIcon(e))){var a=i*n;if(o>=a&&a+i>=o)return r.toggle(e),!0}return!(!r.isDoubleClickToToggle()||!Ks(t))&&(r.toggle(e),!0)},_34o:function(t,e){var i=this.list,n=i.lp(t).x,r=i._levelMap[e._id],o=i._indent,a=o*(r+1);return n>=a&&a+o>=n?void i.checkData(e):void(this.toggle(t,e,o,r)||i.setFocusData(e))},_33o:function(t,e){var i=this,n=i.list;if(!i.toggle(t,e,n._indent,n.getLevel(e)))if($s(t)){var r=n.sm();if(r.size()>0){for(var o=n._rows,a=null,s=0,l=o.size();l>s;s++)if(n.isSelected(o.get(s))){a=s;break}var c=null;for(s=o.size()-1;s>=0;s--)if(n.isSelected(o.get(s))){c=s;break}var h,u,d=n.getRowIndex(e);for(a>d?(h=d-1,u=a):d>c?(h=c,u=d):(h=a,u=c);h!==u;)h++,r.as(n._rows.get(h))}else r.ss(e)}else Kv.superClass._33o.call(i,t,e)},handle_keydown:function(t){if(co(t)||uo(t)){var e=this.list,i=e._rows,n=e.isCheckMode(),r=e.sm(),o=n?e.getFocusData():r.ld();o?o.hasChildren()&&(co(t)?e.collapse(o):e.expand(o)):i.size()>0&&(o=i.get(0),n?e.setFocusData(o):r.ss(o))}else Kv.superClass.handle_keydown.call(this,t)}});var $v=Uv.TableView=function(t){this._98I(),this._5o(t),new t_(this)};Wv("TableView",e,{ms_ac:[ee,ie,te,"sortMode",Re,ze,we,Me,Se,Ie,Ce,"sortColumn",Oe,Te,me,be,ye,_e,ve],ms_v:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_45o:1,_47o:1,_sortMode:ke,_editable:!0,_batchEditable:!1,_rowHeight:_s,_rowLineVisible:u.tableViewRowLineVisible,_rowLineColor:u.tableViewRowLineColor,_columnLineVisible:u.tableViewColumnLineVisible,_columnLineColor:u.tableViewColumnLineColor,_scrollBarColor:bs,_scrollBarSize:xs,_autoHideScrollBar:as,_autoMakeVisible:os,_selectBackground:u.tableViewSelectBackground,_labelColor:u.tableViewLabelColor,_labelSelectColor:u.tableViewLabelSelectColor,_labelFont:u.tableViewLabelFont,getCheckColumn:function(){var t=this;if(!t._31o){var e=t._31o=new qv;e.setEditable(!0),e.setWidth(40),e.getValue=t.getCheckColumValue,e.drawCell=t.drawCheckColumnCell}return t._31o},isCheckMode:function(){return this._39o.contains(this._31o)},setCheckMode:function(t){var e=this,i=e._39o,n=e.getCheckColumn();t!==e.isCheckMode()&&(t?i.add(n,0):i.remove(n),e.fp(De,!t,t))},getCheckColumValue:function(t,e,i){return i.isSelected(t)},drawCheckColumnCell:function(t,e,i,n,r,o,a,s,l){As(t,l.getCheckIcon(e),r+a/2,o+s/2,e,l)}});var t_=function(t){Kn(t_,this,[t])};bl(t_,Jv,{_34o:function(t,e){var i=this.list,n=i._31o;if(i.isCellEditable(e,n,t)){var r=i._3Q(n),o=i.lp(t).x;if(r&&o>=r.startX&&o<r.startX+n.getWidth())return void i.checkData(e)}i._37O(e,t),i.setFocusData(e)},_33o:function(t,e){this.list._37O(e,t),t_.superClass._33o.apply(this,arguments)}});var e_=Uv.TreeTableView=function(t){var e=this,i=e._4o=new qv;e._35o(),e._98I(),e._5o(t),i.setDisplayName("Name"),i.setEditable(!0),i.setWidth(180),i.drawCell=i_,i.getValue=n_,e._39o.add(i),new r_(e)},i_=function(t,e,i,n,r,o,a,s,l){l.drawTree(t,e,i,r,o,a,s)},n_=function(t,e,i){return i.getLabel(t)};Wv("TreeTableView",e,{ms_ac:[ee,ie,te,"sortMode",Re,ze,xe,De,"rootData","rootVisible",Oe,Te,"sortColumn",Ee,Pe,me,be,ye,_e,Se,we,Me,Ie,Ce,ve,"loader"],ms_v:1,ms_bnb:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_48o:1,_14Q:1,_45o:1,_47o:1,_sortMode:ke,_checkMode:l,_editable:!0,_batchEditable:!1,_indent:vs,_rowHeight:_s,_rowLineVisible:u.treeTableViewRowLineVisible,_rowLineColor:u.treeTableViewRowLineColor,_columnLineVisible:u.treeTableViewColumnLineVisible,_columnLineColor:u.treeTableViewColumnLineColor,_expandIcon:u.treeTableViewExpandIcon,_collapseIcon:u.treeTableViewCollapseIcon,_scrollBarColor:bs,_scrollBarSize:xs,_autoHideScrollBar:as,_autoMakeVisible:os,_selectBackground:u.treeTableViewSelectBackground,_labelColor:u.treeTableViewLabelColor,_labelSelectColor:u.treeTableViewLabelSelectColor,_labelFont:u.treeTableViewLabelFont,getTreeColumn:function(){return this._4o}});var r_=function(t){Kn(r_,this,[t])};bl(r_,Jv,{_34o:function(t,e){var i=this.list,n=i._4o,r=i._3Q(n),o=i.lp(t).x;if(r){var a=i._indent,s=r.startX+a*i.getLevel(e);if(zs(i.getToggleIcon(e))&&o>=s&&s+a>=o)return void i.toggle(e);if(i.isCellEditable(e,n)&&(s+=a,o>=s&&s+a>=o))return void i.checkData(e)}i._37O(e,t),i.setFocusData(e)},_33o:function(t,e){var i=this.list,n=i.lp(t).x;if(zs(i.getToggleIcon(e))){var r=i._3Q(i._4o);if(r){var o=i._indent,a=r.startX+o*i.getLevel(e);if(n>=a&&a+o>=n)return void i.toggle(e)}}i._37O(e,t),r_.superClass._33o.apply(this,arguments)}});var o_=Uv.TableHeader=function(t){var e=this,i=e._view=mr(1,e),n=e._39o=t.getColumnModel(),r=e.iv;e.tv=e._tableView=t,e._60I=new gc,e._canvas=wr(i),i.style.background=u.tableHeaderBackground||"",i.style.height=ys+It,n.mm(r,e),n.md(r,e),n.mh(r,e),t.mp((function(t){kv[t.property]&&e.iv()}),e),new a_(e),e.iv()};Wv("TableHeader",e,{ms_v:1,ms_lp:1,ms_fire:1,ms_ac:["checkIcon","sortDescIcon","sortAscIcon",ee,te,xe,"moveBackground","insertColor",Ie,Ce,"resizable","movable"],_checkIcon:Ht,_movable:!0,_resizable:!0,_labelColor:u.tableHeaderLabelColor,_labelFont:u.tableHeaderLabelFont,_columnLineColor:u.tableHeaderColumnLineColor,_columnLineVisible:u.tableHeaderColumnLineVisible,_sortDescIcon:u.tableHeaderSortDescIcon,_sortAscIcon:u.tableHeaderSortAscIcon,_moveBackground:u.tableHeaderMoveBackground,_insertColor:u.tableHeaderInsertColor,_indent:vs,getCheckIcon:function(){return this._checkIcon},getTableView:function(){return this.tv},getLabel:function(t){return t.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(t){return t.getColor()||this._labelColor},getLabelAlign:function(t){return t._align},onPropertyChanged:function(){this.iv()},_5Q:function(t){this._61I=t,this.iv()},getLogicalPoint:function(t){return dl(t,this._canvas,this.tv.tx())},validateImpl:function(){var t=this,e=t._canvas,i=t.getWidth(),n=t.getHeight(),r=t.tv,o=t._60I,a=t._61I,s=-r.tx(),l=0;(i!==e.clientWidth||n!==e.clientHeight)&&Ir(e,i,n),o.clear(),t._39o._roots.each((function(t){if(t.isVisible()){var e=l+t.getWidth();s+i>=l&&e>=s&&o.add({column:t,startX:l}),l=e}}));var c=kr(e);if(Ar(c,-s,0,1),c.beginPath(),c.rect(s,0,i,n),c.clip(),c.clearRect(s,0,i,n),o.each((function(e){var i=e.column,r=e.startX,o=i.getWidth();o>0&&(c.save(),c.beginPath(),c.rect(r,0,o,n),c.clip(),a&&a.column===i||t.drawColumn(c,i,r,0,o,n),t._columnLineVisible&&Ao(c,r+o-1,0,1,n,t._columnLineColor),c.restore())})),a){var h=a.column,u=(l=a.startX,a.position),d=h.getWidth();c.save(),c.beginPath(),c.rect(l,0,d,n),c.clip(),c.fillStyle=t._moveBackground,c.fill(),t.drawColumn(c,h,l,0,d,n),c.restore(),hr(c,t._insertColor,u,0,n)}c.restore()},_6Q:function(t){var e=this.tv;return e._31o===t&&e.sm().getSelectionMode()===ut},drawColumn:function(t,e,i,n,r,o){var a=this,s=a.tv,l=zs(e.getIcon()),c=a.getLabelAlign(e);if(a._6Q(e)){var h=zs(a._checkIcon);As(t,h,i+r/2,n+o/2,e,a)}else{var u=a.getLabel(e),d=a.getLabelFont(e),f=a.getLabelColor(e),g=Xs(d,u).width,p=l?a._indent:0;c===gt?(l&&Vs(t,l,ei,i,n,p,o),qs(t,u,d,f,i+p,n,r,o,gt)):c===pt?(l&&Vs(t,l,ei,i+r-g-p,n,p,o),qs(t,u,d,f,i,n,r,o,pt)):(l&&Vs(t,l,ei,i+(r-g-p)/2,n,p,o),qs(t,u,d,f,i+(r-g+p)/2,n,0,o,gt))}if(e.isSortable()&&s.getSortColumn()===e&&(l=zs(e.getSortOrder()===Ae?a._sortAscIcon:a._sortDescIcon))){var v=hc(l,e)/2+2;As(t,l,c===pt?i+v:i+r-v,n+o/2,e,s)}}});var a_=function(t){var e=this;e.th=t,e.tv=t._tableView,e.addListeners()};bl(a_,e,{ms_listener:1,getView:function(){return this.th.getView()},setCursor:function(t){this.getView().style.cursor=t},handle_mousemove:function(t){if(!Xr){var e=this;delete e._29o,e.setCursor(ct);for(var i=e.th,n=i._60I,r=i.lp(t).x,o=n.size()-1;o>=0;o--){var a=n.get(o),s=a.column,l=a.startX+s.getWidth();if(i.isResizable()&&O(l-r)<=(lt?10:3))return e._29o=a,void e.setCursor(di);r>a.startX&&l>r&&(e._29o=a),(s.isClickable()||s.isSortable()||i.isMovable()||e.tv.getCheckColumn&&s===e.tv.getCheckColumn())&&r>a.startX&&l>r&&e.setCursor(gi)}}},handle_mousedown:function(t){this.handle_touchstart(t)},handle_touchstart:function(t){var e=this;Os(t),e.tv.endEditing(),e.handle_mousemove(t),e._29o&&(e.x=el(t).x,e.lx=e.th.lp(t).x,e.w=e._29o.column.getWidth(),gl(e,t))},handleWindowMouseMove:function(t){this.handleWindowTouchMove(t)},handleWindowTouchMove:function(t){var e=this,i=e.th,n=e.getView().style.cursor,r=e._29o,o=el(t).x-e.x;if(e.resizing||e.moving||(n===di?e.resizing=1:i.isMovable()&&n===gi&&O(o)>2&&(e.moving=1)),e.resizing)r.column.setWidth(e.w+o);else if(e.moving){var a=e.lx+o;i._60I.each((function(t){var e=t.startX,n=e+t.column.getWidth();if(a>=e&&n>=a){var s={column:r.column,startX:r.startX+o,front:n-a>a-e,insertColumn:t.column};s.position=s.front?e:n,i._5Q(s)}}))}},_16Q:function(t,e){var i=this,n=i.tv,r=i.th,o=r._checkIcon;if(r._6Q(t)){var a=zs(o),s=i.lx,l=t.getWidth(),c=hc(a,t);if(s>=e+l/2-c&&e+l/2+c>=s){r.setCheckIcon(o===jt?Ht:jt);var h=n.sm(),u=n._rows;return o===jt?h.rs(u):h.ss(u),n.onCheckColumnClicked(t),!0}}return!1},handleWindowMouseUp:function(t){this.handleWindowTouchEnd(t)},handleWindowTouchEnd:function(t){var e=this,i=e.tv,n=e.th,r=e._29o;if(e.moving){var o=n._61I;if(o&&o.insertColumn!==o.column){var a=o.column,s=i.getColumnModel()._roots,c=s.remove(a),h=s.indexOf(o.insertColumn);h>=0&&(o.front||h++,h<=s.size()&&(s.add(a,h),i.getColumnModel()._38I(a,c,h)))}n._5Q(l),delete e.moving}else if(!e.resizing&&r){a=r.column;var u=n.lp(t).x,d=r.startX,f=!0;if(n.onColumnClicked){var g=n.onColumnClicked(a,t,d);!1===g&&(f=!1)}if(f&&u>=d&&u<=d+a.getWidth()&&!e._16Q(a,d)){if(a.isSortable()){var p=i.getSortMode(),v=a.getSortOrder();p===ke?i.getSortColumn()===a?(v===Ve&&i.setSortColumn(l),a.setSortOrder(v===Ae?Ve:Ae)):i.setSortColumn(a):"bistate"===p&&(i.getSortColumn()===a?a.setSortOrder(v===Ae?Ve:Ae):i.setSortColumn(a))}i.onColumnClicked(a,t,d)}}e._29o=e.resizing=e.x=e.lx=e.w=l}}),Uv.TablePane=function(t){this.init(new $v(t))},Wv("TablePane",e,{ms_v:1,_44o:1}),Uv.TreeTablePane=function(t){this.init(new e_(t))},Wv("TreeTablePane",e,{ms_v:1,_44o:1}),Uv.Toolbar=function(t){var e=this,i=e._view=mr(1,e),n=i.style;n.background=u.toolbarBackground||"",n.height=ms+It,e._canvas=wr(i),e._30o=new gc,e._90I=new gc,e.setItems(t||[]),i.handleGroupSelectedChanged=function(t){if(t.isSelected()){var i=t.getGroupId();null!=i&&e._items.forEach((function(e){var n=e.element;n&&n!==t&&n.setSelected&&n.getGroupId&&n.getGroupId()===i&&n.setSelected(!1)}))}},new s_(e)},Wv("Toolbar",e,{ms_v:1,ms_fire:1,ms_tx:1,ms_lp:1,ms_tip:1,ms_value:1,ms_ac:[zt,ee,te,ie,ve,"itemGap","separatorColor","currentItem","stickToRight"],_labelColor:u.toolbarLabelColor,_labelSelectColor:u.toolbarLabelSelectColor,_labelFont:u.toolbarLabelFont,_selectBackground:u.toolbarSelectBackground,_itemGap:u.toolbarItemGap,_separatorColor:u.toolbarSeparatorColor,_stickToRight:!1,getSumWidth:function(){return this._64I},getToolTip:function(t){var e=this.getItemInfoAt(t);return e?e.item.toolTip:l},getLabelColor:function(t){return t&&t.selected&&t.type!==jt&&t.type!==Gt?this._labelSelectColor:this._labelColor},onPropertyChanged:function(t){this.iv(),t.property===zt&&this._items.forEach((function(t){yr(t)}))},redraw:function(){this.iv()},addItem:function(t,e){var i=this._items;e==l?i.push(t):i.splice(e,0,t),this.fp(zt,l,i)},removeItem:function(t){if(t)for(var e=this._items,i=0;i<e.length;i++)t===e[i]&&(e.splice(i,1),this.fp(zt,l,e))},removeItemById:function(t){if(t!=l)for(var e=this._items,i=0;i<e.length;i++)if(t===e[i].id){var n=e.splice(i,1)[0];return this.fp(zt,l,e),n}},getItemById:function(t){if(t!=l)for(var e=this._items,i=0;i<e.length;i++){var n=e[i];if(t===n.id)return n}},setItemVisible:function(t,e){var i=this.getItemById(t);i&&(i.visible=e)},getItemInfos:function(){return this._30o},getItemInfoAt:function(t){var e=this,i=0,n=e._30o,r=e.lp(t),o=r.x,a=r.y;if(a>=0&&a<=e.getHeight())for(;i<n.size();i++){var s=n.get(i);if(s.startX<=o&&o<=s.endX)return s}return l},drawItem:function(t,e,i,n,r){if(!1===e.visible)return 0;if(An(e.visible)&&!e.visible())return 0;var o=this,a=e.disabled;a&&(t.globalAlpha=is);var s=o.drawItemImpl(t,e,i,n,r),l=o._itemGap;return a&&(t.globalAlpha=1),this._currentItem!==e||"separator"===e||!0===e.separator||e.unfocusable||Go(t,o._separatorColor,i-l/2,0,s+l,n),s},drawItemImpl:function(t,e,i,n,r){var o=this,a=o._view,s=o._itemGap,c=n/2,h=e.type,u=e.element,d=e.label;On(u)&&(d=u,u=l);var f,g=o.getLabelFont(e),p=o.getLabelColor(e),v=e.selected,_=zs(e.icon),y=hc(_,e),m=0,b=y+(d?Xs(g,d).width:0);if("separator"===e||!0===e.separator)return hr(t,o._separatorColor,i,n/4,c),1;if(u){_&&As(t,_,i+y/2,c,e,o),qs(t,d,g,p,i+y,0,0,n);var x=Hr(u);r||o._90I.add(x),x.parentNode!==a&&Mr(a,x),u.iv&&u.iv(),u.validate&&u.validate();var w=x.getBoundingClientRect(),C=w.width,S=x.style;return Sr(x),S.left=o.tx()+i+b+It,S.top=(n-w.height)/2+It,b+C}return h===Gt?f=zs(v?Ut:Wt):h===jt&&(f=zs(v?jt:Ht)),f?(m=hc(f,e),As(t,f,i+m/2,c,e,o),i+=m,b+=m):v&&Ao(t,i-s/2,0,b+s,n,o.getSelectBackground(e)),_&&As(t,_,i+y/2,c,e,o),qs(t,d,g,p,i+y,0,0,n),b},validateImpl:function(){var t=this,e=t._canvas,i=t.getWidth(),n=t.getHeight(),r=t._30o,o=t._items;Ir(e,i,n);var a=kr(e),s=t._itemGap,l=s/2;Ar(a,t.tx(),0,1),a.clearRect(0,0,i,n);var c=t._90I;t._90I=new gc,r.clear(),o.forEach((function(e){var i=t.drawItem(a,e,l,n);r.add({item:e,startX:l,endX:l+i,width:i}),i&&(l+=i+s)})),c.each((function(e){t._90I.contains(e)||pl(e)}));var h=t._64I;t._64I=P(0,l),a.restore(),t._stickToRight?(t._65O=0,a=kr(e),l=i-t._64I+s,Ar(a,0,0,1),a.clearRect(0,0,i,n),r.clear(),o.forEach((function(e){var i=t.drawItem(a,e,l,n,!0);r.add({item:e,startX:l,endX:l+i,width:i}),i&&(l+=i+s)})),a.restore()):t.tx(t.tx()),h!==t._64I&&t.onSumWidthChanged(h,t._64I)},onSumWidthChanged:function(){},handleClick:function(t,e){var i=this,n=t.type,r=t.action,o=t.groupId,a=t.selected;t.disabled||(o!=l?a||(t.selected=!0,this._items.forEach((function(e){e.groupId===o&&t!==e&&(e.selected=!1)})),r&&t.action(t,i,e)):n===jt||"toggle"===n?(t.selected=!a,r&&t.action(t,i,e)):r&&t.action(t,i,e)),cs(),i.iv()}});var s_=function(t){this.tb=t,this.addListeners()};bl(s_,e,{ms_listener:1,getView:function(){return this.tb._view},handle_mousewheel:function(t){this.handleScroll(t,t.wheelDelta/40*10)},handle_DOMMouseScroll:function(t){this.handleScroll(t,10*-t.detail)},handleScroll:function(t,e){Os(t);var i=this.tb;i.isScrollable()&&!i._stickToRight&&(i.tx(i.tx()+e),qr())},handle_mousemove:function(t){var e=this;Xr||e.setItem(t)},handle_mouseout:function(t){var e=this;t.target===e.getView()?e.tb.setCurrentItem(l):e.handle_mousemove(t)},handle_mousedown:function(t){this.handle_mousemove(t),this.handle_touchstart(t)},handle_touchstart:function(t){var e=this,i=e.tb,n=t.target;Qs(t)&&(n===e.getView()||n===i._canvas)&&(Os(t),i.setFocus(t)&&(this.setItem(t,!0),(i.isScrollable()||e.info&&!e.info.item.disabled)&&(e.x=el(t).x,e.tx=i.tx(),gl(e,t))))},handleWindowMouseMove:function(t){this.handleWindowTouchMove(t)},handleWindowTouchMove:function(t){var e=this,i=e.tb;if(!i._stickToRight){var n=el(t).x-e.x;!e._25o&&O(n)>2&&i.isScrollable()&&(e._25o=1),e._25o&&i.tx(e.tx+n)}},handleWindowMouseUp:function(t){this.handleWindowTouchEnd(t)},handleWindowTouchEnd:function(t){var e=this,i=e.tb,n=e.info,r=e.tb.getItemInfoAt(t);if(!e._25o&&n){var o=n.item;r&&r.item===o&&i.handleClick(o,t)}e._25o=e.x=e.tx=l,e.setItem()},setItem:function(t,e){var i=this,n=i.tb,r=i.info=t?n.getItemInfoAt(t):l,o=r?r.item:l;n.setCurrentItem(o),e&&o&&An(o.onDown)&&o.onDown(t)}}),Uv.BorderPane=function(){this._view=mr(1,this),this.iv()},Wv("BorderPane",e,{ms_v:1,ms_ac:["topHeight","bottomHeight","leftWidth","rightWidth"],ms_fire:1,getLeftView:function(){return this._leftView},setLeftView:function(t,e){this._12o("leftView",t),e!=l&&this.setLeftWidth(e)},getRightView:function(){return this._rightView},setRightView:function(t,e){this._12o("rightView",t),e!=l&&this.setRightWidth(e)},getTopView:function(){return this._topView},setTopView:function(t,e){this._12o("topView",t),e!=l&&this.setTopHeight(e)},getBottomView:function(){return this._bottomView},setBottomView:function(t,e){this._12o("bottomView",t),e!=l&&this.setBottomHeight(e)},getCenterView:function(){return this._centerView},setCenterView:function(t){this._12o("centerView",t)},_12o:function(t,e){var i=this,n="_"+t,r=i._view,o=i[n];o!==e&&(o&&(o.getView?pl(o.getView()):pl(o)),i[n]=e,e&&(e.getView?Mr(r,e.getView(),1):Mr(r,e,1)),i.fp(t,o,e))},onPropertyChanged:function(){this.iv()},validateImpl:function(){var t=this,e=t._topView,i=t._bottomView,n=t._leftView,r=t._rightView,o=t._centerView,a=t.getWidth(),s=t.getHeight(),c=0,h=0,u=a,d=s,f=0,g=0,p=0,v=0;e&&(f=t._topHeight==l?Or(e):t._topHeight,h=f),i&&(g=t._bottomHeight==l?Or(i):t._bottomHeight,d=s-g),n&&(p=t._leftWidth==l?Dr(n):t._leftWidth,c=p),r&&(v=t._rightWidth==l?Dr(r):t._rightWidth,u=a-v);var _=P(0,u-c),y=P(0,d-h);e&&Gr(e,0,0,a,f),i&&Gr(i,0,d,a,g),n&&Gr(n,0,h,p,y),r&&Gr(r,u,h,v,y),o&&Gr(o,c,h,_,y)}})}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);