!function(Z,q){"use strict";var w="ht",a=w+".layout.",F=Z[w]||module.parent.exports.ht,N=F.List,K=F.DataModel,z=F.Node,n=F.Edge,A=F.Group,h=Math,Y=h.sqrt,R=h.random,o=h.max,E=h.min,b=function(a){return a*a};F.Default.getInternal().addMSMap({ms_force:function(v){v._interval=50,v._stepCount=10,v._motionLimit=.01,v._edgeRepulsion=.65,v._nodeRepulsion=.65,v._damper=1,v._maxMotion=0,v._motionRatio=0,v.init=function(p){var E=this;p instanceof K?E.dm=p:E.gv=p,E._nodeMap={},E._nodes=new N,E._edges=new N},v.start=function(){var h=this,o=h.gv;if(!h._timer){var A=h.cdm=o?o.dm():h.dm;A.mm(h.handleDataModelChange,h),A.md(h.handleDataPropertyChange,h),o&&o.mp(h.handleGV,h),A.each(function(l){if(h.isVisible(l)&&h.isLayoutable(l)&&l instanceof z)if(h instanceof g){var q=l.p3();l.p3([q[0]+R(),q[1]+R(),q[2]+R()])}else q=l.p(),l.p(q.x+R(),q.y+R())}),h._timer=setInterval(function(){h.relax()},h._interval),h._damper=1}},v.stop=function(){var W=this;W._timer&&(W.cdm.umm(W.handleDataModelChange,W),W.cdm.umd(W.handleDataPropertyChange,W),W.gv&&W.gv.ump(W.handleGV,W),clearInterval(W._timer),delete W._timer,delete W.cdm)},v.handleGV=function(D){var c=this;if("dataModel"===D.property){var W=D.oldValue,r=D.newValue;W&&(W.umm(c.handleDataModelChange,c),W.umd(c.handleDataPropertyChange,c)),this.cdm=r,r.mm(c.handleDataModelChange,c),r.md(c.handleDataPropertyChange,c)}},v.relax=function(){var o=this;if(!(o._damper<.1&&o._maxMotion<o._motionLimit)){this.cdm.each(function(M){o.isVisible(M)&&(M instanceof n?o.addEdge(M):M instanceof z&&o.addNode(M))});for(var J,l,$=0,C=o._edges,c=o._nodes,w=c.size();$<o._stepCount;$++){for(C.each(o.relaxEdge,o),J=0;w>J;J++)for(l=0;w>l;l++)o.relaxNode(c.get(J),c.get(l));o.moveNode()}o._isAdjusting=1,c.each(function(e){e.fix||(e.p?e.v.p3(e.p):e.v.p(e.x,e.y))}),delete o._isAdjusting,o._nodeMap={},c.clear(),C.clear(),o.onRelaxed()}},v.onRelaxed=function(){},v.isRunning=function(){return!!this._timer},v.isVisible=function($){return $.s("layoutable")===!1?!1:this.gv?this.gv.isVisible($):!0},v.isLayoutable=function(s){if(s.s("layoutable")===!1)return!1;if(s instanceof A)return!1;var I=this;return I.gv?I.gv.isMovable(s)&&!I.gv.isSelected(s):!(I.cdm||I.dm).sm().co(s)},v.getNodeRepulsion=function(){return this._nodeRepulsion},v.setNodeRepulsion=function(r){this._nodeRepulsion=r,this._damper=1},v.getEdgeRepulsion=function(){return this._edgeRepulsion},v.setEdgeRepulsion=function(i){this._edgeRepulsion=i,this._damper=1},v.getStepCount=function(){return this._stepCount},v.setStepCount=function(K){this._stepCount=K,this._damper=1},v.getInterval=function(){return this._interval},v.setInterval=function($){var j=this;j._interval!==$&&(j._interval=$,j._timer&&(clearInterval(j._timer),j._timer=setInterval(function(){j.relax()},$)))},v.handleDataPropertyChange=function(R){!this._isAdjusting&&this.isVisible(R.data)&&(this._damper=1)},v.handleDataModelChange=function(){this._damper=1},v.damp=function(){var I=this._maxMotion,_=this._damper;this._motionRatio<=.001&&((.2>I||I>1&&.9>_)&&_>.01?this._damper-=.01:.4>I&&_>.003?this._damper-=.003:_>1e-4&&(this._damper-=1e-4)),I<this._motionLimit&&(this._damper=0)}}}),F.layout.ForceLayout=function(t){this.init(t)},F.Default.def(a+"ForceLayout",q,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(s){this._limitBounds=s,this._damper=1},getNodeSize:function(L){var p=this.gv;return p&&p.getDataUIBounds?p.getDataUIBounds(L):L.getRect()},addNode:function(H){var m=this,M=m._nodeMap[H._id];if(M)return M;var q=H.p();M={v:H,x:q.x,y:q.y,dx:0,dy:0,fix:!m.isLayoutable(H),s:m.getNodeSize(H)};var C=M.s,h=Y(b(C.width)+b(C.height))*m._nodeRepulsion;return M.r=1>h?100:h,m._nodeMap[H._id]=M,m._nodes.add(M),M},addEdge:function(C){if(C._40I&&C._41I){var X=this,m=X.addNode(C._40I),f=X.addNode(C._41I),w={s:m,t:f};f=f.s,m=m.s;var r=f.width+m.width,v=f.height+m.height;w.length=Y(r*r+v*v)*X._edgeRepulsion,w.length<=0&&(w.length=100),X._edges.add(w)}},relaxEdge:function(A){var a=A.t,m=A.s,L=a.x-m.x,B=a.y-m.y,c=Y(L*L+B*B),T=100*A.length,s=.25*L/T*c,p=.25*B/T*c;a.dx=a.dx-s,a.dy=a.dy-p,m.dx=m.dx+s,m.dy=m.dy+p},relaxNode:function(j,P){if(j!==P){var U=0,o=0,N=j.x-P.x,D=j.y-P.y,A=N*N+D*D;0===A?(U=R(),o=R()):36e4>A&&(U=N/A,o=D/A);var f=j.r*P.r/400;U*=f,o*=f,j.dx+=U,j.dy+=o,P.dx-=U,P.dy-=o}},moveNode:function(){var r=this,Z=r._limitBounds,l=r._maxMotion,Q=0,u=r._damper;r._nodes.each(function(g){if(!g.fix){var $=g.dx*u,q=g.dy*u;if(g.dx=$/2,g.dy=q/2,Q=o(Y($*$+q*q),Q),g.x+=o(-40,E(40,$)),g.y+=o(-40,E(40,q)),Z){g.x<Z.x&&(g.x=Z.x,r.adjust(1,0)),g.y<Z.y&&(g.y=Z.y,r.adjust(0,1));var d=g.s;g.x+d.width>Z.x+Z.width&&(g.x=Z.x+Z.width-d.width,r.adjust(-1,0)),g.y+d.height>Z.y+Z.height&&(g.y=Z.y+Z.height-d.height,r.adjust(0,-1))}}}),r._maxMotion=Q,r._motionRatio=Q>0?l/Q-1:0,r.damp()},adjust:function(k,a){var Q=this._limitBounds;this._nodes.each(function(Z){k>0?(!Q||Z.x+Z.s.width+k<Q.x+Q.width)&&(Z.x+=k):(!Q||Z.x+k>Q.x)&&(Z.x+=k),a>0?(!Q||Z.y+Z.s.height+a<Q.y+Q.height)&&(Z.y+=a):(!Q||Z.y+a>Q.y)&&(Z.y+=a)})}});var g=F.layout.Force3dLayout=function(u){this.init(u)};F.Default.def(a+"Force3dLayout",q,{ms_force:1,getNodeSize3d:function(a){return a.s3()},addNode:function(Y){var a=this,r=a._nodeMap[Y._id];if(r)return r;r={v:Y,p:Y.p3(),d:[0,0,0],fix:!a.isLayoutable(Y),s:a.getNodeSize3d(Y)};var K=r.s,C=F.Default.getDistance(K)*a._nodeRepulsion;return r.r=1>C?100:C,a._nodeMap[Y._id]=r,a._nodes.add(r),r},addEdge:function(R){if(R._40I&&R._41I){var O=this,J=O.addNode(R._40I),B=O.addNode(R._41I),r={s:J,t:B};B=B.s,J=J.s,r.length=Y(b(B[0]+J[0])+b(B[1]+J[1])+b(B[2]+J[2]))*O._edgeRepulsion,r.length<=0&&(r.length=100),O._edges.add(r)}},relaxEdge:function(l){var v=l.t.p,i=l.s.p,Q=l.t.d,k=l.s.d,u=v[0]-i[0],q=v[1]-i[1],w=v[2]-i[2],P=Y(u*u+q*q+w*w),C=100*l.length,X=.25*u/C*P,I=.25*q/C*P,c=.25*w/C*P;Q[0]-=X,Q[1]-=I,Q[2]-=c,k[0]+=X,k[1]+=I,k[2]+=c},relaxNode:function(x,w){if(x!==w){var h=x.p,n=w.p,c=0,u=0,V=0,b=h[0]-n[0],G=h[1]-n[1],d=h[2]-n[2],$=b*b+G*G+d*d;0===$?(c=R(),u=R(),V=R()):216e6>$&&(c=b/$,u=G/$,V=d/$);var M=x.r*w.r/400,t=x.d,H=w.d;c*=M,u*=M,V*=M,t[0]+=c,t[1]+=u,t[2]+=V,H[0]-=c,H[1]-=u,H[2]-=V}},moveNode:function(){var H=this,e=H._maxMotion,P=0,I=H._damper;H._nodes.each(function(y){if(!y.fix){var p=y.p,O=y.d,v=O[0]*I,k=O[1]*I,N=O[2]*I;O[0]=v/2,O[1]=k/2,O[2]=N/2,P=o(Y(v*v+k*k+N*N),P),p[0]+=o(-40,E(40,v)),p[1]+=o(-40,E(40,k)),p[2]+=o(-40,E(40,N))}}),H._maxMotion=P,H._motionRatio=P>0?e/P-1:0,H.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);